import{s as t}from"../components/components-admin.CiIAoamg.js";import{b as e,s as i}from"./utils-webhook.ts.CrLxl67R.js";async function r(r,a,s){const n=crypto.randomUUID();let o=s;if(!s||0===Object.keys(s).length)try{const{data:e,error:i}=await t.from("profiles").select("*").eq("id",a.id).single();!i&&e&&(o=e)}catch(y){}const c=r.stopoverCities||[],d={language:o?.language||"",disabilities:Array.isArray(o?.disabilities)?o.disabilities:[],medical_conditions:Array.isArray(o?.medical_conditions)?o.medical_conditions:[],allergies:Array.isArray(o?.allergies)?o.allergies:[],lgbtq_status:Array.isArray(o?.lgbtq_status)?o.lgbtq_status:[],dietary_preferences:Array.isArray(o?.dietary_preferences)?o.dietary_preferences:[],email:a.email,first_name:o?.first_name||"",last_name:o?.last_name||"",birth_date:o?.birth_date||null,residence_location:o?.residence_location||""},l={id:n,user_id:a.id,trip_id:n,title:r.title||"",description:r.description||"",location:r.startingCity||r.location||"",coordinates:r.startingCityCoordinates?JSON.stringify(r.startingCityCoordinates):null,profile_data:d,trip_type:"ZapRoad",starting_city:r.startingCity||"",starting_city_coordinates:r.startingCityCoordinates?JSON.stringify(r.startingCityCoordinates):null,stopover_cities:c.length>0?JSON.stringify(c.map((t=>({name:t.name,coordinates:JSON.stringify(t.coordinates)})))):"[]",end_city:r.endCity||"",end_city_coordinates:r.endCityCoordinates?JSON.stringify(r.endCityCoordinates):null,number_of_people:r.numberOfPeople||1,adults:r.adults||1,kids:r.kids||0,has_electric_car:!0===r.hasElectricCar||!0===r.has_electric_car,car_type:r.carType||r.car_type||"",interests:Array.isArray(r.interests)?r.interests:[],has_pets:!0===r.hasPets||!0===r.has_pets,notes:r.notes||"",start_date:r.startDate?r.startDate.toISOString():null,end_date:r.endDate?r.endDate.toISOString():null,special_requirements:r.specialRequirements||"",budget:r.budget?parseFloat(r.budget):0,currency:r.currency||"CAD",category:r.category||""};try{const{data:r,error:s}=await t.from("zaproad_data").insert(l).select();if(s)throw s;if(await new Promise((t=>setTimeout(t,1e3))),r&&r.length>0){const t=e({...r[0],email:a.email,trip_type:"zaproad"});await i(t)}return r}catch(y){throw y}}export{r as c};
//# sourceMappingURL=utils-zaproadcreation.ts.Sn3TFOx8.js.map
