import{s as t}from"../components/components-admin.CiIAoamg.js";import{a as e,s as i}from"./utils-webhook.ts.CrLxl67R.js";async function a(a,r,s){const o=crypto.randomUUID();let n=s;if(!s||0===Object.keys(s).length)try{const{data:e,error:i}=await t.from("profiles").select("*").eq("id",r.id).single();!i&&e&&(n=e)}catch(_){}const c=Array.isArray(a.activityTimes)?a.activityTimes:[],d=Array.isArray(a.activityTypes)?a.activityTypes:[],l=Array.isArray(a.requestedActivities)?a.requestedActivities:[],y=(a.includeLunch,!0===a.includeBudgetPerPerson),m=a.startDate?new Date(a.startDate).toISOString():null,u={language:n?.language||"",disabilities:Array.isArray(n?.disabilities)?n.disabilities:[],medical_conditions:Array.isArray(n?.medical_conditions)?n.medical_conditions:[],allergies:Array.isArray(n?.allergies)?n.allergies:[],lgbtq_status:Array.isArray(n?.lgbtq_status)?n.lgbtq_status:[],dietary_preferences:Array.isArray(n?.dietary_preferences)?n.dietary_preferences:[],email:r.email,first_name:n?.first_name||"",last_name:n?.last_name||"",birth_date:n?.birth_date||null,residence_location:n?.residence_location||""},p={id:o,user_id:r.id,trip_id:o,title:a.title||"",description:a.description||"",location:a.location||"",coordinates:a.coordinates?JSON.stringify(a.coordinates):null,adults:a.adults||1,kids:a.kids||0,profile_data:u,trip_type:"ZapOut",activity_times:c,activity_types:d,requested_activities:l,additional_needs:a.additionalNeeds||null,date:m,min_budget:a.minBudget||"0",max_budget:a.maxBudget||"500",currency:a.currency||"USD",...y&&{budget_per_person:a.budgetPerPerson||""},...a.category&&{category:a.category},...a.budget&&{budget:a.budget},...a.transportationMode&&{transportation_mode:a.transportationMode},...a.transportationDetails&&{transportation_details:a.transportationDetails},...a.accommodationType&&{accommodation_type:a.accommodationType},...a.accommodationDetails&&{accommodation_details:a.accommodationDetails}};try{const{data:a,error:s}=await t.from("zapout_data").insert(p).select();if(s)throw s;if(await new Promise((t=>setTimeout(t,1e3))),a&&a.length>0){const t=e({...a[0],email:r.email,trip_type:"zapout"});await i(t)}return a}catch(_){throw _}}export{a as c};
//# sourceMappingURL=utils-zapoutcreation.ts.BIyobya6.js.map
