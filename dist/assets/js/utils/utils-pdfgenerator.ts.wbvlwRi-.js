import{E as e}from"../vendor/vendor--jspdf.DSIHBPwe.js";import{a as t}from"./utils-mapboxutils.ts.6FvsIj9k.js";const n={primary:"#1d1d1e",secondary:"#62626a",accent:"#61936f",background:"#fcfcfc",link:"#3b82f6"},a={title:20,subtitle:16,heading:14,normal:11,small:9},i={margin:20,lineHeight:7},r=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),o=e=>e?e.replace(/^[Ø=Üí]+\s*/g,"").replace(/[^\x20-\x7E]/g,"").replace(/\s+/g," ").replace(/[`*_~]/g,"").replace(/\[(.*?)\]\(.*?\)/g,"$1").replace(/!\[.*?\]\(.*?\)/g,"").replace(/\\[a-z]+\{.*?\}/g,"").replace(/\u{1F4CD}/gu,"").replace(/&[a-z]+;/g,"").trim():"",s=(e,t,r)=>{const o=e.internal.pageSize.width;return e.setDrawColor(n.accent),e.setLineWidth(.5),e.line(i.margin,10,o-i.margin,10),e.setFontSize(a.small),e.setTextColor(n.secondary),e.text(`Page ${t} of ${r}`,o-i.margin,15,{align:"right"}),25},l=e=>{const t=e.internal.pageSize.width,r=e.internal.pageSize.height;e.setDrawColor(n.accent),e.setLineWidth(.5),e.line(i.margin,r-15,t-i.margin,r-15),e.setFontSize(a.small),e.setTextColor(n.secondary);const o=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});e.text(`Generated by ZapAround on ${o}`,i.margin,r-10)},g=(e,t,r)=>{const o=e.internal.pageSize.width;return e.setFillColor(n.background),e.setDrawColor(n.accent),e.setLineWidth(.5),e.rect(i.margin-5,r-5,o-2*i.margin+10,12,"F"),e.line(i.margin-5,r+7,o-i.margin+5,r+7),e.setFontSize(a.subtitle),e.setTextColor(n.primary),e.setFont("helvetica","bold"),e.text(t,i.margin,r+4),r+15},c=async e=>{try{const n=e.map(((e,t)=>`pin-s-${t+1}+1d1d1e(${e.coordinates[0]},${e.coordinates[1]})`)).join(","),a=e.map((e=>e.coordinates[0])),i=e.map((e=>e.coordinates[1])),r=[(Math.min(...a)+Math.max(...a))/2,(Math.min(...i)+Math.max(...i))/2];return await t(r,6,800,400,"mapbox://styles/mapbox/streets-v11",n)}catch(n){return""}},d=async t=>{const d=new e({orientation:"portrait",unit:"mm",format:"a4"});if(await(async(e,t)=>{const o=e.internal.pageSize.width,s=e.internal.pageSize.height;let l=40;try{const t=await fetch("https://zaparound.com/logo.png").then((e=>e.blob())),n=URL.createObjectURL(t),a=60,i=20,r=(o-a)/2;e.addImage(n,"PNG",r,l,a,i),l+=i+20}catch(g){e.setFontSize(32),e.setTextColor(n.primary),e.setFont("helvetica","bold"),e.text("ZapAround",o/2,l,{align:"center"}),l+=20}if(e.setFontSize(a.subtitle),e.setTextColor(n.secondary),e.setFont("helvetica","normal"),e.text("Travel Itinerary",o/2,l,{align:"center"}),l+=40,e.setFontSize(24),e.setTextColor(n.primary),e.setFont("helvetica","bold"),e.text(t.title,o/2,l,{align:"center"}),t.description){l+=20,e.setFontSize(a.normal),e.setTextColor(n.secondary),e.setFont("helvetica","normal");const r=e.splitTextToSize(t.description,o-4*i.margin);e.text(r,o/2,l,{align:"center"})}if(t.startDate||t.endDate){l+=40,e.setFontSize(a.normal),e.setTextColor(n.primary),e.setFont("helvetica","bold");const i=t.startDate&&t.endDate?`${r(t.startDate)} - ${r(t.endDate)}`:t.startDate?r(t.startDate):r(t.endDate);e.text(i,o/2,l,{align:"center"})}l=s-80,e.setDrawColor(n.accent),e.setLineWidth(1),e.line(i.margin,l,o-i.margin,l)})(d,t),t.geopositions.length>0&&(d.addPage(),await(async(e,t)=>{let n=s(e,2,e.internal.getNumberOfPages());n=g(e,"Trip Overview Map",n),n+=10;const a=await c(t),r=await fetch(a).then((e=>e.blob())),o=URL.createObjectURL(r);e.addImage(o,"PNG",i.margin,n,e.internal.pageSize.width-2*i.margin,120),l(e)})(d,t.geopositions)),t.geopositions.length>0&&(d.addPage(),((e,t)=>{let r=s(e,e.internal.getCurrentPageInfo().pageNumber,e.internal.getNumberOfPages());r=g(e,"Stops and Points",r),r+=10;const c=(e.internal.pageSize.width-2*i.margin-20)/3,d=Math.floor((e.internal.pageSize.height-70)/45);t.forEach(((t,m)=>{const p=m%3,h=Math.floor(m%(3*d)/3);m>0&&m%(3*d)==0&&(l(e),e.addPage(),r=s(e,e.internal.getCurrentPageInfo().pageNumber,e.internal.getNumberOfPages()),r=g(e,"Stops and Points (Continued)",r),r+=10);const u=i.margin+p*(c+10),b=r+45*h;e.setFillColor(n.background),e.setDrawColor(n.accent),e.setLineWidth(.2),e.roundedRect(u,b,c,37,2,2,"FD"),e.setFontSize(a.normal),e.setTextColor(n.primary),e.setFont("helvetica","bold");const x=`${m+1}. ${o(t.name)}`,S=e.splitTextToSize(x,c-10),f=S.length>1?12:6;e.text(S,u+5,b+6);let F=b+f+6;if(t.description){e.setTextColor(n.secondary),e.setFontSize(a.small),e.setFont("helvetica","normal");const i=e.splitTextToSize(o(t.description),c-10);i.length>2&&(i.length=2,i[1]=i[1].substring(0,i[1].length-3)+"..."),e.text(i,u+5,F),F+=5*i.length+2}e.setTextColor(n.secondary),e.setFontSize(a.small),e.setFont("helvetica","normal");const z=t.Adresse?o(t.Adresse):`${t.coordinates[1].toFixed(4)}, ${t.coordinates[0].toFixed(4)}`,C=e.splitTextToSize(z,c-10);C.length>2&&(C.length=2,C[1]=C[1].substring(0,C[1].length-3)+"..."),e.text(C,u+5,F)})),l(e)})(d,t.geopositions)),t.ai_content&&(d.addPage(),((e,t)=>{let r=s(e,e.internal.getCurrentPageInfo().pageNumber,e.internal.getNumberOfPages());r=g(e,"Travel Tips & AI Insights",r),r+=10;const c=e.internal.pageSize.width-2*i.margin;t.replace(/```[^`]*```/g,"").split(/(?=# )/g).forEach(((t,g)=>{g>0&&(l(e),e.addPage(),r=s(e,e.internal.getCurrentPageInfo().pageNumber,e.internal.getNumberOfPages())),t.split("\n").forEach((t=>{t.trim()&&(r>e.internal.pageSize.height-30&&(l(e),e.addPage(),r=s(e,e.internal.getCurrentPageInfo().pageNumber,e.internal.getNumberOfPages())),t.startsWith("# ")?(e.setFontSize(a.title),e.setTextColor(n.primary),e.setFont("helvetica","bold"),t=t.substring(2)):t.startsWith("## ")?(e.setFontSize(a.subtitle),e.setTextColor(n.primary),e.setFont("helvetica","bold"),t=t.substring(3)):t.startsWith("### ")?(e.setFontSize(a.heading),e.setTextColor(n.primary),e.setFont("helvetica","bold"),t=t.substring(4)):(e.setFontSize(a.normal),e.setTextColor(n.secondary),e.setFont("helvetica","normal")),e.splitTextToSize(o(t),c).forEach((t=>{t.trim()&&(e.text(t,i.margin,r),r+=i.lineHeight)})),r+=3)}))})),l(e)})(d,t.ai_content)),t.geopositions.length>0){d.addPage();let e=s(d,d.internal.getCurrentPageInfo().pageNumber,d.internal.getNumberOfPages());e=g(d,"Navigation",e),e+=20;const r=(e=>{if(0===e.length)return"";const t=e[0],n=e[e.length-1],a=e.slice(1,-1);let i="https://www.google.com/maps/dir/?api=1";i+=`&origin=${t.coordinates[1]},${t.coordinates[0]}`,i+=`&destination=${n.coordinates[1]},${n.coordinates[0]}`,a.length>0&&(i+=`&waypoints=${a.map((e=>`${e.coordinates[1]},${e.coordinates[0]}`)).join("|")}`);return i+="&travelmode=driving",i})(t.geopositions);d.setTextColor(n.link),d.setFontSize(a.normal),d.setFont("helvetica","normal"),d.textWithLink("Open Route in Google Maps",i.margin,e,{url:r}),l(d)}d.save(`zaparound-trip-${t.title.toLowerCase().replace(/\s+/g,"-")}.pdf`)};export{d as g};
//# sourceMappingURL=utils-pdfgenerator.ts.wbvlwRi-.js.map
