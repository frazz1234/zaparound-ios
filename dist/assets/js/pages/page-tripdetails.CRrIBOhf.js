import{r as e,j as t}from"../vendor/vendor-react-core.D1hcyiwY.js";import{s}from"../components/components-admin.CiIAoamg.js";import{T as r}from"../components/components-tripmap.tsx.B4l0_mxI.js";import{u as o}from"../hooks/hooks-use-toast.ts.Dg8obzHg.js";import{E as i,T as a,a as n,b as d,c as l,d as c,e as m,f as p,g as h}from"../components/components-trip-details.pqq_6ZMJ.js";import{g as u}from"../utils/utils-pdfgenerator.ts.wbvlwRi-.js";import{I as v,B as x,aY as g,z as j,a2 as f,L as y}from"../components/components-ui.C8hnNhgu.js";import{l as b}from"../vendor/vendor--lodash.D80NHDHN.js";import{u as w}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{A as k,m as N}from"../vendor/vendor--framer-motion.Dpgjd5L1.js";import{$ as _,w as S,aA as C,bj as z,T as L}from"../vendor/vendor--lucide-react.DRw9PYsu.js";import{a as I,b as O,u as E}from"../vendor/vendor--react-router.Gdfmkz0l.js";import"../vendor/vendor--cookie.D-6orQ43.js";import"../vendor/vendor--react-hook-form.C68mK_Ba.js";import"../vendor/vendor---hookform-resolvers.CwYzTTZs.js";import"../vendor/vendor--zod.Cebk8UiH.js";import"../vendor/vendor-supabase-client.BJD0U0P8.js";import"../vendor/vendor-supabase-other.BhmW1H_P.js";import"../components/components-mobilenavigation.tsx.DtMtI5i3.js";import"../components/components-languagerouter.tsx.CHVsY7fH.js";import"../vendor/vendor--i18next.CHTa0CEF.js";import"../vendor/vendor--i18next-browser-languagedetector.h4x3AYwK.js";import"../vendor/vendor--i18next-http-backend.DjHzioAf.js";import"../hooks/hooks-useuserrole.ts.BKHSjdY6.js";import"../components/components-languageselector.tsx.x8buceJ0.js";import"../components/components-navigation.CB-8LlfF.js";import"../components/components-theme-toggle.tsx.CfzjOSrj.js";import"../components/components-theme-provider.tsx.Cd7zUHTE.js";import"../components/components-blog.C3TFiFB1.js";import"../utils/utils-blogutils.ts.CpQs8y27.js";import"../utils/utils-cache.ts.BtmNadnX.js";import"../vendor/vendor--lru-cache.CYB7PIxo.js";import"../components/components-optimizedimage.tsx.DVN-Ynzu.js";import"../vendor/vendor--date-fns.BbAlDtqN.js";import"../hooks/hooks-useblogs.ts.B-jKAetY.js";import"../vendor/vendor-query-main.DFU6mXji.js";import"../vendor/vendor---tanstack-query-core.CIZi0Zbo.js";import"../vendor/vendor-ui-utils.CjDQ2U02.js";import"../vendor/vendor--react-markdown.C_e4o-CH.js";import"../vendor/vendor--devlop.Cl3hj7Sz.js";import"../vendor/vendor--unified.ti5-l0IV.js";import"../vendor/vendor--bail.gCPcOVbC.js";import"../vendor/vendor--extend.BFvm699q.js";import"../vendor/vendor--is-plain-obj.DeEdtHJQ.js";import"../vendor/vendor--trough.zzWXwSIo.js";import"../vendor/vendor--vfile.Cn6Vy3Ir.js";import"../vendor/vendor--vfile-message.Re42m5o3.js";import"../vendor/vendor--unist-util-stringify-position.CvSG9YTx.js";import"../vendor/vendor--remark-parse.DdoJrvcY.js";import"../vendor/vendor--mdast-util-from-markdown.DI8nvaYJ.js";import"../vendor/vendor--micromark-util-decode-numeric-character-reference.DA7xEauU.js";import"../vendor/vendor--micromark-util-decode-string.BCF2SQ7o.js";import"../vendor/vendor--decode-named-character-reference.C-EXV6yX.js";import"../vendor/vendor--micromark-util-normalize-identifier.CzKtq1sx.js";import"../vendor/vendor--micromark.aJPyxAJv.js";import"../vendor/vendor--micromark-util-combine-extensions.CQDa_SAq.js";import"../vendor/vendor--micromark-util-chunked.3k3e5hER.js";import"../vendor/vendor--micromark-factory-space.CZc9TqN4.js";import"../vendor/vendor--micromark-util-character.DUwsRT9L.js";import"../vendor/vendor--micromark-core-commonmark.yO25BTZZ.js";import"../vendor/vendor--micromark-util-classify-character.x6FlXUUS.js";import"../vendor/vendor--micromark-util-resolve-all.U8fstr8o.js";import"../vendor/vendor--micromark-util-subtokenize.BfHYzAYP.js";import"../vendor/vendor--micromark-factory-destination.pZKs7oL9.js";import"../vendor/vendor--micromark-factory-label.BbusvwMx.js";import"../vendor/vendor--micromark-factory-title.BBtcOUHM.js";import"../vendor/vendor--micromark-factory-whitespace.BhZ6YKME.js";import"../vendor/vendor--micromark-util-html-tag-name.DbKNfynz.js";import"../vendor/vendor--mdast-util-to-string.Ck87fAyN.js";import"../vendor/vendor--remark-rehype.B9Xnklpv.js";import"../vendor/vendor--mdast-util-to-hast.C2F2cLDR.js";import"../vendor/vendor---ungap-structured-clone.DadG6O39.js";import"../vendor/vendor--micromark-util-sanitize-uri.BXHzaaAi.js";import"../vendor/vendor--unist-util-position.CVUg9P9R.js";import"../vendor/vendor--trim-lines.C03Dth7Y.js";import"../vendor/vendor--unist-util-visit.41WSH7so.js";import"../vendor/vendor--unist-util-visit-parents.DAGCrDnu.js";import"../vendor/vendor--unist-util-is.C5Jwnfs7.js";import"../vendor/vendor--hast-util-to-jsx-runtime.BOWXXjuU.js";import"../vendor/vendor--comma-separated-tokens.DIu3lqJt.js";import"../vendor/vendor--property-information.Dc64tFtG.js";import"../vendor/vendor--space-separated-tokens.C97BfSlU.js";import"../vendor/vendor--style-to-js.DQsO4XA8.js";import"../vendor/vendor--style-to-object.DGZeIPGP.js";import"../vendor/vendor--inline-style-parser.BFz9PO4J.js";import"../vendor/vendor--hast-util-whitespace.DlJMGLAz.js";import"../vendor/vendor--estree-util-is-identifier-name.0h9-8Xae.js";import"../vendor/vendor--html-url-attributes.BA_i5Yxb.js";import"../vendor/vendor--react-helmet-async.BMUx00aU.js";import"../vendor/vendor--react-fast-compare.4d-J074I.js";import"../vendor/vendor--invariant.D6mx6rc7.js";import"../vendor/vendor--shallowequal.BwnEDCFe.js";import"../vendor/vendor--web-vitals.C1BoAgs7.js";import"../vendor/vendor-supabase-realtime.PMyDaGD3.js";import"../vendor/vendor--sonner.ECaEf7Ie.js";import"../vendor/vendor-react-dom.BnDkh-2X.js";import"../vendor/vendor-react-scheduler.B5Ht9ZB3.js";import"../hooks/hooks-useadminauth.ts.BJ7uhFTt.js";import"../vendor/vendor--mapbox-gl.CIg18VY7.js";import"../vendor/vendor--remark-gfm.CpBcol-m.js";import"../vendor/vendor--micromark-extension-gfm.Dl_vc4ln.js";import"../vendor/vendor--micromark-extension-gfm-autolink-literal.-G0bnZtf.js";import"../vendor/vendor--micromark-extension-gfm-footnote.Di_4tubf.js";import"../vendor/vendor--micromark-extension-gfm-strikethrough.BxlEkCeJ.js";import"../vendor/vendor--micromark-extension-gfm-table.DxDdzEf_.js";import"../vendor/vendor--micromark-extension-gfm-task-list-item.B_TzjndW.js";import"../vendor/vendor--mdast-util-gfm.Bmj8_opG.js";import"../vendor/vendor--mdast-util-gfm-autolink-literal.CzFbhFxs.js";import"../vendor/vendor--ccount.D181NsKZ.js";import"../vendor/vendor--mdast-util-find-and-replace.2NNR_zk8.js";import"../vendor/vendor--mdast-util-gfm-footnote.e5vq7Xl8.js";import"../vendor/vendor--mdast-util-gfm-strikethrough.CppM9lzQ.js";import"../vendor/vendor--mdast-util-gfm-table.B2qxGisx.js";import"../vendor/vendor--markdown-table.BkNFvfyU.js";import"../vendor/vendor--mdast-util-to-markdown.DByij97Q.js";import"../vendor/vendor--longest-streak.2qYzcRvv.js";import"../vendor/vendor--mdast-util-phrasing.B-hQ8TRi.js";import"../vendor/vendor--mdast-util-gfm-task-list-item.DlkyJv2w.js";import"../hooks/hooks-useoptimizedqueries.ts.PW6zh7FL.js";import"../components/components-trips.Ce9sOLST.js";import"../components/components-community.DdS-HWu3.js";import"../utils/utils-placeutils.ts.vo-R8UHO.js";import"../vendor/vendor--jspdf.DSIHBPwe.js";import"../vendor/vendor---babel-runtime.29jaxZcp.js";import"../vendor/vendor--fflate.K-dupnmX.js";import"../utils/utils-mapboxutils.ts.6FvsIj9k.js";import"../vendor/vendor-ui-toast.CyvsGWN1.js";import"../vendor/vendor-ui-core.CPnW5LH0.js";import"../vendor/vendor--aria-hidden.BHUiN-rI.js";import"../vendor/vendor--react-remove-scroll.DR6iVcCg.js";import"../vendor/vendor--tslib.Bc9CN1Ef.js";import"../vendor/vendor--react-remove-scroll-bar.Dz-JErv0.js";import"../vendor/vendor--react-style-singleton.ER5nEGYx.js";import"../vendor/vendor--get-nonce.BYiZHLe3.js";import"../vendor/vendor--use-sidecar.svB0tWl8.js";import"../vendor/vendor--use-callback-ref.Dt9orvWx.js";import"../vendor/vendor---floating-ui-react-dom.gDT63CuY.js";import"../vendor/vendor---floating-ui-dom.CdGDzP9A.js";import"../vendor/vendor---floating-ui-core.D6mclMLM.js";import"../vendor/vendor---floating-ui-utils.D9HCu73I.js";import"../vendor/vendor-ui-dialog.CY7OxuK6.js";import"../vendor/vendor-ui-tooltip.n7I39vTs.js";import"../vendor/vendor--embla-carousel-react.Bc6nB0ya.js";import"../vendor/vendor--embla-carousel-reactive-utils.BIRN7lq8.js";import"../vendor/vendor--embla-carousel.clUl8sxa.js";import"../vendor/vendor--cmdk.q6oiTfmV.js";import"../vendor/vendor--react-day-picker.D6HWAs9M.js";import"../vendor/vendor--motion-dom.C5KZPrWP.js";import"../vendor/vendor--motion-utils.DAP8mxSY.js";const M=()=>{const{t:s}=w("trip"),[r,o]=e.useState(0),[i,a]=e.useState("message"),[n,d]=e.useState(""),l=s("loading.waitMessages",{returnObjects:!0});e.useEffect((()=>{const e=()=>{const e=Math.floor(Math.random()*l.length);d(l[e])};e();const t=setInterval(e,4e3);return()=>clearInterval(t)}),[l]);const c=s("loading.travelTips",{returnObjects:!0}),m=s("loading.zapTips",{returnObjects:!0}),p={title:s("loading.preview.title"),sections:s("loading.preview.sections",{returnObjects:!0})},[h,u]=e.useState(0);return e.useEffect((()=>{if("preview"===i){const e=setInterval((()=>{u((e=>(e+1)%p.sections.length))}),4e3);return()=>clearInterval(e)}}),[i,p.sections.length]),e.useEffect((()=>{const e=setInterval((()=>{o((e=>(e+1)%(c.length+m.length)))}),4e3);return()=>clearInterval(e)}),[c.length,m.length]),t.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-[#fcfcfc] z-50 overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 opacity-5",children:t.jsx("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(#61936f 1px, transparent 1px)",backgroundSize:"30px 30px"}})}),t.jsxs("div",{className:"relative h-full flex flex-col items-center justify-center p-4 sm:p-6",children:[t.jsx("div",{className:"mb-8 sm:mb-12",children:t.jsx(N.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"w-16 h-16 sm:w-24 sm:h-24 rounded-full bg-gradient-to-br from-[#61936f] to-[#1d1d1e] shadow-xl flex items-center justify-center",children:t.jsx("span",{className:"text-2xl sm:text-4xl text-white font-bold",children:"Z"})})}),t.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"mb-8 text-center",children:t.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[#61936f]/10 border border-[#61936f]/20",children:[t.jsx("svg",{className:"w-5 h-5 text-[#61936f]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),t.jsx("span",{className:"text-sm font-medium text-[#1d1d1e]",children:s("aiContent.emailNotification")})]})}),t.jsx("div",{className:"w-full max-w-2xl mx-auto",children:t.jsxs(k,{mode:"wait",children:["message"===i&&t.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center px-4 sm:px-0",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-[#030303] mb-2 sm:mb-3",children:n}),t.jsx("p",{className:"text-base sm:text-lg text-[#62626a] max-w-md mx-auto",children:s("loading.pleaseWait")})]},"message"),"tips"===i&&t.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center px-4 sm:px-0",children:[t.jsx("h3",{className:"text-lg font-medium text-[#030303] mb-3",children:r<c.length?s("loading.tips.title"):s("loading.tips.zapTitle")}),t.jsx("p",{className:"text-base sm:text-lg text-[#62626a] max-w-md mx-auto",children:r<c.length?c[r]:m[r-c.length]})]},"tips"),"preview"===i&&t.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center px-4 sm:px-0",children:[t.jsx("h3",{className:"text-lg font-medium text-[#030303] mb-3",children:p.title}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs(N.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-[#61936f] px-3 py-1 bg-[#61936f]/10 rounded-full",children:p.sections[h].category}),t.jsx("span",{className:"text-sm text-[#62626a]",children:p.sections[h].readTime})]}),t.jsx("h4",{className:"text-xl font-semibold text-[#030303] mb-2",children:p.sections[h].title}),t.jsx("p",{className:"text-[#62626a] text-base",children:p.sections[h].description})]},h),t.jsx("div",{className:"flex justify-center space-x-2",children:p.sections.map(((e,s)=>t.jsx(N.button,{className:"w-2 h-2 rounded-full "+(s===h?"bg-[#61936f]":"bg-[#62626a]/20"),onClick:()=>u(s),whileHover:{scale:1.2},whileTap:{scale:.9}},s)))})]})]},"preview")]})}),t.jsx(N.div,{className:"mt-6 sm:mt-8 w-[280px] sm:w-64 h-1.5 bg-gray-100 rounded-full overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:t.jsx(N.div,{className:"h-full bg-gradient-to-r from-[#61936f] to-[#1d1d1e]",animate:{x:["-100%","100%"]},transition:{repeat:1/0,duration:1.5,ease:"easeInOut"}})}),t.jsx("div",{className:"mt-4 sm:mt-6 flex space-x-2",children:[0,1,2].map((e=>t.jsx(N.div,{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-[#61936f]",animate:{scale:[1,1.5,1],opacity:[.3,1,.3]},transition:{duration:1,repeat:1/0,delay:.2*e}},e)))}),t.jsx("button",{onClick:()=>window.location.href="/dashboard",className:"mt-8 px-6 py-3 rounded-lg font-semibold text-white bg-[#61936f] hover:bg-[#1d1d1e] transition-colors duration-200 shadow-md focus:outline-none focus:ring-2 focus:ring-[#61936f] focus:ring-offset-2",children:s("loading.returnToDashboard")})]})]})},T=()=>{const{tripId:T}=I(),A=O(),q=E(),{lang:D}=I(),[F,W]=e.useState(null),[$,B]=e.useState(null),[J,Z]=e.useState(null),[P,V]=e.useState(!0),[R,H]=e.useState(!1),[K,U]=e.useState(!0),[G,Q]=e.useState(""),{toast:Y}=o(),[X,ee]=e.useState([2.3488,48.8534]),[te,se]=e.useState([]),{t:re}=w("trip"),[oe,ie]=e.useState(!1),ae=e.useRef(null),ne=e.useRef(0),[de,le]=e.useState(!1),ce=A.pathname.includes("/zapout/"),me=A.pathname.includes("/zaproad/"),[pe,he]=e.useState(!1),[ue,ve]=e.useState([{id:1,text:"Passport/ID",checked:!1},{id:2,text:"Travel Insurance",checked:!1},{id:3,text:"Hotel Reservations",checked:!1},{id:4,text:"Transportation Tickets",checked:!1},{id:5,text:"Local Currency",checked:!1},{id:6,text:"Phone Charger",checked:!1},{id:7,text:"Medications",checked:!1},{id:8,text:"Weather-appropriate clothes",checked:!1}]),[xe,ge]=e.useState([]),[je,fe]=e.useState(""),[ye,be]=e.useState(null),[we,ke]=e.useState(!1),[Ne,_e]=e.useState([]),[Se,Ce]=e.useState(""),[ze,Le]=e.useState(""),[Ie,Oe]=e.useState(new Set),[Ee,Me]=e.useState(!1),Te=re("aiContent.waitMessages",{returnObjects:!0}),Ae=()=>{const e=Math.floor(Math.random()*Te.length);return Te[e]},qe=ce?`${window.location.origin}/zapout/${T}/share`:me?`${window.location.origin}/zaproad/${T}/share`:`${window.location.origin}/trips/${T}/share`,[De,Fe]=e.useState(!1),[We,$e]=e.useState(!1),[Be,Je]=e.useState(!1),[Ze,Pe]=e.useState(null),Ve=e.useCallback((async()=>{if(T)try{let e;if(ne.current+=1,ce){const{data:t}=await s.from("zapout_data").select("ai_content").eq("id",T).single();e=t}else if(me){const{data:t}=await s.from("zaproad_data").select("ai_content").eq("id",T).single();e=t}else{const{data:t}=await s.from("trips").select("ai_content").eq("id",T).single();e=t}e&&e.ai_content?(ce&&$?B((t=>({...t,ai_content:e.ai_content}))):me&&J?Z((t=>({...t,ai_content:e.ai_content}))):F&&W((t=>({...t,ai_content:e.ai_content}))),ae.current&&(clearInterval(ae.current),ae.current=null),U(!1)):ne.current>=60&&(U(!1),ae.current&&(clearInterval(ae.current),ae.current=null),Y({title:"Note",description:"AI content generation is taking longer than expected. Please refresh the page later."}))}catch(e){}}),[T,ce,me,F,$,J,Y]);e.useEffect((()=>(K&&T&&(Ve(),ae.current=setInterval(Ve,5e3)),()=>{ae.current&&(clearInterval(ae.current),ae.current=null)})),[K,T,Ve]),e.useEffect((()=>{if(K){Q(Ae());const e=setInterval((()=>{Q(Ae())}),4e3);return()=>clearInterval(e)}}),[K]),e.useEffect((()=>{window.scrollTo(0,0),ce?He():me?Ke():Re()}),[T,ce,me]);const Re=async()=>{try{V(!0);const{data:t,error:r}=await s.from("trips").select("*").eq("id",T).single();if(r)throw r;let o=[];if(t.geoposition)try{const e="string"==typeof t.geoposition?JSON.parse(t.geoposition):t.geoposition;o=(Array.isArray(e)?e:[e]).filter((e=>e&&e.name&&e.type&&Array.isArray(e.coordinates)&&2===e.coordinates.length&&!isNaN(e.coordinates[0])&&!isNaN(e.coordinates[1])))}catch(e){}se(o),o.length>0&&ee(o[0].coordinates);const i={...t,transportation_details:"string"==typeof t.transportation_details?JSON.parse(t.transportation_details):t.transportation_details||{},accommodation_details:"string"==typeof t.accommodation_details?JSON.parse(t.accommodation_details):t.accommodation_details||{},geoposition:o};W(i),V(!1),U(!i.ai_content),i.ai_content||(ne.current=0),i&&"boolean"==typeof i.is_shareable&&Fe(i.is_shareable)}catch(t){q("/dashboard")}},He=async()=>{try{V(!0);const{data:t,error:r}=await s.from("zapout_data").select("*").eq("id",T).single();if(r)return void q("/dashboard");const o=t;let i=[];if(o.geoposition)try{const e="string"==typeof o.geoposition?JSON.parse(o.geoposition):o.geoposition;i=(Array.isArray(e)?e:[e]).filter((e=>e&&e.name&&e.type&&Array.isArray(e.coordinates)&&2===e.coordinates.length&&!isNaN(e.coordinates[0])&&!isNaN(e.coordinates[1])))}catch(e){}if(0===i.length&&o.activity_locations)try{const e="string"==typeof o.activity_locations?JSON.parse(o.activity_locations):o.activity_locations;Array.isArray(e)&&(i=e.filter((e=>e&&e.coordinates&&e.name)).map((e=>({name:e.name,type:e.type||"activity",coordinates:e.coordinates}))))}catch(e){}if(0===i.length&&o.coordinates)try{const e=JSON.parse(o.coordinates);Array.isArray(e)&&2===e.length&&(i=[{name:o.location||"Main Location",type:"main",coordinates:[Number(e[0]),Number(e[1])]}])}catch(e){}se(i),i.length>0&&ee(i[0].coordinates),B({...o,type:"ZapOut",description:o.additional_needs||null,geoposition:i}),V(!1),U(!o.ai_content),o.ai_content||(ne.current=0)}catch(t){Y({title:"Error",description:"Failed to load ZapOut trip details"}),q("/dashboard")}},Ke=async()=>{try{V(!0);const{data:t,error:r}=await s.from("zaproad_data").select("*").eq("id",T).single();if(r)return Y({title:"Error",description:"Failed to load ZapRoad trip details"}),void q("/dashboard");const o=t;let i=[];if(o.geoposition)try{const e="string"==typeof o.geoposition?JSON.parse(o.geoposition):o.geoposition;i=(Array.isArray(e)?e:[e]).filter((e=>{const t=e&&e.name&&e.type&&Array.isArray(e.coordinates)&&2===e.coordinates.length&&!isNaN(e.coordinates[0])&&!isNaN(e.coordinates[1]);return t}))}catch(e){}if(0===i.length){const t=[];if(o.starting_city&&o.starting_city_coordinates&&t.push({name:o.starting_city,coordinates:o.starting_city_coordinates,type:"start"}),o.stopover_cities)try{const e="string"==typeof o.stopover_cities?JSON.parse(o.stopover_cities):o.stopover_cities;Array.isArray(e)&&t.push(...e.map((e=>({name:e.name,coordinates:e.coordinates,type:"stopover"}))))}catch(e){}o.end_city&&o.end_city_coordinates&&t.push({name:o.end_city,coordinates:o.end_city_coordinates,type:"end"}),i=t.filter((e=>e.coordinates)).map((t=>{try{const e=JSON.parse(t.coordinates);return Array.isArray(e)&&2===e.length?{name:t.name,type:t.type,coordinates:[Number(e[0]),Number(e[1])]}:null}catch(e){return null}})).filter((e=>null!==e))}se(i),i.length>0&&ee(i[0].coordinates);const a={...o,type:"ZapRoad",description:o.special_requirements||null,geoposition:i};Z(a),V(!1),U(!o.ai_content),o.ai_content||(ne.current=0)}catch(t){Y({title:"Error",description:"Failed to load ZapRoad trip details"}),q("/dashboard")}},Ue=e=>{if(0===e.length)return;const t=e.map((e=>{const[t,s]=e.coordinates;return`${s},${t}`})).join("/");window.open(`https://www.google.com/maps/dir/${t}`,"_blank")};e.useEffect((()=>(document.body.style.overflow=P||K?"hidden":"auto",()=>{document.body.style.overflow="auto"})),[P,K]),e.useEffect((()=>{F&&"boolean"==typeof F.is_shareable&&Fe(F.is_shareable),$&&"boolean"==typeof $.is_shareable&&$e($.is_shareable),J&&"boolean"==typeof J.is_shareable&&Je(J.is_shareable)}),[F,$,J]);e.useEffect((()=>{s.auth.getUser().then((({data:{user:e}})=>{Pe(e?.id??null)}))}),[]);const Ge=F&&Ze&&F.user_id===Ze||$&&Ze&&$.user_id===Ze||J&&Ze&&J.user_id===Ze,Qe=async()=>{if(je.trim())try{ke(!0);const e={title:je,content:"",trip_id:T,trip_type:tt?"zapout":st?"zaproad":"zaptrip"},{data:t,error:r}=await s.from("trip_notes").insert([e]).select().single();if(r)throw r;ge((e=>[t,...e])),fe("")}catch(e){Y({title:"Error",description:"Failed to create note"})}finally{ke(!1)}},Ye=e.useCallback(b.debounce((async(e,t)=>{try{const{error:r}=await s.from("trip_notes").update({content:t}).eq("id",e);if(r)throw r}catch(r){Y({title:"Error",description:"Failed to save changes"})}}),1e3),[]);e.useEffect((()=>{pe&&(async()=>{try{const{data:e,error:t}=await s.from("trip_notes").select("*").eq("trip_id",T).eq("trip_type",tt?"zapout":st?"zaproad":"zaptrip").order("created_at",{ascending:!1});if(t)throw t;ge(e||[])}catch(e){Y({title:"Error",description:"Failed to load notes"})}})()}),[pe,T]);const Xe=async()=>{if(Se.trim())try{Me(!0);const e={title:Se,trip_id:T,trip_type:tt?"zapout":st?"zaproad":"zaptrip"},{data:t,error:r}=await s.from("trip_checklist_items").insert([e]).select().single();if(r)throw r;_e((e=>[...e,{...t,subitems:[]}])),Ce("")}catch(e){Y({title:"Error",description:"Failed to create checklist item"})}finally{Me(!1)}},et=async e=>{if(ze.trim())try{Me(!0);const t={title:ze,parent_id:e},{data:r,error:o}=await s.from("trip_checklist_subitems").insert([t]).select().single();if(o)throw o;_e((t=>t.map((t=>t.id===e?{...t,subitems:[...t.subitems,r]}:t)))),Le("")}catch(t){}finally{Me(!1)}};if(e.useEffect((()=>{pe&&(async()=>{try{const{data:e,error:t}=await s.from("trip_checklist_items").select("*").eq("trip_id",T).eq("trip_type",tt?"zapout":st?"zaproad":"zaptrip").order("created_at",{ascending:!0});if(t)throw t;const r=await Promise.all(e.map((async e=>{const{data:t,error:r}=await s.from("trip_checklist_subitems").select("*").eq("parent_id",e.id).order("created_at",{ascending:!0});if(r)throw r;return{...e,subitems:t||[]}})));_e(r)}catch(e){Y({title:"Error",description:"Failed to load checklist items"})}})()}),[pe,T]),P||K)return t.jsx(k,{children:t.jsx(M,{})});if(!F&&!$&&!J)return t.jsx("div",{className:"container mx-auto p-8",children:"Trip not found"});const tt=ce||null!==$||F&&"ZapOut"===F.trip_type,st=me||null!==J||F&&"ZapRoad"===F.trip_type,rt=$?$.title:J?J.title:F?.title||"",ot=$?$.description||"":J?J.description||"":F?.description||"";return t.jsxs("div",{className:"min-h-screen bg-[#fcfcfc]",children:[t.jsx("div",{className:"bg-white sticky top-0 z-50 shadow-sm",children:t.jsxs("div",{className:"max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center",children:[t.jsxs("button",{onClick:()=>{"mapDashboard"===localStorage.getItem("tripDetailsPreviousPage")?(localStorage.removeItem("tripDetailsPreviousPage"),q("/map-dashboard")):q("/dashboard")},className:"flex items-center text-gray-700 hover:text-blue-600 transition-colors",children:[t.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),t.jsx("span",{className:"hidden sm:inline",children:(localStorage.getItem("tripDetailsPreviousPage"),re("details.backToDashboard"))})]}),Ge&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"flex items-center gap-2",children:[!tt&&t.jsxs("button",{onClick:()=>he(!pe),className:"flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200",children:[t.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),re("details.notes")]}),t.jsxs("button",{onClick:()=>{R?(async()=>{if(F||$||J)try{V(!0);const e=te.map((e=>({name:e.name,type:e.type,coordinates:e.coordinates})));if($){const t={title:$.title,category:$.category,additional_needs:$.notes||$.description,location:$.location,geoposition:e,coordinates:te.length>0?JSON.stringify(te[0].coordinates):null,activity_types:$.activity_types||[],activity_times:$.activity_times||[]},{error:r}=await s.from("zapout_data").update(t).eq("id",T);if(r)throw r;return Y({title:"Success",description:"ZapOut trip details saved successfully"}),void q("/dashboard")}if(J){const e=JSON.stringify(te.map((e=>({name:e.name,type:e.type,coordinates:e.coordinates})))),t=te.slice(1,-1).map((e=>({name:e.name,coordinates:JSON.stringify(e.coordinates)}))),r=JSON.stringify(t),o=te.length>0?JSON.stringify(te[0].coordinates):J.starting_city_coordinates,i=te.length>1?JSON.stringify(te[te.length-1].coordinates):J.end_city_coordinates,a={title:J.title,category:J.category,special_requirements:J.notes||J.description,starting_city:J.starting_city,starting_city_coordinates:o,end_city:J.end_city,end_city_coordinates:i,geoposition:e,stopover_cities:r},{error:n}=await s.from("zaproad_data").update(a).eq("id",T);if(n)throw n;return Y({title:"Success",description:"ZapRoad trip details saved successfully"}),void q("/dashboard")}if(F){const t={transportation_details:JSON.stringify(F.transportation_details),accommodation_details:JSON.stringify(F.accommodation_details),geoposition:e,category:F.category,notes:F.notes,budget:F.budget},{error:r}=await s.from("trips").update(t).eq("id",F.id);if(r)throw r;Y({title:"Success",description:"Trip details saved successfully"}),q("/dashboard")}}catch(e){Y({title:"Error",description:"Failed to save trip details. Please try again."})}finally{V(!1)}})():H(!0)},className:"flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200",children:[t.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),re(R?"details.saveChanges":"details.editDetails")]})]})})]})}),t.jsxs("div",{className:"max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-12 gap-6",children:[t.jsxs("div",{className:"xl:col-span-8 xl:row-span-2 space-y-6",children:[t.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100",children:t.jsxs("div",{className:"p-6",children:[t.jsx("h1",{className:"text-3xl font-bold text-[#030303] mb-2",children:rt}),ot&&t.jsx("p",{className:"mb-4 text-sm text-[#62626a]",children:ot}),t.jsx(r,{height:"300px",geopositions:te,showTerrain:!0,onMarkerClick:e=>{ee(e.coordinates)},initialCenter:X,className:"rounded-xl overflow-hidden shadow-inner h-[300px] sm:h-[400px] lg:h-[600px]"})]})}),t.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100",children:[t.jsxs("div",{className:"p-4 border-b border-gray-100 bg-white flex justify-between items-center cursor-pointer",onClick:()=>ie(!oe),children:[t.jsx("h2",{className:"text-xl font-bold text-[#030303]",children:re("details.stopsAndPoints")}),t.jsx("svg",{className:"w-5 h-5 transform transition-transform "+(oe?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),t.jsxs("div",{className:`relative ${oe?"max-h-none":"max-h-[200px]"} overflow-hidden`,children:[t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:te.map(((e,s)=>t.jsxs("div",{className:"group relative bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-gray-100 hover:border-blue-200 overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-blue-500 to-indigo-500 rounded-tl-lg rounded-bl-lg"}),t.jsxs("div",{className:"p-4 pl-5",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("div",{className:"flex-shrink-0 w-7 h-7 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-full flex items-center justify-center font-semibold text-sm",children:s+1}),t.jsx("h3",{className:"ml-3 font-semibold text-base text-gray-800 group-hover:text-blue-600 transition-colors",children:e.name})]}),e.description&&t.jsx("p",{className:"text-gray-600 text-sm mb-2",children:e.description}),t.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[t.jsxs("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.Adresse||`${e.coordinates[1].toFixed(4)}, ${e.coordinates[0].toFixed(4)}`]})]})]},`${e.name}-${s}`)))})}),!oe&&t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-white to-transparent pointer-events-none"})]}),!oe&&te.length>2&&t.jsx("div",{className:"p-4 border-t border-gray-100 text-center",children:t.jsxs("button",{onClick:()=>ie(!0),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:[re("details.showAllStops")," (",te.length,")"]})})]}),t.jsx(i,{location:F?.location||$?.location||J?.starting_city||""}),te.length>0&&t.jsx(a,{city:F?.location||$?.location||J?.starting_city||"",coordinates:te[0].coordinates})]}),t.jsxs("div",{className:"xl:col-span-4 space-y-6",children:[t.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:t.jsx("div",{className:"p-4",children:tt?t.jsx(n,{tripId:T,isDirectZapOut:!!$}):st?t.jsx(d,{tripId:T,isDirectZapRoad:!!J}):t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:re("zapTrip.details.title")}),t.jsx("div",{children:t.jsx(l,{startDate:F?.start_date||"",endDate:F?.end_date||"",location:F?.location||"",category:F?.category||null,activityTypes:[],budget:F?.budget||null,isEditing:R,isZapOutTrip:!1,isZapRoadTrip:!1,hideBudget:!1,onCategoryChange:e=>W(F?{...F,category:e}:null),onBudgetChange:e=>W(F?{...F,budget:e}:null)})}),t.jsx("div",{className:"pt-6 border-t border-gray-100",children:t.jsx(c,{details:F?.transportation_details||{},isEditing:R,onChange:e=>W(F?{...F,transportation_details:e}:null)})}),t.jsx("div",{className:"pt-6 border-t border-gray-100",children:t.jsx(m,{details:F?.accommodation_details||{},isEditing:R,onChange:e=>W(F?{...F,accommodation_details:e}:null)})})]})})}),t.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"mt-6 space-y-3",children:[(tt||!tt&&!st)&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>q("/map-dashboard",{state:{selectedTripId:T,tripType:tt?"zapout":"zaptrip"}}),className:"w-full flex items-center justify-center px-4 py-2 bg-[#1d1d1e] text-white rounded-lg hover:bg-[#2d2d2e] transition-colors",children:[t.jsx(_,{className:"w-5 h-5 mr-2"}),re("types.zapOut.details.viewOnMap")]}),te.length>0&&t.jsxs("button",{onClick:()=>Ue(te),className:"w-full flex items-center justify-center px-4 py-2 bg-[#1d1d1e] text-white rounded-lg hover:bg-[#2d2d2e] transition-colors",children:[t.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),re("navigation.viewOnGoogleMaps")]})]}),st&&te.length>0&&t.jsxs("button",{onClick:()=>Ue(te),className:"w-full flex items-center justify-center px-4 py-2 bg-[#1d1d1e] text-white rounded-lg hover:bg-[#2d2d2e] transition-colors",children:[t.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),re("navigation.startNavigation")]}),Ge&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:async()=>{if(tt&&$?.id&&!We){const{error:e}=await s.from("zapout_data").update({is_shareable:!0}).eq("id",$.id);e||$e(!0)}else if(st&&J?.id&&!Be){const{error:e}=await s.from("zaproad_data").update({is_shareable:!0}).eq("id",J.id);e||Je(!0)}else if(F?.id&&!De){const{error:e}=await s.from("trips").update({is_shareable:!0}).eq("id",F.id);e||Fe(!0)}le(!0)},className:"w-full flex items-center justify-center px-4 py-2 bg-white text-[#1d1d1e] border border-[#62626a] rounded-lg hover:bg-[#fcfcfc] transition-all duration-200",children:[t.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),re("details.shareTrip")]}),t.jsx(p,{open:de,onOpenChange:le,shareUrl:qe})]}),Ge&&t.jsxs("button",{onClick:()=>{Y({title:"✨ Coming Soon!",description:`${"Community sharing"} will be available soon. Stay tuned for updates!`,className:"backdrop-blur-sm",style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:"2rem",background:"rgba(255, 255, 255, 0.8)",borderRadius:"1rem",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",animation:"fadeIn 0.3s ease-out",zIndex:50,textAlign:"center",color:"#1a1a1a",fontSize:"1.1rem",fontWeight:500,width:"auto",minWidth:"300px",maxWidth:"90vw"}})},className:"w-full flex items-center justify-center px-4 py-2 bg-white text-[#1d1d1e] border border-[#62626a] rounded-lg hover:bg-[#fcfcfc] transition-all duration-200",children:[t.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),re("details.shareToCommunity")]}),t.jsxs("button",{onClick:()=>{const e={title:rt,description:ot,startDate:F?.start_date||$?.date||J?.start_date,endDate:F?.end_date||J?.end_date,category:F?.category||$?.category||J?.category||void 0,notes:F?.notes||$?.additional_needs||J?.special_requirements||void 0,geopositions:te.map((e=>({...e,type:e.type||"point",coordinates:e.coordinates}))),ai_content:F?.ai_content||$?.ai_content||J?.ai_content};u(e)},className:"w-full flex items-center justify-center px-4 py-2 bg-white text-[#1d1d1e] border border-[#62626a] rounded-lg hover:bg-[#fcfcfc] transition-all duration-200",children:[t.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),re("details.printTrip")]})]})})})]})]}),t.jsx("div",{className:"mt-6",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:[t.jsx("div",{className:"p-4 border-b border-gray-100 bg-white",children:t.jsxs("h2",{className:"text-xl font-bold text-[#030303] flex items-center",children:[t.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),re("details.travelTips")]})}),t.jsx("div",{className:"p-4 sm:p-8",children:t.jsxs("div",{className:"w-full max-w-full mx-auto overflow-hidden",children:[F?.ai_content&&t.jsx(h,{content:F.ai_content,tripType:F?.trip_type||F?.type||"ZapTrip"}),$?.ai_content&&t.jsx(h,{content:$.ai_content,tripType:$?.type||"ZapOut"}),J?.ai_content&&t.jsx(h,{content:J.ai_content,tripType:J?.type||"ZapRoad"})]})})]})}),t.jsx("div",{className:"mt-6"})]}),t.jsx(k,{children:pe&&t.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},className:"fixed inset-0 bg-white z-50 overflow-y-auto",children:t.jsxs("div",{className:"max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-8",children:[t.jsx("h2",{className:"text-2xl font-bold",children:re("details.notes")}),t.jsxs("button",{onClick:()=>he(!1),className:"flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200",children:[t.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),re("details.close")]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[t.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-6",children:t.jsxs("div",{className:"flex flex-col space-y-4",children:[t.jsx("h3",{className:"text-lg font-semibold",children:re("details.notesInPage")}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(v,{value:je,onChange:e=>fe(e.target.value),placeholder:re("details.notesPlaceholder"),className:"flex-1",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Qe())}}),t.jsxs(x,{onClick:Qe,disabled:we||!je.trim(),className:"shrink-0",children:[t.jsx(S,{className:"w-4 h-4 mr-2"}),re("details.addNote")]})]}),t.jsx(g,{className:"h-[600px] pr-4",children:t.jsx("div",{className:"space-y-4",children:xe.map((e=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2 hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"font-medium",children:e.title}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(x,{variant:"ghost",size:"sm",onClick:()=>be(ye===e.id?null:e.id),className:"hover:bg-gray-200",children:ye===e.id?t.jsx(C,{className:"w-4 h-4"}):t.jsx(z,{className:"w-4 h-4"})}),t.jsx(x,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{ke(!0);const{error:t}=await s.from("trip_notes").delete().eq("id",e);if(t)throw t;ge((t=>t.filter((t=>t.id!==e))))}catch(t){Y({title:"Error",description:"Failed to delete note"})}finally{ke(!1)}})(e.id),className:"hover:bg-red-100 hover:text-red-600",children:t.jsx(L,{className:"w-4 h-4"})})]})]}),ye===e.id?t.jsx(j,{value:e.content,onChange:t=>(async(e,t)=>{ge((s=>s.map((s=>s.id===e?{...s,content:t}:s)))),Ye(e,t)})(e.id,t.target.value),placeholder:"Write your note here...",className:"min-h-[100px] resize-none",autoFocus:!0}):t.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:e.content||"No content yet..."}),t.jsx("p",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleDateString()})]},e.id)))})})]})}),t.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-6",children:t.jsxs("div",{className:"flex flex-col space-y-4",children:[t.jsx("h3",{className:"text-lg font-semibold",children:re("details.checklist.title")}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(v,{value:Se,onChange:e=>Ce(e.target.value),placeholder:re("details.checklist.newItem"),className:"flex-1",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Xe())}}),t.jsxs(x,{onClick:Xe,disabled:Ee||!Se.trim(),className:"shrink-0",children:[t.jsx(S,{className:"w-4 h-4 mr-2"}),re("details.checklist.addItem")]})]}),t.jsx(g,{className:"h-[600px] pr-4",children:t.jsx("div",{className:"space-y-4",children:Ne.map((e=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2 hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(f,{id:`checklist-${e.id}`,checked:e.is_checked,onCheckedChange:()=>(async e=>{try{const t=Ne.find((t=>t.id===e));if(!t)return;const{error:r}=await s.from("trip_checklist_items").update({is_checked:!t.is_checked}).eq("id",e);if(r)throw r;_e((t=>t.map((t=>t.id===e?{...t,is_checked:!t.is_checked}:t))))}catch(t){Y({title:"Error",description:"Failed to update checklist item"})}})(e.id)}),t.jsx(y,{htmlFor:`checklist-${e.id}`,className:"text-base "+(e.is_checked?"line-through text-gray-500":""),children:e.title})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(x,{variant:"ghost",size:"sm",onClick:()=>{Oe((t=>{const s=new Set(t);return s.has(e.id)?s.delete(e.id):s.add(e.id),s}))},className:"hover:bg-gray-200",children:t.jsx("svg",{className:"w-4 h-4 transform transition-transform "+(Ie.has(e.id)?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})}),t.jsx(x,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{Me(!0);const{error:t}=await s.from("trip_checklist_items").delete().eq("id",e);if(t)throw t;_e((t=>t.filter((t=>t.id!==e)))),Y({title:"Success",description:"Checklist item deleted successfully"})}catch(t){Y({title:"Error",description:"Failed to delete checklist item"})}finally{Me(!1)}})(e.id),className:"hover:bg-red-100 hover:text-red-600",title:re("details.checklist.deleteItem"),children:t.jsx(L,{className:"w-4 h-4"})})]})]}),Ie.has(e.id)&&t.jsxs("div",{className:"pl-8 space-y-2",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[t.jsx(v,{value:ze,onChange:e=>Le(e.target.value),placeholder:re("details.checklist.newSubItem"),className:"flex-1",onKeyDown:t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),et(e.id))}}),t.jsxs(x,{onClick:()=>et(e.id),disabled:Ee||!ze.trim(),className:"shrink-0 whitespace-nowrap",children:[t.jsx(S,{className:"w-4 h-4 sm:mr-2"}),t.jsx("span",{className:"hidden sm:inline",children:re("details.checklist.addSubItem")}),t.jsx("span",{className:"sm:hidden",children:re("details.checklist.addSubItem")})]})]}),e.subitems.map((r=>t.jsxs("div",{className:"flex items-center justify-between p-1.5 hover:bg-gray-200 rounded-lg transition-colors",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(f,{id:`subitem-${r.id}`,checked:r.is_checked,onCheckedChange:()=>(async(e,t)=>{try{const r=Ne.find((t=>t.id===e)),o=r?.subitems.find((e=>e.id===t));if(!o)return;const{error:i}=await s.from("trip_checklist_subitems").update({is_checked:!o.is_checked}).eq("id",t);if(i)throw i;_e((s=>s.map((s=>s.id===e?{...s,subitems:s.subitems.map((e=>e.id===t?{...e,is_checked:!e.is_checked}:e))}:s))))}catch(r){Y({title:"Error",description:"Failed to update sub-item"})}})(e.id,r.id),className:"h-4 w-4"}),t.jsx(y,{htmlFor:`subitem-${r.id}`,className:"text-xs sm:text-sm "+(r.is_checked?"line-through text-gray-500":""),children:r.title})]}),t.jsx(x,{variant:"ghost",size:"sm",onClick:()=>(async(e,t)=>{try{Me(!0);const{error:r}=await s.from("trip_checklist_subitems").delete().eq("id",t);if(r)throw r;_e((s=>s.map((s=>s.id===e?{...s,subitems:s.subitems.filter((e=>e.id!==t))}:s)))),Y({title:"Success",description:"Sub-item deleted successfully"})}catch(r){Y({title:"Error",description:"Failed to delete sub-item"})}finally{Me(!1)}})(e.id,r.id),className:"hover:bg-red-100 hover:text-red-600 p-1.5",title:re("details.checklist.deleteSubItem"),children:t.jsx(L,{className:"w-4 h-4"})})]},r.id)))]})]},e.id)))})})]})})]})]})})})]})};export{T as default};
//# sourceMappingURL=page-tripdetails.CRrIBOhf.js.map
