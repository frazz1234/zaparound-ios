{"version":3,"file":"page-dashboard.CaqwBdJP.js","sources":["../../../../src/pages/Dashboard.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useTrips } from '@/hooks/useTrips';\nimport { DashboardContent } from '@/components/dashboard/DashboardContent';\nimport { useToast } from '@/hooks/use-toast';\nimport { useTranslation } from 'react-i18next';\nimport { useSearchParams, useNavigate, useParams } from 'react-router-dom';\nimport { useUserRole } from '@/hooks/useUserRole';\nimport { getFreeTripInfo } from '@/utils/freeTripManager';\nimport { Button } from '@/components/ui/button';\nimport { getFullName, getFirstName } from '@/utils/profileUtils';\n\nconst Dashboard = () => {\n  const { userRole, loading: roleLoading } = useUserRole();\n  const { trips, loading: tripsLoading, getTrips, refreshTrips, deleteTrip } = useTrips();\n  const [userId, setUserId] = useState<string | null>(null);\n  const [profile, setProfile] = useState<any>(null);\n  const [searchParams] = useSearchParams();\n  const { toast } = useToast();\n  const { t } = useTranslation('dashboard');\n  const [hasFreeTrip, setHasFreeTrip] = useState<boolean>(false);\n  const navigate = useNavigate();\n  const { lang } = useParams();\n\n  useEffect(() => {\n    // Scroll to top when component mounts\n    window.scrollTo(0, 0);\n    \n    async function initialize() {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (user) {\n        setUserId(user.id);\n        await getTrips(user.id);\n        await getProfile(user.id);\n      }\n    }\n    \n    initialize();\n  }, [userRole]);\n\n  const getProfile = async (userId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('profiles')\n        .select(`username, first_name, last_name, avatar_url`)\n        .eq('id', userId)\n        .single();\n\n      if (error && error.code !== '406') {\n        throw error;\n      }\n\n      setProfile(data);\n    } catch (error) {\n      console.error(\"Error fetching profile:\", error);\n    }\n  };\n\n  useEffect(() => {\n    // Check if this is a redirect from Stripe\n    const sessionId = searchParams.get('session_id');\n    if (sessionId) {\n      // Show success toast\n      toast({\n        title: t('success'),\n        description: t('paymentSuccess'),\n      });\n      \n      // Remove query params to prevent showing the same toast on refresh\n      window.history.replaceState({}, document.title, window.location.pathname);\n    }\n  }, [searchParams, toast, t]);\n\n  const handleTripCreated = async () => {\n    if (userId) {\n      await refreshTrips(userId);\n    }\n  };\n\n  const handleDeleteTrip = async (tripId: string): Promise<boolean> => {\n    console.log(\"Dashboard: Handling delete for trip ID:\", tripId);\n    try {\n      const success = await deleteTrip(tripId);\n      if (success) {\n        console.log(\"Delete operation successful\");\n        toast({\n          title: t('trip.deletion.success'),\n          description: t('trip.deletion.successMessage'),\n        });\n      } else {\n        console.error(\"Delete operation failed\");\n      }\n      return success;\n    } catch (error) {\n      console.error(\"Error in handleDeleteTrip:\", error);\n      return false;\n    }\n  };\n\n  const handleCreateTrip = () => {\n    const currentLang = lang || 'en';\n    navigate(`/${currentLang}/create-trip`);\n  };\n\n  // Function to get first name from profile\n  const getProfileFirstName = () => {\n    if (!profile) return '';\n    return profile.first_name || profile.username || '';\n  };\n\n  const loading = roleLoading || tripsLoading;\n\n  // Show loading state while fetching data\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto\"></div>\n          <p className=\"mt-2 text-gray-600\">{t('loading')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Show empty state if no trips\n  if (trips.length === 0) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center max-w-md mx-auto px-4\">\n          <div className=\"mb-8\">\n            <div className=\"mx-auto h-24 w-24 bg-gray-200 rounded-full flex items-center justify-center mb-4 overflow-hidden\">\n              <img \n                src=\"https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExMW55cDl2MGZjZmJqOWExaXRkc2ttYmRpcWJlZDN5Y202ZGFzaHR5cyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/VGG8UY1nEl66Y/giphy.gif\"\n                alt=\"ZapAround Animation\" \n                className=\"h-full w-full object-cover rounded-full\"\n              />\n            </div>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2 whitespace-nowrap\">\n              {t('trip.empty.welcome', { name: getProfileFirstName() })}\n            </h2>\n            <p className=\"text-gray-600 mb-8\">\n              {t('trip.empty.noneYet')}\n            </p>\n          </div>\n          \n          <div className=\"space-y-4\">\n            <Button \n              onClick={handleCreateTrip}\n              className=\"w-full bg-gradient-to-r from-[#10B981] to-[#059669] text-white border-none hover:from-[#059669] hover:to-[#047857] hover:scale-105 transition-all duration-300 shadow-lg rounded-full font-medium tracking-wide px-8 py-3\"\n            >\n              {t('trip.empty.createFirst')}\n            </Button>\n            \n            <p className=\"text-sm text-gray-500\">\n              {t('trip.empty.description')}\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <DashboardContent \n      loading={loading}\n      trips={trips}\n      fullName={getFullName(profile?.first_name, profile?.last_name)}\n      onTripCreated={handleTripCreated}\n      onDeleteTrip={handleDeleteTrip}\n      userRole={userRole}\n      hasFreeTrip={hasFreeTrip}\n    />\n  );\n};\n\nexport default Dashboard;\n"],"names":["Dashboard","userRole","loading","roleLoading","useUserRole","trips","tripsLoading","getTrips","refreshTrips","deleteTrip","useTrips","userId","setUserId","useState","profile","setProfile","searchParams","useSearchParams","toast","useToast","t","useTranslation","hasFreeTrip","setHasFreeTrip","navigate","useNavigate","lang","useParams","useEffect","window","scrollTo","async","data","user","supabase","auth","getUser","id","getProfile","initialize","error","from","select","eq","single","code","get","title","description","history","replaceState","document","location","pathname","handleCreateTrip","className","children","jsxs","jsx","length","src","alt","name","first_name","username","Button","onClick","DashboardContent","fullName","getFullName","last_name","onTripCreated","onDeleteTrip","tripId","success"],"mappings":"msNAYA,MAAMA,EAAY,KAChB,MAAMC,SAAEA,EAAUC,QAASC,GAAgBC,KACrCC,MAAEA,EAAOH,QAASI,EAAAC,SAAcA,eAAUC,EAAcC,WAAAA,GAAeC,KACtEC,EAAQC,GAAaC,EAAAA,SAAwB,OAC7CC,EAASC,GAAcF,EAAAA,SAAc,OACrCG,GAAgBC,KACjBC,MAAEA,GAAUC,KACZC,EAAEA,GAAMC,EAAe,cACtBC,EAAaC,GAAkBV,EAAAA,UAAkB,GAClDW,EAAWC,KACXC,KAAEA,GAASC,IAEjBC,EAAAA,WAAU,KAEDC,OAAAC,SAAS,EAAG,GAEnBC,iBACQ,MAAEC,MAAMC,KAAEA,UAAiBC,EAASC,KAAKC,UAC3CH,IACFrB,EAAUqB,EAAKI,UACT9B,EAAS0B,EAAKI,UACdC,EAAWL,EAAKI,IACxB,CAGSE,EAAA,GACV,CAACtC,IAEE,MAAAqC,EAAaP,MAAOpB,IACpB,IACF,MAAMqB,KAAEA,EAAMQ,MAAAA,SAAgBN,EAC3BO,KAAK,YACLC,OAAO,+CACPC,GAAG,KAAMhC,GACTiC,SAEC,GAAAJ,GAAwB,QAAfA,EAAMK,KACX,MAAAL,EAGRzB,EAAWiB,SACJQ,GACuC,GAIlDZ,EAAAA,WAAU,KAEUZ,EAAa8B,IAAI,gBAG3B5B,EAAA,CACJ6B,MAAO3B,EAAE,WACT4B,YAAa5B,EAAE,oBAIVS,OAAAoB,QAAQC,aAAa,CAAC,EAAGC,SAASJ,MAAOlB,OAAOuB,SAASC,UAAQ,GAEzE,CAACrC,EAAcE,EAAOE,IAEzB,MA0BMkC,EAAmB,KAEd9B,EAAA,IADWE,GAAQ,mBACU,EASlCxB,EAAUC,GAAeG,EAG/B,OAAIJ,QAEC,MAAI,CAAAqD,UAAU,gDACbC,SAACC,EAAAA,KAAA,MAAA,CAAIF,UAAU,cACbC,SAAA,CAACE,EAAAA,IAAA,MAAA,CAAIH,UAAU,+EACd,IAAE,CAAAA,UAAU,qBAAsBC,SAAApC,EAAE,kBAOxB,IAAjBf,EAAMsD,aAEL,MAAI,CAAAJ,UAAU,2DACbC,SAACC,EAAAA,KAAA,MAAA,CAAIF,UAAU,oCACbC,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIF,UAAU,OACbC,SAAA,CAACE,EAAAA,IAAA,MAAA,CAAIH,UAAU,mGACbC,SAAAE,EAAAA,IAAC,MAAA,CACCE,IAAI,2KACJC,IAAI,sBACJN,UAAU,8CAGdG,EAAAA,IAAC,KAAG,CAAAH,UAAU,0DACXC,SAAApC,EAAE,qBAAsB,CAAE0C,KAhChChD,IACEA,EAAQiD,YAAcjD,EAAQkD,WADhB,aAkCZ,IAAE,CAAAT,UAAU,qBACVC,SAAApC,EAAE,2BAIPqC,EAAAA,KAAC,MAAI,CAAAF,UAAU,YACbC,SAAA,CAAAE,EAAAA,IAACO,EAAA,CACCC,QAASZ,EACTC,UAAU,4NAETC,WAAE,kCAGJ,IAAE,CAAAD,UAAU,wBACVC,SAAApC,EAAE,oCASbsC,EAAAA,IAACS,EAAA,CACCjE,UACAG,QACA+D,SAAUC,EAAYvD,GAASiD,WAAYjD,GAASwD,WACpDC,cA9FsBxC,UACpBpB,SACIH,EAAaG,EAAM,EA6FzB6D,aAzFqBzC,MAAO0C,IAE1B,IACI,MAAAC,QAAgBjE,EAAWgE,GAU1B,OATHC,GAEIxD,EAAA,CACJ6B,MAAO3B,EAAE,yBACT4B,YAAa5B,EAAE,kCAKZsD,QACAlC,GAEA,OAAA,CAAA,GA0EPvC,WACAqB,eACF"}