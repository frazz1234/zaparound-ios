import{r as e,j as s}from"../vendor/vendor-react-core.D1hcyiwY.js";import{a as t,c as a}from"../utils/utils-placeutils.ts.vo-R8UHO.js";import{m as n}from"../vendor/vendor--mapbox-gl.CIg18VY7.js";import{B as r,C as l,k as i,l as c,V as o,m as d}from"../components/components-ui.C8hnNhgu.js";import{s as m}from"../components/components-admin.CiIAoamg.js";import{u as x}from"../hooks/hooks-use-toast.ts.Dg8obzHg.js";import{g as h}from"../utils/utils-mapboxutils.ts.6FvsIj9k.js";import{u as p}from"../hooks/hooks-usefavorites.ts.B2ecJjdl.js";import{S as u}from"../components/components-seo.tsx.Dk-lg3q2.js";import{u as g}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{u as j,i as f,H as v,M as y,s as N,I as w,N as b,af as _,bB as k,ae as $,h as C,U as S,X as z,n as P,o as L}from"../vendor/vendor--lucide-react.DRw9PYsu.js";import{m as M}from"../vendor/vendor--framer-motion.Dpgjd5L1.js";import{a as E,b as F,u as R}from"../vendor/vendor--react-router.Gdfmkz0l.js";const H=()=>{const{placeSlug:H}=E(),D=F(),I=R(),{t:T}=g("zap-places"),U=("undefined"!=typeof navigator?document.documentElement.lang||navigator.language?.slice(0,2):"en")||"en",A={en:"en_US",fr:"fr_FR",es:"es_ES"}[U]||"en_US",{toast:B}=x(),{isFavorited:q,toggleFavorite:W}=p(),[Z,G]=e.useState(null),[O,V]=e.useState(!0),[X,K]=e.useState(null),[Y,J]=e.useState([]),[Q,ee]=e.useState(!1),[se,te]=e.useState(null),[ae,ne]=e.useState([]),[re,le]=e.useState(!1),[ie,ce]=e.useState(0),[oe,de]=e.useState(0),[me,xe]=e.useState(null),he=e.useRef(null),pe=e.useRef(null),ue=e.useRef(null),ge=D.state;let je=ge?.placeId;if(!je){const e=new URLSearchParams(window.location.search);je=e.get("id")}const fe=q(je||"");e.useEffect((()=>{(async()=>{try{const e=await h();xe(e)}catch(e){}})()}),[]),e.useEffect((()=>{je&&(ye(),we())}),[je]),e.useEffect((()=>{if(Z?.geometry?.location&&pe.current&&!ue.current){return ve()}}),[Z,me]);const ve=()=>{if(!Z?.geometry?.location||!pe.current)return;if(!me){const e=document.createElement("div");return e.className="w-full h-full bg-gray-100 flex items-center justify-center text-gray-500",e.innerHTML='\n        <div class="text-center">\n          <div class="text-2xl mb-2">üó∫Ô∏è</div>\n          <p class="text-sm">Map loading...</p>\n        </div>\n      ',pe.current.appendChild(e),()=>{pe.current&&e.parentNode&&pe.current.removeChild(e)}}n.accessToken=me;const{lat:e,lng:s}=Z.geometry.location;ue.current=new n.Map({container:pe.current,style:"mapbox://styles/mapbox/streets-v12",center:[s,e],zoom:15,attributionControl:!1}),ue.current.addControl(new n.NavigationControl,"top-right"),ue.current.addControl(new n.AttributionControl({compact:!0}));const t=new n.Popup({offset:25}).setHTML(`\n        <div class="p-2">\n          <h3 class="font-semibold text-sm">${Z.name}</h3>\n          <p class="text-xs text-gray-600">${Z.formatted_address}</p>\n        </div>\n      `);return(new n.Marker).setLngLat([s,e]).setPopup(t).addTo(ue.current),ue.current.on("load",(()=>{ue.current&&ue.current.resize()})),()=>{ue.current&&(ue.current.remove(),ue.current=null)}},ye=async()=>{try{V(!0);const{data:e,error:s}=await m.functions.invoke("google-places-search",{body:{action:"details",placeId:je,fields:"place_id,name,formatted_address,geometry,types,rating,user_ratings_total,opening_hours,website,international_phone_number,reviews,photos,price_level,vicinity",language:"en"}});if(s)throw s;if("OK"!==e.status||!e.result)throw new Error("Place not found");G(e.result),e.result.photos&&e.result.photos.length>0&&Ne(e.result.photos)}catch(e){K(e instanceof Error?e.message:"Failed to load place details")}finally{V(!1)}},Ne=async e=>{try{const s=e?.slice(0,6).map((async e=>{const{data:s,error:t}=await m.functions.invoke("google-places-search",{body:{action:"photo",photoReference:e.photo_reference,maxWidth:800,maxHeight:600}});return t?null:s}))||[],t=(await Promise.all(s)).filter((e=>null!==e));ne(t)}catch(s){}},we=async()=>{try{ee(!0);const{data:e,error:s}=await m.from("community_posts").select("\n          *,\n          likes:post_likes(count),\n          replies:post_replies(count),\n                      profile:profiles!user_id (\n              username,\n              first_name,\n              last_name,\n              avatar_url\n            )\n        ").eq("place_id",je).order("created_at",{ascending:!1}).limit(5);if(s)throw s;J(e||[])}catch(e){}finally{ee(!1)}},be=()=>{const e=a(je,Z?.name||"",U),s=`${window.location.origin}${e}`;navigator.clipboard.writeText(s),B({title:"Link Copied",description:"Place page link copied to clipboard."})},_e=e=>e?"$".repeat(e):null;return O?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#61936f] mx-auto"}),s.jsx("p",{className:"mt-4 text-gray-600",children:T("loading")})]})}):je?X||!Z?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:T("placeNotFound")}),s.jsx("p",{className:"text-gray-600 mb-6",children:X||T("placeNotFoundDescription")}),s.jsxs(r,{onClick:()=>I(-1),children:[s.jsx(j,{className:"h-4 w-4 mr-2"}),T("goBack")]})]})}):s.jsxs(s.Fragment,{children:[Z&&s.jsx(u,{title:`${Z.name} | ZapAround`,description:`${Z.formatted_address||""}${Z.rating?` ‚Ä¢ Rating ${Z.rating.toFixed(1)}${Z.user_ratings_total?` (${Z.user_ratings_total})`:""}`:""}`.trim(),image:ae?.[0]||"/og-image.png",url:`/${U}/zap-places/${t(Z.name)}`,locale:A,breadcrumbs:[{name:"Home",url:`/${U}/`},{name:"Place",url:`/${U}/zap-places/${t(Z.name)}`}],structuredData:{"@context":"https://schema.org","@type":"Place",name:Z.name,address:Z.formatted_address||void 0,url:`https://zaparound.com/${U}/zap-places/${t(Z.name)}`,geo:Z.geometry?.location?{"@type":"GeoCoordinates",latitude:Z.geometry.location.lat,longitude:Z.geometry.location.lng}:void 0,aggregateRating:Z.rating?{"@type":"AggregateRating",ratingValue:Z.rating,reviewCount:Z.user_ratings_total||void 0}:void 0,openingHoursSpecification:Z.opening_hours?.weekday_text?Z.opening_hours.weekday_text.map((e=>({"@type":"OpeningHoursSpecification",description:e}))):void 0,image:ae&&ae.length>0?ae.slice(0,3):void 0}}),s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white shadow-sm border-b sticky top-0 z-50",children:s.jsx("div",{className:"container max-w-7xl mx-auto px-4 py-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(r,{variant:"ghost",onClick:()=>I(-1),className:"flex items-center space-x-2",children:[s.jsx(j,{className:"h-4 w-4"}),s.jsx("span",{children:T("back")})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs(r,{variant:"outline",size:"sm",onClick:async()=>{if(navigator.share&&Z)try{const e=a(je,Z.name,U);await navigator.share({title:Z.name,text:`Check out ${Z.name} on ZapAround!`,url:`${window.location.origin}${e}`})}catch(e){be()}else be()},className:"flex items-center space-x-2 bg-blue-50 border-blue-500 text-blue-600 hover:bg-blue-500 hover:text-white transition-colors duration-200",children:[s.jsx(f,{className:"h-4 w-4"}),s.jsx("span",{children:T("share")})]}),s.jsxs(r,{variant:fe?"default":"outline",size:"sm",onClick:async()=>{if(!Z&&!ge)return void B({title:"Error",description:"Place details not available.",variant:"destructive"});const e={place_id:je,place_name:Z?.name||ge?.name||"",place_address:Z?.formatted_address||"",place_rating:Z?.rating||ge?.rating||0,place_lat:Z?.geometry?.location?.lat??ge?.lat??0,place_lng:Z?.geometry?.location?.lng??ge?.lng??0,place_types:Z?.types||ge?.types||[]};await W(e)},className:"flex items-center space-x-2 transition-colors duration-200 "+(fe?"bg-red-500 text-white hover:bg-red-600":"bg-red-50 border-red-500 text-red-600 hover:bg-red-500 hover:text-white"),children:[s.jsx(v,{className:"h-4 w-4 "+(fe?"fill-current":"")}),s.jsx("span",{children:T(fe?"saved":"save")})]})]})]})})}),s.jsx("div",{className:"container max-w-7xl mx-auto px-4 py-8",children:s.jsxs(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[s.jsx(l,{children:s.jsx(i,{children:s.jsx("div",{className:"flex items-start justify-between",children:s.jsxs("div",{className:"flex items-start space-x-4",children:[s.jsx("div",{className:"text-4xl",children:(ke=Z.types,ke&&0!==ke.length?ke.includes("restaurant")||ke.includes("food")?"üçΩÔ∏è":ke.includes("tourist_attraction")||ke.includes("point_of_interest")?"üèõÔ∏è":ke.includes("lodging")||ke.includes("hotel")?"üè®":ke.includes("shopping_mall")||ke.includes("store")?"üõçÔ∏è":ke.includes("park")||ke.includes("natural_feature")?"üå≥":ke.includes("museum")?"üèõÔ∏è":ke.includes("amusement_park")||ke.includes("entertainment")?"üé°":"üìç":"üìç")}),s.jsxs("div",{className:"flex-1",children:[s.jsx(c,{className:"text-2xl font-bold text-[#030303] mb-2",children:Z.name}),s.jsxs("div",{className:"flex items-center space-x-4 text-sm text-[#62626a]",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(y,{className:"h-4 w-4"}),s.jsx("span",{children:Z.formatted_address})]}),Z.rating&&s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(N,{className:"h-4 w-4 text-yellow-500 fill-current"}),s.jsx("span",{className:"font-medium",children:Z.rating.toFixed(1)}),Z.user_ratings_total&&s.jsxs("span",{children:["(",Z.user_ratings_total,")"]})]}),_e(Z.price_level)&&s.jsx(o,{variant:"secondary",children:_e(Z.price_level)})]})]})]})})})}),ae.length>0&&s.jsxs(l,{children:[s.jsx(i,{children:s.jsxs(c,{className:"flex items-center space-x-2",children:[s.jsx(w,{className:"h-5 w-5"}),s.jsx("span",{children:T("photos")})]})}),s.jsx(d,{children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{ref:he,className:"flex space-x-3 md:space-x-4 overflow-x-auto scrollbar-hide pb-2 -mb-2 snap-x snap-mandatory cursor-grab active:cursor-grabbing",onMouseDown:e=>{he.current&&(le(!0),ce(e.pageX-he.current.offsetLeft),de(he.current.scrollLeft))},onMouseMove:e=>{if(!re||!he.current)return;e.preventDefault();const s=2*(e.pageX-he.current.offsetLeft-ie);he.current.scrollLeft=oe-s},onMouseUp:()=>{le(!1)},onMouseLeave:()=>{le(!1)},onWheel:e=>{he.current&&(e.preventDefault(),he.current.scrollLeft+=e.deltaY)},style:{userSelect:re?"none":"auto"},children:ae.map(((e,t)=>s.jsx("div",{className:"flex-shrink-0 w-48 h-36 md:w-64 md:h-48 rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity shadow-md snap-start",onClick:e=>{re||(e=>{te(e)})(t)},style:{pointerEvents:re?"none":"auto"},children:s.jsx("img",{src:e,alt:`${Z.name} - Photo ${t+1}`,className:"w-full h-full object-cover",loading:"lazy",draggable:!1})},t)))}),ae.length>2&&s.jsx("div",{className:"flex justify-center mt-4 space-x-2",children:Array.from({length:Math.ceil(ae.length/2)},((e,t)=>s.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-300"},t)))})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[s.jsx(l,{children:s.jsx(d,{className:"pt-6",children:s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs(r,{variant:"outline",onClick:()=>{if(Z?.geometry?.location){const{lat:e,lng:s}=Z.geometry.location,t=`https://www.google.com/maps/search/?api=1&query=${e},${s}`;window.open(t,"_blank")}},className:"flex flex-col items-center space-y-2 h-auto py-4",children:[s.jsx(b,{className:"h-5 w-5"}),s.jsx("span",{className:"text-sm",children:T("directions")})]}),Z.website&&s.jsxs(r,{variant:"outline",onClick:()=>window.open(Z.website,"_blank"),className:"flex flex-col items-center space-y-2 h-auto py-4",children:[s.jsx(_,{className:"h-5 w-5"}),s.jsx("span",{className:"text-sm",children:T("website")})]}),Z.international_phone_number&&s.jsxs(r,{variant:"outline",onClick:()=>window.open(`tel:${Z.international_phone_number}`),className:"flex flex-col items-center space-y-2 h-auto py-4",children:[s.jsx(k,{className:"h-5 w-5"}),s.jsx("span",{className:"text-sm",children:T("call")})]}),s.jsxs(r,{variant:"outline",onClick:()=>I("/community",{state:{placeId:je}}),className:"flex flex-col items-center space-y-2 h-auto py-4",children:[s.jsx($,{className:"h-5 w-5"}),s.jsx("span",{className:"text-sm",children:T("posts")})]})]})})}),Z.opening_hours&&s.jsxs(l,{children:[s.jsx(i,{children:s.jsxs(c,{className:"flex items-center space-x-2",children:[s.jsx(C,{className:"h-5 w-5"}),s.jsx("span",{children:T("openingHours")})]})}),s.jsx(d,{children:s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"flex items-center space-x-2",children:s.jsx(o,{variant:Z.opening_hours.open_now?"default":"secondary",children:Z.opening_hours.open_now?T("openNow"):T("closed")})}),Z.opening_hours.weekday_text&&s.jsx("div",{className:"space-y-1",children:Z.opening_hours.weekday_text.map(((e,t)=>s.jsx("div",{className:"text-sm text-[#62626a]",children:e},t)))})]})})]}),Z.reviews&&Z.reviews.length>0&&s.jsxs(l,{children:[s.jsx(i,{children:s.jsxs(c,{className:"flex items-center space-x-2",children:[s.jsx(S,{className:"h-5 w-5"}),s.jsxs("span",{children:[T("reviews")," (",Z.reviews.length,")"]})]})}),s.jsx(d,{children:s.jsx("div",{className:"space-y-4",children:Z.reviews.slice(0,3).map(((e,t)=>s.jsxs("div",{className:"border-b border-gray-100 pb-4 last:border-b-0",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(N,{className:"h-4 w-4 text-yellow-500 fill-current"}),s.jsx("span",{className:"text-sm font-medium",children:e.rating})]}),s.jsxs("span",{className:"text-sm text-[#62626a]",children:["by ",e.author_name]})]}),s.jsx("p",{className:"text-sm text-[#030303]",children:e.text})]},t)))})})]}),s.jsxs(l,{children:[s.jsx(i,{children:s.jsxs(c,{className:"flex items-center space-x-2",children:[s.jsx($,{className:"h-5 w-5"}),s.jsx("span",{children:T("communityPosts")})]})}),s.jsx(d,{children:Q?s.jsx("div",{className:"text-center py-4",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#61936f] mx-auto"})}):Y.length>0?s.jsx("div",{className:"space-y-4",children:Y.map((e=>s.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"h-10 w-10 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center",children:e.profile?.avatar_url?s.jsx("img",{src:e.profile.avatar_url,alt:e.profile.username||"User",className:"w-full h-full object-cover rounded-full"}):s.jsx(S,{className:"h-5 w-5 text-blue-500"})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx("span",{className:"font-medium text-sm",children:e.profile?.username||`${e.profile?.first_name||""} ${e.profile?.last_name||""}`.trim()||"Anonymous"}),s.jsx("span",{className:"text-xs text-[#62626a]",children:new Date(e.created_at).toLocaleDateString()})]}),s.jsx("p",{className:"text-sm text-[#030303] line-clamp-2",children:e.content}),s.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-[#62626a]",children:[s.jsxs("span",{children:[e.likes?.[0]?.count||0," likes"]}),s.jsxs("span",{children:[e.replies?.[0]?.count||0," replies"]})]})]})]})},e.id)))}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx($,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-500",children:T("noPosts")}),s.jsx(r,{onClick:()=>I("/community",{state:{placeId:je}}),className:"mt-4",children:T("beFirstToPost")})]})})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs(l,{children:[s.jsx(i,{children:s.jsx(c,{children:T("quickInfo")})}),s.jsxs(d,{className:"space-y-4",children:[Z.types&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-sm text-[#62626a] mb-2",children:T("categories")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Z.types.slice(0,5).map(((e,t)=>s.jsx(o,{variant:"outline",className:"text-xs",children:e.replace(/_/g," ")},t)))})]}),Z.vicinity&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-sm text-[#62626a] mb-1",children:T("vicinity")}),s.jsx("p",{className:"text-sm text-[#030303]",children:Z.vicinity})]})]})]}),s.jsxs(l,{children:[s.jsx(i,{children:s.jsx(c,{children:T("location")})}),s.jsx(d,{children:s.jsx("div",{ref:pe,className:"w-full h-64 rounded-lg overflow-hidden",style:{minHeight:"256px"}})})]})]})]})]})}),null!==se&&ae.length>0&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center",children:s.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[s.jsx(r,{variant:"ghost",size:"sm",onClick:()=>{te(null)},className:"absolute top-4 right-4 text-white hover:bg-white hover:text-black z-10",children:s.jsx(z,{className:"h-6 w-6"})}),s.jsx(r,{variant:"ghost",size:"sm",onClick:()=>{null!==se&&ae.length>0&&te(0===se?ae.length-1:se-1)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white hover:text-black z-10",children:s.jsx(P,{className:"h-8 w-8"})}),s.jsx(r,{variant:"ghost",size:"sm",onClick:()=>{null!==se&&ae.length>0&&te((se+1)%ae.length)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white hover:text-black z-10",children:s.jsx(L,{className:"h-8 w-8"})}),s.jsx("img",{src:ae[se],alt:`${Z.name} - Photo ${se+1}`,className:"max-w-full max-h-full object-contain"}),s.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white text-sm",children:[se+1," / ",ae.length]})]})})]})]}):s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Invalid Place URL"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"This place page cannot be accessed directly. Please navigate to it from the community or map."}),s.jsxs(r,{onClick:()=>I(`/${U}/community`),children:[s.jsx(j,{className:"h-4 w-4 mr-2"}),"Go to Community"]})]})});var ke};export{H as Z};
//# sourceMappingURL=page-zapplaces.DUC-9mmj.js.map
