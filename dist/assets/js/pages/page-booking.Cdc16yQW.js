import{r as e,j as s}from"../vendor/vendor-react-core.D1hcyiwY.js";import{A as t,F as a,a as n}from"../components/components-booking.BlKl1Fts.js";import{aN as r,aO as i,$ as l,a0 as c,B as d,a1 as o,ai as m,p as x,q as h,r as u,s as g,t as p,I as f,a3 as j,aP as v,C as y,aQ as N,aR as b,k as w,l as _,m as k,V as S,R as F,L as D,aS as C,az as I}from"../components/components-ui.C8hnNhgu.js";import{c as P}from"../components/components-blog.C3TFiFB1.js";import{u as $}from"../hooks/hooks-use-toast.ts.Dg8obzHg.js";import{s as T}from"../components/components-admin.CiIAoamg.js";import{f as O}from"../utils/utils-flightdatapersistence.ts.C7K1q72P.js";import{F as E}from"../components/components-flightbookingloadingdialog.tsx.B_ZOuox7.js";import{u as U}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{u as A,c as R}from"../vendor/vendor--react-router.Gdfmkz0l.js";import{aw as M,f as B,S as L,h as z,P as H,b7 as q,au as V,A as Y,b as G,bl as J,bm as W,r as K,bn as Q,ah as X,bo as Z,aY as ee,t as se,aD as te,u as ae,M as ne,s as re,ak as ie}from"../vendor/vendor--lucide-react.DRw9PYsu.js";import{f as le}from"../vendor/vendor--date-fns.BbAlDtqN.js";import{A as ce}from"../components/components-auth.B-7euJmi.js";import{u as de}from"../hooks/hooks-useprofile.ts.Ck17Ru8_.js";import{u as oe}from"../hooks/hooks-usesecurepassport.ts.Dh9bJBHw.js";import{u as me}from"../hooks/hooks-usedevmode.ts.9ktsDRue.js";import{L as xe}from"../components/components-trips.Ce9sOLST.js";function he(){const{t:n,i18n:w}=U(),_=A(),[k]=R(),{toast:S}=$(),[F,D]=e.useState(),[C,I]=e.useState(),[ae,ne]=e.useState("roundtrip"),[re,ie]=e.useState({adults:1,children:0,infantsInSeat:0,infantsOnLap:0}),[ce,de]=e.useState("economy"),[oe,me]=e.useState(""),[xe,he]=e.useState(""),[ue,ge]=e.useState(!1),[pe,fe]=e.useState(!1),[je,ve]=e.useState(!1),[ye,Ne]=e.useState(!1),[be,we]=e.useState(null),[_e,ke]=e.useState(""),[Se,Fe]=e.useState(0),[De,Ce]=e.useState(null),[Ie,Pe]=e.useState(!1),[$e,Te]=e.useState({id:`pas_${Math.random().toString(36).substr(2,9)}`,title:"",given_name:"",family_name:"",email:"",phone_number:"",gender:"",born_on:""}),[Oe,Ee]=e.useState(!1),[Ue,Ae]=e.useState(null),[Re,Me]=e.useState("USD"),[Be,Le]=e.useState({}),[ze,He]=e.useState(!1),[qe,Ve]=e.useState(null),Ye=e.useRef(0),[Ge,Je]=e.useState(1),We=e.useRef(null),Ke=e.useRef(""),[Qe,Xe]=e.useState("best"),[Ze,es]=e.useState(new Set),[ss,ts]=e.useState({airlines:[],stops:"any",bags:"any",priceRange:[0,5e3],connectingAirports:[],duration:[0,24]}),[as,ns]=e.useState(0),[rs,is]=e.useState(!1),[ls,cs]=e.useState(!1),[ds,os]=e.useState(!1),[ms,xs]=e.useState(null),[hs,us]=e.useState(null),gs=()=>({origin:oe,destination:xe,departureDate:F?.toISOString().split("T")[0]||"",returnDate:C?.toISOString().split("T")[0],passengers:re.adults+re.children+re.infantsInSeat+re.infantsOnLap,cabinClass:ce,currency:Re,maxConnections:1}),ps=async e=>{const s=gs();await O.saveFlightData(s,e,e.timing||null,De?.id,{currentStep:"search"});Fe(Date.now());const t=O.createSearchUrl(s,w.language);window.history.replaceState({},"",t)},fs=async()=>{const e=O.getSearchIdFromUrl(window.location.href);if(e){const s=await O.loadFlightDataBySearchId(e);if(s)return void(await js(s))}const s=await(async()=>{const e=gs();return await O.loadFlightData(e)})();s&&await js(s)},js=async e=>{const s=await O.needsRefresh(e.searchParams);if(s.needsRefresh){os(!0),xs(s.reason);const e="expired"===s.reason?"Flight offers have expired. Refreshing search...":"Flight data is stale. Refreshing search...";S({title:"Data Refresh Required",description:e,duration:3e3}),Ne(!0),_s(!0)}else{we(e.searchResults),Fe(e.searchTimestamp),us(e.timing),Ce(e.selectedOfferId?e.searchResults.data.offers.find((s=>s.id===e.selectedOfferId)):null);const s=e.searchParams;me(s.origin),he(s.destination),s.departureDate&&D(new Date(s.departureDate)),s.returnDate&&I(new Date(s.returnDate)),de(s.cabinClass),Me(s.currency),ie({adults:s.passengers,children:0,infantsInSeat:0,infantsOnLap:0})}},vs=()=>{const e=qe||be?.data?.offers||[];return e.length?e.filter((e=>{if(ss.airlines.length>0){const s=e.slices[0]?.segments[0]?.marketing_carrier?.iata_code;if(!s||!ss.airlines.includes(s))return!1}if("any"!==ss.stops){const s=e.slices.reduce(((e,s)=>e+Math.max(0,s.segments.length-1)),0);switch(ss.stops){case"nonstop":if(s>0)return!1;break;case"1_or_fewer":if(s>1)return!1;break;case"2_or_fewer":if(s>2)return!1}}const s=e.converted_amount?parseFloat(e.converted_amount):parseFloat(e.total_amount);if(s<ss.priceRange[0]||s>ss.priceRange[1])return!1;const t=e.slices.reduce(((e,s)=>e+(e=>{if(!e.length)return 0;const s=e[0],t=e[e.length-1],a=new Date(s.departing_at);return(new Date(t.arriving_at).getTime()-a.getTime())/36e5})(s.segments)),0);if(t<ss.duration[0]||t>ss.duration[1])return!1;if(ss.connectingAirports.length>0){if(!e.slices.flatMap((e=>e.segments.slice(1,-1).map((e=>e.origin?.iata_code)))).filter(Boolean).some((e=>ss.connectingAirports.includes(e))))return!1}return!0})):[]},ys=re.adults+re.children+re.infantsInSeat+re.infantsOnLap,Ns=(e,s)=>{const t={...re},a=t[e]+s;"adults"===e?a>=1&&a<=9&&(t[e]=a):"children"===e?a>=0&&a<=8&&ys+s<=9&&(t[e]=a):"infantsInSeat"===e?a>=0&&a<=4&&ys+s<=9&&(t[e]=a):"infantsOnLap"===e&&a>=0&&a<=4&&ys+s<=9&&(t[e]=a),ie(t)},bs=async e=>{if(Be[e]&&Date.now()-Ye.current<3e5)return Be[e];try{const s=await fetch(`https://open.er-api.com/v6/latest/${e}`);if(!s.ok)throw new Error("Failed to fetch exchange rates");const t=await s.json();if("success"===t.result)return Le((s=>({...s,[e]:t.rates}))),Ye.current=Date.now(),t.rates;throw new Error("Invalid response from exchange rate API")}catch(s){return Be[e]}},ws=(e,s)=>new Intl.NumberFormat("en-US",{style:"currency",currency:s,minimumFractionDigits:2,maximumFractionDigits:2}).format(e);e.useEffect((()=>{if(!be?.data?.offers||!be.data.offers.length)return He(!1),void Ve(null);be.timing&&us(be.timing),be?.data?.offers&&be.data.offers.length>0&&(cs(!1),os(!1),xs(null));const e=be.data.offers[0].total_currency;if(e!==Re){He(!0);(async()=>{const s=await bs(e);if(s&&s[Re]){const e=be.data.offers.map((e=>({...e,converted_amount:(parseFloat(e.total_amount)*s[Re]).toFixed(2),converted_currency:Re})));Ve(e)}else Ve(null)})()}else He(!1),Ve(null);(async()=>{const e=new Set;be.data.offers.forEach((s=>{s.conditions?.change_before_departure?.penalty_currency&&e.add(s.conditions.change_before_departure.penalty_currency),s.conditions?.refund_before_departure?.penalty_currency&&e.add(s.conditions.refund_before_departure.penalty_currency)}));for(const s of e)s===Re||Be[s]||await bs(s)})()}),[be]),e.useEffect((()=>{if(!be?.data?.offers||!be.data.offers.length)return;const e=be.data.offers[0].total_currency;if(e!==Re){He(!0);(async()=>{const s=await bs(e);if(s&&s[Re]){const e=be.data.offers.map((e=>({...e,converted_amount:(parseFloat(e.total_amount)*s[Re]).toFixed(2),converted_currency:Re})));Ve(e)}else Ve(null)})()}else He(!1),Ve(null);(async()=>{const e=new Set;be.data.offers.forEach((s=>{s.conditions?.change_before_departure?.penalty_currency&&e.add(s.conditions.change_before_departure.penalty_currency),s.conditions?.refund_before_departure?.penalty_currency&&e.add(s.conditions.refund_before_departure.penalty_currency)}));for(const s of e)s!==Re&&await bs(s)})()}),[Re]),e.useEffect((()=>{const e=async()=>{const e=gs(),s=await O.getTimeRemaining(e);s>0?(ns(s),is(!1),s<12e4&&!ye&&!rs&&S({title:"Offers Expiring Soon",description:"Flight offers will expire in less than 2 minutes. Consider refreshing to get updated prices.",duration:5e3})):(ns(0),is(!0))};e();const s=setInterval(e,1e3);return()=>clearInterval(s)}),[hs,be]),e.useEffect((()=>{if(Se>0){const e=Date.now();cs(e-Se>18e5)}else cs(be?.data?.offers&&be.data.offers.length>0&&!hs?.expires_at&&!hs?.search_started_at)}),[Se,be,hs]),e.useEffect((()=>{const e=k.get("origin"),s=k.get("destination"),t=k.get("departureDate"),a=k.get("returnDate"),n=k.get("tripType"),r=k.get("adults"),i=k.get("children"),l=k.get("infantsInSeat"),c=k.get("infantsOnLap"),d=k.get("cabinClass");e&&me(e),s&&he(s),t&&D(new Date(t)),a&&I(new Date(a)),n&&ne(n),d&&de(d),r&&ie((e=>({...e,adults:parseInt(r)}))),i&&ie((e=>({...e,children:parseInt(i)}))),l&&ie((e=>({...e,infantsInSeat:parseInt(l)}))),c&&ie((e=>({...e,infantsOnLap:parseInt(c)})));if(O.getSearchIdFromUrl(window.location.href))return void fs();if(!e&&!s)return void fs();const o=`${e}-${s}-${t}-${a}-${r}-${i}-${l}-${c}-${d}`;if(e&&s&&t&&d&&Ke.current!==o){Ke.current=o;const n=t,m=a||void 0,x={origin:e.toUpperCase(),destination:s.toUpperCase(),departureDate:n,returnDate:m,passengers:parseInt(r||"1")+parseInt(i||"0")+parseInt(l||"0")+parseInt(c||"0"),passengerTypes:{adults:parseInt(r||"1"),children:parseInt(i||"0"),infantsInSeat:parseInt(l||"0"),infantsOnLap:parseInt(c||"0")},cabinClass:d.toLowerCase(),maxConnections:1,currency:Re};(async()=>{try{ve(!0);const{data:e,error:s}=await T.functions.invoke("duffel-search",{body:x});if(s)throw new Error(s.message||"Failed to search for flights");if(!e)throw new Error("No search results received");we(e),ps(e)}catch(e){S({title:"Search Failed",description:e.message||"Failed to search for flights. Please try again.",variant:"destructive"})}finally{ve(!1)}})()}}),[k,Re]),e.useEffect((()=>{Je(1)}),[be,qe]);const _s=async(e=!1)=>{try{if(e||ve(!0),!(oe&&xe&&F&&ce))return void S({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});const s=F.toISOString().split("T")[0],t=C?C.toISOString().split("T")[0]:void 0,a={origin:oe.toUpperCase(),destination:xe.toUpperCase(),departureDate:s,returnDate:t,passengers:ys,passengerTypes:{adults:re.adults,children:re.children,infantsInSeat:re.infantsInSeat,infantsOnLap:re.infantsOnLap},cabinClass:ce.toLowerCase(),maxConnections:1,currency:Re},{data:n,error:r}=await T.functions.invoke("duffel-search",{body:a});if(r)throw new Error(r.message||"Failed to search for flights");if(!n)throw new Error("No search results received");we(n),ps(n)}catch(s){S({title:"Search Failed",description:s.message||"Failed to search for flights. Please try again.",variant:"destructive"})}finally{e||ve(!1),Ne(!1)}},ks=e=>{try{const s=new Date(e);return isNaN(s.getTime())?"N/A":le(s,"HH:mm")}catch(s){return"N/A"}},Ss=e=>{try{const s=new Date(e);return isNaN(s.getTime())?"N/A":le(s,"MMM d, yyyy")}catch(s){return"N/A"}},Fs=e=>{const s=e.replace(/\D/g,"");return`+${s.startsWith("1")?s:`1${s}`}`},Ds=async()=>{try{if(Ee(!0),rs||ls)return void S({title:"Offers Expired",description:"The flight offers have expired or are too old. Please refresh the search to get updated prices.",variant:"destructive"});if(!($e.title&&$e.given_name&&$e.family_name&&$e.email&&$e.phone_number&&$e.gender&&$e.born_on))return void S({title:"Missing Information",description:"Please fill in all required passenger information",variant:"destructive"});if(!De?.passengers?.[0]?.id)throw new Error("No passenger ID found in the offer");const e={offerId:De?.id,passengers:[{...$e,id:De.passengers[0].id,gender:"male"===$e.gender?"m":"f",phone_number:Fs($e.phone_number),born_on:new Date($e.born_on).toISOString().split("T")[0]}],payments:[{type:"balance",currency:Re||De?.total_currency||"USD",amount:De?.total_amount||"0"}]},{data:s,error:t}=await T.functions.invoke("duffel-booking",{body:e});if(t)throw t;Ae(s),S({title:"Booking Successful",description:"Your flight has been booked successfully!"}),Pe(!1),Ce(null),we(null),Te({id:"",title:"",given_name:"",family_name:"",email:"",phone_number:"",gender:"",born_on:""})}catch(e){S({title:"Booking Failed",description:e.message||"Failed to book the flight",variant:"destructive"})}finally{Ee(!1)}};return s.jsxs("div",{className:"min-h-screen bg-[#fcfcfc]",children:[s.jsx(E,{isOpen:je}),s.jsxs("div",{className:"sticky top-16 z-20 bg-white border-b border-[#e5e5e5] shadow-sm",children:[s.jsx("div",{className:"px-4 pb-4 flex justify-center",children:s.jsx("div",{className:"max-w-6xl w-full",children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),_s()},className:"flex flex-col gap-4 justify-center w-full pt-8",role:"search","aria-label":"Flight search form",children:[s.jsx("div",{className:"flex justify-left w-full items-end",children:s.jsxs(r,{type:"single",value:ae,onValueChange:e=>e&&ne(e),className:"justify-center",id:"trip-type",children:[s.jsx(i,{value:"roundtrip",className:"px-3 py-1.5 text-sm data-[state=on]:text-[#61936f] data-[state=on]:border-[#61936f] data-[state=on]:bg-[#61936f]/5 hover:bg-[#61936f]/10 data-[state=off]:bg-transparent data-[state=off]:text-[#62626a] data-[state=off]:border-[#e5e5e5]",children:"Round Trip"}),s.jsx(i,{value:"oneway",className:"px-3 py-1.5 text-sm data-[state=on]:text-[#61936f] data-[state=on]:border-[#61936f] data-[state=on]:bg-[#61936f]/5 hover:bg-[#61936f]/10 data-[state=off]:bg-transparent data-[state=off]:text-[#62626a] data-[state=off]:border-[#e5e5e5]",children:"One Way"})]})}),s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-end justify-center w-full",children:[s.jsxs("div",{className:"w-full md:w-auto",children:[s.jsx("label",{htmlFor:"from",className:"sr-only",children:"From"}),s.jsx(t,{value:oe,onChange:me,placeholder:"From",className:"min-w-[200px]"})]}),s.jsxs("div",{className:"w-full md:w-auto",children:[s.jsx("label",{htmlFor:"to",className:"sr-only",children:"To"}),s.jsx(t,{value:xe,onChange:he,placeholder:"To",className:"min-w-[200px]"})]}),s.jsxs("div",{className:"hidden md:block w-full md:w-auto",children:[s.jsx("label",{htmlFor:"passengers",className:"sr-only",children:"Passengers"}),s.jsxs(l,{children:[s.jsx(c,{asChild:!0,children:s.jsxs(d,{variant:"outline",className:"w-16 justify-center text-left font-normal",id:"passengers",type:"button",children:[s.jsx(M,{className:"mr-2 h-4 w-4"}),ys]})}),s.jsx(o,{className:"w-80 p-4",align:"start",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium leading-none",children:"Passengers"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Adults"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Age 12+"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("adults",-1),disabled:re.adults<=1,className:"h-8 w-8 p-0",children:"-"}),s.jsx("span",{className:"w-8 text-center text-sm",children:re.adults}),s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("adults",1),disabled:re.adults>=9||ys>=9,className:"h-8 w-8 p-0",children:"+"})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Children"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Age 2-11"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("children",-1),disabled:re.children<=0,className:"h-8 w-8 p-0",children:"-"}),s.jsx("span",{className:"w-8 text-center text-sm",children:re.children}),s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("children",1),disabled:re.children>=8||ys>=9,className:"h-8 w-8 p-0",children:"+"})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Infants (In seat)"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Under 2 with seat"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("infantsInSeat",-1),disabled:re.infantsInSeat<=0,className:"h-8 w-8 p-0",children:"-"}),s.jsx("span",{className:"w-8 text-center text-sm",children:re.infantsInSeat}),s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("infantsInSeat",1),disabled:re.infantsInSeat>=4||ys>=9,className:"h-8 w-8 p-0",children:"+"})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Infants (On lap)"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Under 2 without seat"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("infantsOnLap",-1),disabled:re.infantsOnLap<=0,className:"h-8 w-8 p-0",children:"-"}),s.jsx("span",{className:"w-8 text-center text-sm",children:re.infantsOnLap}),s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("infantsOnLap",1),disabled:re.infantsOnLap>=4||ys>=9,className:"h-8 w-8 p-0",children:"+"})]})]})]}),s.jsx("div",{className:"pt-3 border-t",children:s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Total: ",ys," passenger",1!==ys?"s":""]})})]})})]})]}),s.jsxs("div",{className:"w-full md:w-auto",children:[s.jsx("label",{htmlFor:"departure-date",className:"sr-only",children:"Departure Date"}),s.jsxs(l,{open:ue,onOpenChange:ge,children:[s.jsx(c,{asChild:!0,children:s.jsxs(d,{variant:"outline",className:P("w-full min-w-[140px] justify-start text-left font-normal",!F&&"text-muted-foreground"),id:"departure-date",type:"button",children:[s.jsx(B,{className:"mr-2 h-4 w-4"}),F?le(F,"PPP"):"Departure"]})}),s.jsx(o,{className:"w-auto p-0",children:s.jsx(m,{mode:"single",selected:F,onSelect:e=>{D(e),e&&(ge(!1),"roundtrip"===ae&&fe(!0))},initialFocus:!0,disabled:e=>{const s=new Date;s.setHours(0,0,0,0);const t=new Date(e);return t.setHours(0,0,0,0),t<s}})})]})]}),"roundtrip"===ae&&s.jsxs("div",{className:"w-full md:w-auto",children:[s.jsx("label",{htmlFor:"return-date",className:"sr-only",children:"Return Date"}),s.jsxs(l,{open:pe,onOpenChange:fe,children:[s.jsx(c,{asChild:!0,children:s.jsxs(d,{variant:"outline",className:P("w-full min-w-[140px] justify-start text-left font-normal",!C&&"text-muted-foreground"),id:"return-date",type:"button",children:[s.jsx(B,{className:"mr-2 h-4 w-4"}),C?le(C,"PPP"):"Return"]})}),s.jsx(o,{className:"w-auto p-0",children:s.jsx(m,{mode:"single",selected:C,onSelect:e=>{I(e),e&&fe(!1)},initialFocus:!0,disabled:e=>{const s=new Date;s.setHours(0,0,0,0);const t=F?new Date(F):s;t.setHours(0,0,0,0);const a=new Date(e);return a.setHours(0,0,0,0),a<s||F&&a<=t}})})]})]}),s.jsxs("div",{className:"w-full md:w-auto",children:[s.jsx("label",{htmlFor:"class",className:"sr-only",children:"Class"}),s.jsxs(x,{value:ce,onValueChange:de,children:[s.jsx(h,{id:"class",className:"w-full min-w-[120px]",children:s.jsx(u,{placeholder:"Class"})}),s.jsxs(g,{children:[s.jsx(p,{value:"economy",children:"Economy"}),s.jsx(p,{value:"premium_economy",children:"Premium Economy"}),s.jsx(p,{value:"business",children:"Business"}),s.jsx(p,{value:"first",children:"First"})]})]})]}),s.jsxs("div",{className:"w-full md:w-auto",children:[s.jsx("label",{htmlFor:"currency",className:"sr-only",children:"Currency"}),s.jsxs(x,{value:Re,onValueChange:Me,children:[s.jsx(h,{id:"currency",className:"w-20",children:s.jsx(u,{placeholder:"Currency"})}),s.jsxs(g,{children:[s.jsx(p,{value:"USD",children:"USD"}),s.jsx(p,{value:"EUR",children:"EUR"}),s.jsx(p,{value:"GBP",children:"GBP"}),s.jsx(p,{value:"CAD",children:"CAD"}),s.jsx(p,{value:"AUD",children:"AUD"}),s.jsx(p,{value:"JPY",children:"JPY"}),s.jsx(p,{value:"CHF",children:"CHF"})]})]})]}),s.jsxs("div",{className:"block md:hidden w-full md:w-auto",children:[s.jsx("label",{htmlFor:"passengers-mobile",className:"sr-only",children:"Passengers"}),s.jsxs(l,{children:[s.jsx(c,{asChild:!0,children:s.jsxs(d,{variant:"outline",className:"w-16 justify-center text-left font-normal",id:"passengers-mobile",type:"button",children:[s.jsx(M,{className:"mr-2 h-4 w-4"}),ys]})}),s.jsx(o,{className:"w-80 p-4",align:"start",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium leading-none",children:"Passengers"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Adults"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Age 12+"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("adults",-1),disabled:re.adults<=1,className:"h-8 w-8 p-0",children:"-"}),s.jsx("span",{className:"w-8 text-center text-sm",children:re.adults}),s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("adults",1),disabled:re.adults>=9||ys>=9,className:"h-8 w-8 p-0",children:"+"})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Children"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Age 2-11"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("children",-1),disabled:re.children<=0,className:"h-8 w-8 p-0",children:"-"}),s.jsx("span",{className:"w-8 text-center text-sm",children:re.children}),s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("children",1),disabled:re.children>=8||ys>=9,className:"h-8 w-8 p-0",children:"+"})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Infants (In seat)"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Under 2 with seat"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("infantsInSeat",-1),disabled:re.infantsInSeat<=0,className:"h-8 w-8 p-0",children:"-"}),s.jsx("span",{className:"w-8 text-center text-sm",children:re.infantsInSeat}),s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("infantsInSeat",1),disabled:re.infantsInSeat>=4||ys>=9,className:"h-8 w-8 p-0",children:"+"})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Infants (On lap)"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Under 2 without seat"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("infantsOnLap",-1),disabled:re.infantsOnLap<=0,className:"h-8 w-8 p-0",children:"-"}),s.jsx("span",{className:"w-8 text-center text-sm",children:re.infantsOnLap}),s.jsx(d,{variant:"outline",size:"sm",onClick:()=>Ns("infantsOnLap",1),disabled:re.infantsOnLap>=4||ys>=9,className:"h-8 w-8 p-0",children:"+"})]})]})]}),s.jsx("div",{className:"pt-3 border-t",children:s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Total: ",ys," passenger",1!==ys?"s":""]})})]})})]})]}),s.jsx("div",{className:"w-full md:w-auto",children:s.jsx(d,{className:"w-full min-w-[120px] bg-gradient-to-r from-[#10B981] to-[#059669] text-white border-none hover:from-[#059669] hover:to-[#047857] hover:scale-105 transition-all duration-300 shadow-lg rounded-full font-medium tracking-wide",type:"submit",disabled:je,"aria-label":"Search flights",children:s.jsx("span",{className:"flex items-center gap-2",children:je?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Searching..."]}):s.jsxs(s.Fragment,{children:[s.jsx(L,{className:"h-4 w-4"}),"Search"]})})})})]})]})})}),be?.data?.offers&&be.data.offers.length>0&&s.jsx("div",{className:"px-4 pb-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm font-medium text-[#62626a]",children:"Sort by:"}),s.jsxs(r,{type:"single",value:Qe,onValueChange:e=>e&&Xe(e),className:"justify-start",children:[s.jsx(i,{value:"best",className:"px-4 py-1 text-xs data-[state=on]:bg-[#61936f] data-[state=on]:text-white data-[state=on]:border-[#61936f] hover:bg-[#61936f]/10",children:"Best"}),s.jsx(i,{value:"direct",className:"px-4 py-1 text-xs data-[state=on]:bg-[#61936f] data-[state=on]:text-white data-[state=on]:border-[#61936f] hover:bg-[#61936f]/10",children:"Most Direct"}),s.jsx(i,{value:"cheapest",className:"px-4 py-1 text-xs data-[state=on]:bg-[#61936f] data-[state=on]:text-white data-[state=on]:border-[#61936f] hover:bg-[#61936f]/10",children:"Cheapest"}),s.jsx(i,{value:"fastest",className:"px-4 py-1 text-xs data-[state=on]:bg-[#61936f] data-[state=on]:text-white data-[state=on]:border-[#61936f] hover:bg-[#61936f]/10",children:"Fastest"})]}),s.jsxs("span",{className:"text-xs text-[#62626a] ml-2",children:["(","best"===Qe?"Price + Duration + Stops":"direct"===Qe?"Fewest stops":"cheapest"===Qe?"Lowest price":"Shortest duration",")"]})]})})]}),s.jsxs("div",{className:"max-w-5xl mx-auto px-2 md:px-0 pt-8",children:[be&&be.data.offers&&be.data.offers.length>0&&s.jsx(a,{onFiltersChange:e=>{ts(e)}}),be&&s.jsxs("div",{className:"mt-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("h2",{className:"text-2xl font-semibold text-[#1d1d1e]",children:"Available Flights"}),hs?.expires_at&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium "+(rs?"bg-red-100 text-red-700 border border-red-200":as<6e4?"bg-orange-100 text-orange-700 border border-orange-200":"bg-green-100 text-green-700 border border-green-200"),children:[s.jsx(z,{className:"h-4 w-4"}),rs?s.jsx("span",{children:"Offers Expired"}):s.jsxs("span",{children:["Expires in ",O.formatTimeRemaining(as)]})]}),be?.data?.offers&&be.data.offers.length>0&&ls&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-700 border border-yellow-200",children:[s.jsx(z,{className:"h-4 w-4"}),s.jsx("span",{children:"Offers may be expired - Refresh recommended"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[Se>0&&s.jsxs("div",{className:"text-sm text-[#62626a]",children:[n("search.lastUpdated"),": ",new Date(Se).toLocaleTimeString()]}),ye&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-[#61936f]",children:[s.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-[#61936f] border-t-transparent"}),n("search.refreshing")]}),s.jsxs(d,{variant:"outline",size:"sm",onClick:()=>_s(!0),disabled:ye,className:"text-[#61936f] border-[#61936f] hover:bg-[#61936f] hover:text-white",children:[s.jsx(L,{className:"h-4 w-4 mr-1"}),n("search.refresh")]})]})]}),ze&&s.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 mb-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),s.jsx("div",{className:"ml-3",children:s.jsxs("p",{className:"text-sm",children:[s.jsx("strong",{children:"Currency Conversion:"})," Original prices are in ",be?.data?.offers[0]?.total_currency,". Converted prices in ",Re," are shown for your convenience using real-time exchange rates."]})})]})}),(()=>{if(!(qe||be?.data?.offers||[]).length)return null;const e=((e,s)=>{if(!e||0===e.length)return e;const t=[...e];switch(s){case"cheapest":return t.sort(((e,s)=>parseFloat(e.converted_amount||e.total_amount)-parseFloat(s.converted_amount||s.total_amount)));case"fastest":return t.sort(((e,s)=>{const t=e=>e.slices.reduce(((e,s)=>{if(!s.segments.length)return e;const t=new Date(s.segments[0].departing_at);return e+(new Date(s.segments[s.segments.length-1].arriving_at).getTime()-t.getTime())}),0);return t(e)-t(s)}));case"direct":return t.sort(((e,s)=>{const t=e=>e.slices.reduce(((e,s)=>e+Math.max(0,s.segments.length-1)),0);return t(e)-t(s)}));default:return t.sort(((e,s)=>{const t=e=>parseFloat(e.converted_amount||e.total_amount)/100*.5+e.slices.reduce(((e,s)=>{if(!s.segments.length)return e;const t=new Date(s.segments[0].departing_at);return e+(new Date(s.segments[s.segments.length-1].arriving_at).getTime()-t.getTime())}),0)/36e5*.3+.2*e.slices.reduce(((e,s)=>e+Math.max(0,s.segments.length-1)),0);return t(e)-t(s)}))}})(vs(),Qe),t=e.filter((e=>{if(!hs?.expires_at)return!0;return(new Date).getTime()<new Date(hs.expires_at).getTime()-3e5}));if(t.length<e.length){e.length,t.length}if(0===t.length)return s.jsx("div",{className:"text-center py-8",children:s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[s.jsx("div",{className:"flex items-center justify-center mb-4",children:s.jsx(z,{className:"h-8 w-8 text-red-500"})}),s.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"All Offers Have Expired"}),s.jsx("p",{className:"text-red-600 mb-4",children:"The flight offers have expired. Please refresh your search to get current prices."}),s.jsx(d,{onClick:()=>_s(!1),className:"bg-red-600 hover:bg-red-700 text-white",children:"Refresh Search"})]})});const a=Math.ceil(t.length/10),n=10*(Ge-1),r=n+10,i=t.slice(n,r);return s.jsxs("div",{ref:We,className:"space-y-6",children:[i.map((e=>{if(!e?.slices?.length)return null;const t=(e,s)=>{if(null===e||null===s)return"Unknown";if(s===Re)return`${e} ${s}`;if(Be[s]&&Be[s][Re]){return`${(parseFloat(e)*Be[s][Re]).toFixed(2)} ${Re}`}return`${e} ${s}`},a=e=>e?e.allowed?"0.00"===e.penalty_amount?{text:"Free",color:"text-green-500",icon:G}:{text:`Fee: ${t(e.penalty_amount,e.penalty_currency)}`,color:"text-yellow-500",icon:se}:{text:"Not allowed",color:"text-red-500",icon:te}:{text:"Unknown",color:"text-gray-500",icon:se},n=e=>{if(!e.length)return"";const s=new Date(e[0].departing_at),t=(new Date(e[e.length-1].arriving_at).getTime()-s.getTime())/1e3/60,a=Math.floor(t/60),n=Math.round(t%60);return`${a}h${n>0?` ${n}m`:""}`},r=e=>Math.max(0,e.length-1),i=()=>{if(!hs?.expires_at)return!1;const e=(new Date).getTime();return new Date(hs.expires_at).getTime()-e<6e5};return s.jsx(v,{open:Ze.has(e.id),onOpenChange:()=>(e=>{const s=new Set(Ze);s.has(e)?s.delete(e):s.add(e),es(s)})(e.id),children:s.jsxs(y,{className:"overflow-hidden border rounded-2xl shadow-md bg-white "+(i()?"border-orange-300 bg-orange-50":"border-[#e5e5e5]"),children:[s.jsx(N,{asChild:!0,children:s.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[s.jsx("div",{className:"flex items-center gap-3",children:e.slices[0]?.segments[0]?.operating_carrier?.logo_symbol_url?s.jsx("img",{src:e.slices[0].segments[0].operating_carrier.logo_symbol_url,alt:e.slices[0].segments[0].operating_carrier.name+" logo",className:"w-8 h-8 object-contain rounded-full border border-[#e5e5e5] bg-white shadow-sm",loading:"lazy",onError:e=>{e.currentTarget.style.display="none"}}):s.jsx("div",{className:"w-8 h-8 rounded-full bg-[#f3f3f3] flex items-center justify-center",children:s.jsx(H,{className:"w-4 h-4 text-[#61936f]"})})}),s.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"font-bold text-lg text-[#1d1d1e]",children:ks(e.slices[0]?.segments[0]?.departing_at)}),s.jsx("div",{className:"text-xs text-[#62626a]",children:e.slices[0]?.segments[0]?.origin?.iata_code})]}),i()&&s.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-700 border border-orange-200",children:[s.jsx(z,{className:"h-3 w-3"}),s.jsx("span",{children:"Expires Soon"})]}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"text-xs text-[#62626a] font-medium",children:n(e.slices[0]?.segments)}),s.jsx("div",{className:"flex items-center gap-1",children:0===r(e.slices[0]?.segments)?s.jsx("span",{className:"text-xs text-[#61936f]",children:"Nonstop"}):s.jsxs("span",{className:"text-xs text-[#eab308]",children:[r(e.slices[0]?.segments)," stop",r(e.slices[0]?.segments)>1?"s":""]})})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"font-bold text-lg text-[#1d1d1e]",children:ks(e.slices[0]?.segments[e.slices[0]?.segments.length-1]?.arriving_at)}),s.jsx("div",{className:"text-xs text-[#62626a]",children:e.slices[0]?.segments[e.slices[0]?.segments.length-1]?.destination?.iata_code})]})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-sm text-[#1d1d1e]",children:e.slices[0]?.segments[0]?.marketing_carrier?.name||"Unknown Airline"}),s.jsx("div",{className:"text-xs text-[#62626a]",children:"roundtrip"===ae?"round trip":"one way"})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-xl font-bold text-[#61936f]",children:e.converted_amount?ws(parseFloat(e.converted_amount),e.converted_currency):ws(parseFloat(e.total_amount),e.total_currency)}),e.converted_amount&&s.jsxs("span",{className:"block text-xs text-gray-400",children:["(",ws(parseFloat(e.total_amount),e.total_currency)," USD)"]})]}),s.jsx(d,{variant:"ghost",size:"sm",className:"p-1",children:Ze.has(e.id)?s.jsx(q,{className:"w-4 h-4"}):s.jsx(V,{className:"w-4 h-4"})})]})]})})}),s.jsx(b,{children:s.jsx("div",{className:"px-4 pb-4 border-t border-gray-100",children:s.jsxs("div",{className:"pt-4 space-y-4",children:[e.slices.map(((e,t)=>{if(!e?.segments?.length)return null;const a=r(e.segments);return s.jsxs("div",{className:"mb-4",children:[t>0&&s.jsx(j,{className:"my-4"}),s.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:gap-6",children:s.jsxs("div",{className:"flex-1 flex flex-col md:flex-row md:items-center gap-4",children:[s.jsxs("div",{className:"flex flex-col items-center min-w-[80px]",children:[s.jsx("div",{className:"font-bold text-lg text-[#1d1d1e]",children:ks(e.segments[0].departing_at)}),s.jsx("div",{className:"text-xs text-[#62626a]",children:e.segments[0].origin?.iata_code}),s.jsx("div",{className:"text-xs text-[#62626a]",children:Ss(e.segments[0].departing_at)})]}),s.jsxs("div",{className:"flex flex-col items-center flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Y,{className:"w-5 h-5 text-[#61936f]"}),s.jsx("span",{className:"text-xs text-[#62626a] font-medium",children:n(e.segments)}),s.jsx(Y,{className:"w-5 h-5 text-[#61936f] rotate-180"})]}),s.jsx("div",{className:"flex items-center gap-1 mt-1",children:0===a?s.jsxs("span",{className:"text-xs text-[#61936f] flex items-center gap-1",children:[s.jsx(G,{className:"w-4 h-4"})," Nonstop"]}):s.jsxs("span",{className:"text-xs text-[#eab308] flex items-center gap-1",children:[s.jsx(J,{className:"w-4 h-4"})," ",a," stop",a>1?"s":""]})})]}),s.jsxs("div",{className:"flex flex-col items-center min-w-[80px]",children:[s.jsx("div",{className:"font-bold text-lg text-[#1d1d1e]",children:ks(e.segments[e.segments.length-1].arriving_at)}),s.jsx("div",{className:"text-xs text-[#62626a]",children:e.segments[e.segments.length-1].destination?.iata_code}),s.jsx("div",{className:"text-xs text-[#62626a]",children:Ss(e.segments[e.segments.length-1].arriving_at)})]})]})})]},t)})),s.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[s.jsxs("div",{className:"flex items-center gap-2 bg-[#f3f3f3] rounded px-3 py-1",children:[s.jsx(M,{className:"w-4 h-4 text-[#61936f]"}),s.jsxs("div",{className:"text-xs text-[#1d1d1e] flex flex-wrap gap-1",children:[re.adults>0&&s.jsxs("span",{children:[re.adults," Adult",re.adults>1?"s":""]}),re.children>0&&s.jsxs("span",{children:[re.children," Child",re.children>1?"ren":""]}),re.infantsInSeat>0&&s.jsxs("span",{children:[re.infantsInSeat," Infant",re.infantsInSeat>1?"s":""," (seat)"]}),re.infantsOnLap>0&&s.jsxs("span",{children:[re.infantsOnLap," Infant",re.infantsOnLap>1?"s":""," (lap)"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 bg-[#f3f3f3] rounded px-3 py-1",children:[s.jsx(W,{className:"w-4 h-4 text-[#61936f]"}),s.jsx("span",{className:"text-xs text-[#1d1d1e] capitalize",children:"premium_economy"===ce?"Premium Economy":"business"===ce?"Business":"first"===ce?"First":"Economy"})]}),s.jsxs("div",{className:"flex items-center gap-2 bg-[#f3f3f3] rounded px-3 py-1",children:[s.jsx(K,{className:"w-4 h-4 text-[#61936f]"}),s.jsx("span",{className:"text-xs text-[#1d1d1e]",children:"Baggage info"})]}),s.jsxs("div",{className:"flex items-center gap-2 bg-[#f3f3f3] rounded px-3 py-1",children:[s.jsx(Q,{className:"w-4 h-4 text-[#61936f]"}),s.jsx("span",{className:"text-xs text-[#1d1d1e]",children:"Wi-Fi"})]}),s.jsxs("div",{className:"flex items-center gap-2 bg-[#f3f3f3] rounded px-3 py-1",children:[s.jsx(X,{className:"w-4 h-4 text-[#61936f]"}),s.jsx("span",{className:"text-xs text-[#1d1d1e]",children:"Snacks"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Z,{className:"w-4 h-4 text-[#61936f]"}),s.jsx("span",{className:"font-medium text-[#1d1d1e]",children:"Changes:"}),(()=>{const t=a(e.conditions?.change_before_departure),n=t.icon;return s.jsxs("span",{className:`ml-2 text-xs ${t.color} flex items-center gap-1`,children:[s.jsx(n,{className:"w-4 h-4"}),t.text]})})()]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ee,{className:"w-4 h-4 text-[#61936f]"}),s.jsx("span",{className:"font-medium text-[#1d1d1e]",children:"Refunds:"}),(()=>{const t=a(e.conditions?.refund_before_departure),n=t.icon;return s.jsxs("span",{className:`ml-2 text-xs ${t.color} flex items-center gap-1`,children:[s.jsx(n,{className:"w-4 h-4"}),t.text]})})()]})]}),s.jsx("div",{className:"flex justify-end pt-4",children:s.jsx(d,{className:"bg-[#1d1d1e] hover:bg-[#61936f] text-white font-semibold px-6 py-2 rounded-lg",onClick:async()=>{if(hs?.expires_at){if((new Date).getTime()>=new Date(hs.expires_at).getTime()-3e5)return void S({title:"Offer Expired",description:"This flight offer has expired. Please refresh your search to get current prices.",variant:"destructive"})}localStorage.setItem("selectedFlightOffer",JSON.stringify(e));const s=gs();await O.updateSelectedOffer(s,e.id);const t=O.createFlightDetailsUrl(e.id,s,w.language);_(t)},children:"Select Flight"})})]})})})]})},e.id)})),a>1&&s.jsxs("div",{className:"flex justify-center gap-4 mt-6",children:[s.jsx(d,{variant:"outline",onClick:()=>Je((e=>Math.max(1,e-1))),disabled:1===Ge,children:"Previous"}),s.jsxs("span",{className:"text-[#62626a]",children:["Page ",Ge," of ",a]}),s.jsx(d,{variant:"outline",onClick:()=>Je((e=>Math.min(a,e+1))),disabled:Ge===a,children:"Next"})]})]})})()]}),s.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-md",children:[s.jsx("h3",{className:"font-semibold mb-2 text-[#1d1d1e]",children:"Best Price Guarantee"}),s.jsx("p",{className:"text-sm text-[#62626a]",children:"We guarantee the best prices for your flights"})]}),s.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-md",children:[s.jsx("h3",{className:"font-semibold mb-2 text-[#1d1d1e]",children:"24/7 Support"}),s.jsx("p",{className:"text-sm text-[#62626a]",children:"Our team is always here to help you"})]}),s.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-md",children:[s.jsx("h3",{className:"font-semibold mb-2 text-[#1d1d1e]",children:"Flexible Booking"}),s.jsx("p",{className:"text-sm text-[#62626a]",children:"Free cancellation on most flights"})]})]}),Ie&&De?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[s.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Passenger Information"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Title"}),s.jsxs(x,{value:$e.title,onValueChange:e=>Te({...$e,title:e}),children:[s.jsx(h,{children:s.jsx(u,{placeholder:"Select title"})}),s.jsxs(g,{children:[s.jsx(p,{value:"mr",children:"Mr"}),s.jsx(p,{value:"mrs",children:"Mrs"}),s.jsx(p,{value:"ms",children:"Ms"}),s.jsx(p,{value:"dr",children:"Dr"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"First Name"}),s.jsx(f,{value:$e.given_name,onChange:e=>Te({...$e,given_name:e.target.value}),placeholder:"Enter first name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Last Name"}),s.jsx(f,{value:$e.family_name,onChange:e=>Te({...$e,family_name:e.target.value}),placeholder:"Enter last name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Email"}),s.jsx(f,{type:"email",value:$e.email,onChange:e=>Te({...$e,email:e.target.value}),placeholder:"Enter email"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Phone Number"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(x,{value:$e.phone_number.split("+")[1]?.substring(0,2)||"1",onValueChange:e=>{const s=$e.phone_number.replace(/\D/g,""),t=s.length>2?s.substring(2):"";Te({...$e,phone_number:`+${e}${t}`})},children:[s.jsx(h,{className:"w-[100px]",children:s.jsx(u,{placeholder:"+1"})}),s.jsxs(g,{children:[s.jsx(p,{value:"1",children:"+1 (US/CA)"}),s.jsx(p,{value:"44",children:"+44 (UK)"}),s.jsx(p,{value:"33",children:"+33 (FR)"}),s.jsx(p,{value:"49",children:"+49 (DE)"}),s.jsx(p,{value:"61",children:"+61 (AU)"})]})]}),s.jsx(f,{type:"tel",value:$e.phone_number.replace(/\D/g,"").substring(2),onChange:e=>{const s=$e.phone_number.split("+")[1]?.substring(0,2)||"1",t=e.target.value.replace(/\D/g,"");t.length<=10&&Te({...$e,phone_number:`+${s}${t}`})},placeholder:"Enter phone number",className:"flex-1"})]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter your phone number without spaces or special characters"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Gender"}),s.jsxs(x,{value:$e.gender,onValueChange:e=>Te({...$e,gender:e}),children:[s.jsx(h,{children:s.jsx(u,{placeholder:"Select gender"})}),s.jsxs(g,{children:[s.jsx(p,{value:"male",children:"Male"}),s.jsx(p,{value:"female",children:"Female"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Date of Birth"}),s.jsx(f,{type:"date",value:$e.born_on,onChange:e=>Te({...$e,born_on:e.target.value})})]})]}),s.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[s.jsx(d,{variant:"outline",onClick:()=>Pe(!1),disabled:Oe,children:"Cancel"}),s.jsx(d,{className:"bg-[#72ba87] hover:bg-[#61936f] text-white",onClick:Ds,disabled:Oe,children:Oe?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Booking..."]}):"Confirm Booking"})]})]})}):null,Ue?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),s.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Booking Confirmed!"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"Your flight has been successfully booked."})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Booking Reference"}),s.jsx("p",{className:"text-2xl font-mono mt-2",children:Ue.data?.booking_reference||"N/A"})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Flight Details"}),Ue.data?.slices?.map(((e,t)=>s.jsxs("div",{className:"mb-6 last:mb-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:s.jsx(H,{className:"w-4 h-4 text-blue-600"})}),s.jsxs("div",{children:[s.jsxs("p",{className:"font-medium",children:[e.origin?.iata_code," → ",e.destination?.iata_code]}),s.jsx("p",{className:"text-sm text-gray-500",children:Ss(e.segments[0]?.departing_at)})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"font-medium",children:e.segments[0]?.marketing_carrier?.name}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Flight ",e.segments[0]?.marketing_carrier?.iata_code]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Departure"}),s.jsx("p",{className:"font-medium",children:ks(e.segments[0]?.departing_at)}),s.jsx("p",{className:"text-sm",children:e.origin?.name}),e.segments[0]?.origin_terminal&&s.jsxs("p",{className:"text-sm text-gray-500",children:["Terminal ",e.segments[0].origin_terminal]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Arrival"}),s.jsx("p",{className:"font-medium",children:ks(e.segments[0]?.arriving_at)}),s.jsx("p",{className:"text-sm",children:e.destination?.name}),e.segments[0]?.destination_terminal&&s.jsxs("p",{className:"text-sm text-gray-500",children:["Terminal ",e.segments[0].destination_terminal]})]})]})]},t)))]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Passenger Information"}),Ue.data?.passengers?.map((e=>s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-4 last:mb-0",children:[s.jsxs("p",{className:"font-medium",children:[e.title," ",e.given_name," ",e.family_name]}),s.jsx("p",{className:"text-sm text-gray-500",children:e.email})]},e.id)))]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Price Details"}),s.jsxs("div",{className:"space-y-2",children:[Ue.data?.base_amount&&Ue.data?.base_currency&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"Base Fare"}),s.jsxs("span",{className:"font-medium",children:[Ue.data.base_currency," ",Ue.data.base_amount]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"Taxes & Fees"}),s.jsxs("span",{className:"font-medium",children:[Ue.data.total_currency," ",(parseFloat(Ue.data.total_amount)-parseFloat(Ue.data.base_amount)).toFixed(2)]})]}),s.jsx(j,{})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"Total Amount"}),s.jsxs("span",{className:"text-xl font-semibold",children:[Ue.data?.total_amount," ",Ue.data?.total_currency]})]})]})]})]}),s.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[s.jsx(d,{variant:"outline",onClick:()=>{Ae(null),_(`/${w.language}/bookings`)},children:"View All Bookings"}),s.jsx(d,{className:"bg-[#72ba87] hover:bg-[#61936f] text-white",onClick:()=>{Ae(null),me(""),he(""),D(void 0),I(void 0),ie({adults:1,children:0,infantsInSeat:0,infantsOnLap:0}),de("")},children:"Book Another Flight"})]})]})}):null]})]})}const ue=[{code:"US",name:"United States"},{code:"FR",name:"France"},{code:"ES",name:"Spain"},{code:"GB",name:"United Kingdom"},{code:"CA",name:"Canada"},{code:"DE",name:"Germany"},{code:"IT",name:"Italy"},{code:"JP",name:"Japan"},{code:"AU",name:"Australia"}];function ge(){const{t:t,i18n:a}=U("booking"),r=A(),[i]=R(),{isDev:l,getDevModeBadge:c}=me(),{toast:o}=$(),[m,E]=e.useState(null),[B,L]=e.useState([]),[J,W]=e.useState(new Set),[Q,X]=e.useState(!1),[Z,ee]=e.useState("passengers"),[te,re]=e.useState("USD"),[ie,xe]=e.useState({}),he={current:0},[ge,pe]=e.useState(0),[fe,je]=e.useState(!1),[ve,ye]=e.useState(!1),[Ne,be]=e.useState(null),we=[{type:"checked",weight:"23kg",price:30,currency:"USD"},{type:"checked",weight:"32kg",price:50,currency:"USD"},{type:"carry_on",weight:"7kg",price:0,currency:"USD"},{type:"carry_on",weight:"10kg",price:15,currency:"USD"}],[_e,ke]=e.useState(null),[Se,Fe]=e.useState(null),[De,Ce]=e.useState(!1),[Ie,Pe]=e.useState(!1),[$e,Te]=e.useState(!1),{profile:Oe}=de(),{passportData:Ee}=oe();e.useEffect((()=>{(async()=>{if(!i.get("offerId"))return void r(`/${a.language}/booking/internal-flights`);const e=localStorage.getItem("selectedFlightOffer");if(e){const s=JSON.parse(e);E(s);const t=s.passengers.map(((e,s)=>({id:e.id,title:"",given_name:"",family_name:"",email:"",phone_number:"",phone_country_code:"",gender:"",born_on:"",passport_number:"",passport_country:"",passport_expiry:"",luggage:{checked:0,carry_on:0}})));L(t),t.length>0&&W(new Set([t[0].id])),s.total_currency&&re(s.total_currency);const a=async()=>{const e=new Set;s.conditions?.change_before_departure?.penalty_currency&&e.add(s.conditions.change_before_departure.penalty_currency),s.conditions?.refund_before_departure?.penalty_currency&&e.add(s.conditions.refund_before_departure.penalty_currency);for(const t of e)t!==s.total_currency&&await Ye(t)};await a();const n=O.getSearchIdFromUrl(window.location.href);if(n){const e=await O.loadFlightDataBySearchId(n);e&&(be(e.timing),re(e.searchParams.currency),e.userProgress&&"search"!==e.userProgress.currentStep&&(ee(e.userProgress.currentStep),e.userProgress.passengerForms&&L(e.userProgress.passengerForms),e.userProgress.ancillariesPayload&&ke(e.userProgress.ancillariesPayload)))}else{const e={origin:s.slices[0]?.segments[0]?.origin?.iata_code||"",destination:s.slices[0]?.segments[0]?.destination?.iata_code||"",departureDate:s.slices[0]?.segments[0]?.departing_at?.split("T")[0]||"",returnDate:s.slices.length>1?s.slices[1]?.segments[0]?.departing_at?.split("T")[0]:void 0,passengers:s.passengers.length,cabinClass:"economy",currency:s.total_currency,maxConnections:1},t=O.loadFlightData(e);t&&(be(t.timing),re(t.searchParams.currency),t.userProgress&&"search"!==t.userProgress.currentStep&&(ee(t.userProgress.currentStep),t.userProgress.passengerForms&&L(t.userProgress.passengerForms),t.userProgress.ancillariesPayload&&ke(t.userProgress.ancillariesPayload)))}}else r(`/${a.language}/booking/internal-flights`)})()}),[i,r,a.language]),e.useEffect((()=>{if(!m)return;const e=async()=>{const e=O.getSearchIdFromUrl(window.location.href);if(e){const s=await O.loadFlightDataBySearchId(e);if(s&&s.timing.expires_at){const e=(new Date).getTime(),t=new Date(s.timing.expires_at).getTime(),a=Math.max(0,t-e);a>0?(pe(a),je(!1),a<12e4&&!fe&&o({title:"Offer Expiring Soon",description:"This flight offer will expire in less than 2 minutes. Please complete your booking quickly or refresh to get updated prices.",duration:5e3})):(pe(0),je(!0))}}else{const e={origin:m.slices[0]?.segments[0]?.origin?.iata_code||"",destination:m.slices[0]?.segments[0]?.destination?.iata_code||"",departureDate:m.slices[0]?.segments[0]?.departing_at?.split("T")[0]||"",returnDate:m.slices.length>1?m.slices[1]?.segments[0]?.departing_at?.split("T")[0]:void 0,passengers:m.passengers.length,cabinClass:"economy",currency:m.total_currency,maxConnections:1},s=await O.getTimeRemaining(e);s>0?(pe(s),je(!1),s<12e4&&!fe&&o({title:"Offer Expiring Soon",description:"This flight offer will expire in less than 2 minutes. Please complete your booking quickly or refresh to get updated prices.",duration:5e3})):(pe(0),je(!0))}};e();const s=setInterval(e,1e3);return()=>clearInterval(s)}),[Ne,m]),e.useEffect((()=>{if(Ne?.search_started_at){const e=(new Date).getTime(),s=new Date(Ne.search_started_at).getTime();ye(e-s>18e5)}else ye(!1)}),[Ne]);const Ue=(e,s,t)=>{L((a=>a.map((a=>a.id===e?{...a,[s]:t}:a))))},Ae=(e,s,t)=>{L((a=>a.map((a=>a.id===e?{...a,luggage:{...a.luggage,[s]:t}}:a))))},Re=e=>{const s=[];e.title||s.push(t("validation.titleRequired")),e.given_name||s.push(t("validation.firstNameRequired")),e.family_name||s.push(t("validation.lastNameRequired")),e.email||s.push(t("validation.emailRequired")),e.phone_number||s.push(t("validation.phoneRequired")),e.gender||s.push(t("validation.genderRequired")),e.born_on||s.push(t("validation.birthDateRequired"));if(e.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)&&s.push(t("validation.invalidEmail")),e.phone_number&&e.phone_country_code){const a=`${e.phone_country_code}${e.phone_number.replace(/[^\d]/g,"")}`;(!/^\+[1-9]\d{1,14}$/.test(a)||a.length<8||a.length>15)&&s.push(t("validation.invalidPhone"))}else e.phone_number&&e.phone_country_code||s.push(t("validation.phoneRequired"));return s},Me=()=>{for(const e of B){const s=Re(e);if(s.length>0)return o({title:t("booking.validationError"),description:`${t("booking.missingInfoDesc")} ${e.given_name||"Unknown"}: ${s.join(", ")}`,variant:"destructive"}),!1}return!0},Be=()=>{if("passengers"===Z){if(Me()&&(ee("ancillaries"),m)){const e={origin:m.slices[0]?.segments[0]?.origin?.iata_code||"",destination:m.slices[0]?.segments[0]?.destination?.iata_code||"",departureDate:m.slices[0]?.segments[0]?.departing_at?.split("T")[0]||"",returnDate:m.slices.length>1?m.slices[1]?.segments[0]?.departing_at?.split("T")[0]:void 0,passengers:m.passengers.length,cabinClass:"economy",currency:m.total_currency,maxConnections:1};O.updateUserProgress(e,{currentStep:"ancillaries",passengerForms:B})}}else if("ancillaries"===Z){if(ee("luggage"),m){const e={origin:m.slices[0]?.segments[0]?.origin?.iata_code||"",destination:m.slices[0]?.segments[0]?.destination?.iata_code||"",departureDate:m.slices[0]?.segments[0]?.departing_at?.split("T")[0]||"",returnDate:m.slices.length>1?m.slices[1]?.segments[0]?.departing_at?.split("T")[0]:void 0,passengers:m.passengers.length,cabinClass:"economy",currency:m.total_currency,maxConnections:1};O.updateUserProgress(e,{currentStep:"luggage",ancillariesPayload:_e})}}else if("luggage"===Z&&(ee("payment"),m)){const e={origin:m.slices[0]?.segments[0]?.origin?.iata_code||"",destination:m.slices[0]?.segments[0]?.destination?.iata_code||"",departureDate:m.slices[0]?.segments[0]?.departing_at?.split("T")[0]||"",returnDate:m.slices.length>1?m.slices[1]?.segments[0]?.departing_at?.split("T")[0]:void 0,passengers:m.passengers.length,cabinClass:"economy",currency:m.total_currency,maxConnections:1};O.updateUserProgress(e,{currentStep:"payment",luggageSelections:B.map((e=>e.luggage))})}},Le=()=>{"ancillaries"===Z?ee("passengers"):"luggage"===Z?ee("ancillaries"):"payment"===Z&&ee("luggage")},ze=async()=>{if(m){Te(!0);try{const e=B.reduce(((e,s)=>{const t=we.find((e=>"checked"===e.type&&"23kg"===e.weight))?.price||0,a=we.find((e=>"carry_on"===e.type&&"10kg"===e.weight))?.price||0;return e+(s.luggage?.checked||0)*t+(s.luggage?.carry_on||0)*a}),0),s=Se?parseFloat(Se.offer_total_amount)-parseFloat(m?.total_amount||"0"):0,t=Je(),a={origin:m.slices[0]?.segments[0]?.origin?.iata_code||"",destination:m.slices[0]?.segments[0]?.destination?.iata_code||"",departureDate:m.slices[0]?.segments[0]?.departing_at?.split("T")[0]||"",returnDate:m.slices.length>1?m.slices[1]?.segments[0]?.departing_at?.split("T")[0]:void 0,airline:m.slices[0]?.segments[0]?.marketing_carrier?.name||"",flightNumber:m.slices[0]?.segments[0]?.marketing_carrier?.iata_code||""},n={offerId:m.id,passengers:B.map((e=>{const s=`${e.phone_country_code}${e.phone_number.replace(/[^\d]/g,"")}`;return{id:e.id,title:e.title,given_name:e.given_name,family_name:e.family_name,email:e.email,phone_number:s,gender:"male"===e.gender?"m":"f",born_on:e.born_on}})),amount:t.toFixed(2),currency:m.total_currency,base_amount:m.base_amount,base_currency:m.base_currency,luggage_fees:e.toFixed(2),ancillaries_fees:s.toFixed(2),ancillaries:_e,flightDetails:a},{data:r,error:i}=await T.functions.invoke("stripe-flight-payment",{body:n,headers:{Authorization:`Bearer ${(await T.auth.getSession()).data.session?.access_token}`}});if(i)return void o({title:"Payment Error",description:i.message||"Failed to create checkout session",variant:"destructive"});r.url?window.location.href=r.url:o({title:"Payment Error",description:"No checkout URL received",variant:"destructive"})}catch(e){o({title:"Payment Error",description:e.message||"Failed to initiate payment",variant:"destructive"})}finally{Te(!1)}}},He=e=>le(new Date(e),"HH:mm"),qe=e=>{if(!e.length)return"0h 0m";const s=e[0],t=e[e.length-1],a=new Date(s.departing_at),n=new Date(t.arriving_at).getTime()-a.getTime();return`${Math.floor(n/36e5)}h ${Math.floor(n%36e5/6e4)}m`},Ve=e=>{const s=Math.max(0,e.length-1);return 0===s?t("flight.direct"):1===s?`1 ${t("flight.stop")}`:`${s} ${t("flight.stops")}`},Ye=async e=>{if(ie[e]&&Date.now()-he.current<3e5)return ie[e];try{const s=await fetch(`https://open.er-api.com/v6/latest/${e}`);if(!s.ok)throw new Error("Failed to fetch exchange rates");const t=await s.json();if("success"===t.result)return xe((s=>({...s,[e]:t.rates}))),he.current=Date.now(),t.rates;throw new Error("Invalid response from exchange rate API")}catch(s){return ie[e]}},Ge=(e,s)=>{if(null===e||null===s)return"Unknown";if(s===te)return`${e} ${s}`;if(ie[s]&&ie[s][te]){return`${(parseFloat(e)*ie[s][te]).toFixed(2)} ${te}`}return`${e} ${s}`},Je=()=>{if(!m)return 0;let e=parseFloat(m.total_amount),s=0,t=0;return B.forEach((e=>{if(e.luggage){const t=we.find((e=>"checked"===e.type&&"23kg"===e.weight)),a=we.find((e=>"carry_on"===e.type&&"10kg"===e.weight));t&&(s+=e.luggage.checked*t.price),a&&(s+=e.luggage.carry_on*a.price)}})),Se&&(t=parseFloat(Se.offer_total_amount)-e),e+s+t};return m?s.jsxs("div",{className:"min-h-screen bg-[#fcfcfc]",children:[s.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs(d,{variant:"ghost",size:"sm",onClick:async()=>{const e=O.getSearchIdFromUrl(window.location.href);if(e){const s=await O.loadFlightDataBySearchId(e);if(s){const e=O.createSearchUrl(s.searchParams,a.language);r(e)}else r(`/${a.language}/booking/internal-flights`)}else r(`/${a.language}/booking/internal-flights`)},className:"text-[#1d1d1e] hover:text-[#61936f]",children:[s.jsx(ae,{className:"h-4 w-4 mr-2"}),t("details.backToSearch")]}),s.jsx(j,{orientation:"vertical",className:"h-6"}),s.jsx("h1",{className:"text-lg font-semibold text-[#1d1d1e]",children:t("details.title")}),Ne?.expires_at&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium "+(fe?"bg-red-100 text-red-700 border border-red-200":ge<6e4?"bg-orange-100 text-orange-700 border border-orange-200":"bg-green-100 text-green-700 border border-green-200"),children:[s.jsx(z,{className:"h-4 w-4"}),fe?s.jsx("span",{children:"Offers Expired"}):s.jsxs("span",{children:["Expires in ",O.formatTimeRemaining(ge)]})]}),ve&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-700 border border-yellow-200",children:[s.jsx(z,{className:"h-4 w-4"}),s.jsx("span",{children:"Offers may be expired - Refresh recommended"})]})]}),s.jsxs("div",{className:"hidden md:flex items-center space-x-4",children:[s.jsxs("div",{className:P("flex items-center space-x-2","passengers"===Z?"text-[#61936f]":"text-[#62626a]"),children:[s.jsx("div",{className:P("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium","passengers"===Z?"bg-[#61936f] text-white":"bg-gray-200 text-gray-600"),children:"1"}),s.jsx("span",{className:"text-sm font-medium",children:t("steps.passengers")})]}),s.jsx(Y,{className:"h-4 w-4 text-[#62626a]"}),s.jsxs("div",{className:P("flex items-center space-x-2","ancillaries"===Z?"text-[#61936f]":"text-[#62626a]"),children:[s.jsx("div",{className:P("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium","ancillaries"===Z?"bg-[#61936f] text-white":"bg-gray-200 text-gray-600"),children:"2"}),s.jsx("span",{className:"text-sm font-medium",children:t("steps.ancillaries")})]}),s.jsx(Y,{className:"h-4 w-4 text-[#62626a]"}),s.jsxs("div",{className:P("flex items-center space-x-2","luggage"===Z?"text-[#61936f]":"text-[#62626a]"),children:[s.jsx("div",{className:P("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium","luggage"===Z?"bg-[#61936f] text-white":"bg-gray-200 text-gray-600"),children:"3"}),s.jsx("span",{className:"text-sm font-medium",children:t("steps.luggage")})]}),s.jsx(Y,{className:"h-4 w-4 text-[#62626a]"}),s.jsxs("div",{className:P("flex items-center space-x-2","payment"===Z?"text-[#61936f]":"text-[#62626a]"),children:[s.jsx("div",{className:P("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium","payment"===Z?"bg-[#61936f] text-white":"bg-gray-200 text-gray-600"),children:"4"}),s.jsx("span",{className:"text-sm font-medium",children:t("steps.payment")})]})]})]})})}),s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsx("div",{className:"lg:col-span-1",children:s.jsxs(y,{className:"sticky top-24",children:[s.jsx(w,{children:s.jsxs(_,{className:"flex items-center space-x-2",children:[s.jsx(H,{className:"h-5 w-5 text-[#61936f]"}),s.jsx("span",{children:t("flight.details")})]})}),s.jsxs(k,{className:"space-y-6",children:[s.jsx("div",{className:"space-y-4",children:m.slices.map(((e,a)=>{return s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(S,{variant:"outline",className:"text-[#61936f] border-[#61936f]",children:t(0===a?"flight.outbound":"flight.return")}),s.jsx("span",{className:"text-sm text-[#62626a]",children:(n=e.segments[0].departing_at,le(new Date(n),"MMM dd, yyyy"))})]}),s.jsx("div",{className:"space-y-3",children:e.segments.map(((e,a)=>s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"font-semibold text-lg",children:He(e.departing_at)}),s.jsx("p",{className:"text-sm text-[#62626a]",children:e.origin.iata_code})]}),s.jsxs("div",{className:"flex-1 flex items-center justify-center",children:[s.jsx("div",{className:"flex-1 h-px bg-gray-300"}),s.jsx(H,{className:"h-4 w-4 text-[#61936f] mx-2"}),s.jsx("div",{className:"flex-1 h-px bg-gray-300"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"font-semibold text-lg",children:He(e.arriving_at)}),s.jsx("p",{className:"text-sm text-[#62626a]",children:e.destination.iata_code})]})]})}),s.jsxs("div",{className:"flex items-center justify-between text-sm text-[#62626a]",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(z,{className:"h-3 w-3"}),s.jsx("span",{children:qe([e])})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(ne,{className:"h-3 w-3"}),s.jsx("span",{children:Ve([e])})]})]}),s.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-sm",children:e.marketing_carrier.name}),s.jsxs("p",{className:"text-xs text-[#62626a]",children:[t("flight.flight")," ",e.marketing_carrier.iata_code]})]}),e.aircraft&&s.jsx("div",{className:"text-right",children:s.jsx("p",{className:"text-xs text-[#62626a]",children:e.aircraft.name})})]})})]},a)))})]},a);var n}))}),s.jsx(j,{}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"font-semibold text-[#1d1d1e]",children:t("payment.priceBreakdown")}),s.jsxs("div",{className:"space-y-2 text-sm",children:[m.base_amount&&m.base_currency&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Base Fare"}),s.jsxs("span",{children:[m.base_currency," ",m.base_amount]})]}),s.jsxs("div",{className:"flex justify-between text-gray-500",children:[s.jsx("span",{children:"Taxes & Fees"}),s.jsxs("span",{children:[m.total_currency," ",(parseFloat(m.total_amount)-parseFloat(m.base_amount)).toFixed(2)]})]}),s.jsx(j,{})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:t("payment.baseFare")}),s.jsxs("span",{children:[m.total_currency," ",m.total_amount]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:t("payment.luggageFees")}),s.jsxs("span",{children:["USD ",B.reduce(((e,s)=>{const t=we.find((e=>"checked"===e.type&&"23kg"===e.weight))?.price||0,a=we.find((e=>"carry_on"===e.type&&"10kg"===e.weight))?.price||0;return e+(s.luggage?.checked||0)*t+(s.luggage?.carry_on||0)*a}),0)]})]}),Se&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:t("payment.ancillariesFees")}),s.jsxs("span",{children:[Se.offer_total_currency," ",(parseFloat(Se.offer_total_amount)-parseFloat(m.total_amount)).toFixed(2)]})]}),s.jsx(j,{}),s.jsxs("div",{className:"flex justify-between font-semibold",children:[s.jsx("span",{children:t("payment.total")}),s.jsxs("div",{className:"flex items-center gap-2",children:[l&&s.jsx(S,{variant:"secondary",className:"text-xs",children:c()}),s.jsxs("span",{className:l?"line-through text-gray-500":"",children:[m.total_currency," ",Je().toFixed(2)]}),l&&s.jsxs("span",{className:"text-green-600 font-bold",children:[m.total_currency," 0.00"]})]})]})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"font-semibold text-[#1d1d1e]",children:t("booking.conditions")}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(G,{className:"h-4 w-4 text-green-500"}),s.jsxs("span",{children:[t("booking.changes"),": ",m.conditions.change_before_departure?.allowed?t("booking.allowed"):t("booking.notAllowed"),m.conditions.change_before_departure?.allowed&&m.conditions.change_before_departure?.penalty_amount&&s.jsxs("span",{className:"text-yellow-600 ml-2",children:["(Fee: ",Ge(m.conditions.change_before_departure.penalty_amount,m.conditions.change_before_departure.penalty_currency),")"]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(G,{className:"h-4 w-4 text-green-500"}),s.jsxs("span",{children:[t("booking.refunds"),": ",m.conditions.refund_before_departure?.allowed?t("booking.allowed"):t("booking.notAllowed"),m.conditions.refund_before_departure?.allowed&&m.conditions.refund_before_departure?.penalty_amount&&s.jsxs("span",{className:"text-yellow-600 ml-2",children:["(Fee: ",Ge(m.conditions.refund_before_departure.penalty_amount,m.conditions.refund_before_departure.penalty_currency),")"]})]})]})]})]})]})]})}),s.jsxs("div",{className:"lg:col-span-2 space-y-6",children:["passengers"===Z&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-semibold text-[#1d1d1e] mb-2",children:t("details.passengerInfo")}),s.jsx("p",{className:"text-[#62626a]",children:t("details.passengerInfoDesc")})]}),B.map(((e,a)=>s.jsx(y,{children:s.jsxs(v,{open:J.has(e.id),onOpenChange:()=>(e=>{const s=new Set(J);s.has(e)?s.delete(e):s.add(e),W(s)})(e.id),children:[s.jsx(N,{asChild:!0,children:s.jsx(w,{className:"cursor-pointer hover:bg-gray-50 transition-colors",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-[#61936f] text-white rounded-full flex items-center justify-center text-sm font-medium",children:a+1}),s.jsxs("div",{children:[s.jsxs(_,{className:"text-lg",children:[t("details.passenger")," ",a+1]}),s.jsx(F,{children:e.given_name&&e.family_name?`${e.given_name} ${e.family_name}`:t("details.clickToAddDetails")})]})]}),J.has(e.id)?s.jsx(q,{className:"h-5 w-5 text-[#62626a]"}):s.jsx(V,{className:"h-5 w-5 text-[#62626a]"})]})})}),s.jsx(b,{children:s.jsxs(k,{className:"space-y-4",children:[Oe&&s.jsx("div",{className:"flex justify-end mb-4",children:s.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:()=>(e=>{if(!Oe)return void o({title:"No Profile Information",description:"Please complete your profile information first.",variant:"destructive"});const s={given_name:Oe.first_name||"",family_name:Oe.last_name||"",email:Oe.email||"",born_on:Oe.birth_date||"",passport_number:Ee?.passport_number||"",passport_country:Ee?.passport_country||"",passport_expiry:Ee?.passport_expiry_date||""};L((t=>t.map((t=>t.id===e?{...t,...s}:t)))),o({title:"Profile Information Filled",description:"Your profile information has been filled in."})})(e.id),className:"text-sm",children:[s.jsx(M,{className:"h-4 w-4 mr-2"}),t("passenger.fillWithMyInfo")]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(D,{htmlFor:`title-${e.id}`,children:t("passenger.title")}),s.jsxs(x,{value:e.title,onValueChange:s=>Ue(e.id,"title",s),children:[s.jsx(h,{children:s.jsx(u,{placeholder:t("passenger.selectTitle")})}),s.jsxs(g,{children:[s.jsx(p,{value:"mr",children:t("passenger.mr")}),s.jsx(p,{value:"mrs",children:t("passenger.mrs")}),s.jsx(p,{value:"ms",children:t("passenger.ms")}),s.jsx(p,{value:"dr",children:t("passenger.dr")}),s.jsx(p,{value:"miss",children:t("passenger.miss")}),s.jsx(p,{value:"master",children:t("passenger.master")})]})]})]}),s.jsxs("div",{children:[s.jsx(D,{htmlFor:`gender-${e.id}`,children:t("passenger.gender")}),s.jsxs(x,{value:e.gender,onValueChange:s=>Ue(e.id,"gender",s),children:[s.jsx(h,{children:s.jsx(u,{placeholder:t("passenger.selectGender")})}),s.jsxs(g,{children:[s.jsx(p,{value:"male",children:t("passenger.male")}),s.jsx(p,{value:"female",children:t("passenger.female")})]})]})]}),s.jsxs("div",{children:[s.jsx(D,{htmlFor:`given-name-${e.id}`,children:t("passenger.firstName")}),s.jsx(f,{id:`given-name-${e.id}`,value:e.given_name,onChange:s=>Ue(e.id,"given_name",s.target.value),placeholder:t("passenger.enterFirstName")})]}),s.jsxs("div",{children:[s.jsx(D,{htmlFor:`family-name-${e.id}`,children:t("passenger.lastName")}),s.jsx(f,{id:`family-name-${e.id}`,value:e.family_name,onChange:s=>Ue(e.id,"family_name",s.target.value),placeholder:t("passenger.enterLastName")})]}),s.jsxs("div",{children:[s.jsx(D,{htmlFor:`email-${e.id}`,children:t("passenger.email")}),s.jsx(f,{id:`email-${e.id}`,type:"email",value:e.email,onChange:s=>Ue(e.id,"email",s.target.value),placeholder:t("passenger.enterEmail")})]}),s.jsxs("div",{children:[s.jsx(D,{htmlFor:`phone-${e.id}`,children:t("passenger.phoneNumber")}),s.jsx(C,{value:e.phone_number||"",onChange:s=>Ue(e.id,"phone_number",s),countryCode:e.phone_country_code||"+1",onCountryCodeChange:s=>Ue(e.id,"phone_country_code",s)})]}),s.jsx("div",{children:s.jsx(I,{date:e.born_on?(()=>{const[s,t,a]=e.born_on.split("-").map(Number);return new Date(s,t-1,a)})():void 0,setDate:s=>Ue(e.id,"born_on",s?`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`:""),label:t("passenger.dateOfBirth"),placeholder:t("passenger.selectDateOfBirth"),maxYear:(new Date).getFullYear(),disabledDates:e=>e>new Date})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(D,{children:t("passenger.passportNumber")}),s.jsx(f,{value:e.passport_number,onChange:s=>Ue(e.id,"passport_number",s.target.value),placeholder:t("passenger.enterPassportNumber")})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(D,{children:t("passenger.passportCountry")}),s.jsxs(x,{value:e.passport_country,onValueChange:s=>Ue(e.id,"passport_country",s),children:[s.jsx(h,{children:s.jsx(u,{placeholder:t("passenger.selectPassportCountry")})}),s.jsx(g,{children:ue.map((e=>s.jsx(p,{value:e.code,children:e.name},e.code)))})]})]}),s.jsx("div",{className:"space-y-2",children:s.jsx(I,{date:e.passport_expiry?(()=>{const[s,t,a]=e.passport_expiry.split("-").map(Number);return new Date(s,t-1,a)})():void 0,setDate:s=>Ue(e.id,"passport_expiry",s?`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`:""),label:t("passenger.passportExpiry"),placeholder:t("passenger.selectPassportExpiry"),minYear:(new Date).getFullYear(),maxYear:(new Date).getFullYear()+20,disabledDates:e=>e<new Date})})]})]})})]})},e.id))),s.jsx("div",{className:"flex justify-end",children:s.jsxs(d,{onClick:Be,className:"bg-[#61936f] hover:bg-[#4a7a5a] text-white",children:[t("navigation.continueToAncillaries"),s.jsx(Y,{className:"h-4 w-4 ml-2"})]})})]}),"ancillaries"===Z&&m&&s.jsx(n,{offerId:m.id,passengers:B,onAncillariesSelected:(e,s)=>{ke(e),Fe(s)},onBack:Le,onContinue:Be,selectedAncillaries:_e,ancillariesMetadata:Se}),"luggage"===Z&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-semibold text-[#1d1d1e] mb-2",children:"Luggage Selection"}),s.jsx("p",{className:"text-[#62626a]",children:"Choose your luggage options for each passenger."})]}),B.map(((e,t)=>s.jsxs(y,{children:[s.jsx(w,{children:s.jsxs(_,{className:"flex items-center space-x-2",children:[s.jsx(K,{className:"h-5 w-5 text-[#61936f]"}),s.jsxs("span",{children:["Passenger ",t+1,": ",e.given_name," ",e.family_name]})]})}),s.jsxs(k,{className:"space-y-6",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"font-medium text-[#1d1d1e]",children:"Checked Luggage"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:we.filter((e=>"checked"===e.type)).map((t=>s.jsx("div",{className:P("border rounded-lg p-4 cursor-pointer transition-colors",(e.luggage?.checked||0)>0?"border-[#61936f] bg-[#61936f]/5":"border-gray-200 hover:border-gray-300"),onClick:()=>Ae(e.id,"checked",(e.luggage?.checked||0)>0?0:1),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:t.weight}),s.jsx("p",{className:"text-sm text-[#62626a]",children:"Checked bag"})]}),s.jsx("div",{className:"text-right",children:s.jsx("p",{className:"font-medium",children:0===t.price?"Free":`$${t.price}`})})]})},t.weight)))})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"font-medium text-[#1d1d1e]",children:"Carry-on Luggage"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:we.filter((e=>"carry_on"===e.type)).map((t=>s.jsx("div",{className:P("border rounded-lg p-4 cursor-pointer transition-colors",(e.luggage?.carry_on||0)>0?"border-[#61936f] bg-[#61936f]/5":"border-gray-200 hover:border-gray-300"),onClick:()=>Ae(e.id,"carry_on",(e.luggage?.carry_on||0)>0?0:1),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:t.weight}),s.jsx("p",{className:"text-sm text-[#62626a]",children:"Carry-on bag"})]}),s.jsx("div",{className:"text-right",children:s.jsx("p",{className:"font-medium",children:0===t.price?"Free":`$${t.price}`})})]})},t.weight)))})]})]})]},e.id))),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(d,{variant:"outline",onClick:Le,children:[s.jsx(ae,{className:"h-4 w-4 mr-2"}),t("navigation.backToAncillaries")]}),s.jsxs(d,{onClick:Be,className:"bg-[#61936f] hover:bg-[#4a7a5a] text-white",children:[t("navigation.continueToPayment"),s.jsx(Y,{className:"h-4 w-4 ml-2"})]})]})]}),"payment"===Z&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-semibold text-[#1d1d1e] mb-2",children:"Payment & Confirmation"}),s.jsx("p",{className:"text-[#62626a]",children:"Review your booking details and complete payment."})]}),s.jsxs(y,{children:[s.jsx(w,{children:s.jsx(_,{children:"Booking Summary"})}),s.jsxs(k,{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"font-medium text-[#1d1d1e]",children:"Passengers"}),B.map(((e,t)=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"font-medium",children:[e.title," ",e.given_name," ",e.family_name]}),s.jsx("p",{className:"text-sm text-[#62626a]",children:e.email})]}),s.jsx("div",{className:"text-right",children:s.jsxs("p",{className:"text-sm text-[#62626a]",children:[e.luggage?.checked||0," checked, ",e.luggage?.carry_on||0," carry-on"]})})]},e.id)))]}),s.jsx(j,{}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"font-medium text-[#1d1d1e]",children:"Price Breakdown"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Base fare"}),s.jsxs("span",{children:[m.total_currency," ",m.total_amount]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:t("payment.luggageFees")}),s.jsxs("span",{children:["USD ",B.reduce(((e,s)=>{const t=we.find((e=>"checked"===e.type&&"23kg"===e.weight))?.price||0,a=we.find((e=>"carry_on"===e.type&&"10kg"===e.weight))?.price||0;return e+(s.luggage?.checked||0)*t+(s.luggage?.carry_on||0)*a}),0)]})]}),Se&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:t("payment.ancillariesFees")}),s.jsxs("span",{children:[Se.offer_total_currency," ",(parseFloat(Se.offer_total_amount)-parseFloat(m.total_amount)).toFixed(2)]})]}),s.jsx(j,{}),s.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[s.jsx("span",{children:t("payment.total")}),s.jsxs("div",{className:"flex items-center gap-2",children:[l&&s.jsx(S,{variant:"secondary",className:"text-xs",children:c()}),s.jsxs("span",{className:l?"line-through text-gray-500":"",children:[m.total_currency," ",Je().toFixed(2)]}),l&&s.jsxs("span",{className:"text-green-600 font-bold",children:[m.total_currency," 0.00"]})]})]})]})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(se,{className:"h-5 w-5 text-blue-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-blue-900",children:t("payment.importantInfo")}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:t("payment.importantInfoDesc")})]})]})})]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(d,{variant:"outline",onClick:Le,children:[s.jsx(ae,{className:"h-4 w-4 mr-2"}),t("navigation.backToLuggage")]}),s.jsx(d,{onClick:async()=>{if(!Me())return;if(Ne?.expires_at){if((new Date).getTime()>=new Date(Ne.expires_at).getTime()-3e5)return void o({title:"Offer Expired",description:"This flight offer has expired. Please refresh your search to get current prices.",variant:"destructive"})}if(fe||ve)return void o({title:"Offers Expired",description:"The flight offers have expired or are too old. Please refresh the search to get updated prices.",variant:"destructive"});const{data:{session:e}}=await T.auth.getSession();if(!e)return Pe(!0),void Ce(!0);await ze()},disabled:$e||fe||ve,className:"bg-[#61936f] hover:bg-[#4a7a5a] text-white",children:$e?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),t("payment.processing")]}):s.jsxs(s.Fragment,{children:[t("payment.payNow")," (",l?s.jsxs("span",{className:"text-green-600 font-bold",children:[m.total_currency," 0.00"]}):`${m.total_currency} ${Je().toFixed(2)}`,")",s.jsx(G,{className:"h-4 w-4 ml-2"})]})})]})]})]})]})}),s.jsx(ce,{isOpen:De,onClose:()=>Ce(!1),onSuccess:async()=>{Ce(!1),Ie&&(Pe(!1),await(async()=>{X(!0);try{const e=B.reduce(((e,s)=>{const t=we.find((e=>"checked"===e.type&&"23kg"===e.weight))?.price||0,a=we.find((e=>"carry_on"===e.type&&"10kg"===e.weight))?.price||0;return e+(s.luggage?.checked||0)*t+(s.luggage?.carry_on||0)*a}),0),s=Se?parseFloat(Se.offer_total_amount)-parseFloat(m?.total_amount||"0"):0,n={offerId:m?.id,passengers:B.map((e=>{const s=`${e.phone_country_code}${e.phone_number.replace(/[^\d]/g,"")}`;return{id:e.id,title:e.title,given_name:e.given_name,family_name:e.family_name,email:e.email,phone_number:s,gender:"male"===e.gender?"m":"f",born_on:e.born_on}})),payments:[{type:"balance",currency:m?.total_currency||"USD",amount:m?.total_amount||"0"}],luggage_fees:e.toFixed(2),ancillaries_fees:s.toFixed(2),base_amount:m?.base_amount,base_currency:m?.base_currency,ancillaries:_e||void 0},{data:{session:i},error:l}=await T.auth.getSession();if(l||!i?.access_token)return void o({title:"Authentication Error",description:"Please log in again to complete your booking.",variant:"destructive"});const{data:c,error:d}=await T.functions.invoke("duffel-booking",{body:n,headers:{Authorization:`Bearer ${i.access_token}`}});if(d)throw d;o({title:t("booking.bookingSuccessful"),description:t("booking.bookingSuccessfulDesc")}),r(`/${a.language}/bookings`)}catch(e){let s=e.message||t("booking.bookingFailed");401===e.status?s="Authentication failed. Please log in again to complete your booking.":e.error&&(s=e.error),o({title:t("booking.bookingFailed"),description:s,variant:"destructive"})}finally{X(!1)}})())},title:"Sign in to complete your booking",description:"Please sign in or create an account to complete your flight booking.",defaultTab:"signin"})]}):s.jsx("div",{className:"min-h-screen bg-[#fcfcfc] flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#61936f] mx-auto mb-4"}),s.jsx("p",{className:"text-[#1d1d1e]",children:t("details.title")})]})})}function pe(){const{t:t,i18n:a}=U(),n=A(),{toast:r}=$(),[i,f]=e.useState(!1),[j,v]=e.useState([]),[y,N]=e.useState(null),[b,w]=e.useState({location:"",coordinates:[0,0],checkIn:new Date,checkOut:new Date((new Date).setDate((new Date).getDate()+1)),guests:1,rooms:1});e.useEffect((()=>{(async()=>{const{data:{user:e}}=await T.auth.getUser();if(e){const s=e.email||"",{data:t}=await T.from("profiles").select("phone").eq("id",e.id).single();N({email:s,phone:t?.phone||""})}})()}),[]);return s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsxs("div",{className:"max-w-4xl mx-auto",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Book Hotels"}),s.jsx("p",{className:"text-gray-600",children:"Find and book the perfect hotel for your stay"})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Location"}),s.jsx(xe,{value:b.location,onChange:(e,s)=>{w((t=>({...t,location:e,coordinates:s})))},onSelect:(e,s)=>{w((t=>({...t,location:e,coordinates:s})))},className:"w-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Check-in Date"}),s.jsxs(l,{children:[s.jsx(c,{asChild:!0,children:s.jsxs(d,{variant:"outline",className:P("w-full justify-start text-left font-normal",!b.checkIn&&"text-muted-foreground"),children:[s.jsx(B,{className:"mr-2 h-4 w-4"}),b.checkIn?le(b.checkIn,"PPP"):s.jsx("span",{children:"Pick a date"})]})}),s.jsx(o,{className:"w-auto p-0",children:s.jsx(m,{mode:"single",selected:b.checkIn,onSelect:e=>e&&w({...b,checkIn:e}),initialFocus:!0})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Check-out Date"}),s.jsxs(l,{children:[s.jsx(c,{asChild:!0,children:s.jsxs(d,{variant:"outline",className:P("w-full justify-start text-left font-normal",!b.checkOut&&"text-muted-foreground"),children:[s.jsx(B,{className:"mr-2 h-4 w-4"}),b.checkOut?le(b.checkOut,"PPP"):s.jsx("span",{children:"Pick a date"})]})}),s.jsx(o,{className:"w-auto p-0",children:s.jsx(m,{mode:"single",selected:b.checkOut,onSelect:e=>e&&w({...b,checkOut:e}),initialFocus:!0})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Guests & Rooms"}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs(x,{value:b.guests.toString(),onValueChange:e=>w({...b,guests:parseInt(e)}),children:[s.jsx(h,{children:s.jsx(u,{placeholder:"Guests"})}),s.jsx(g,{children:[1,2,3,4,5,6].map((e=>s.jsxs(p,{value:e.toString(),children:[e," ",1===e?"Guest":"Guests"]},e)))})]}),s.jsxs(x,{value:b.rooms.toString(),onValueChange:e=>w({...b,rooms:parseInt(e)}),children:[s.jsx(h,{children:s.jsx(u,{placeholder:"Rooms"})}),s.jsx(g,{children:[1,2,3,4].map((e=>s.jsxs(p,{value:e.toString(),children:[e," ",1===e?"Room":"Rooms"]},e)))})]})]})]})]}),s.jsx("div",{className:"mt-6",children:s.jsx(d,{className:"w-full bg-[#72ba87] hover:bg-[#61936f] text-white",onClick:async()=>{try{if(f(!0),!b.location||!b.coordinates[0]||!b.coordinates[1])return void r({title:"Missing Location",description:"Please select a valid location",variant:"destructive"});const{data:e,error:s}=await T.functions.invoke("duffel-booking-hotel-search",{body:{location:b.location,coordinates:b.coordinates,checkIn:le(b.checkIn,"yyyy-MM-dd"),checkOut:le(b.checkOut,"yyyy-MM-dd"),guests:b.guests,rooms:b.rooms}});if(s)throw s;if(e?.error)return void("Feature not enabled"===e.error?r({title:"Feature Not Available",description:e.details||"Hotel booking is currently being set up. Please try again later or contact support for more information.",variant:"destructive"}):"No hotels found"===e.error?r({title:"No Hotels Found",description:"No hotels were found for your search criteria. Please try a different location or dates.",variant:"destructive"}):r({title:"Error",description:e.details||"Failed to search hotels. Please try again later.",variant:"destructive"}));const t=e;if(!t.hotels||0===t.hotels.length)return void r({title:"No Hotels Found",description:"No hotels were found for your search criteria. Please try a different location or dates.",variant:"destructive"});v(t.hotels)}catch(e){(e.message||"").includes("not enabled for your account")?r({title:"Feature Not Available",description:"Hotel booking is currently being set up. Please try again later or contact support for more information.",variant:"destructive"}):r({title:"Error",description:"Failed to search hotels. Please try again later.",variant:"destructive"})}finally{f(!1)}},disabled:i,children:i?s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Searching..."]}):s.jsxs("div",{className:"flex items-center",children:[s.jsx(L,{className:"mr-2 h-4 w-4"}),"Search Hotels"]})})})]}),j.length>0?s.jsx("div",{className:"space-y-4",children:j.map((e=>s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex justify-between items-start mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold mb-1",children:e.hotel.name}),s.jsxs("div",{className:"flex items-center text-gray-600 mb-2",children:[s.jsx(ne,{className:"w-4 h-4 mr-1"}),s.jsxs("span",{children:[e.hotel.address.city,", ",e.hotel.address.country]})]}),s.jsx("div",{className:"flex items-center",children:[...Array(Math.floor(e.hotel.rating))].map(((e,t)=>s.jsx(re,{className:"w-4 h-4 text-yellow-400 fill-current"},t)))})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-2xl font-bold text-[#72ba87]",children:[e.total_amount," ",e.total_currency]}),s.jsx("p",{className:"text-sm text-gray-600",children:"per night"})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"font-medium mb-2",children:"Room Types"}),s.jsx("div",{className:"space-y-2",children:e.room_types.map(((e,t)=>s.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[s.jsx("p",{className:"font-medium",children:e.name}),s.jsx("p",{className:"text-sm text-gray-600",children:e.description})]},t)))})]}),s.jsx(d,{className:"w-full bg-[#72ba87] hover:bg-[#61936f] text-white",onClick:()=>(async e=>{try{if(f(!0),!y?.email)return void r({title:"User Information Required",description:"Please make sure you're logged in to book a hotel.",variant:"destructive"});const{data:s,error:t}=await T.functions.invoke("duffel-booking-hotel",{body:{offerId:e,guests:b.guests,contact:{email:y.email,phone:y.phone||"+1234567890"}}});if(t)throw t;r({title:"Success",description:"Hotel booking confirmed!"}),n(`/${a.language}/bookings`)}catch(s){r({title:"Error",description:"Failed to book hotel",variant:"destructive"})}finally{f(!1)}})(e.id),disabled:i,children:i?s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Booking..."]}):"Book Now"})]},e.id)))}):s.jsxs("div",{className:"text-center text-gray-500",children:[s.jsx(ie,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),s.jsx("p",{children:"Enter your search criteria to find available hotels"})]})]})})}export{he as F,pe as H,ge as a};
//# sourceMappingURL=page-booking.Cdc16yQW.js.map
