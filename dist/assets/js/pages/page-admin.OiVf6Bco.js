import{r as e,j as s}from"../vendor/vendor-react-core.D1hcyiwY.js";import{u as r}from"../hooks/hooks-useadminauth.ts.BJ7uhFTt.js";import{u as t}from"../hooks/hooks-useadminusers.ts.Cd20xC4E.js";import{s as n,U as i,a as o,B as a,E as l}from"../components/components-admin.CiIAoamg.js";import{C as d,k as c,l as m,m as u,N as v,O as x,P as p,Q as j,B as h,G as f,J as g,K as b,M as w,ab as y,aA as N,aB as k,aC as _,aD as C,aE as S,aF as D,aG as z,aH as B}from"../components/components-ui.C8hnNhgu.js";import{u as T}from"../hooks/hooks-use-toast.ts.Dg8obzHg.js";import{u as U}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{L as E,U as q,M as O,at as I,a2 as F,V as A,bj as P,T as L,bk as R,ab as W}from"../vendor/vendor--lucide-react.DRw9PYsu.js";import{u as Z}from"../vendor/vendor--react-router.Gdfmkz0l.js";import"../vendor/vendor--cookie.D-6orQ43.js";import"../utils/utils-cache.ts.BtmNadnX.js";import"../vendor/vendor--lru-cache.CYB7PIxo.js";import"../vendor/vendor--react-hook-form.C68mK_Ba.js";import"../vendor/vendor---hookform-resolvers.CwYzTTZs.js";import"../vendor/vendor--zod.Cebk8UiH.js";import"../vendor/vendor-supabase-client.BJD0U0P8.js";import"../vendor/vendor-supabase-other.BhmW1H_P.js";import"../components/components-mobilenavigation.tsx.DtMtI5i3.js";import"../components/components-languagerouter.tsx.CHVsY7fH.js";import"../vendor/vendor--i18next.CHTa0CEF.js";import"../vendor/vendor--i18next-browser-languagedetector.h4x3AYwK.js";import"../vendor/vendor--i18next-http-backend.DjHzioAf.js";import"../hooks/hooks-useuserrole.ts.BKHSjdY6.js";import"../components/components-languageselector.tsx.x8buceJ0.js";import"../components/components-navigation.CB-8LlfF.js";import"../components/components-theme-toggle.tsx.CfzjOSrj.js";import"../components/components-theme-provider.tsx.Cd7zUHTE.js";import"../components/components-blog.C3TFiFB1.js";import"../utils/utils-blogutils.ts.CpQs8y27.js";import"../components/components-optimizedimage.tsx.DVN-Ynzu.js";import"../vendor/vendor--date-fns.BbAlDtqN.js";import"../hooks/hooks-useblogs.ts.B-jKAetY.js";import"../vendor/vendor-query-main.DFU6mXji.js";import"../vendor/vendor---tanstack-query-core.CIZi0Zbo.js";import"../vendor/vendor--lodash.D80NHDHN.js";import"../vendor/vendor--framer-motion.Dpgjd5L1.js";import"../vendor/vendor--motion-dom.C5KZPrWP.js";import"../vendor/vendor--motion-utils.DAP8mxSY.js";import"../vendor/vendor-ui-utils.CjDQ2U02.js";import"../vendor/vendor--react-markdown.C_e4o-CH.js";import"../vendor/vendor--devlop.Cl3hj7Sz.js";import"../vendor/vendor--unified.ti5-l0IV.js";import"../vendor/vendor--bail.gCPcOVbC.js";import"../vendor/vendor--extend.BFvm699q.js";import"../vendor/vendor--is-plain-obj.DeEdtHJQ.js";import"../vendor/vendor--trough.zzWXwSIo.js";import"../vendor/vendor--vfile.Cn6Vy3Ir.js";import"../vendor/vendor--vfile-message.Re42m5o3.js";import"../vendor/vendor--unist-util-stringify-position.CvSG9YTx.js";import"../vendor/vendor--remark-parse.DdoJrvcY.js";import"../vendor/vendor--mdast-util-from-markdown.DI8nvaYJ.js";import"../vendor/vendor--micromark-util-decode-numeric-character-reference.DA7xEauU.js";import"../vendor/vendor--micromark-util-decode-string.BCF2SQ7o.js";import"../vendor/vendor--decode-named-character-reference.C-EXV6yX.js";import"../vendor/vendor--micromark-util-normalize-identifier.CzKtq1sx.js";import"../vendor/vendor--micromark.aJPyxAJv.js";import"../vendor/vendor--micromark-util-combine-extensions.CQDa_SAq.js";import"../vendor/vendor--micromark-util-chunked.3k3e5hER.js";import"../vendor/vendor--micromark-factory-space.CZc9TqN4.js";import"../vendor/vendor--micromark-util-character.DUwsRT9L.js";import"../vendor/vendor--micromark-core-commonmark.yO25BTZZ.js";import"../vendor/vendor--micromark-util-classify-character.x6FlXUUS.js";import"../vendor/vendor--micromark-util-resolve-all.U8fstr8o.js";import"../vendor/vendor--micromark-util-subtokenize.BfHYzAYP.js";import"../vendor/vendor--micromark-factory-destination.pZKs7oL9.js";import"../vendor/vendor--micromark-factory-label.BbusvwMx.js";import"../vendor/vendor--micromark-factory-title.BBtcOUHM.js";import"../vendor/vendor--micromark-factory-whitespace.BhZ6YKME.js";import"../vendor/vendor--micromark-util-html-tag-name.DbKNfynz.js";import"../vendor/vendor--mdast-util-to-string.Ck87fAyN.js";import"../vendor/vendor--remark-rehype.B9Xnklpv.js";import"../vendor/vendor--mdast-util-to-hast.C2F2cLDR.js";import"../vendor/vendor---ungap-structured-clone.DadG6O39.js";import"../vendor/vendor--micromark-util-sanitize-uri.BXHzaaAi.js";import"../vendor/vendor--unist-util-position.CVUg9P9R.js";import"../vendor/vendor--trim-lines.C03Dth7Y.js";import"../vendor/vendor--unist-util-visit.41WSH7so.js";import"../vendor/vendor--unist-util-visit-parents.DAGCrDnu.js";import"../vendor/vendor--unist-util-is.C5Jwnfs7.js";import"../vendor/vendor--hast-util-to-jsx-runtime.BOWXXjuU.js";import"../vendor/vendor--comma-separated-tokens.DIu3lqJt.js";import"../vendor/vendor--property-information.Dc64tFtG.js";import"../vendor/vendor--space-separated-tokens.C97BfSlU.js";import"../vendor/vendor--style-to-js.DQsO4XA8.js";import"../vendor/vendor--style-to-object.DGZeIPGP.js";import"../vendor/vendor--inline-style-parser.BFz9PO4J.js";import"../vendor/vendor--hast-util-whitespace.DlJMGLAz.js";import"../vendor/vendor--estree-util-is-identifier-name.0h9-8Xae.js";import"../vendor/vendor--html-url-attributes.BA_i5Yxb.js";import"../vendor/vendor--react-helmet-async.BMUx00aU.js";import"../vendor/vendor--react-fast-compare.4d-J074I.js";import"../vendor/vendor--invariant.D6mx6rc7.js";import"../vendor/vendor--shallowequal.BwnEDCFe.js";import"../vendor/vendor--web-vitals.C1BoAgs7.js";import"../vendor/vendor-supabase-realtime.PMyDaGD3.js";import"../vendor/vendor--sonner.ECaEf7Ie.js";import"../vendor/vendor-react-dom.BnDkh-2X.js";import"../vendor/vendor-react-scheduler.B5Ht9ZB3.js";import"../vendor/vendor-ui-toast.CyvsGWN1.js";import"../vendor/vendor-ui-core.CPnW5LH0.js";import"../vendor/vendor--aria-hidden.BHUiN-rI.js";import"../vendor/vendor--react-remove-scroll.DR6iVcCg.js";import"../vendor/vendor--tslib.Bc9CN1Ef.js";import"../vendor/vendor--react-remove-scroll-bar.Dz-JErv0.js";import"../vendor/vendor--react-style-singleton.ER5nEGYx.js";import"../vendor/vendor--get-nonce.BYiZHLe3.js";import"../vendor/vendor--use-sidecar.svB0tWl8.js";import"../vendor/vendor--use-callback-ref.Dt9orvWx.js";import"../vendor/vendor---floating-ui-react-dom.gDT63CuY.js";import"../vendor/vendor---floating-ui-dom.CdGDzP9A.js";import"../vendor/vendor---floating-ui-core.D6mclMLM.js";import"../vendor/vendor---floating-ui-utils.D9HCu73I.js";import"../vendor/vendor-ui-dialog.CY7OxuK6.js";import"../vendor/vendor-ui-tooltip.n7I39vTs.js";import"../vendor/vendor--embla-carousel-react.Bc6nB0ya.js";import"../vendor/vendor--embla-carousel-reactive-utils.BIRN7lq8.js";import"../vendor/vendor--embla-carousel.clUl8sxa.js";import"../vendor/vendor--cmdk.q6oiTfmV.js";import"../vendor/vendor--react-day-picker.D6HWAs9M.js";const $=()=>{const{loading:$,isAdmin:M}=r(),{t:V}=U(["admin","common"]),{users:G,searchTerm:K,setSearchTerm:Q,loading:H,refreshUsers:J,pagination:{currentPage:X,setCurrentPage:Y,hasNextPage:ee,hasPreviousPage:se,startIndex:re,endIndex:te},allUsers:ne,filteredCount:ie}=t(),{toast:oe}=T(),ae=Z(),[le,de]=e.useState([]),[ce,me]=e.useState(!1),[ue,ve]=e.useState(null),[xe,pe]=e.useState(!1),[je,he]=e.useState(null),[fe,ge]=e.useState(!1),[be,we]=e.useState([]),[ye,Ne]=e.useState(null),[ke,_e]=e.useState("all"),[Ce,Se]=e.useState("all"),[De,ze]=e.useState([]),[Be,Te]=e.useState(!1),[Ue,Ee]=e.useState(null),[qe,Oe]=e.useState(!1),[Ie,Fe]=e.useState(null),[Ae,Pe]=e.useState(null),[Le,Re]=e.useState(null),[We,Ze]=e.useState(!1),[$e,Me]=e.useState("all"),Ve=ne.length,Ge=ne.reduce(((e,s)=>e+(s.zap_trip_count||0)),0),Ke=ne.reduce(((e,s)=>e+(s.zap_out_count||0)),0),Qe=ne.reduce(((e,s)=>e+(s.zap_road_count||0)),0),He=be.reduce(((e,s)=>{const r=s.location||"Unknown";return e[r]||(e[r]=[]),e[r].push(s),e}),{}),Je=["all",...Object.keys(He)].sort(),Xe="all"===ke?be:be.filter((e=>e.location===ke)),Ye=[{value:"all",label:V("types.all")},{value:"hotel",label:V("types.hotel")},{value:"restaurant",label:V("types.restaurant")},{value:"bar",label:V("types.bar")},{value:"event",label:V("types.event")},{value:"activity",label:V("types.activity")},{value:"other",label:V("types.other")}];e.useEffect((()=>{es(),ss(),rs()}),[]),e.useEffect((()=>{}),[De]);const es=async()=>{try{const{data:e,error:s}=await n.from("blogs").select("*").order("published_at",{ascending:!1});if(s)throw s;de(e||[])}catch(e){oe({title:V("common.error"),description:V("admin.failedToFetchBlogs"),variant:"destructive"})}},ss=async()=>{try{const{data:e,error:s}=await n.from("event_suggestion").select("*").order("priority",{ascending:!0});if(s)throw s;we(e||[])}catch(e){oe({title:V("common.error"),description:V("admin.failedToFetchEvents"),variant:"destructive"})}},rs=async()=>{try{Te(!0);const{data:{user:e},error:s}=await n.auth.getUser();if(s)throw s;const{data:r,error:t}=await n.from("businesses").select("count").limit(1),{data:i,error:o}=await n.from("businesses").select("*").order("created_at",{ascending:!1});if(o)throw o;if(!i)return void ze([]);const a=i.map((e=>({...e,team_member_count:0})));ze(a)}catch(e){oe({title:V("common.error"),description:V("admin.failedToFetchBusinesses"),variant:"destructive"}),ze([])}finally{Te(!1)}};e.useEffect((()=>{}),[De]),e.useEffect((()=>{}),[Be]);const ts=async e=>{try{const{error:s}=await n.from("event_suggestion").delete().eq("id",e);if(s)throw s;we(be.filter((s=>s.id!==e))),oe({title:V("common.success"),description:V("admin.eventDeleted")})}catch(s){oe({title:V("common.error"),description:V("admin.failedToDeleteEvent"),variant:"destructive"})}},ns=e=>{Ne(e),ge(!0)},is=()=>{ge(!1),Ne(null)},os=De.filter((e=>"all"===$e||e.status===$e));return $?s.jsx("div",{className:"flex justify-center items-center min-h-screen",children:s.jsx(E,{className:"h-12 w-12 animate-spin text-indigo-500"})}):M?s.jsxs("div",{className:"container mx-auto py-8 px-4",children:[s.jsx("h1",{className:"text-3xl font-bold mb-8",children:V("title")}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[s.jsxs(d,{children:[s.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(m,{className:"text-sm font-medium",children:V("totalUsers")}),s.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsx(u,{children:s.jsx("div",{className:"text-2xl font-bold",children:Ve})})]}),s.jsxs(d,{children:[s.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(m,{className:"text-sm font-medium",children:V("totalZapTrips")}),s.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsx(u,{children:s.jsx("div",{className:"text-2xl font-bold",children:Ge})})]}),s.jsxs(d,{children:[s.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(m,{className:"text-sm font-medium",children:V("totalZapOuts")}),s.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsx(u,{children:s.jsx("div",{className:"text-2xl font-bold",children:Ke})})]}),s.jsxs(d,{children:[s.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(m,{className:"text-sm font-medium",children:V("totalZapRoads")}),s.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsx(u,{children:s.jsx("div",{className:"text-2xl font-bold",children:Qe})})]})]}),s.jsxs(v,{defaultValue:"users",className:"space-y-6",children:[s.jsxs(x,{children:[s.jsx(p,{value:"users",children:V("users")}),s.jsx(p,{value:"blogs",children:V("blogs")}),s.jsx(p,{value:"events",children:V("events")}),s.jsx(p,{value:"businesses",children:V("businesses")})]}),s.jsx(j,{value:"users",className:"space-y-6",children:s.jsxs(d,{children:[s.jsxs(c,{className:"flex flex-row items-center justify-between",children:[s.jsx(m,{children:V("users")}),s.jsxs(h,{children:[s.jsx(A,{className:"mr-2 h-4 w-4"}),V("addUser")]})]}),s.jsxs(u,{children:[s.jsx(i,{searchTerm:K,setSearchTerm:Q,onRefresh:J,isLoading:H}),H?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(E,{className:"h-8 w-8 animate-spin"})}):s.jsxs(s.Fragment,{children:[s.jsx(o,{users:G,onRoleUpdated:()=>{window.location.reload(),J()},onDeleteUser:e=>{ve(e),he(null)}}),s.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:K?V("showingFilteredUsers",{start:re,end:te,total:ie,query:K}):V("showingUsers",{start:re,end:te,total:Ve})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(h,{variant:"outline",size:"sm",onClick:()=>Y(X-1),disabled:!se,children:V("previous")}),s.jsx(h,{variant:"outline",size:"sm",onClick:()=>Y(X+1),disabled:!ee,children:V("next")})]})]})]})]})]})}),s.jsx(j,{value:"blogs",className:"space-y-6",children:s.jsxs(d,{children:[s.jsxs(c,{className:"flex flex-row items-center justify-between",children:[s.jsx(m,{children:V("blogs")}),s.jsx(h,{onClick:()=>me(!ce),children:V(ce?"cancel":"createBlog")})]}),s.jsx(u,{children:ce?s.jsx(a,{}):s.jsx("div",{className:"space-y-4",children:le.map((e=>s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.title_en}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[V("category"),": ",e.category||V("noCategory")]}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[V("publishedOn"),": ",new Date(e.published_at).toLocaleDateString()]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(h,{variant:"outline",size:"icon",onClick:()=>{return s=e.id,void ae(`/admin/blog/${s}`);var s},children:s.jsx(P,{className:"h-4 w-4"})}),s.jsx(h,{variant:"destructive",size:"icon",onClick:()=>(async e=>{try{const{error:s}=await n.from("blogs").delete().eq("id",e);if(s)throw s;de(le.filter((s=>s.id!==e))),oe({title:V("common.success"),description:V("admin.blogDeleted")})}catch(s){oe({title:V("common.error"),description:V("admin.failedToDeleteBlog"),variant:"destructive"})}})(e.id),children:s.jsx(L,{className:"h-4 w-4"})})]})]},e.id)))})})]})}),s.jsx(j,{value:"events",className:"space-y-4",children:fe?s.jsxs(d,{children:[s.jsxs(c,{className:"flex flex-row items-center justify-between",children:[s.jsx(m,{children:V(ye?"edit":"addEvent")}),s.jsx(h,{onClick:is,children:V("cancel")})]}),s.jsx(u,{children:s.jsx(l,{event:ye||void 0,onSuccess:()=>{is(),ss()}})})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("h2",{className:"text-2xl font-bold",children:V("events")}),s.jsx("select",{value:ke,onChange:e=>_e(e.target.value),className:"px-3 py-2 border rounded-md text-sm",children:Je.map((e=>s.jsx("option",{value:e,children:"all"===e?V("allLocations"):e},e)))})]}),s.jsxs(h,{onClick:()=>ge(!0),children:[s.jsx(R,{className:"w-4 h-4 mr-2"}),V("addEvent")]})]}),s.jsx("div",{className:"grid gap-6",children:"all"===ke?Object.entries(He).sort().map((([e,r])=>s.jsxs(d,{children:[s.jsx(c,{children:s.jsxs(m,{className:"flex items-center gap-2",children:[s.jsx(O,{className:"w-5 h-5"}),e,s.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",r.length," ",(r.length,V("events")),")"]})]})}),s.jsxs(u,{children:[s.jsx("div",{className:"flex gap-2 mb-4",children:Ye.map((e=>s.jsx("button",{onClick:()=>Se(e.value),className:"px-3 py-1 rounded-full text-xs font-medium transition-colors "+(Ce===e.value?"bg-[#1d1d1e] text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.label},e.value)))}),s.jsx("div",{className:"grid gap-3 grid-cols-1 md:grid-cols-3 lg:grid-cols-5",children:r.filter((e=>"all"===Ce||e.type===Ce)).map((e=>s.jsxs("div",{className:"relative group bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[s.jsx("div",{className:"aspect-[16/10] overflow-hidden",children:s.jsx("img",{src:e.url_placeholder_image,alt:e.title,className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder-image.jpg"}})}),s.jsxs("div",{className:"p-3",children:[s.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("hotel"===e.type?"bg-blue-100 text-blue-800":"restaurant"===e.type?"bg-orange-100 text-orange-800":"bar"===e.type?"bg-purple-100 text-purple-800":"event"===e.type?"bg-green-100 text-green-800":"activity"===e.type?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.type}),s.jsx("span",{className:"text-xs text-gray-500",children:e.priority})]}),s.jsx("h3",{className:"font-semibold text-sm mb-1 truncate",children:e.title}),s.jsx("p",{className:"text-xs text-gray-600 mb-2 truncate",children:e.business_name}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsxs(h,{variant:"outline",size:"sm",className:"h-8 px-2 text-xs",onClick:()=>ns(e),children:[s.jsx(P,{className:"w-3 h-3 mr-1"}),V("edit")]}),s.jsxs(h,{variant:"outline",size:"sm",className:"h-8 px-2 text-xs text-red-600 hover:text-red-700",onClick:()=>ts(e.id),children:[s.jsx(L,{className:"w-3 h-3 mr-1"}),V("delete")]})]})]})]},e.id)))})]})]},e))):s.jsx(d,{children:s.jsxs(u,{className:"pt-6",children:[s.jsx("div",{className:"flex gap-2 mb-4",children:Ye.map((e=>s.jsx("button",{onClick:()=>Se(e.value),className:"px-3 py-1 rounded-full text-xs font-medium transition-colors "+(Ce===e.value?"bg-[#1d1d1e] text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.label},e.value)))}),s.jsx("div",{className:"grid gap-3 grid-cols-1 md:grid-cols-3 lg:grid-cols-5",children:Xe.filter((e=>"all"===Ce||e.type===Ce)).map((e=>s.jsxs("div",{className:"relative group bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow",children:[s.jsx("div",{className:"aspect-[16/10] overflow-hidden",children:s.jsx("img",{src:e.url_placeholder_image,alt:e.title,className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder-image.jpg"}})}),s.jsxs("div",{className:"p-3",children:[s.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("hotel"===e.type?"bg-blue-100 text-blue-800":"restaurant"===e.type?"bg-orange-100 text-orange-800":"bar"===e.type?"bg-purple-100 text-purple-800":"event"===e.type?"bg-green-100 text-green-800":"activity"===e.type?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.type}),s.jsx("span",{className:"text-xs text-gray-500",children:e.priority})]}),s.jsx("h3",{className:"font-semibold text-sm mb-1 truncate",children:e.title}),s.jsx("p",{className:"text-xs text-gray-600 mb-2 truncate",children:e.business_name}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsxs(h,{variant:"outline",size:"sm",className:"h-8 px-2 text-xs",onClick:()=>ns(e),children:[s.jsx(P,{className:"w-3 h-3 mr-1"}),V("edit")]}),s.jsxs(h,{variant:"outline",size:"sm",className:"h-8 px-2 text-xs text-red-600 hover:text-red-700",onClick:()=>ts(e.id),children:[s.jsx(L,{className:"w-3 h-3 mr-1"}),V("delete")]})]})]})]},e.id)))})]})})})]})}),s.jsxs(j,{value:"businesses",className:"space-y-6",children:[s.jsxs(d,{children:[s.jsxs(c,{className:"flex flex-row items-center justify-between",children:[s.jsx(m,{children:V("businesses")}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{variant:"all"===$e?"default":"outline",size:"sm",onClick:()=>Me("all"),children:V("allBusinesses")}),s.jsx(h,{variant:"active"===$e?"default":"outline",size:"sm",onClick:()=>Me("active"),children:V("activeBusinesses")}),s.jsx(h,{variant:"pending"===$e?"default":"outline",size:"sm",onClick:()=>Me("pending"),children:V("pendingBusinesses")}),s.jsx(h,{variant:"inactive"===$e?"default":"outline",size:"sm",onClick:()=>Me("inactive"),children:V("inactiveBusinesses")})]})]}),s.jsx(u,{children:Be?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(E,{className:"h-8 w-8 animate-spin"})}):0===os.length?s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"all"===$e?V("noBusinesses"):V("noBusinessesWithStatus",{status:$e})}):s.jsx("div",{className:"space-y-4",children:os.map((e=>s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[e.logo_url?s.jsx("img",{src:e.logo_url,alt:e.name,className:"w-12 h-12 rounded-full object-cover"}):s.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center",children:s.jsx(W,{className:"h-6 w-6 text-gray-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.name}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[V("teamMembers"),": ",e.team_member_count]}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[V("status"),": ",e.status]}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[V("createdAt"),": ",new Date(e.created_at).toLocaleDateString()]}),s.jsx(h,{variant:"link",className:"h-auto p-0 text-sm",onClick:()=>(async e=>{try{Ze(!0);const{data:s,error:r}=await n.from("profiles").select("id, email, full_name, created_at").eq("id",e).single();if(r)throw r;Re(s)}catch(s){oe({title:V("common.error"),description:s.message||V("admin.failedToFetchOwnerInfo"),variant:"destructive"})}finally{Ze(!1)}})(e.owner_id),children:V("viewOwnerInfo")})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("select",{value:e.status,onChange:s=>(async(e,s)=>{try{Pe(e);const{error:t}=await n.from("businesses").update({status:s,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;const{data:i,error:o}=await n.from("businesses").select("\n          id,\n          name,\n          owner_id\n        ").eq("id",e).single();if(o)throw o;if(!i)throw new Error("Business not found");const{data:a,error:l}=await n.from("profiles").select("email, full_name").eq("id",i.owner_id).single();try{await n.functions.invoke("send-business-status-email",{body:{businessName:i.name,businessId:i.id,ownerEmail:a?.email||"",ownerName:a?.full_name||"Business Owner",status:s}})}catch(r){}oe({title:V("businesses.status.success.title"),description:V("businesses.status.success.description")}),rs()}catch(t){oe({title:V("businesses.status.error.title"),description:t.message||V("businesses.status.error.description"),variant:"destructive"})}finally{Pe(null)}})(e.id,s.target.value),disabled:Ae===e.id,className:"px-3 py-2 border rounded-md text-sm",children:[s.jsx("option",{value:"pending",children:V("statusPending")}),s.jsx("option",{value:"active",children:V("statusActive")}),s.jsx("option",{value:"inactive",children:V("statusInactive")})]}),s.jsx(h,{variant:"outline",size:"icon",onClick:()=>ae(`/admin/business/${e.id}`),children:s.jsx(P,{className:"h-4 w-4"})}),s.jsx(h,{variant:"destructive",size:"icon",onClick:()=>{return s=e.id,Ee(s),void Fe(null);var s},children:s.jsx(L,{className:"h-4 w-4"})})]})]},e.id)))})})]}),s.jsx(f,{open:!!Le,onOpenChange:()=>Re(null),children:s.jsxs(g,{children:[s.jsxs(b,{children:[s.jsx(w,{children:V("ownerInformation")}),s.jsx(y,{children:V("ownerInformationDescription")})]}),We?s.jsx("div",{className:"flex justify-center py-4",children:s.jsx(E,{className:"h-6 w-6 animate-spin"})}):Le?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:V("ownerName")}),s.jsx("p",{className:"text-sm text-muted-foreground",children:Le.full_name||V("noName")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:V("ownerEmail")}),s.jsx("p",{className:"text-sm text-muted-foreground",children:Le.email})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:V("ownerCreatedAt")}),s.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(Le.created_at).toLocaleDateString()})]})]}):null]})})]})]}),s.jsx(N,{open:!!ue,onOpenChange:e=>!e&&(ve(null),void he(null)),children:s.jsxs(k,{children:[s.jsxs(_,{children:[s.jsx(C,{children:V("confirmDeleteUser")}),s.jsxs(S,{children:[V("deleteUserWarning"),je&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600",children:je})]})]}),s.jsxs(D,{children:[s.jsx(z,{disabled:xe,children:V("cancel")}),s.jsx(B,{onClick:async()=>{if(ue)try{pe(!0),he(null);const{data:e}=await n.auth.getSession(),s=e?.session?.access_token;if(!s)throw new Error(V("common.notAuthenticated"));const r=await n.functions.invoke("delete-user",{body:{userId:ue},headers:{Authorization:`Bearer ${s}`}});if(r.error)throw new Error(r.error.message||V("admin.failedToDeleteUser"));if(!r.data.success)throw new Error(r.data.error||V("admin.failedToDeleteUser"));!1===r.data.auth_deleted?oe({title:V("common.warning"),description:V("admin.userDataDeletedButAuthRemains"),variant:"warning"}):oe({title:V("common.success"),description:V("admin.userDeleted")}),J(),window.location.reload()}catch(e){he(e.message||V("admin.failedToDeleteUser")),oe({title:V("common.error"),description:e.message||V("admin.failedToDeleteUser"),variant:"destructive"})}finally{pe(!1)}},disabled:xe,className:"bg-red-600 hover:bg-red-700",children:xe?s.jsxs(s.Fragment,{children:[s.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),V("common.processing")]}):V("delete")})]})]})}),s.jsx(N,{open:!!Ue,onOpenChange:e=>!e&&(Ee(null),void Fe(null)),children:s.jsxs(k,{children:[s.jsxs(_,{children:[s.jsx(C,{children:V("confirmDeleteBusiness")}),s.jsxs(S,{children:[V("deleteBusinessWarning"),Ie&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600",children:Ie})]})]}),s.jsxs(D,{children:[s.jsx(z,{disabled:qe,children:V("cancel")}),s.jsx(B,{onClick:async()=>{if(Ue)try{Oe(!0),Fe(null);const{error:e}=await n.from("business_members").delete().eq("business_id",Ue);if(e)throw e;const{error:s}=await n.from("business_clients").delete().eq("business_id",Ue);if(s)throw s;const{error:r}=await n.from("business_activity").delete().eq("business_id",Ue);if(r)throw r;const{error:t}=await n.from("businesses").delete().eq("id",Ue);if(t)throw t;oe({title:V("common.success"),description:V("admin.businessDeleted")}),rs()}catch(e){Fe(e.message||V("admin.failedToDeleteBusiness")),oe({title:V("common.error"),description:e.message||V("admin.failedToDeleteBusiness"),variant:"destructive"})}finally{Oe(!1),Ee(null)}},disabled:qe,className:"bg-red-600 hover:bg-red-700",children:qe?s.jsxs(s.Fragment,{children:[s.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),V("common.processing")]}):V("delete")})]})]})})]}):s.jsx("div",{className:"p-8 text-center",children:s.jsx("p",{className:"text-red-500 text-lg",children:V("common.accessDenied")})})};export{$ as default};
//# sourceMappingURL=page-admin.OiVf6Bco.js.map
