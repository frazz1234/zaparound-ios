import{r as e,j as r}from"../vendor/vendor-react-core.D1hcyiwY.js";import{u as o}from"../vendor/vendor--react-hook-form.C68mK_Ba.js";import{t}from"../vendor/vendor---hookform-resolvers.CwYzTTZs.js";import{o as s,a as n,s as i,b as a,e as d,l}from"../vendor/vendor--zod.Cebk8UiH.js";import{B as c,p as m,q as v,r as p,s as j,t as u,C as h,m as x,A as g,n as f,o as k,F as b,u as y,v as _,w,x as N,I as C,y as E,z as S}from"../components/components-ui.C8hnNhgu.js";import{u as q}from"../hooks/hooks-use-toast.ts.Dg8obzHg.js";import{s as $}from"../components/components-admin.CiIAoamg.js";import{u as B}from"../hooks/hooks-useadminauth.ts.BJ7uhFTt.js";import{u as F}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{L as z,n as T,C as I}from"../vendor/vendor--lucide-react.DRw9PYsu.js";import{a as L,u as U}from"../vendor/vendor--react-router.Gdfmkz0l.js";import"../vendor/vendor--cookie.D-6orQ43.js";import"../vendor/vendor-ui-toast.CyvsGWN1.js";import"../vendor/vendor-react-dom.BnDkh-2X.js";import"../vendor/vendor-react-scheduler.B5Ht9ZB3.js";import"../vendor/vendor-ui-core.CPnW5LH0.js";import"../vendor/vendor--aria-hidden.BHUiN-rI.js";import"../vendor/vendor--react-remove-scroll.DR6iVcCg.js";import"../vendor/vendor--tslib.Bc9CN1Ef.js";import"../vendor/vendor--react-remove-scroll-bar.Dz-JErv0.js";import"../vendor/vendor--react-style-singleton.ER5nEGYx.js";import"../vendor/vendor--get-nonce.BYiZHLe3.js";import"../vendor/vendor--use-sidecar.svB0tWl8.js";import"../vendor/vendor--use-callback-ref.Dt9orvWx.js";import"../vendor/vendor---floating-ui-react-dom.gDT63CuY.js";import"../vendor/vendor---floating-ui-dom.CdGDzP9A.js";import"../vendor/vendor---floating-ui-core.D6mclMLM.js";import"../vendor/vendor---floating-ui-utils.D9HCu73I.js";import"../vendor/vendor-ui-dialog.CY7OxuK6.js";import"../vendor/vendor-ui-utils.CjDQ2U02.js";import"../components/components-blog.C3TFiFB1.js";import"../utils/utils-blogutils.ts.CpQs8y27.js";import"../utils/utils-cache.ts.BtmNadnX.js";import"../vendor/vendor--lru-cache.CYB7PIxo.js";import"../components/components-optimizedimage.tsx.DVN-Ynzu.js";import"../vendor/vendor--date-fns.BbAlDtqN.js";import"../hooks/hooks-useblogs.ts.B-jKAetY.js";import"../vendor/vendor-query-main.DFU6mXji.js";import"../vendor/vendor---tanstack-query-core.CIZi0Zbo.js";import"../vendor/vendor--lodash.D80NHDHN.js";import"../vendor/vendor--framer-motion.Dpgjd5L1.js";import"../vendor/vendor--motion-dom.C5KZPrWP.js";import"../vendor/vendor--motion-utils.DAP8mxSY.js";import"../vendor/vendor--react-markdown.C_e4o-CH.js";import"../vendor/vendor--devlop.Cl3hj7Sz.js";import"../vendor/vendor--unified.ti5-l0IV.js";import"../vendor/vendor--bail.gCPcOVbC.js";import"../vendor/vendor--extend.BFvm699q.js";import"../vendor/vendor--is-plain-obj.DeEdtHJQ.js";import"../vendor/vendor--trough.zzWXwSIo.js";import"../vendor/vendor--vfile.Cn6Vy3Ir.js";import"../vendor/vendor--vfile-message.Re42m5o3.js";import"../vendor/vendor--unist-util-stringify-position.CvSG9YTx.js";import"../vendor/vendor--remark-parse.DdoJrvcY.js";import"../vendor/vendor--mdast-util-from-markdown.DI8nvaYJ.js";import"../vendor/vendor--micromark-util-decode-numeric-character-reference.DA7xEauU.js";import"../vendor/vendor--micromark-util-decode-string.BCF2SQ7o.js";import"../vendor/vendor--decode-named-character-reference.C-EXV6yX.js";import"../vendor/vendor--micromark-util-normalize-identifier.CzKtq1sx.js";import"../vendor/vendor--micromark.aJPyxAJv.js";import"../vendor/vendor--micromark-util-combine-extensions.CQDa_SAq.js";import"../vendor/vendor--micromark-util-chunked.3k3e5hER.js";import"../vendor/vendor--micromark-factory-space.CZc9TqN4.js";import"../vendor/vendor--micromark-util-character.DUwsRT9L.js";import"../vendor/vendor--micromark-core-commonmark.yO25BTZZ.js";import"../vendor/vendor--micromark-util-classify-character.x6FlXUUS.js";import"../vendor/vendor--micromark-util-resolve-all.U8fstr8o.js";import"../vendor/vendor--micromark-util-subtokenize.BfHYzAYP.js";import"../vendor/vendor--micromark-factory-destination.pZKs7oL9.js";import"../vendor/vendor--micromark-factory-label.BbusvwMx.js";import"../vendor/vendor--micromark-factory-title.BBtcOUHM.js";import"../vendor/vendor--micromark-factory-whitespace.BhZ6YKME.js";import"../vendor/vendor--micromark-util-html-tag-name.DbKNfynz.js";import"../vendor/vendor--mdast-util-to-string.Ck87fAyN.js";import"../vendor/vendor--remark-rehype.B9Xnklpv.js";import"../vendor/vendor--mdast-util-to-hast.C2F2cLDR.js";import"../vendor/vendor---ungap-structured-clone.DadG6O39.js";import"../vendor/vendor--micromark-util-sanitize-uri.BXHzaaAi.js";import"../vendor/vendor--unist-util-position.CVUg9P9R.js";import"../vendor/vendor--trim-lines.C03Dth7Y.js";import"../vendor/vendor--unist-util-visit.41WSH7so.js";import"../vendor/vendor--unist-util-visit-parents.DAGCrDnu.js";import"../vendor/vendor--unist-util-is.C5Jwnfs7.js";import"../vendor/vendor--hast-util-to-jsx-runtime.BOWXXjuU.js";import"../vendor/vendor--comma-separated-tokens.DIu3lqJt.js";import"../vendor/vendor--property-information.Dc64tFtG.js";import"../vendor/vendor--space-separated-tokens.C97BfSlU.js";import"../vendor/vendor--style-to-js.DQsO4XA8.js";import"../vendor/vendor--style-to-object.DGZeIPGP.js";import"../vendor/vendor--inline-style-parser.BFz9PO4J.js";import"../vendor/vendor--hast-util-whitespace.DlJMGLAz.js";import"../vendor/vendor--estree-util-is-identifier-name.0h9-8Xae.js";import"../vendor/vendor--html-url-attributes.BA_i5Yxb.js";import"../vendor/vendor--react-helmet-async.BMUx00aU.js";import"../vendor/vendor--react-fast-compare.4d-J074I.js";import"../vendor/vendor--invariant.D6mx6rc7.js";import"../vendor/vendor--shallowequal.BwnEDCFe.js";import"../vendor/vendor--web-vitals.C1BoAgs7.js";import"../vendor/vendor-ui-tooltip.n7I39vTs.js";import"../vendor/vendor--embla-carousel-react.Bc6nB0ya.js";import"../vendor/vendor--embla-carousel-reactive-utils.BIRN7lq8.js";import"../vendor/vendor--embla-carousel.clUl8sxa.js";import"../vendor/vendor--cmdk.q6oiTfmV.js";import"../vendor/vendor--react-day-picker.D6HWAs9M.js";import"../vendor/vendor-supabase-client.BJD0U0P8.js";import"../vendor/vendor-supabase-other.BhmW1H_P.js";import"../components/components-mobilenavigation.tsx.DtMtI5i3.js";import"../components/components-languagerouter.tsx.CHVsY7fH.js";import"../vendor/vendor--i18next.CHTa0CEF.js";import"../vendor/vendor--i18next-browser-languagedetector.h4x3AYwK.js";import"../vendor/vendor--i18next-http-backend.DjHzioAf.js";import"../hooks/hooks-useuserrole.ts.BKHSjdY6.js";import"../components/components-languageselector.tsx.x8buceJ0.js";import"../components/components-navigation.CB-8LlfF.js";import"../components/components-theme-toggle.tsx.CfzjOSrj.js";import"../components/components-theme-provider.tsx.Cd7zUHTE.js";import"../vendor/vendor-supabase-realtime.PMyDaGD3.js";import"../vendor/vendor--sonner.ECaEf7Ie.js";const A=s({title:i().min(1,"Title is required"),content:i().min(1,"Content is required"),excerpt:i().optional(),image_url:i().url("Must be a valid URL").optional().or(l("")),category:i().optional(),language:d(["en","fr","es"]),is_published:a().default(!0),keywords:n(i()).optional(),location:i().optional(),activities:n(i()).optional(),stock_tickers:n(i()).optional()});function V(){const{id:s}=L(),n=U(),{toast:i}=q(),{t:a}=F(["admin","common"]),{loading:d}=B(),[l,V]=e.useState(!0),[O,R]=e.useState(!1),[D,K]=e.useState(null),[M,P]=e.useState(null),[Q,W]=e.useState("en"),X=o({resolver:t(A),defaultValues:{title:"",content:"",excerpt:"",image_url:"",category:"",language:"en",is_published:!0,keywords:[],location:"",activities:[],stock_tickers:[]}});e.useEffect((()=>{if(d)return;(async()=>{try{const{data:e,error:r}=await $.from("blogs").select("*").eq("id",s).single();if(r)throw r;if(!e)throw new Error("Blog not found");P(e),X.reset({title:e[`title_${Q}`]||"",content:e[`content_${Q}`]||"",excerpt:e[`excerpt_${Q}`]||"",image_url:e.image_url||"",category:e.category||"",language:Q,is_published:e.is_published,keywords:e.keywords||[],location:e.location||"",activities:e.activities||[],stock_tickers:e.stock_tickers||[]})}catch(e){K(e instanceof Error?e.message:"Failed to fetch blog"),i({title:a("error"),description:e instanceof Error?e.message:"Failed to fetch blog",variant:"destructive"})}finally{V(!1)}})()}),[s,d,X,Q,i,a]);return l?r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsx(z,{className:"h-8 w-8 animate-spin"})}):M?r.jsxs("div",{className:"container mx-auto py-12 px-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(c,{variant:"ghost",size:"icon",onClick:()=>n("/admin"),children:r.jsx(T,{className:"h-6 w-6"})}),r.jsx("h1",{className:"text-2xl font-bold",children:a("editBlog")})]}),r.jsx("div",{className:"flex items-center gap-4",children:r.jsxs(m,{value:Q,onValueChange:e=>{W(e),X.reset({title:M[`title_${e}`]||"",content:M[`content_${e}`]||"",excerpt:M[`excerpt_${e}`]||"",image_url:M.image_url||"",category:M.category||"",language:e,is_published:M.is_published,keywords:M.keywords||[],location:M.location||"",activities:M.activities||[],stock_tickers:M.stock_tickers||[]})},children:[r.jsx(v,{className:"w-[180px]",children:r.jsx(p,{placeholder:a("selectLanguage")})}),r.jsxs(j,{children:[r.jsx(u,{value:"en",children:"English"}),r.jsx(u,{value:"fr",children:"Français"}),r.jsx(u,{value:"es",children:"Español"})]})]})})]}),r.jsx(h,{children:r.jsxs(x,{className:"pt-6",children:[D&&r.jsxs(g,{variant:"destructive",className:"mb-6",children:[r.jsx(I,{className:"h-4 w-4"}),r.jsx(f,{children:a("error")}),r.jsx(k,{children:D})]}),r.jsx(b,{...X,children:r.jsxs("form",{onSubmit:X.handleSubmit((async e=>{try{R(!0),K(null);const r={[`title_${e.language}`]:e.title,[`content_${e.language}`]:e.content,[`excerpt_${e.language}`]:e.excerpt||null,image_url:e.image_url||null,category:e.category||null,is_published:e.is_published,published_at:e.is_published?M?.published_at||(new Date).toISOString():null,keywords:e.keywords||[],location:e.location||null,activities:e.activities||[],stock_tickers:e.stock_tickers||[]},{error:o}=await $.from("blogs").update(r).eq("id",s);if(o)throw o;i({title:a("success"),description:a("blogUpdated")});const{data:t,error:n}=await $.from("blogs").select("*").eq("id",s).single();if(n)throw n;P(t)}catch(r){K(r instanceof Error?r.message:"Failed to update blog"),i({title:a("error"),description:r instanceof Error?r.message:"Failed to update blog",variant:"destructive"})}finally{R(!1)}})),className:"space-y-6",children:[r.jsx(y,{control:X.control,name:"title",render:({field:e})=>r.jsxs(_,{children:[r.jsx(w,{children:a("blogTitle")}),r.jsx(N,{children:r.jsx(C,{placeholder:a("enterBlogTitle"),...e})}),r.jsx(E,{})]})}),r.jsx(y,{control:X.control,name:"content",render:({field:e})=>r.jsxs(_,{children:[r.jsx(w,{children:a("blogContent")}),r.jsx(N,{children:r.jsx(S,{placeholder:a("writeBlogContent"),className:"min-h-[200px]",...e})}),r.jsx(E,{})]})}),r.jsx(y,{control:X.control,name:"excerpt",render:({field:e})=>r.jsxs(_,{children:[r.jsx(w,{children:a("blogExcerpt")}),r.jsx(N,{children:r.jsx(S,{placeholder:a("writeBlogExcerpt"),className:"min-h-[100px]",...e})}),r.jsx(E,{})]})}),r.jsx(y,{control:X.control,name:"image_url",render:({field:e})=>r.jsxs(_,{children:[r.jsx(w,{children:a("blogImage")}),r.jsx(N,{children:r.jsx(C,{placeholder:a("enterImageUrl"),...e})}),r.jsx(E,{})]})}),r.jsx(y,{control:X.control,name:"category",render:({field:e})=>r.jsxs(_,{children:[r.jsx(w,{children:a("blogCategory")}),r.jsx(N,{children:r.jsx(C,{placeholder:a("enterBlogCategory"),...e})}),r.jsx(E,{})]})}),r.jsx(y,{control:X.control,name:"keywords",render:({field:e})=>r.jsxs(_,{children:[r.jsx(w,{children:"Keywords"}),r.jsx(N,{children:r.jsx(C,{placeholder:"Enter keywords (comma-separated)",onChange:r=>e.onChange(r.target.value.split(",").map((e=>e.trim()))),value:e.value?.join(", ")||""})}),r.jsx(E,{})]})}),r.jsx(y,{control:X.control,name:"location",render:({field:e})=>r.jsxs(_,{children:[r.jsx(w,{children:"Location"}),r.jsx(N,{children:r.jsx(C,{placeholder:"Enter location",...e})}),r.jsx(E,{})]})}),r.jsx(y,{control:X.control,name:"activities",render:({field:e})=>r.jsxs(_,{children:[r.jsx(w,{children:"Activities"}),r.jsx(N,{children:r.jsx(C,{placeholder:"Enter activities (comma-separated)",onChange:r=>e.onChange(r.target.value.split(",").map((e=>e.trim()))),value:e.value?.join(", ")||""})}),r.jsx(E,{})]})}),r.jsx(y,{control:X.control,name:"stock_tickers",render:({field:e})=>r.jsxs(_,{children:[r.jsx(w,{children:"Stock Tickers"}),r.jsx(N,{children:r.jsx(C,{placeholder:"Enter stock tickers (comma-separated)",onChange:r=>e.onChange(r.target.value.split(",").map((e=>e.trim()))),value:e.value?.join(", ")||""})}),r.jsx(E,{})]})}),r.jsx(y,{control:X.control,name:"is_published",render:({field:e})=>r.jsxs(_,{className:"flex items-center space-x-2 space-y-0",children:[r.jsx(N,{children:r.jsx("input",{type:"checkbox",checked:e.value,onChange:e.onChange,className:"w-4 h-4"})}),r.jsx(w,{className:"font-normal",children:a("publishBlog")})]})}),r.jsx(c,{type:"submit",className:"w-full",disabled:O,children:O?r.jsxs(r.Fragment,{children:[a("saving"),r.jsx(z,{className:"ml-2 h-4 w-4 animate-spin"})]}):a("saveChanges")})]})})]})})]}):r.jsx("div",{className:"container mx-auto py-12 px-4",children:r.jsxs("div",{className:"text-center",children:[r.jsx("h1",{className:"text-2xl font-bold mb-4",children:a("blogNotFound")}),r.jsx(c,{onClick:()=>n("/admin"),children:a("backToAdmin")})]})})}export{V as default};
//# sourceMappingURL=page-blogedit.aH6eHfmV.js.map
