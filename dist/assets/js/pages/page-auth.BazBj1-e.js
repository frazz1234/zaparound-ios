import{r as s,j as e}from"../vendor/vendor-react-core.D1hcyiwY.js";import{C as a,k as t,l as r,R as n,m as o,N as i,O as l,P as c,Q as d,G as m,J as u,K as p,M as g,ab as h}from"../components/components-ui.C8hnNhgu.js";import{s as x}from"../components/components-admin.CiIAoamg.js";import{L as j}from"../components/components-languageselector.tsx.x8buceJ0.js";import{L as f,S as w,R as b}from"../components/components-auth.B-7euJmi.js";import{u as S}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{u as v,b as y,a as N}from"../vendor/vendor--react-router.Gdfmkz0l.js";function I(){const I=v(),P=y(),{lang:U}=N(),{t:R}=S("auth"),[$,_]=s.useState(""),[E,L]=s.useState(""),[M,A]=s.useState("signin"),[T,C]=s.useState(!1),[k,z]=s.useState(!1),[O,V]=s.useState(""),q=P.state?.returnTo||"/dashboard",D=P.state?.plan||null;s.useEffect((()=>{window.scrollTo(0,0),window.location.pathname.includes("/auth/callback")?G():F();"signup"===new URLSearchParams(P.search).get("mode")&&A("signup")}),[P]);const F=async()=>{try{const{data:{user:s}}=await x.auth.getUser();s&&J(s.id)}catch(s){}},G=async()=>{try{const{data:{session:s}}=await x.auth.getSession();if(s){const e=new URLSearchParams(window.location.search);"true"===e.get("isNewSignUp")&&"apple"===s.user?.app_metadata?.provider?window.location.href="/?isNewSignUp=true":J(s.user.id)}else I("/auth")}catch(s){I("/auth")}},J=async s=>{try{localStorage.removeItem("userRole"),localStorage.removeItem("isAdmin"),localStorage.removeItem("userRoleTimestamp");const{data:e,error:a}=await x.from("user_roles").select("role").eq("user_id",s).maybeSingle();if(a){return void I(`/${U||"en"}/dashboard`)}const t=e?.role||"nosubs";if(localStorage.setItem("userRole",t),localStorage.setItem("isAdmin","false"),localStorage.setItem("userRoleTimestamp",Date.now().toString()),localStorage.getItem("zaparound_free_trip_state"))return void I("/",{replace:!0});const r=U||"en";if("nosubs"===t&&"/pricing"===q&&D)I(`/${r}/pricing`,{state:{selectedPlan:D}});else if(q&&"/dashboard"!==q){const s=q.startsWith(`/${r}`)?q:`/${r}${q}`;I(s)}else I(`/${r}/dashboard`)}catch(e){I(`/${U||"en"}/dashboard`)}},K=async()=>{const{data:{user:s}}=await x.auth.getUser();if(s)J(s.id);else{I(`/${U||"en"}/dashboard`)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:[e.jsxs(a,{className:"w-full max-w-md",children:[e.jsxs(t,{className:"space-y-1",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/zaparound-uploads/transparentnoliner.webp",alt:"ZapAround Logo",className:"h-12"})}),e.jsx(r,{className:"text-2xl text-center font-bold",children:R("signin"===M?"signIn.title":"signUp.title")}),e.jsx(n,{className:"text-center",children:R("signin"===M?"signIn.subtitle":"signUp.subtitle")})]}),e.jsxs(o,{children:[e.jsxs(i,{defaultValue:M,value:M,onValueChange:s=>A(s),className:"w-full",children:[e.jsxs(l,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(c,{id:"signin-tab",value:"signin",children:R("signIn.button")}),e.jsx(c,{id:"signup-tab",value:"signup",children:R("signUp.button")})]}),e.jsx(d,{value:"signin",children:e.jsx(f,{email:$,setEmail:_,password:E,setPassword:L,onForgotPassword:()=>C(!0),onSuccess:K,errorMessage:O,setErrorMessage:V})}),e.jsx(d,{value:"signup",children:e.jsx(w,{email:$,setEmail:_,password:E,setPassword:L,errorMessage:O,setErrorMessage:V,onSuccess:K})})]}),e.jsx("div",{className:"flex items-center justify-between gap-2 mt-4",children:e.jsx(j,{variant:"ghost"})})]})]}),e.jsx(m,{open:T,onOpenChange:C,children:e.jsxs(u,{className:"sm:max-w-[425px]",children:[e.jsxs(p,{children:[e.jsx(g,{children:R("resetPassword.title")}),e.jsx(h,{children:R("resetPassword.subtitle")})]}),e.jsx(b,{onSuccess:()=>C(!1)})]})})]})}export{I as A};
//# sourceMappingURL=page-auth.BazBj1-e.js.map
