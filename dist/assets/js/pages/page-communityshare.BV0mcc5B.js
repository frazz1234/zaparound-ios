import{r as e,j as t}from"../vendor/vendor-react-core.D1hcyiwY.js";import{s as a}from"../components/components-admin.CiIAoamg.js";import{u as r}from"../hooks/hooks-use-toast.ts.Dg8obzHg.js";import{B as s,aT as i,D as n,f as o,g as l,j as c}from"../components/components-ui.C8hnNhgu.js";import{a as d,b as m,M as u}from"../components/components-community.DdS-HWu3.js";import{c as p}from"../components/components-blog.C3TFiFB1.js";import{H as x}from"../vendor/vendor--react-helmet-async.BMUx00aU.js";import{u as h}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{u as g,U as f,i as y,ac as j,H as v,bt as b,L as w}from"../vendor/vendor--lucide-react.DRw9PYsu.js";import{a as N,u as _}from"../vendor/vendor--react-router.Gdfmkz0l.js";const k=()=>{const{postId:k,locationSlug:$}=N(),C=_(),{toast:S}=r(),{t:P}=h("community"),[U,E]=e.useState(null),[L,z]=e.useState(!0),[A,F]=e.useState(null),[T,D]=e.useState({}),[Z,q]=e.useState([]),[B,M]=e.useState(""),[R,I]=e.useState([]),[O,H]=e.useState(0),[J,W]=e.useState(!1),[Y,G]=e.useState(!1);e.useEffect((()=>{Q(),K(),X()}),[k]);const K=async()=>{const{data:{user:e}}=await a.auth.getUser();F(e)},Q=async()=>{try{z(!0);const{data:e,error:t}=await a.from("community_posts").select("\n          *,\n          likes:post_likes(count),\n          replies:post_replies(count),\n          profile:profiles!user_id (\n            username,\n            first_name,\n            last_name,\n            avatar_url\n          )\n        ").eq("id",k).single();if(t)throw t;E(e),A&&V()}catch(e){S({title:"Error",description:"Failed to fetch post. Please try again.",variant:"destructive"})}finally{z(!1)}},V=async()=>{try{const{data:{user:e}}=await a.auth.getUser();if(!e)return;const{data:t,error:r}=await a.from("post_likes").select("post_id").eq("post_id",k).eq("user_id",e.id);if(r)throw r;const s={};t.forEach((e=>{s[e.post_id]=!0})),D(s)}catch(e){}},X=async()=>{try{const{data:e,error:t}=await a.from("post_replies").select("\n          *,\n          profile:profiles!user_id (\n            username,\n            first_name,\n            last_name,\n            avatar_url\n          )\n        ").eq("post_id",k).order("created_at",{ascending:!1});if(t)throw t;q(e||[])}catch(e){}};return L?t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"}),t.jsx("p",{className:"mt-4 text-gray-600",children:"Loading post..."})]})}):U?(U.location?(U.location,U.content.substring(0,150)):(U.content.substring(0,160),U.content.length),U.media_urls&&U.media_urls.length>0?U.media_urls.find((e=>"image"===e.type)):U.image_url,t.jsxs(t.Fragment,{children:[t.jsx(x,{children:(()=>{const e=(()=>{if(!U)return null;const e=U.location?`${U.location} - Community Post on ZapAround`:"Community Post on ZapAround";let t="";U.location&&(t=`Discover ${U.location} through our community. `),t+=(U.content||"").substring(0,150)+((U.content||"").length>150?"...":"");const a=U.media_urls?.[0]?.url||U.image_url||"/apple-touch-icon.png",r=window.location.pathname.split("/")[1]||"en",s=$?`${window.location.origin}/${r}/community/share/${U.id}/${$}`:`${window.location.origin}/${r}/community/share/${U.id}`,i={"@context":"https://schema.org","@type":"Article",headline:e,description:t,image:a,author:{"@type":"Person",name:`${U.profile?.first_name||""} ${U.profile?.last_name||""}`.trim()||U.profile?.username||"ZapAround User"},publisher:{"@type":"Organization",name:"ZapAround",url:window.location.origin},datePublished:U.created_at,dateModified:U.updated_at||U.created_at,mainEntityOfPage:{"@type":"WebPage","@id":s}};U.location&&(i.contentLocation={"@type":"Place",name:U.location});const n=["en","fr","es"].filter((e=>e!==r));return{title:e,description:t,image:a,canonicalUrl:s,structuredData:i,alternates:n.map((e=>({lang:e,url:s.replace(`/${r}/`,`/${e}/`)})))}})();return e?t.jsxs(t.Fragment,{children:[t.jsx("title",{children:e.title}),t.jsx("meta",{name:"description",content:e.description}),t.jsx("meta",{property:"og:title",content:e.title}),t.jsx("meta",{property:"og:description",content:e.description}),t.jsx("meta",{property:"og:type",content:"article"}),t.jsx("meta",{property:"og:url",content:e.canonicalUrl}),t.jsx("meta",{property:"og:image",content:e.image}),t.jsx("meta",{property:"og:site_name",content:"ZapAround"}),t.jsx("meta",{property:"og:locale",content:window.location.pathname.split("/")[1]||"en"}),t.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),t.jsx("meta",{name:"twitter:title",content:e.title}),t.jsx("meta",{name:"twitter:description",content:e.description}),t.jsx("meta",{name:"twitter:image",content:e.image}),t.jsx("meta",{name:"twitter:site",content:"@zaparounds"}),t.jsx("link",{rel:"canonical",href:e.canonicalUrl}),t.jsx("meta",{name:"robots",content:"index, follow"}),t.jsx("meta",{name:"googlebot",content:"index, follow"}),e.alternates?.map((e=>t.jsx("link",{rel:"alternate",hrefLang:e.lang,href:e.url},e.lang))),t.jsx("link",{rel:"alternate",hrefLang:"x-default",href:e.canonicalUrl.replace(/\/[a-z]{2}\//,"/en/")}),U.location&&t.jsxs(t.Fragment,{children:[t.jsx("meta",{name:"geo.placename",content:U.location}),t.jsx("meta",{name:"geo.region",content:U.location}),t.jsx("meta",{name:"keywords",content:`${U.location}, community, travel, ZapAround, ${U.content?.substring(0,100)||""}`})]}),t.jsx("script",{type:"application/ld+json",children:JSON.stringify(e.structuredData)})]}):null})()}),t.jsx("div",{className:"min-h-screen bg-gray-50",children:t.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-8",children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs(s,{variant:"ghost",onClick:()=>{const e=window.location.pathname.split("/")[1]||"en";C(`/${e}/community`)},className:"mb-4 flex items-center gap-2",children:[t.jsx(g,{className:"h-4 w-4"}),P("navigation.title")]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"h-12 w-12 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center shadow-sm overflow-hidden",children:U.profile?.avatar_url?t.jsx("img",{src:a.storage.from("avatars").getPublicUrl(U.profile.avatar_url).data.publicUrl,alt:U.profile.username||`${U.profile.first_name||""} ${U.profile.last_name||""}`.trim()||"User",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.style.display="none",e.currentTarget.parentElement.classList.remove("overflow-hidden")}}):t.jsx(f,{className:"h-6 w-6 text-blue-500"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"font-semibold text-gray-800",children:U.profile?.username||`${U.profile?.first_name||""} ${U.profile?.last_name||""}`.trim()||P("user.anonymous")}),t.jsx("p",{className:"text-sm text-gray-500",children:new Date(U.created_at).toLocaleString()}),U.rating&&t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx(i,{rating:U.rating,size:"sm",readonly:!0}),t.jsxs("span",{className:"text-xs text-gray-500",children:[U.rating," ",1!==U.rating?P("rating.stars"):P("rating.star")]})]})]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(n,{children:[t.jsx(o,{asChild:!0,children:t.jsx(s,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-gray-100",title:"Share post",children:t.jsx(y,{className:"h-4 w-4 text-blue-500"})})}),t.jsxs(l,{align:"end",className:"w-48",children:[t.jsxs(c,{onClick:async()=>{const e=window.location.pathname.split("/")[1]||(navigator.language||"en").slice(0,2),t=$?`${window.location.origin}/${e}/community/share/${U.id}/${$}`:`${window.location.origin}/${e}/community/share/${U.id}`,a=P("share.checkFound","Check what I found on ZapAround"),r=(U.content||"").trim(),s=`${a}${(r.length>220?r.substring(0,220)+"...":r)?`\n'${r}'`:""}${U.location?`\n${U.location}`:""}\n${t}`;if("undefined"!=typeof navigator&&navigator.share){const e={title:"ZapAround",text:s,url:t};try{if(U.media_urls&&U.media_urls.length>0){const t=U.media_urls.find((e=>"image"===e.type));if(t&&t.url){const a=await fetch(t.url),r=await a.blob(),s=r.type&&r.type.split("/")[1]||"jpg",i=new File([r],`zaparound-share.${s}`,{type:r.type||"image/jpeg"});navigator.canShare&&navigator.canShare({files:[i]})&&(e.files=[i])}}}catch(i){}try{return void(await navigator.share(e))}catch(i){}}try{await navigator.clipboard.writeText(s),S({title:"Link Copied!",description:"Post text and link have been copied to your clipboard."})}catch(i){const e=document.createElement("textarea");e.value=s,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),S({title:"Link Copied!",description:"Post text and link have been copied to your clipboard."})}},className:"cursor-pointer",children:[t.jsx(y,{className:"h-4 w-4 mr-2"}),P("postActions.shareWithDevice","Share with device")]}),t.jsxs(c,{onClick:async()=>{const e=window.location.pathname.split("/")[1]||(navigator.language||"en").slice(0,2),t=$?`${window.location.origin}/${e}/community/share/${U.id}/${$}`:`${window.location.origin}/${e}/community/share/${U.id}`;try{await navigator.clipboard.writeText(t),S({title:"Link Copied!",description:"Post link has been copied to your clipboard."})}catch(a){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),S({title:"Link Copied!",description:"Post link has been copied to your clipboard."})}},className:"cursor-pointer",children:[t.jsx(j,{className:"h-4 w-4 mr-2"}),P("postActions.copyLink","Copy link")]})]})]})})]}),U.location&&t.jsx("div",{className:"mb-4",children:t.jsx(d,{location:U.location,placeId:U.place_id,placeLat:U.place_lat,placeLng:U.place_lng,placeTypes:U.place_types,placeRating:U.place_rating,placeUserRatingsTotal:U.place_user_ratings_total})}),t.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-4",children:[t.jsx("p",{className:"text-gray-700 leading-relaxed text-lg",children:U.content}),U.media_urls&&U.media_urls.length>0||U.image_url?t.jsx("div",{className:"mt-4",children:t.jsx(m,{media:U.media_urls&&U.media_urls.length>0?U.media_urls:U.image_url,maxPreview:10})}):null]}),t.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(s,{variant:"ghost",size:"sm",className:p("flex items-center rounded-full px-4",T[k]?"text-red-500 hover:bg-red-50":"hover:bg-gray-100"),onClick:async()=>{try{const{data:{user:e}}=await a.auth.getUser();if(!e)return void S({title:"Error",description:"You must be logged in to like posts.",variant:"destructive"});if(T[k]){const{error:t}=await a.from("post_likes").delete().eq("post_id",k).eq("user_id",e.id);if(t)throw t;D((e=>({...e,[k]:!1}))),E((e=>({...e,likes:[{count:(e.likes?.[0]?.count||1)-1}]})))}else{const{error:t}=await a.from("post_likes").insert([{post_id:k,user_id:e.id}]);if(t)throw t;D((e=>({...e,[k]:!0}))),E((e=>({...e,likes:[{count:(e.likes?.[0]?.count||0)+1}]})))}}catch(e){S({title:"Error",description:"Failed to update like. Please try again.",variant:"destructive"})}},children:[t.jsx(v,{className:p("h-4 w-4 mr-2",T[k]?"fill-current":"")}),U.likes?.[0]?.count||0," Likes"]}),t.jsxs(s,{variant:"ghost",size:"sm",className:"flex items-center rounded-full px-4 hover:bg-gray-100",onClick:()=>G(!Y),children:[t.jsx(b,{className:"h-4 w-4 mr-2"}),U.replies?.[0]?.count||0," ",P("replies.title")]})]}),t.jsxs(s,{variant:"outline",size:"sm",onClick:()=>C("/community"),className:"flex items-center gap-2",children:[t.jsx(j,{className:"h-4 w-4"}),P("navigation.title")]})]}),A&&t.jsx("div",{className:"mt-6 pt-4 border-t",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("textarea",{value:B,onChange:e=>M(e.target.value),placeholder:P("replies.placeholder"),className:"w-full p-3 border border-gray-200 rounded-lg resize-none focus:ring-2 focus:ring-green-500 focus:border-transparent",rows:3}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:P("rating.ratePost")}),t.jsx(i,{rating:O,onRatingChange:H,size:"sm"}),O>0&&t.jsxs("span",{className:"text-sm text-gray-500",children:[O," ",P(1!==O?"rating.stars":"rating.star")]})]}),t.jsx(u,{onMediaChange:e=>{I(e)},maxFiles:5,disabled:J}),t.jsx("div",{className:"flex justify-end",children:t.jsx(s,{size:"sm",onClick:async()=>{if(A)if(B.trim()||0!==R.length)try{W(!0);const e=await(async e=>{if(!e||0===e.length)return[];const t=[];for(const s of e)try{const e=s.file.name.split(".").pop(),r=`community-replies/${Date.now()}-${Math.random().toString(36).substring(2)}.${e}`,{error:i}=await a.storage.from("community-media").upload(r,s.file);if(i)throw i;const{data:{publicUrl:n}}=a.storage.from("community-media").getPublicUrl(r);t.push({id:s.id,url:n,type:s.type,thumbnail:"video"===s.type?s.preview:void 0})}catch(r){S({title:"Error",description:"Failed to upload media. Please try again.",variant:"destructive"})}return t})(R),{data:t,error:r}=await a.from("post_replies").insert([{post_id:k,user_id:A.id,content:B.trim(),media_urls:e,rating:O>0?O:null,created_at:(new Date).toISOString()}]).select("\n          *,\n          profile:profiles!user_id (\n            username,\n            first_name,\n            last_name,\n            avatar_url\n          )\n        ").single();if(r)throw r;q((e=>[t,...e])),E((e=>({...e,replies:[{count:(e.replies?.[0]?.count||0)+1}]}))),M(""),I([]),H(0),S({title:"Success",description:"Reply posted successfully!"}),Y||G(!0)}catch(e){S({title:"Error",description:"Failed to post reply. Please try again.",variant:"destructive"})}finally{W(!1)}else S({title:"Error",description:"Please add some content or media to your reply.",variant:"destructive"});else S({title:"Error",description:"You must be logged in to reply.",variant:"destructive"})},disabled:J||!B.trim()&&0===R.length,className:p("relative px-6 py-2 bg-gradient-to-r from-[#10B981] to-[#059669] text-white border-none hover:from-[#059669] hover:to-[#047857] hover:scale-105 transition-all duration-300 shadow-lg rounded-full font-medium tracking-wide flex items-center gap-2",!B.trim()&&0===R.length&&"opacity-50 cursor-not-allowed"),children:J?t.jsxs(t.Fragment,{children:[t.jsx(w,{className:"h-4 w-4 animate-spin"}),P("replies.posting")]}):P("replies.replyButton")})})]})}),Y&&t.jsxs("div",{className:"mt-6 pt-4 border-t",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:P("replies.title")}),t.jsx("div",{className:"space-y-4",children:0===Z.length?t.jsx("p",{className:"text-gray-500 text-center py-4",children:P("replies.noReplies")}):Z.map((e=>t.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"h-8 w-8 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center shadow-sm overflow-hidden flex-shrink-0",children:e.profile?.avatar_url?t.jsx("img",{src:a.storage.from("avatars").getPublicUrl(e.profile.avatar_url).data.publicUrl,alt:e.profile.username||`${e.profile.first_name||""} ${e.profile.last_name||""}`.trim()||"User",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.style.display="none",e.currentTarget.parentElement.classList.remove("overflow-hidden")}}):t.jsx(f,{className:"h-4 w-4 text-blue-500"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("p",{className:"font-medium text-gray-800 text-sm",children:e.profile?.username||`${e.profile?.first_name||""} ${e.profile?.last_name||""}`.trim()||P("user.anonymous")}),t.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleString()})]}),t.jsx("p",{className:"text-gray-700 text-sm mb-2",children:e.content}),e.rating&&t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(i,{rating:e.rating,size:"sm",readonly:!0}),t.jsxs("span",{className:"text-xs text-gray-500",children:[e.rating," ",1!==e.rating?P("rating.stars"):P("rating.star")]})]}),e.media_urls&&e.media_urls.length>0||e.image_url?t.jsx("div",{className:"mt-2",children:t.jsx(m,{media:e.media_urls&&e.media_urls.length>0?e.media_urls:e.image_url,maxPreview:3})}):null]})]})},e.id)))})]})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#61936f]/20 to-[#4a7c59]/20 rounded-3xl blur-2xl transform rotate-3 scale-105"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-tl from-[#10B981]/15 to-[#059669]/15 rounded-3xl blur-xl transform -rotate-2 scale-105"}),t.jsxs("div",{className:"relative bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 p-8 transform hover:scale-[1.02] transition-all duration-500 hover:shadow-3xl",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#61936f]/5 to-[#10B981]/5 rounded-3xl"}),t.jsxs("div",{className:"relative z-10 text-center",children:[t.jsx("h2",{className:"text-3xl font-bold mb-4 tracking-tight text-[#1d1d1e]",children:U.location?P("communityShare.readyToExplore",{location:U.location}):P("communityShare.readyToJoin")}),t.jsx("p",{className:"text-lg mb-8 text-[#62626a] max-w-2xl mx-auto",children:U.location?P("communityShare.discoverMore"):P("communityShare.shareStories")}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[t.jsx(s,{size:"lg",className:"relative px-8 py-3 bg-gradient-to-r from-[#61936f] to-[#4a7c59] hover:from-[#4a7c59] hover:to-[#3d6b4a] text-white hover:scale-105 transition-all duration-300 shadow-lg rounded-full font-semibold tracking-wide min-w-[180px] border-0",onClick:()=>C("/community"),children:P("communityShare.exploreCommunity")}),t.jsx(s,{size:"lg",variant:"outline",className:"relative px-8 py-3 border-2 border-[#61936f] text-[#61936f] hover:bg-[#61936f] hover:text-white hover:scale-105 transition-all duration-300 rounded-full font-semibold tracking-wide min-w-[180px]",onClick:()=>C("/"),children:P("communityShare.startPlanning")})]})]}),t.jsx("div",{className:"absolute top-4 left-4 w-8 h-8 border-l-2 border-t-2 border-[#61936f]/30 rounded-tl-2xl"}),t.jsx("div",{className:"absolute top-4 right-4 w-8 h-8 border-r-2 border-t-2 border-[#61936f]/30 rounded-tr-2xl"}),t.jsx("div",{className:"absolute bottom-4 left-4 w-8 h-8 border-l-2 border-b-2 border-[#61936f]/30 rounded-bl-2xl"}),t.jsx("div",{className:"absolute bottom-4 right-4 w-8 h-8 border-r-2 border-b-2 border-[#61936f]/30 rounded-br-2xl"})]})]})]})})]})):t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Post Not Found"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"The post you're looking for doesn't exist or has been removed."}),t.jsxs(s,{onClick:()=>{const e=window.location.pathname.split("/")[1]||"en";C(`/${e}/community`)},children:[t.jsx(g,{className:"h-4 w-4 mr-2"}),"Back to Community"]})]})})};export{k as C};
//# sourceMappingURL=page-communityshare.BV0mcc5B.js.map
