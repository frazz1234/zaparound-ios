{"version":3,"file":"components-bookings.q58dYAlO.js","sources":["../../../../src/components/bookings/EmailBookingDialog.tsx"],"sourcesContent":["import { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { supabase } from '@/integrations/supabase/client';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Mail, Send, Loader2 } from 'lucide-react';\nimport { useToast } from \"@/components/ui/use-toast\";\n\ninterface EmailBookingDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  bookingData: any;\n}\n\nexport function EmailBookingDialog({ isOpen, onClose, bookingData }: EmailBookingDialogProps) {\n  const { t, i18n } = useTranslation('zapbooking');\n  const { toast } = useToast();\n  const [email, setEmail] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!email.trim()) {\n      toast({\n        title: t('error'),\n        description: t('emailDialog.pleaseEnterValidEmail'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Basic email validation\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      toast({\n        title: t('error'),\n        description: t('emailDialog.pleaseEnterValidEmail'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const { data, error } = await supabase.functions.invoke('send-booking-email', {\n        body: {\n          bookingReference: bookingData.booking_reference,\n          recipientEmail: email.trim(),\n          bookingData: bookingData,\n          language: i18n.language\n        }\n      });\n\n      if (error) throw error;\n\n      toast({\n        title: t('emailDialog.success'),\n        description: t('emailDialog.bookingDetailsSent'),\n      });\n\n      setEmail('');\n      onClose();\n    } catch (error: any) {\n      console.error('Error sending booking email:', error);\n      toast({\n        title: t('error'),\n        description: error.message || t('emailDialog.failedToSend'),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !isLoading) {\n      handleSubmit(e);\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center\">\n            <Mail className=\"w-5 h-5 mr-2\" />\n            {t('emailDialog.title')}\n          </DialogTitle>\n          <DialogDescription>\n            {t('emailDialog.description')} {bookingData?.booking_reference}.\n          </DialogDescription>\n        </DialogHeader>\n        \n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">{t('emailDialog.emailAddress')}</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              placeholder={t('emailDialog.emailPlaceholder')}\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              onKeyPress={handleKeyPress}\n              disabled={isLoading}\n              autoFocus\n            />\n          </div>\n          \n          <div className=\"flex justify-end space-x-2\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={onClose}\n              disabled={isLoading}\n            >\n              {t('emailDialog.cancel')}\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={isLoading || !email.trim()}\n              className=\"bg-[#61936f] hover:bg-[#4a7c5a] text-white\"\n            >\n              {isLoading ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  {t('emailDialog.sending')}\n                </>\n              ) : (\n                <>\n                  <Send className=\"w-4 h-4 mr-2\" />\n                  {t('emailDialog.sendEmail')}\n                </>\n              )}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n} "],"names":["EmailBookingDialog","isOpen","onClose","bookingData","t","i18n","useTranslation","toast","useToast","email","setEmail","useState","isLoading","setIsLoading","handleSubmit","async","e","preventDefault","trim","title","description","variant","test","data","error","supabase","functions","invoke","body","bookingReference","booking_reference","recipientEmail","language","message","jsx","Dialog","open","onOpenChange","children","jsxs","DialogContent","className","DialogHeader","DialogTitle","Mail","DialogDescription","onSubmit","Label","htmlFor","Input","id","type","placeholder","value","onChange","target","onKeyPress","key","disabled","autoFocus","Button","onClick","Fragment","Loader2","Send"],"mappings":"4ZAsBO,SAASA,GAAmBC,OAAEA,EAAQC,QAAAA,EAAAC,YAASA,IACpD,MAAMC,EAAEA,EAAAC,KAAGA,GAASC,EAAe,eAC7BC,MAAEA,GAAUC,KACXC,EAAOC,GAAYC,EAAAA,SAAS,KAC5BC,EAAWC,GAAgBF,EAAAA,UAAS,GAErCG,EAAeC,MAAOC,IAGtB,GAFJA,EAAEC,kBAEGR,EAAMS,OAMT,YALMX,EAAA,CACJY,MAAOf,EAAE,SACTgB,YAAahB,EAAE,qCACfiB,QAAS,gBAOb,GADmB,6BACHC,KAAKb,GAArB,CASAI,GAAa,GACT,IACI,MAAAU,KAAEA,QAAMC,SAAgBC,EAASC,UAAUC,OAAO,qBAAsB,CAC5EC,KAAM,CACJC,iBAAkB1B,EAAY2B,kBAC9BC,eAAgBtB,EAAMS,OACtBf,cACA6B,SAAU3B,EAAK2B,YAInB,GAAIR,EAAa,MAAAA,EAEXjB,EAAA,CACJY,MAAOf,EAAE,uBACTgB,YAAahB,EAAE,oCAGjBM,EAAS,IACDR,UACDsB,GAEDjB,EAAA,CACJY,MAAOf,EAAE,SACTgB,YAAaI,EAAMS,SAAW7B,EAAE,4BAChCiB,QAAS,eACV,CACD,QACAR,GAAa,EAAK,CA/BlB,MALMN,EAAA,CACJY,MAAOf,EAAE,SACTgB,YAAahB,EAAE,qCACfiB,QAAS,eAiCO,EAWpB,OAAAa,EAAAA,IAACC,GAAOC,KAAMnC,EAAQoC,aAAcnC,EAClCoC,SAAAC,EAAAA,KAACC,EAAc,CAAAC,UAAU,cACvBH,SAAA,CAAAC,OAACG,EACC,CAAAJ,SAAA,CAACC,EAAAA,KAAAI,EAAA,CAAYF,UAAU,oBACrBH,SAAA,CAACJ,EAAAA,IAAAU,EAAA,CAAKH,UAAU,iBACfrC,EAAE,+BAEJyC,EACE,CAAAP,SAAA,CAAAlC,EAAE,2BAA2B,IAAED,GAAa2B,kBAAkB,UAIlES,EAAAA,KAAA,OAAA,CAAKO,SAAUhC,EAAc2B,UAAU,YACtCH,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIE,UAAU,YACbH,SAAA,CAAAJ,MAACa,EAAM,CAAAC,QAAQ,QAASV,SAAAlC,EAAE,8BAC1B8B,EAAAA,IAACe,EAAA,CACCC,GAAG,QACHC,KAAK,QACLC,YAAahD,EAAE,gCACfiD,MAAO5C,EACP6C,SAAWtC,GAAMN,EAASM,EAAEuC,OAAOF,OACnCG,WA5BYxC,IACR,UAAVA,EAAEyC,KAAoB7C,GACxBE,EAAaE,EAAC,EA2BN0C,SAAU9C,EACV+C,WAAS,OAIbpB,EAAAA,KAAC,MAAI,CAAAE,UAAU,6BACbH,SAAA,CAAAJ,EAAAA,IAAC0B,EAAA,CACCT,KAAK,SACL9B,QAAQ,UACRwC,QAAS3D,EACTwD,SAAU9C,EAET0B,WAAE,wBAELJ,EAAAA,IAAC0B,EAAA,CACCT,KAAK,SACLO,SAAU9C,IAAcH,EAAMS,OAC9BuB,UAAU,6CAETH,WAEGC,EAAAA,KAAAuB,EAAAA,SAAA,CAAAxB,SAAA,CAACJ,EAAAA,IAAA6B,EAAA,CAAQtB,UAAU,8BAClBrC,EAAE,0BAIHmC,EAAAA,KAAAuB,EAAAA,SAAA,CAAAxB,SAAA,CAACJ,EAAAA,IAAA8B,EAAA,CAAKvB,UAAU,iBACfrC,EAAE,wCASrB"}