{"version":3,"file":"components-tripmap.tsx.B4l0_mxI.js","sources":["../../../../src/components/TripMap.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport mapboxgl from 'mapbox-gl';\nimport 'mapbox-gl/dist/mapbox-gl.css';\n\ninterface GeoPosition {\n  name: string;\n  type: string;\n  coordinates: [number, number];\n  description?: string;\n}\n\ninterface TripMapProps {\n  className?: string;\n  height?: string;\n  center?: [number, number];\n  zoom?: number;\n  geopositions?: GeoPosition[];\n  onMarkerClick?: (position: GeoPosition) => void;\n  showTerrain?: boolean;\n  initialCenter?: [number, number];\n}\n\n// Custom marker styles\nconst markerStyles = `\n.custom-marker {\n  width: 35px;\n  height: 35px;\n  cursor: pointer;\n  transform-origin: bottom;\n  transition: all 0.3s ease;\n}\n\n.custom-marker:hover {\n  transform: scale(1.1) translateY(-5px);\n}\n\n.marker-content {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background: linear-gradient(45deg, #3b82f6, #6366f1);\n  border: 3px solid white;\n  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n  color: white;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  font-size: 14px;\n}\n\n.mapboxgl-popup {\n  max-width: 300px !important;\n}\n\n.mapboxgl-popup-content {\n  padding: 0 !important;\n  border-radius: 12px !important;\n  overflow: hidden !important;\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;\n}\n\n.popup-content {\n  padding: 16px;\n  background: white;\n}\n\n.popup-header {\n  padding: 12px 16px;\n  background: linear-gradient(to right, #3b82f6, #6366f1);\n  color: white;\n  margin: -16px -16px 12px -16px;\n}\n\n.popup-title {\n  font-size: 16px;\n  font-weight: 600;\n  margin: 0;\n}\n\n.popup-description {\n  color: #4b5563;\n  font-size: 14px;\n  margin: 8px 0;\n}\n\n.popup-coordinates {\n  display: flex;\n  align-items: center;\n  color: #6b7280;\n  font-size: 12px;\n  margin-top: 8px;\n}\n\n.popup-icon {\n  width: 16px;\n  height: 16px;\n  margin-right: 4px;\n}\n`;\n\nconst TripMap = ({ \n  className = \"\", \n  height = \"500px\",\n  center = [2.3488, 48.8534], // Default to Paris\n  zoom = 12,\n  geopositions = [],\n  onMarkerClick,\n  showTerrain = true,\n  initialCenter\n}: TripMapProps) => {\n  const mapContainer = useRef<HTMLDivElement>(null);\n  const map = useRef<mapboxgl.Map | null>(null);\n  const markers = useRef<mapboxgl.Marker[]>([]);\n  const [validCenter] = useState<[number, number]>(initialCenter || center);\n  const [activeMarkerId, setActiveMarkerId] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!mapContainer.current) return;\n\n    // Add custom styles\n    const styleSheet = document.createElement('style');\n    styleSheet.textContent = markerStyles;\n    document.head.appendChild(styleSheet);\n\n    // Initialize map only if it doesn't exist\n    if (!map.current) {\n      mapboxgl.accessToken = 'pk.eyJ1IjoibWlzdGVyZnJhenoiLCJhIjoiY203M2ZnM3BoMDhpMTJqcTNiYWpkamIzNyJ9.2SlcuEPIL2yCJw5TIPunVQ';\n      \n      map.current = new mapboxgl.Map({\n        container: mapContainer.current,\n        style: showTerrain \n          ? 'mapbox://styles/mapbox/outdoors-v12'\n          : 'mapbox://styles/mapbox/streets-v12',\n        center: validCenter,\n        zoom: zoom,\n        pitch: 60, // Increased 3D perspective\n        bearing: 0,\n      });\n\n      // Add navigation controls\n      map.current.addControl(\n        new mapboxgl.NavigationControl(),\n        'top-right'\n      );\n\n      // Add fullscreen control\n      map.current.addControl(\n        new mapboxgl.FullscreenControl(),\n        'top-right'\n      );\n\n      // Add terrain and sky layers for 3D effect\n      map.current.on('load', () => {\n        if (!map.current) return;\n\n        if (showTerrain) {\n          map.current.addSource('mapbox-dem', {\n            'type': 'raster-dem',\n            'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',\n            'tileSize': 512,\n            'maxzoom': 14\n          });\n\n          map.current.setTerrain({ \n            'source': 'mapbox-dem',\n            'exaggeration': 1.5 \n          });\n\n          map.current.addLayer({\n            'id': 'sky',\n            'type': 'sky',\n            'paint': {\n              'sky-type': 'atmosphere',\n              'sky-atmosphere-sun': [0.0, 90.0],\n              'sky-atmosphere-sun-intensity': 15\n            }\n          });\n\n          // Add custom layer styles for water and buildings\n          if (!map.current.getLayer('water-custom')) {\n            map.current.addLayer({\n              'id': 'water-custom',\n              'type': 'fill',\n              'source': 'composite',\n              'source-layer': 'water',\n              'paint': {\n                'fill-color': '#93c5fd',\n                'fill-opacity': 0.8\n              }\n            });\n          }\n\n          if (!map.current.getLayer('building-custom')) {\n            map.current.addLayer({\n              'id': 'building-custom',\n              'type': 'fill-extrusion',\n              'source': 'composite',\n              'source-layer': 'building',\n              'paint': {\n                'fill-extrusion-color': '#9ca3af',\n                'fill-extrusion-height': ['get', 'height'],\n                'fill-extrusion-base': ['get', 'min_height'],\n                'fill-extrusion-opacity': 0.6\n              }\n            });\n          }\n        }\n\n        // Add route source and layer with improved styling\n        if (!map.current.getSource('route')) {\n          map.current.addSource('route', {\n            'type': 'geojson',\n            'lineMetrics': true, // Enable line metrics for gradient\n            'data': {\n              'type': 'Feature',\n              'properties': {},\n              'geometry': {\n                'type': 'LineString',\n                'coordinates': []\n              }\n            }\n          });\n        }\n\n        if (!map.current.getLayer('route-outline')) {\n          map.current.addLayer({\n            'id': 'route-outline',\n            'type': 'line',\n            'source': 'route',\n            'layout': {\n              'line-join': 'round',\n              'line-cap': 'round'\n            },\n            'paint': {\n              'line-color': '#ffffff',\n              'line-width': 8,\n              'line-opacity': 0.8,\n              'line-blur': 0.5\n            }\n          });\n        }\n\n        if (!map.current.getLayer('route')) {\n          map.current.addLayer({\n            'id': 'route',\n            'type': 'line',\n            'source': 'route',\n            'layout': {\n              'line-join': 'round',\n              'line-cap': 'round'\n            },\n            'paint': {\n              'line-color': '#3b82f6',\n              'line-gradient': [\n                'interpolate',\n                ['linear'],\n                ['line-progress'],\n                0, '#3b82f6',\n                1, '#6366f1'\n              ],\n              'line-width': 4,\n              'line-opacity': 1\n            }\n          });\n        }\n      });\n    }\n\n    return () => {\n      markers.current.forEach(marker => marker.remove());\n      markers.current = [];\n      \n      if (map.current) {\n        map.current.remove();\n        map.current = null;\n      }\n\n      // Clean up custom styles\n      document.head.removeChild(styleSheet);\n    };\n  }, [showTerrain]); \n\n  // Update route and markers when geopositions change\n  useEffect(() => {\n    if (!map.current) return;\n\n    // Remove existing markers\n    markers.current.forEach(marker => marker.remove());\n    markers.current = [];\n\n    // Add new markers for each geoposition\n    geopositions.forEach((pos, index) => {\n      if (!map.current) return;\n\n      // Create custom marker element\n      const el = document.createElement('div');\n      el.className = 'custom-marker';\n      \n      const markerContent = document.createElement('div');\n      markerContent.className = 'marker-content';\n      markerContent.textContent = `${index + 1}`;\n      el.appendChild(markerContent);\n\n      // Create popup with enhanced styling\n      const popup = new mapboxgl.Popup({ \n        offset: 25,\n        closeButton: false,\n        maxWidth: '300px'\n      }).setHTML(`\n        <div class=\"popup-content\">\n          <div class=\"popup-header\">\n            <h3 class=\"popup-title\">${pos.name}</h3>\n          </div>\n          ${pos.description ? `\n            <p class=\"popup-description\">${pos.description}</p>\n          ` : ''}\n          <div class=\"popup-coordinates\">\n            <svg class=\"popup-icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" \n                d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"/>\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" \n                d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"/>\n            </svg>\n            ${pos.coordinates[1].toFixed(4)}, ${pos.coordinates[0].toFixed(4)}\n          </div>\n        </div>\n      `);\n\n      // Create marker\n      const marker = new mapboxgl.Marker(el)\n        .setLngLat(pos.coordinates)\n        .setPopup(popup)\n        .addTo(map.current);\n\n      // Add click handler\n      el.addEventListener('click', () => {\n        if (onMarkerClick) {\n          onMarkerClick(pos);\n        }\n        setActiveMarkerId(pos.name);\n      });\n\n      markers.current.push(marker);\n    });\n\n    // Update route line if there are multiple points\n    if (geopositions.length > 1 && map.current.getSource('route')) {\n      const routeSource = map.current.getSource('route') as mapboxgl.GeoJSONSource;\n      routeSource.setData({\n        'type': 'Feature',\n        'properties': {},\n        'geometry': {\n          'type': 'LineString',\n          'coordinates': geopositions.map(pos => pos.coordinates)\n        }\n      });\n    }\n\n    // Fit map to show all markers with padding\n    if (geopositions.length > 0) {\n      const bounds = new mapboxgl.LngLatBounds();\n      geopositions.forEach(pos => {\n        bounds.extend(pos.coordinates);\n      });\n\n      map.current.fitBounds(bounds, {\n        padding: { top: 100, bottom: 100, left: 100, right: 100 },\n        maxZoom: 15\n      });\n    } else {\n      map.current.setCenter(validCenter);\n      map.current.setZoom(zoom);\n    }\n  }, [geopositions, zoom, validCenter, onMarkerClick]);\n\n  return (\n    <div className={`relative ${className}`} style={{ height }}>\n      <div ref={mapContainer} className=\"absolute inset-0 rounded-lg shadow-inner\" />\n    </div>\n  );\n};\n\nexport default TripMap;\n"],"names":["TripMap","className","height","center","zoom","geopositions","onMarkerClick","showTerrain","initialCenter","mapContainer","useRef","map","markers","validCenter","useState","activeMarkerId","setActiveMarkerId","useEffect","current","styleSheet","document","createElement","textContent","head","appendChild","mapboxgl","accessToken","Map","container","style","pitch","bearing","addControl","NavigationControl","FullscreenControl","on","addSource","type","url","tileSize","maxzoom","setTerrain","source","exaggeration","addLayer","id","paint","getLayer","getSource","lineMetrics","data","properties","geometry","coordinates","layout","forEach","marker","remove","removeChild","pos","index","el","markerContent","popup","Popup","offset","closeButton","maxWidth","setHTML","name","description","toFixed","Marker","setLngLat","setPopup","addTo","addEventListener","push","length","setData","bounds","LngLatBounds","extend","fitBounds","padding","top","bottom","left","right","maxZoom","setCenter","setZoom","children","ref"],"mappings":"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"}