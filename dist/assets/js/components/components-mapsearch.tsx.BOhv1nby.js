import{r as e,j as t}from"../vendor/vendor-react-core.D1hcyiwY.js";import{c as a}from"./components-blog.C3TFiFB1.js";import{m as s}from"../vendor/vendor--mapbox-gl.CIg18VY7.js";import{u as r}from"../hooks/hooks-usepois.ts.lA82ceWk.js";import{s as n}from"./components-admin.CiIAoamg.js";import{u as o}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{v as i}from"../vendor/vendor--uuid.BuTxD5e6.js";import{ag as c,ah as l,ai as d,aj as p,ak as m,M as u,al as g,am as h,an as x,a2 as y,ao as f,S as b,X as v,F as _,s as w,H as j,N,ap as k,aq as C,ar as $,as as L}from"../vendor/vendor--lucide-react.DRw9PYsu.js";const z=e=>e<1e3?`${Math.round(e)}m`:`${(e/1e3).toFixed(1)}km`,S=(e,a)=>{if(a.includes("address"))return t.jsx(C,{className:"w-4 h-4 text-gray-500"});if(a.includes("poi")){if(!e)return t.jsx(u,{className:"w-4 h-4 text-red-500"});switch(e){case"restaurant":case"cafe":case"food":return t.jsx(L,{className:"w-4 h-4 text-orange-500"});case"hotel":case"lodging":return t.jsx($,{className:"w-4 h-4 text-blue-500"});default:return t.jsx(u,{className:"w-4 h-4 text-red-500"})}}return t.jsx(u,{className:"w-4 h-4 text-purple-500"})},M=(e,t)=>{if(t.includes("address"),t.includes("poi")&&!e)return"#ef4444"},q=(e,t)=>{if(t.includes("address"))return"🏠";if(t.includes("poi")){if(!e)return"📍";switch(e){case"restaurant":case"food":return"🍽️";case"cafe":case"coffee":return"☕";case"hotel":case"lodging":return"🏨";case"bar":case"nightlife":return"🍺";case"museum":case"art":return"🏛️";case"park":case"nature":return"🌳";case"shopping":case"store":return"🛍️";case"entertainment":return"🎉";case"attraction":return"🎡";default:return"📍"}}return"📍"},R=({map:C,onLocationSelect:$,onSaveToFavorites:L,onGetDirections:R})=>{const{t:P}=o(["navigation"]),[E,I]=e.useState(""),[F,T]=e.useState(!1),[A,U]=e.useState([]),[B,J]=e.useState(!1),[O,H]=e.useState(!1),[V,D]=e.useState([]),[G,W]=e.useState("categories"),Y=e.useRef(),Z=e.useRef([]),K=e.useRef(null),Q="pk.eyJ1IjoibWlzdGVyZnJhenoiLCJhIjoiY203M2ZnM3BoMDhpMTJqcTNiYWpkamIzNyJ9.2SlcuEPIL2yCJw5TIPunVQ",X=e.useRef(i()),[ee,te]=e.useState({}),[ae,se]=e.useState(!1),[re,ne]=e.useState(null),[oe,ie]=e.useState([]),[ce,le]=e.useState([]),[de,pe]=e.useState(!1);r(),e.useEffect((()=>{const e=e=>{K.current&&!K.current.contains(e.target)&&T(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);const me=[{id:"food-place",label:P("search.categories.food","Food"),icon:t.jsx(c,{className:"w-5 h-5"}),query:"food"},{id:"cafe-spot",label:P("search.categories.cafe","Cafe"),icon:t.jsx(l,{className:"w-5 h-5"}),query:"cafe"},{id:"bar-pub",label:P("search.categories.bars","Bars"),icon:t.jsx(d,{className:"w-5 h-5"}),query:"bar"},{id:"shopping-mall",label:P("search.categories.shopping","Shopping"),icon:t.jsx(p,{className:"w-5 h-5"}),query:"mall"}],ue=[{id:"hotel-lodging",label:P("search.categories.hotels","Hotels"),icon:t.jsx(m,{className:"w-5 h-5"}),query:"hotel"},{id:"attractions",label:P("search.categories.attractions","Attractions"),icon:t.jsx(u,{className:"w-5 h-5"}),query:"attractions"},{id:"landmark",label:P("search.categories.landmarks","Landmarks"),icon:t.jsx(g,{className:"w-5 h-5"}),query:"landmark"},{id:"museum",label:P("search.categories.museums","Museums"),icon:t.jsx(h,{className:"w-5 h-5"}),query:"museum"},{id:"cinema-theater",label:P("search.categories.cinemas","Cinemas"),icon:t.jsx(x,{className:"w-5 h-5"}),query:"cinema"},{id:"parking-spot",label:P("search.categories.parking","Parking"),icon:t.jsx(y,{className:"w-5 h-5"}),query:"parking"},{id:"pharmacy-store",label:P("search.categories.pharmacies","Pharmacies"),icon:t.jsx(f,{className:"w-5 h-5"}),query:"pharmacy"},{id:"grocery-store",label:P("search.categories.groceries","Groceries"),icon:t.jsx(p,{className:"w-5 h-5"}),query:"grocery"},{id:"gas-station",label:P("search.categories.gas","Gas"),icon:t.jsx(y,{className:"w-5 h-5"}),query:"gas station"}],ge={food:"restaurant",cafe:"cafe",bar:"bar pub",mall:"shopping mall",hotel:"hotel lodging",attractions:"tourist attractions points of interest",landmark:"landmark monument",museum:"museum gallery",cinema:"cinema movie theater",parking:"parking",pharmacy:"pharmacy",grocery:"supermarket grocery","gas station":"gas station fuel"};e.useEffect((()=>()=>{he()}),[]),e.useEffect((()=>{const e=localStorage.getItem("recentMapSearches");if(e)try{D(JSON.parse(e))}catch(t){}}),[]),e.useEffect((()=>{const e=localStorage.getItem("mapFavorites");if(e)try{ie(JSON.parse(e))}catch(t){}}),[]);const he=()=>{Z.current.forEach((e=>e.remove())),Z.current=[]},xe=(e,t)=>{te((a=>({...a,[e]:t})))},ye=async e=>{if(!e.trim()||e.length<2)return[];const t=e.toLowerCase(),a=[],s=C.current?.getCenter(),r=s?.lat||0,o=s?.lng||0;try{const{data:e,error:i}=await n.from("pois").select("\n          *,\n          poi_categories!poi_category_id (\n            name,\n            image_url\n          ),\n          poi_reviews (\n            rating,\n            rating_type,\n            notes,\n            user_id\n          )\n        ").limit(50);if(i)return[];(e||[]).forEach((e=>{const n=e.name.toLowerCase().includes(t),i=e.description?.toLowerCase().includes(t),c=e.categories?.some((e=>e.toLowerCase().includes(t))),l=e.poi_categories?.name?.toLowerCase().includes(t),d=e.poi_reviews?.filter((e=>{const a=e.notes?.toLowerCase().includes(t),s=e.user_id?.toLowerCase().includes(t);return a||s}))||[];if(n||i||c||l||d.length>0){let t,n=0,i=0;if(e.poi_reviews&&e.poi_reviews.length>0){const a={out_of_10:0,out_of_5:0,percentage:0};e.poi_reviews.forEach((e=>{a[e.rating_type]++}));const s=Math.max(a.out_of_10,a.out_of_5,a.percentage);t=a.out_of_10===s?"out_of_10":a.out_of_5===s?"out_of_5":"percentage";const r=e.poi_reviews.filter((e=>e.rating_type===t));if(r.length>0){n=r.reduce(((e,t)=>e+t.rating),0)/r.length}i=e.poi_reviews.length}const c=s?((e,t,a,s)=>{const r=e*Math.PI/180,n=a*Math.PI/180,o=(a-e)*Math.PI/180,i=(s-t)*Math.PI/180,c=Math.sin(o/2)*Math.sin(o/2)+Math.cos(r)*Math.cos(n)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371e3})(r,o,e.lat,e.lng):void 0,l=c&&c<=75e3,p={id:`poi-${e.id}`,place_name:e.address&&e.address!==e.name?e.address:"",center:[e.lng,e.lat],place_type:["poi"],properties:{category:e.poi_categories?.name||e.categories?.[0]||"poi",maki:"marker",distance:c,source:"database_poi",isNearest:l},text:e.name,name:e.name,distance:c,poi_data:{id:e.id,name:e.name,url:e.url,description:e.description&&e.description.trim()&&"0"!==e.description?e.description:void 0,address:e.address,lat:e.lat,lng:e.lng,categories:e.categories||[],poi_category_id:e.poi_category_id,created_at:e.created_at,updated_at:e.updated_at,category_name:e.poi_categories?.name,category_image_url:e.poi_categories?.image_url,average_rating:n>0?n:void 0,review_count:i>0?i:void 0,rating_type:t}};if(d.length>0){const e=d[0];p.review_author=e.user_id?`User ${e.user_id.slice(0,8)}`:"Anonymous",p.review_text=e.notes&&e.notes.trim()?e.notes.trim():"",p.review_rating=e.rating&&e.rating>0?e.rating:void 0}a.push(p)}}));return a.sort(((e,t)=>{const a=e.distance||1/0,s=t.distance||1/0;return a<=75e3&&s<=75e3?a-s:a<=75e3&&s>75e3?-1:s<=75e3&&a>75e3?1:a-s})).slice(0,10)}catch(i){return[]}},fe=async e=>{if(I(e),pe(!1),!e.trim())return U([]),J(!1),le([]),void he();Y.current&&clearTimeout(Y.current),Y.current=setTimeout((async()=>{H(!0);try{const t=C.current?.getCenter(),a=new URL("https://api.mapbox.com/search/searchbox/v1/suggest"),s=new URL("https://api.mapbox.com/geocoding/v5/mapbox.places");let r=e.trim();ge[r.toLowerCase()]&&(r=ge[r.toLowerCase()]);const n=await ye(e);le(n.length>0?n:[]);const o=n.map((e=>({id:e.id,type:"poi",place_type:e.place_type,place_name:e.place_name,text:e.text,center:e.center,name:e.name,address:e.poi_data?.address,full_address:e.poi_data?.address,properties:{...e.properties,poi_data:e.poi_data,review_author:e.review_author,review_text:e.review_text,review_rating:e.review_rating,distance:e.distance,isNearest:e.properties?.isNearest}}))),i=new URLSearchParams({q:r,access_token:Q,session_token:X.current,language:"en",limit:"5",types:"poi"}),c=new URLSearchParams({access_token:Q,limit:"5",language:"en",types:"address,place",autocomplete:"true"});if(t&&(i.append("proximity",`${t.lng},${t.lat}`),c.append("proximity",`${t.lng},${t.lat}`),c.append("proximity_bias","0")),C.current){const e=C.current.getBounds(),t=[e.getWest(),e.getSouth(),e.getEast(),e.getNorth()];t.every((e=>!isNaN(e)&&isFinite(e)))&&i.append("bbox",t.join(","))}ee.priceRange&&i.append("price_range",ee.priceRange),ee.rating&&i.append("min_rating",ee.rating.toString()),ee.openNow&&i.append("open_now","true"),ee.accessibility&&i.append("accessibility","true");const l=encodeURIComponent(r),[d,p]=await Promise.all([fetch(`${a}?${i}`),fetch(`${s}/${l}.json?${c}`)]);let m=[];if(d.ok){const e=await d.json();e.suggestions?.length>0&&(m=e.suggestions.filter((e=>e.name||e.place_name)).map((e=>{let t=null;e.coordinates?t=[e.coordinates.longitude,e.coordinates.latitude]:e.geometry?.coordinates?t=e.geometry.coordinates:e.bbox?t=[(e.bbox[0]+e.bbox[2])/2,(e.bbox[1]+e.bbox[3])/2]:e.metadata?.coordinates?t=e.metadata.coordinates:e.context?.coordinates&&(t=[e.context.coordinates.longitude,e.context.coordinates.latitude]);const a=e.name||e.text,s=e.full_address||e.place_name||a,r="poi"===e.feature_type&&e.address;return{id:e.mapbox_id||`suggestion-poi-${Date.now()}-${Math.random()}`,type:e.feature_type||"poi",place_type:[e.feature_type||"poi"],place_name:s,text:a,center:t,name:a,address:e.address,full_address:e.full_address,properties:{category:e.poi_category?.[0]||e.category||e.feature_type,maki:e.maki,coordinates:t,feature_score:e.feature_score,matching_name:e.matching_name,matching_place_name:e.matching_place_name,address:e.address,distance:e.distance,isLocationPOI:r,source:"search"}}})).filter(Boolean))}let u=[];if(p.ok){const e=await p.json();e.features?.length>0&&(u=e.features.filter((e=>e.place_name)).map((e=>{const t=e.context?.find((e=>e.id.startsWith("address"))),a=e.address||(t?.text.match(/^\d+/)?t.text.match(/^\d+/)[0]:""),s=e.text||e.place_name.split(",")[0],r=a&&!s.includes(a)?`${a} ${s}`:s;return{id:e.id||`suggestion-geo-${Date.now()}-${Math.random()}`,type:e.place_type?.[0]||"address",place_type:e.place_type||["address"],place_name:e.place_name,text:r,center:e.center,name:r,address:a,full_address:e.place_name,properties:{category:e.place_type?.[0]||"address",coordinates:e.center,address:a,feature_score:1,source:"geocoding"},geometry:{coordinates:e.center,type:"Point"}}})))}let g=[...o,...m,...u];n.length>0&&(g=[{id:"fuzzy-poi-category",type:"fuzzy-poi-category",place_type:["category"],place_name:P("search.fuzzy_category",{query:e}),text:P("search.fuzzy_category",{query:e}),name:P("search.fuzzy_category",{query:e}),properties:{category:"fuzzy-poi-category"}},...m,...u]);const h=g.reduce(((e,t)=>(e.some((e=>e.name?.toLowerCase()===t.name?.toLowerCase()&&e.center&&t.center&&Math.abs(e.center[0]-t.center[0])<.01&&Math.abs(e.center[1]-t.center[1])<.01))||e.push(t),e)),[]);h.length>0?(U(h),J(!0)):(U([]),J(!0))}catch(t){U([]),J(!0)}finally{H(!1)}}),300)},be=async e=>{if("fuzzy-poi-category"!==e.type)try{if(H(!0),e.center&&0!==e.center[0]&&0!==e.center[1])return ve(e),void H(!1);const t=e.full_address||e.place_name||(e.address&&e.name?`${e.address} ${e.name}`:e.name),a=new URL("https://api.mapbox.com/geocoding/v5/mapbox.places"),s=encodeURIComponent(t),r=new URLSearchParams({access_token:Q,limit:"1",language:"en",types:"address,place",autocomplete:"false"}),n="search"===e.properties?.source;if(C.current){const e=C.current.getCenter();r.append("proximity",`${e.lng},${e.lat}`),n||r.append("proximity_bias","0")}const o=await fetch(`${a}/${s}.json?${r}`);if(!o.ok)throw new Error("Geocoding request failed");const c=await o.json();if(c.features&&c.features.length>0){const t=c.features[0],a={...e,center:t.center,geometry:{coordinates:t.center,type:"Point"},geocoded_place_name:t.place_name,geocoded_address:t.properties?.address};ve(a)}else ve(e);X.current=i(),H(!1)}catch(t){ve(e),H(!1)}else if(U(ce.map((e=>({id:e.id,type:"poi",place_type:e.place_type,place_name:e.place_name,text:e.text,center:e.center,name:e.name,address:e.poi_data?.address,full_address:e.poi_data?.address,properties:{...e.properties,poi_data:e.poi_data,review_author:e.review_author,review_text:e.review_text,review_rating:e.review_rating,distance:e.distance,isNearest:e.properties?.isNearest}})))),pe(!0),J(!0),C.current&&ce.length>0){const e=new s.LngLatBounds;ce.forEach((t=>{t.center&&e.extend(t.center)})),e.isEmpty()||C.current.fitBounds(e,{padding:80,maxZoom:16})}},ve=e=>{he();let t=null;if(e.center&&Array.isArray(e.center)&&2===e.center.length)t=e.center;else if(e.geometry?.coordinates)t=e.geometry.coordinates;else if(e.coordinates)t=[e.coordinates.longitude,e.coordinates.latitude];else if(e.full_address||e.address||e.properties?.address){const a=e.full_address||e.address||e.properties?.address,s=t&&2===t.length&&!isNaN(t[0])&&!isNaN(t[1])&&!(0===t[0]&&0===t[1]);if(!s&&a&&C.current){const e=C.current.getCenter();t=[e.lng,e.lat]}else if(!s&&!a)return}if(!t)return;let a=15;if("geocoding"===e.properties?.source?e.place_type?.includes("address")?a=17:e.place_type?.includes("place")?a=13:e.place_type?.includes("country")?a=5:e.place_type?.includes("region")&&(a=8):"restaurant"===e.properties?.category||"cafe"===e.properties?.category||"bar"===e.properties?.category?a=17:"hotel"===e.properties?.category?a=16:"landmark"!==e.properties?.category&&"museum"!==e.properties?.category&&"attractions"!==e.properties?.category||(a=16),$)$({...e,center:t,zoom:a});else if(C.current&&t){C.current.flyTo({center:t,zoom:a,duration:1500});const r=document.createElement("div");r.className="category-marker",r.style.width="40px",r.style.height="40px",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",r.style.cursor="pointer",r.style.transition="box-shadow 0.2s ease",r.style.zIndex="1",r.style.position="relative",r.style.transform="none";const n=M(e.properties?.category,e.place_type),o=q(e.properties?.category,e.place_type),i=document.createElement("div");i.style.width="40px",i.style.height="40px",i.style.background=n,i.style.borderRadius="50%",i.style.border="3px solid white",i.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.fontSize="14px",i.style.overflow="hidden",i.style.transition="box-shadow 0.2s ease",i.style.transform="none",i.textContent=o,r.appendChild(i),r.onmouseover=()=>{r.style.zIndex="10",i.style.boxShadow="0 4px 8px rgba(0,0,0,0.3)"},r.onmouseout=()=>{r.style.zIndex="1",i.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)"};const c=new s.Marker({element:r,anchor:"bottom"}).setLngLat(t).addTo(C.current),l=document.createElement("div");l.className="location-details-card",l.style.display="none",l.style.position="absolute",l.style.bottom="0",l.style.left="0",l.style.right="0",l.style.backgroundColor="white",l.style.borderTopLeftRadius="1rem",l.style.borderTopRightRadius="1rem",l.style.padding="1rem",l.style.boxShadow="0 -4px 6px -1px rgba(0, 0, 0, 0.1)",l.style.zIndex="1000",l.style.transform="translateY(100%)",l.style.transition="transform 0.3s ease-in-out",l.innerHTML=`\n                    <div class="flex items-start justify-between mb-4">\n              <div class="flex items-center">\n                <div class="mr-3">\n                  <div style="width: 32px; height: 32px; background: ${n}; border-radius: 50%; border: 2px solid white; display: flex; align-items: center; justify-content: center; font-size: 16px;">\n                    ${o}\n                  </div>\n                </div>\n            <div>\n              <h3 class="font-semibold text-lg">${e.text||e.name||""}</h3>\n              <p class="text-sm text-gray-500">${e.place_name||e.address||""}</p>\n            </div>\n          </div>\n          <button class="close-details p-2 hover:bg-gray-100 rounded-full">\n            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />\n            </svg>\n          </button>\n        </div>\n        <div class="space-y-3">\n          ${e.properties?.distance?`\n            <div class="flex items-center text-sm text-gray-600">\n              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />\n              </svg>\n              ${z(e.properties.distance)}\n            </div>\n          `:""}\n          <div className="flex space-x-2">\n            <button class="flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">\n              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />\n              </svg>\n              <span>${P("search.directions")}</span>\n            </button>\n            <button class="flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">\n              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />\n              </svg>\n              <span>Share</span>\n            </button>\n          </div>\n        </div>\n      `,C.current.getContainer().appendChild(l);const d=()=>{l.style.display="block",requestAnimationFrame((()=>{l.style.transform="translateY(0)"}))},p=()=>{l.style.transform="translateY(100%)",setTimeout((()=>{l.style.display="none"}),300)};r.addEventListener("click",(e=>{e.stopPropagation(),d()})),r.addEventListener("touchend",(e=>{e.stopPropagation(),d()})),l.querySelector(".close-details")?.addEventListener("click",(e=>{e.stopPropagation(),p()}));const m=e=>{l.contains(e.target)||r.contains(e.target)||p()};document.addEventListener("click",m),document.addEventListener("touchend",m);const u=()=>{document.removeEventListener("click",m),document.removeEventListener("touchend",m),l.remove()};c.cleanup=u,Z.current=[c]}const r={id:e.id||`place-${Date.now()}-${t.join("-")}`,place_name:e.place_name||e.name||"",center:t,place_type:Array.isArray(e.place_type)?e.place_type:[e.type||"place"],properties:{category:e.properties?.category||e.type,maki:e.properties?.maki},text:e.text||e.name||""},n=[r,...V.filter((e=>e.id!==r.id))].slice(0,5);D(n),localStorage.setItem("recentMapSearches",JSON.stringify(n)),I(""),U([]),J(!1),T(!1)},_e=e=>{let t;t=oe.some((t=>t.id===e.id))?oe.filter((t=>t.id!==e.id)):[...oe,e],(e=>{ie(e),localStorage.setItem("mapFavorites",JSON.stringify(e))})(t),L&&L(e)},we=({result:e})=>{const s=oe.some((t=>t.id===e.id)),r="database_poi"===e.properties?.source,n=e.poi_data;return t.jsxs("div",{className:a("p-4 border-b border-gray-100 hover:bg-gray-50 relative",e.properties?.isNearest&&"ring-2 ring-green-500/60 bg-green-50"),children:[e.properties?.isNearest&&t.jsx("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow",children:P("search.nearest","Nearest")}),t.jsxs("div",{className:"flex items-start",children:[t.jsx("div",{className:"flex-shrink-0",children:e.photos?.[0]?t.jsx("img",{src:e.photos[0],alt:e.text,className:"w-16 h-16 object-cover rounded-lg"}):r&&n?.category_image_url?t.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-100 flex items-center justify-center",children:t.jsx("img",{src:n.category_image_url,alt:n.category_name||"POI",className:"w-12 h-12 object-cover rounded-lg"})}):t.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-full border-2 border-white shadow-md",style:{backgroundColor:M(e.properties?.category,e.place_type),fontSize:"20px"},children:q(e.properties?.category,e.place_type)})}),t.jsxs("div",{className:"ml-4 flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"font-medium text-gray-900",children:e.text}),t.jsxs("div",{className:"flex items-center space-x-2",children:[r&&n?.average_rating&&n.average_rating>0||e.rating&&e.rating>0?t.jsxs("div",{className:"flex items-center",children:[t.jsx(w,{className:"w-4 h-4 text-yellow-400 fill-current"}),t.jsx("span",{className:"ml-1 text-sm text-gray-600",children:r&&n?.average_rating&&n.average_rating>0?"out_of_5"===n.rating_type?`${n.average_rating.toFixed(1)}/5`:"percentage"===n.rating_type?`${n.average_rating.toFixed(0)}%`:`${n.average_rating.toFixed(1)}/10`:e.rating&&e.rating>0?e.rating.toFixed(1):""})]}):null,t.jsx("div",{onClick:t=>{t.stopPropagation(),_e(e)},className:"p-1 rounded-full hover:bg-gray-100 cursor-pointer",children:t.jsx(j,{className:"w-5 h-5 "+(s?"text-red-500 fill-current":"text-gray-400")})})]})]}),e.place_name&&e.place_name!==e.text&&e.place_name.trim()&&t.jsx("p",{className:"text-sm text-gray-500",children:e.place_name}),r&&n?.category_name&&t.jsx("div",{className:"mt-1 text-sm text-gray-600",children:t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:n.category_name})}),r&&e.review_text&&e.review_text.trim()&&t.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:"text-xs font-medium text-gray-700",children:e.review_author?`${P("search.review_by","Review by")} ${e.review_author}`:P("search.review","Review")}),e.review_rating&&e.review_rating>0&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(w,{className:"w-3 h-3 text-yellow-400 fill-current"}),t.jsx("span",{className:"ml-1 text-xs text-gray-600",children:"number"==typeof e.review_rating?e.review_rating.toFixed(1):e.review_rating})]})]}),t.jsxs("p",{className:"text-xs text-gray-600 line-clamp-2",children:['"',e.review_text,'"']})]}),r&&n?.description&&n.description.trim()&&"0"!==n.description&&!e.review_text&&t.jsx("p",{className:"mt-1 text-sm text-gray-600 line-clamp-2",children:n.description}),e.priceLevel&&e.priceLevel>0&&t.jsx("div",{className:"mt-1 text-sm text-gray-600",children:"$".repeat(e.priceLevel)}),e.openingHours&&t.jsx("div",{className:"mt-1 text-sm text-gray-600",children:e.openingHours.open?t.jsx("span",{className:"text-green-600",children:P("search.open_now")}):t.jsx("span",{className:"text-red-600",children:P("search.closed")})}),(e.distance||e.properties?.distance)&&(e.distance||e.properties?.distance)>0&&t.jsx("div",{className:"mt-1 text-sm text-gray-500",children:z(e.distance||e.properties?.distance)}),t.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[t.jsxs("div",{onClick:t=>{t.stopPropagation(),(e=>{const t=e.full_address||e.place_name||(e.address&&e.name?`${e.address} ${e.name}`:e.name)||e.text;if(!t)return;const a=encodeURIComponent(t),s=`https://www.google.com/maps/search/?api=1&query=${a}`;if(navigator.userAgent.match(/iPhone|iPad|iPod|Android/i)){const e=`comgooglemaps://?q=${a}`,t=document.createElement("iframe");t.style.display="none",t.src=e;const r=setTimeout((()=>{window.open(s,"_blank")}),1e3);t.onload=()=>{clearTimeout(r)},document.body.appendChild(t),setTimeout((()=>{document.body.removeChild(t)}),2e3)}else window.open(s,"_blank")})(e)},className:"flex items-center text-sm text-blue-600 hover:text-blue-800 cursor-pointer",children:[t.jsx(N,{className:"w-4 h-4 mr-1"}),P("search.directions")]}),t.jsxs("div",{onClick:t=>{t.stopPropagation(),(async e=>{const t={title:e.text,text:e.place_name,url:`https://www.google.com/maps/search/?api=1&query=${e.center[1]},${e.center[0]}`};try{navigator.share?await navigator.share(t):(await navigator.clipboard.writeText(t.url),alert("Location URL copied to clipboard!"))}catch(a){}})(e)},className:"flex items-center text-sm text-blue-600 hover:text-blue-800 cursor-pointer",children:[t.jsx(k,{className:"w-4 h-4 mr-1"}),"Share"]})]})]})]})]})},je=()=>t.jsx("div",{className:"p-4 border-t border-gray-100",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Price Range"}),t.jsxs("select",{value:ee.priceRange||"",onChange:e=>xe("priceRange",e.target.value||void 0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Any"}),t.jsx("option",{value:"low",children:"$"}),t.jsx("option",{value:"medium",children:"$$"}),t.jsx("option",{value:"high",children:"$$$"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Minimum Rating"}),t.jsxs("select",{value:ee.rating||"",onChange:e=>xe("rating",e.target.value?Number(e.target.value):void 0),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Any"}),t.jsx("option",{value:"3",children:"3+ stars"}),t.jsx("option",{value:"4",children:"4+ stars"}),t.jsx("option",{value:"4.5",children:"4.5+ stars"})]})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"openNow",checked:ee.openNow||!1,onChange:e=>xe("openNow",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"openNow",className:"ml-2 block text-sm text-gray-700",children:"Open now"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"accessibility",checked:ee.accessibility||!1,onChange:e=>xe("accessibility",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"accessibility",className:"ml-2 block text-sm text-gray-700",children:"Wheelchair accessible"})]})]})});return t.jsx("div",{className:a("absolute z-20 transition-all duration-300 ease-in-out",F?"w-full max-w-xl mx-auto left-0 right-0 top-4 px-4":"w-[calc(100%-32px)] max-w-md mx-auto left-0 right-0 top-4"),children:t.jsx("div",{className:"relative",ref:K,children:t.jsxs("div",{className:a("relative bg-white rounded-xl shadow-lg overflow-hidden",F?"shadow-xl":"hover:shadow-xl transition-shadow"),children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"search",value:E,onChange:e=>fe(e.target.value),onFocus:()=>T(!0),className:a("w-full px-4 pl-12 pr-10 py-3 border-none","bg-white focus:outline-none focus:ring-2 focus:ring-blue-500","text-gray-900 placeholder:text-gray-400"),autoComplete:"off",spellCheck:"false",placeholder:P("search.placeholder","Search locations..."),inputMode:"text",enterKeyHint:"search"}),t.jsx(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),E&&t.jsx("button",{onClick:()=>{I(""),U([]),J(!1),he()},className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full hover:bg-gray-100",children:t.jsx(v,{className:"w-5 h-5 text-gray-400"})})]}),F&&t.jsxs("div",{className:"search-container border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-gray-100",children:[t.jsxs("button",{onClick:()=>se(!ae),className:"flex items-center text-sm text-gray-600 hover:text-gray-900",children:[t.jsx(_,{className:"w-4 h-4 mr-1"}),"Filters"]}),Object.keys(ee).length>0&&t.jsx("button",{onClick:()=>te({}),className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear filters"})]}),ae&&t.jsx(je,{}),B?t.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[ce.length>0&&!de&&t.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-200 p-4",children:t.jsx("button",{onClick:()=>be({id:"fuzzy-poi-category",type:"fuzzy-poi-category",place_type:["category"],place_name:P("search.fuzzy_category",{query:E}),text:P("search.fuzzy_category",{query:E}),name:P("search.fuzzy_category",{query:E}),properties:{category:"fuzzy-poi-category"}}),className:"w-full text-left bg-white hover:bg-blue-50 border border-blue-200 rounded-lg p-4 font-semibold text-blue-900 transition-colors duration-200 shadow-sm",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0 mr-3",children:t.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsx(u,{className:"w-5 h-5 text-blue-600"})})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-bold text-blue-900 text-lg",children:P("search.fuzzy_category",{query:E})}),t.jsx("div",{className:"text-sm text-blue-700 mt-1",children:P("search.fuzzy_category_description","See the best reviews and recommended places and activities by ZapAround")})]}),t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-white text-xs font-bold",children:"→"})})})]})},"fuzzy-poi-category-btn")}),A.length>0?A.map((e=>t.jsx("button",{onClick:()=>be(e),className:"w-full text-left",children:t.jsx(we,{result:{...e,review_author:e.properties?.review_author,review_text:e.properties?.review_text,review_rating:e.properties?.review_rating,poi_data:e.properties?.poi_data,distance:e.properties?.distance}})},`search-result-${e.id}`))):t.jsxs("div",{className:"py-8 text-center",children:[t.jsx(u,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),t.jsx("p",{className:"text-gray-500 font-medium",children:P("search.no_results","No {{category}} found",{category:Object.keys(ge).find((e=>ge[e].toLowerCase()===E.toLowerCase()||E.toLowerCase().includes(e.toLowerCase())))||E})}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:P("search.try_again","Try zooming out or changing your search")})]})]}):t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex space-x-2 mb-4",children:[t.jsx("button",{onClick:()=>W("categories"),className:a("flex-1 px-3 py-2 text-sm font-medium rounded-md","categories"===G?"bg-blue-500 text-white":"bg-white text-gray-700 border border-gray-200"),children:P("search.tabs.categories","Categories")},"categories-tab"),t.jsx("button",{onClick:()=>W("favorites"),className:a("flex-1 px-3 py-2 text-sm font-medium rounded-md","favorites"===G?"bg-blue-500 text-white":"bg-white text-gray-700 border border-gray-200"),children:P("search.tabs.recent","Recent")},"favorites-tab")]}),"categories"===G?t.jsxs("div",{children:[t.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4",children:me.map((e=>t.jsxs("button",{onClick:()=>{I(e.query),fe(e.query),T(!0)},className:"flex flex-col items-center p-2 bg-white border \n                              border-gray-200 rounded-md hover:bg-gray-50",children:[e.icon,t.jsx("span",{className:"text-xs mt-1",children:e.label})]},`category-button-${e.id}`)))}),t.jsx("div",{className:"space-y-1",children:ue.map((e=>t.jsxs("button",{onClick:()=>{I(e.query),fe(e.query),T(!0)},className:"w-full flex items-center p-2 rounded-md hover:bg-gray-50",children:[e.icon,t.jsx("span",{className:"ml-3 text-sm",children:e.label})]},`category-list-${e.id}`)))})]},"categories-content"):t.jsx("div",{className:"space-y-1",children:oe.length>0?oe.map((e=>t.jsxs("button",{onClick:()=>ve(e),className:"w-full flex items-center p-2 rounded-md hover:bg-gray-50",children:[S(e.properties?.category,e.place_type),t.jsxs("div",{className:"ml-3 text-left",children:[t.jsx("div",{className:"font-medium",children:e.text}),t.jsx("div",{className:"text-sm text-gray-500",children:e.place_name.split(",").slice(1).join(",").trim()})]})]},`favorite-${e.id}`))):t.jsxs("div",{className:"text-center py-4 text-gray-500",children:[t.jsx(u,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{children:P("search.no_favorites","No favorites added")})]},"no-favorites")},"favorites-content")]})]})]})})})};export{R as M};
//# sourceMappingURL=components-mapsearch.tsx.BOhv1nby.js.map
