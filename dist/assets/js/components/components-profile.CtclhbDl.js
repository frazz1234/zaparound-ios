const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/components/components-admin.CiIAoamg.js","assets/js/vendor/vendor-react-core.D1hcyiwY.js","assets/js/vendor/vendor--cookie.D-6orQ43.js","assets/js/components/components-ui.C8hnNhgu.js","assets/js/hooks/hooks-use-toast.ts.Dg8obzHg.js","assets/js/vendor/vendor-ui-toast.CyvsGWN1.js","assets/js/vendor/vendor-react-dom.BnDkh-2X.js","assets/js/vendor/vendor-react-scheduler.B5Ht9ZB3.js","assets/js/vendor/vendor-ui-core.CPnW5LH0.js","assets/js/vendor/vendor--aria-hidden.BHUiN-rI.js","assets/js/vendor/vendor--react-remove-scroll.DR6iVcCg.js","assets/js/vendor/vendor--tslib.Bc9CN1Ef.js","assets/js/vendor/vendor--react-remove-scroll-bar.Dz-JErv0.js","assets/js/vendor/vendor--react-style-singleton.ER5nEGYx.js","assets/js/vendor/vendor--get-nonce.BYiZHLe3.js","assets/js/vendor/vendor--use-sidecar.svB0tWl8.js","assets/js/vendor/vendor--use-callback-ref.Dt9orvWx.js","assets/js/vendor/vendor---floating-ui-react-dom.gDT63CuY.js","assets/js/vendor/vendor---floating-ui-dom.CdGDzP9A.js","assets/js/vendor/vendor---floating-ui-core.D6mclMLM.js","assets/js/vendor/vendor---floating-ui-utils.D9HCu73I.js","assets/js/vendor/vendor-ui-dialog.CY7OxuK6.js","assets/js/vendor/vendor-ui-utils.CjDQ2U02.js","assets/js/components/components-blog.C3TFiFB1.js","assets/js/utils/utils-blogutils.ts.CpQs8y27.js","assets/js/utils/utils-cache.ts.BtmNadnX.js","assets/js/vendor/vendor--lru-cache.CYB7PIxo.js","assets/js/components/components-optimizedimage.tsx.DVN-Ynzu.js","assets/js/vendor/vendor--react-i18next.DhHVfoav.js","assets/js/vendor/vendor--date-fns.BbAlDtqN.js","assets/js/vendor/vendor--react-router.Gdfmkz0l.js","assets/js/hooks/hooks-useblogs.ts.B-jKAetY.js","assets/js/vendor/vendor-query-main.DFU6mXji.js","assets/js/vendor/vendor---tanstack-query-core.CIZi0Zbo.js","assets/js/vendor/vendor--lodash.D80NHDHN.js","assets/js/vendor/vendor--lucide-react.DRw9PYsu.js","assets/js/vendor/vendor--framer-motion.Dpgjd5L1.js","assets/js/vendor/vendor--motion-dom.C5KZPrWP.js","assets/js/vendor/vendor--motion-utils.DAP8mxSY.js","assets/js/vendor/vendor--react-markdown.C_e4o-CH.js","assets/js/vendor/vendor--devlop.Cl3hj7Sz.js","assets/js/vendor/vendor--unified.ti5-l0IV.js","assets/js/vendor/vendor--bail.gCPcOVbC.js","assets/js/vendor/vendor--extend.BFvm699q.js","assets/js/vendor/vendor--is-plain-obj.DeEdtHJQ.js","assets/js/vendor/vendor--trough.zzWXwSIo.js","assets/js/vendor/vendor--vfile.Cn6Vy3Ir.js","assets/js/vendor/vendor--vfile-message.Re42m5o3.js","assets/js/vendor/vendor--unist-util-stringify-position.CvSG9YTx.js","assets/js/vendor/vendor--remark-parse.DdoJrvcY.js","assets/js/vendor/vendor--mdast-util-from-markdown.DI8nvaYJ.js","assets/js/vendor/vendor--micromark-util-decode-numeric-character-reference.DA7xEauU.js","assets/js/vendor/vendor--micromark-util-decode-string.BCF2SQ7o.js","assets/js/vendor/vendor--decode-named-character-reference.C-EXV6yX.js","assets/js/vendor/vendor--micromark-util-normalize-identifier.CzKtq1sx.js","assets/js/vendor/vendor--micromark.aJPyxAJv.js","assets/js/vendor/vendor--micromark-util-combine-extensions.CQDa_SAq.js","assets/js/vendor/vendor--micromark-util-chunked.3k3e5hER.js","assets/js/vendor/vendor--micromark-factory-space.CZc9TqN4.js","assets/js/vendor/vendor--micromark-util-character.DUwsRT9L.js","assets/js/vendor/vendor--micromark-core-commonmark.yO25BTZZ.js","assets/js/vendor/vendor--micromark-util-classify-character.x6FlXUUS.js","assets/js/vendor/vendor--micromark-util-resolve-all.U8fstr8o.js","assets/js/vendor/vendor--micromark-util-subtokenize.BfHYzAYP.js","assets/js/vendor/vendor--micromark-factory-destination.pZKs7oL9.js","assets/js/vendor/vendor--micromark-factory-label.BbusvwMx.js","assets/js/vendor/vendor--micromark-factory-title.BBtcOUHM.js","assets/js/vendor/vendor--micromark-factory-whitespace.BhZ6YKME.js","assets/js/vendor/vendor--micromark-util-html-tag-name.DbKNfynz.js","assets/js/vendor/vendor--mdast-util-to-string.Ck87fAyN.js","assets/js/vendor/vendor--remark-rehype.B9Xnklpv.js","assets/js/vendor/vendor--mdast-util-to-hast.C2F2cLDR.js","assets/js/vendor/vendor---ungap-structured-clone.DadG6O39.js","assets/js/vendor/vendor--micromark-util-sanitize-uri.BXHzaaAi.js","assets/js/vendor/vendor--unist-util-position.CVUg9P9R.js","assets/js/vendor/vendor--trim-lines.C03Dth7Y.js","assets/js/vendor/vendor--unist-util-visit.41WSH7so.js","assets/js/vendor/vendor--unist-util-visit-parents.DAGCrDnu.js","assets/js/vendor/vendor--unist-util-is.C5Jwnfs7.js","assets/js/vendor/vendor--hast-util-to-jsx-runtime.BOWXXjuU.js","assets/js/vendor/vendor--comma-separated-tokens.DIu3lqJt.js","assets/js/vendor/vendor--property-information.Dc64tFtG.js","assets/js/vendor/vendor--space-separated-tokens.C97BfSlU.js","assets/js/vendor/vendor--style-to-js.DQsO4XA8.js","assets/js/vendor/vendor--style-to-object.DGZeIPGP.js","assets/js/vendor/vendor--inline-style-parser.BFz9PO4J.js","assets/js/vendor/vendor--hast-util-whitespace.DlJMGLAz.js","assets/js/vendor/vendor--estree-util-is-identifier-name.0h9-8Xae.js","assets/js/vendor/vendor--html-url-attributes.BA_i5Yxb.js","assets/js/vendor/vendor--react-helmet-async.BMUx00aU.js","assets/js/vendor/vendor--react-fast-compare.4d-J074I.js","assets/js/vendor/vendor--invariant.D6mx6rc7.js","assets/js/vendor/vendor--shallowequal.BwnEDCFe.js","assets/js/vendor/vendor--web-vitals.C1BoAgs7.js","assets/js/vendor/vendor-ui-tooltip.n7I39vTs.js","assets/js/vendor/vendor--embla-carousel-react.Bc6nB0ya.js","assets/js/vendor/vendor--embla-carousel-reactive-utils.BIRN7lq8.js","assets/js/vendor/vendor--embla-carousel.clUl8sxa.js","assets/js/vendor/vendor--cmdk.q6oiTfmV.js","assets/js/vendor/vendor--react-day-picker.D6HWAs9M.js","assets/js/vendor/vendor--react-hook-form.C68mK_Ba.js","assets/js/vendor/vendor---hookform-resolvers.CwYzTTZs.js","assets/js/vendor/vendor--zod.Cebk8UiH.js","assets/js/vendor/vendor-supabase-client.BJD0U0P8.js","assets/js/vendor/vendor-supabase-other.BhmW1H_P.js","assets/js/components/components-mobilenavigation.tsx.DtMtI5i3.js","assets/js/components/components-languagerouter.tsx.CHVsY7fH.js","assets/js/vendor/vendor--i18next.CHTa0CEF.js","assets/js/vendor/vendor--i18next-browser-languagedetector.h4x3AYwK.js","assets/js/vendor/vendor--i18next-http-backend.DjHzioAf.js","assets/js/hooks/hooks-useuserrole.ts.BKHSjdY6.js","assets/js/components/components-languageselector.tsx.x8buceJ0.js","assets/js/components/components-navigation.CB-8LlfF.js","assets/js/components/components-theme-toggle.tsx.CfzjOSrj.js","assets/js/components/components-theme-provider.tsx.Cd7zUHTE.js","assets/js/vendor/vendor-supabase-realtime.PMyDaGD3.js","assets/js/vendor/vendor--sonner.ECaEf7Ie.js","assets/js/hooks/hooks-useadminauth.ts.BJ7uhFTt.js"])))=>i.map(i=>d[i]);
import{j as e,r as s}from"../vendor/vendor-react-core.D1hcyiwY.js";import{c as a}from"./components-blog.C3TFiFB1.js";import{C as t,m as r,B as n,L as i,$ as l,a0 as c,a1 as o,p as d,q as m,r as p,s as u,t as h,ai as x,ax as g,ay as j,I as f,az as b,aA as y,aB as v,aC as N,aD as w,aE as C,aF as M,aG as _,aH as S,k as P,l as k,R as E,N as D,O as F,P as $,Q as z,G as A,J as O,K as U,M as Y,ab as B,aj as q,V as T,A as I,n as L,o as V,W as H,U as R}from"./components-ui.C8hnNhgu.js";import{u as G}from"../hooks/hooks-useuserrole.ts.BKHSjdY6.js";import{u as J}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{aw as K,at as W,O as Z,j as Q,ax as X,Z as ee,T as se,f as ae,ay as te,L as re,az as ne,X as ie,aA as le,Y as ce,aB as oe,R as de,b as me,q as pe,aC as ue,aD as he,D as xe,k as ge,ac as je,a1 as fe,a3 as be,a2 as ye,aE as ve}from"../vendor/vendor--lucide-react.DRw9PYsu.js";import{b as Ne,L as we,u as Ce}from"../vendor/vendor--react-router.Gdfmkz0l.js";import{_ as Me}from"./components-mobilenavigation.tsx.DtMtI5i3.js";import{L as _e}from"./components-trips.Ce9sOLST.js";import{f as Se}from"../vendor/vendor--date-fns.BbAlDtqN.js";import{u as Pe,t as ke}from"../hooks/hooks-use-toast.ts.Dg8obzHg.js";import{s as Ee}from"./components-admin.CiIAoamg.js";import{S as De}from"./components-languagerouter.tsx.CHVsY7fH.js";import{u as Fe}from"../hooks/hooks-usesecurepassport.ts.Dh9bJBHw.js";import{u as $e,t as ze,b as Ae}from"../utils/utils-cache.ts.BtmNadnX.js";import{z as Oe}from"../vendor/vendor--zod.Cebk8UiH.js";import{u as Ue}from"../hooks/hooks-useprofile.ts.Ck17Ru8_.js";import{i as Ye}from"../vendor/vendor--i18next.CHTa0CEF.js";import{u as Be}from"../hooks/hooks-usesubscriptionmanager.ts.BQlZZ2ob.js";function qe({className:s}){const{t:i,i18n:l}=J("profile"),c=Ne(),{isAdmin:o}=G(),d=c.pathname.split("/").filter(Boolean)[0]||l.language,m=[{label:i("sidebar.personalInfo"),icon:K,href:`/${d}/profile`},...o?[{label:i("sidebar.passport"),icon:W,href:`/${d}/profile/passport`}]:[],{label:i("sidebar.security"),icon:Z,href:`/${d}/profile/security`},{label:i("sidebar.email"),icon:Q,href:`/${d}/profile/email`},{label:i("sidebar.subscription"),icon:X,href:`/${d}/profile/subscription`},{label:i("sidebar.preferences"),icon:ee,href:`/${d}/profile/preferences`},{label:i("sidebar.account"),icon:se,href:`/${d}/profile/account`,variant:"destructive"}];return e.jsx(t,{className:a("overflow-hidden",s),children:e.jsxs(r,{className:"p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:i("sidebar.title")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i("sidebar.subtitle")})]}),e.jsx("nav",{className:"space-y-1",children:m.map((s=>{const t=c.pathname===s.href,r=s.icon;return e.jsx(n,{variant:s.variant||(t?"secondary":"ghost"),className:a("w-full justify-start gap-2",t&&"bg-accent","destructive"===s.variant&&"mt-8"),asChild:!0,children:e.jsxs(we,{to:s.href,children:[e.jsx(r,{className:"h-4 w-4"}),e.jsx("span",{children:s.label})]})},s.href)}))})]})})}function Te({date:t,setDate:r,disabled:g}){const{t:j,i18n:f}=J("profile"),[b,y]=s.useState(t?t.getMonth():(new Date).getMonth()),[v,N]=s.useState(t?t.getFullYear():(new Date).getFullYear()),w=(new Date).getFullYear(),C=Array.from({length:w-1900+1},((e,s)=>w-s)),M=[j("months.january"),j("months.february"),j("months.march"),j("months.april"),j("months.may"),j("months.june"),j("months.july"),j("months.august"),j("months.september"),j("months.october"),j("months.november"),j("months.december")];return e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:j("personal.birthdate")}),e.jsxs(l,{children:[e.jsx(c,{asChild:!0,children:e.jsxs(n,{variant:"outline",className:a("w-full justify-start text-left font-normal",!t&&"text-muted-foreground",g&&"opacity-50 cursor-not-allowed"),disabled:g,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),t?(e=>{try{let s;switch(f.language){case"fr":s="dd MMMM yyyy";break;case"es":s="dd 'de' MMMM 'de' yyyy";break;default:s="MMMM dd, yyyy"}return Se(e,s)}catch(s){return"Invalid date"}})(t):e.jsx("span",{children:j("validation.invalidDate")})]})}),e.jsxs(o,{className:"w-auto p-3 bg-white shadow-lg rounded-md border z-[999]",align:"start",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs(d,{value:M[b],onValueChange:e=>{const s=M.indexOf(e);if(y(s),t){const e=new Date(t);e.setMonth(s),r(e)}},disabled:g,children:[e.jsx(m,{className:"w-[140px]",children:e.jsx(p,{placeholder:j("personal.birthdate")})}),e.jsx(u,{position:"popper",className:"bg-white z-[1000]",children:M.map(((s,a)=>e.jsx(h,{value:s,children:s},a)))})]}),e.jsxs(d,{value:v.toString(),onValueChange:e=>{const s=parseInt(e);if(N(s),t){const e=new Date(t);e.setFullYear(s),r(e)}},disabled:g,children:[e.jsx(m,{className:"w-[100px]",children:e.jsx(p,{placeholder:j("personal.birthdate")})}),e.jsx(u,{position:"popper",className:"bg-white z-[1000] max-h-[200px] overflow-y-auto",children:C.map((s=>e.jsx(h,{value:s.toString(),children:s},s)))})]})]}),e.jsx(x,{mode:"single",selected:t,onSelect:g?void 0:r,month:new Date(v,b),onMonthChange:g?void 0:e=>{y(e.getMonth()),N(e.getFullYear())},className:a("rounded-md border",g&&"opacity-50 cursor-not-allowed"),disabled:g})]})]})]})}function Ie({value:s,onChange:t,disabled:r}){const{t:n}=J("profile"),l=s[0]||"indifferent";return e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:n("personal.lgbtqStatus")}),e.jsxs(g,{value:l,onValueChange:e=>t([e]),className:"flex flex-col space-y-2",disabled:r,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{value:"indifferent",id:"indifferent",disabled:r}),e.jsx(i,{htmlFor:"indifferent",className:a("cursor-pointer",r&&"opacity-50 cursor-not-allowed"),children:n("lgbtq.indifferent")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{value:"yes",id:"yes",disabled:r}),e.jsx(i,{htmlFor:"yes",className:a("cursor-pointer",r&&"opacity-50 cursor-not-allowed"),children:n("lgbtq.yes")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{value:"no",id:"no",disabled:r}),e.jsx(i,{htmlFor:"no",className:a("cursor-pointer",r&&"opacity-50 cursor-not-allowed"),children:n("lgbtq.no")})]})]})]})}function Le({url:t,onUpload:r,size:n=150,disabled:i=!1}){const{t:l}=J("profile"),{toast:c}=Pe(),[o,d]=s.useState(!1),[m,p]=s.useState(null);s.useEffect((()=>{if(t)try{const{data:e}=Ee.storage.from("avatars").getPublicUrl(t);p(e.publicUrl)}catch(e){p(null)}else p(null)}),[t]);return e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:a("relative rounded-full overflow-hidden bg-gray-100",i&&"opacity-70"),style:{width:n,height:n},children:[m?e.jsx("img",{src:m,alt:"Avatar",className:"w-full h-full object-cover",onError:e=>{p(null)}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200",children:e.jsx(te,{className:"w-8 h-8 text-gray-400"})}),!i&&e.jsx("label",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 text-white cursor-pointer opacity-0 hover:opacity-100 transition-opacity duration-200",htmlFor:"single",children:o?e.jsx(re,{className:"h-6 w-6 animate-spin"}):e.jsx(te,{className:"h-6 w-6"})})]}),!i&&e.jsx("input",{style:{visibility:"hidden",position:"absolute"},type:"file",id:"single",accept:"image/*",onChange:async e=>{try{if(d(!0),!e.target.files||0===e.target.files.length)throw new Error("You must select an image to upload.");const s=e.target.files[0],a=s.name.split(".").pop()?.toLowerCase()||"",n=["jpg","jpeg","png","gif"];if(!n.includes(a))throw new Error(`File type not supported. Please upload ${n.join(", ")} files.`);const{data:{user:i}}=await Ee.auth.getUser();if(!i)throw new Error("No authenticated user found");const o=Date.now(),m=`${i.id}_${o}.${a}`;t&&await Ee.storage.from("avatars").remove([t]);const{data:u,error:h}=await Ee.storage.from("avatars").upload(m,s,{cacheControl:"3600",upsert:!0});if(h)throw h;const{data:{publicUrl:x}}=Ee.storage.from("avatars").getPublicUrl(m);r(m),p(x),c({title:l("toasts.success"),description:l("toasts.avatarUpdated")})}catch(s){c({title:l("toasts.error"),description:s.message||l("toasts.errorUploadingAvatar"),variant:"destructive"})}finally{d(!1)}},disabled:o||i})]})}function Ve({profile:t,setProfile:r,date:l,setDate:c,loading:o,onSubmit:x}){const{t:g,i18n:j}=J("profile"),[b,y]=s.useState(!1),[v,N]=s.useState(t),[w,C]=s.useState(l),M=Ne(),_=Ce();s.useEffect((()=>{if(w){const e=`${w.getFullYear()}-${String(w.getMonth()+1).padStart(2,"0")}-${String(w.getDate()).padStart(2,"0")}`;N((s=>({...s,birth_date:e})))}else N((e=>({...e,birth_date:null})))}),[w]);const S={...v,medical_conditions:v.medical_conditions||[],disabilities:v.disabilities||[],allergies:v.allergies||[],lgbtq_status:v.lgbtq_status||[],dietary_preferences:v.dietary_preferences||[],language:v.language||"en",newsletter_subscribed:v.newsletter_subscribed??!0};return e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{await x(e,v),r(v),c(w),y(!1)}catch(s){ke({title:g("toasts.error"),description:g("toasts.errorSaving"),variant:"destructive"})}},className:"space-y-6",children:[e.jsx("div",{className:"flex justify-end mb-4",children:b?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{type:"button",onClick:()=>{N(t),C(l),y(!1)},variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),g("actions.cancel")]}),e.jsxs(n,{type:"submit",disabled:o,className:"flex items-center gap-2",children:[o?e.jsx(re,{className:"h-4 w-4 animate-spin"}):e.jsx(le,{className:"h-4 w-4"}),g("actions.save")]})]}):e.jsxs(n,{type:"button",onClick:()=>y(!0),variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),g("actions.edit")]})}),e.jsx("div",{className:"flex flex-col items-center mb-8",children:e.jsx(Le,{url:S.avatar_url,onUpload:e=>{N({...v,avatar_url:e}),x(new Event("submit"),{...v,avatar_url:e})},disabled:!b})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"firstName",children:g("personal.firstName")}),e.jsx(f,{id:"firstName",value:S?.first_name||"",onChange:e=>N({...v,first_name:e.target.value}),readOnly:!b,className:a(!b&&"bg-gray-50 text-gray-700")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"lastName",children:g("personal.lastName")}),e.jsx(f,{id:"lastName",value:S?.last_name||"",onChange:e=>N({...v,last_name:e.target.value}),readOnly:!b,className:a(!b&&"bg-gray-50 text-gray-700")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"username",children:g("personal.username")}),e.jsx(f,{id:"username",value:S?.username||"",onChange:e=>N({...v,username:e.target.value}),readOnly:!b,className:a(!b&&"bg-gray-50 text-gray-700")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"language",children:g("settings.language")}),e.jsxs(d,{value:S.language,onValueChange:async e=>{if(["en","fr","es"].includes(e))try{ke({title:g("languageSelector.changing"),description:g("languageSelector.pleaseWait"),variant:"language-change",duration:1e3});N({...v,language:e}),await j.changeLanguage(e);try{const{id:s}=v;if(s){const{error:a}=await(await Me((async()=>{const{supabase:e}=await import("./components-admin.CiIAoamg.js").then((e=>e.c));return{supabase:e}}),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117]))).supabase.from("profiles").update({language:e}).eq("id",s);a||(localStorage.setItem("user_language",e),localStorage.setItem("user_language_timestamp",Date.now().toString()))}}catch(s){}const a=M.pathname.split("/").filter(Boolean);if(De.includes(a[0])){a[0]=e;const s="/"+a.join("/");_(s,{replace:!0})}else{const s=`/${e}${M.pathname}`;_(s,{replace:!0})}ke({title:g("languageSelector.changed"),description:g("languageSelector.changedDescription"),variant:"success",duration:1500})}catch(a){ke({title:g("languageSelector.error"),description:g("languageSelector.errorDescription"),variant:"destructive",duration:5e3})}},disabled:!b,children:[e.jsx(m,{className:a(!b&&"bg-gray-50 text-gray-700"),children:e.jsx(p,{placeholder:g("settings.language")})}),e.jsxs(u,{children:[e.jsx(h,{value:"en",children:g("languageSelector.english")}),e.jsx(h,{value:"fr",children:g("languageSelector.french")}),e.jsx(h,{value:"es",children:g("languageSelector.spanish")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"residence",children:g("personal.address")}),e.jsx(_e,{value:S?.residence_location||"",onChange:(e,s)=>{N({...v,residence_location:e})},disabled:!b,className:a(!b&&"bg-gray-50 text-gray-700")})]}),e.jsx(Te,{date:w,setDate:C,disabled:!b}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"medicalConditions",children:g("personal.medicalConditions")}),e.jsx(f,{id:"medicalConditions",value:S.medical_conditions.join(", "),onChange:e=>N({...v,medical_conditions:e.target.value.split(",").map((e=>e.trim())).filter((e=>""!==e))}),placeholder:g("personal.medicalConditionsPlaceholder"),readOnly:!b,className:a(!b&&"bg-gray-50 text-gray-700")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"disabilities",children:g("personal.disabilities")}),e.jsx(f,{id:"disabilities",value:S.disabilities.join(", "),onChange:e=>N({...v,disabilities:e.target.value.split(",").map((e=>e.trim())).filter((e=>""!==e))}),placeholder:g("personal.disabilitiesPlaceholder"),readOnly:!b,className:a(!b&&"bg-gray-50 text-gray-700")})]}),e.jsx(Ie,{value:S.lgbtq_status,onChange:e=>N({...v,lgbtq_status:e}),disabled:!b}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"allergies",children:g("personal.allergies")}),e.jsx(f,{id:"allergies",value:S.allergies.join(", "),onChange:e=>N({...v,allergies:e.target.value.split(",").map((e=>e.trim())).filter((e=>""!==e))}),placeholder:g("personal.allergiesPlaceholder"),readOnly:!b,className:a(!b&&"bg-gray-50 text-gray-700")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"dietaryPreferences",children:g("personal.dietaryPreferences")}),e.jsx(f,{id:"dietaryPreferences",value:S.dietary_preferences.join(", "),onChange:e=>N({...v,dietary_preferences:e.target.value.split(",").map((e=>e.trim())).filter((e=>""!==e))}),placeholder:g("personal.dietaryPreferencesPlaceholder"),readOnly:!b,className:a(!b&&"bg-gray-50 text-gray-700")})]})]})]})}function He(){const{t:t}=J("profile"),{passportData:r,loading:l,error:c,storePassportData:o,retrievePassportData:x,deletePassportData:g,clearError:j}=Fe(),[P,k]=s.useState({passport_number:"",passport_country:"",passport_expiry_date:""}),[E,D]=s.useState(!1),[F,$]=s.useState(!1),[z,A]=s.useState(!1),[O,U]=s.useState(!1);s.useEffect((()=>{x()}),[]),s.useEffect((()=>{r?(U(!0),k({passport_number:r.passport_number||"",passport_country:r.passport_country||"",passport_expiry_date:r.passport_expiry_date||""})):(U(!1),k({passport_number:"",passport_country:"",passport_expiry_date:""}))}),[r]);const Y=(e,s="passport")=>{if(!e||z)return e||"";switch(s){case"passport":return e.length<=4?"*".repeat(e.length):e.substring(0,2)+"*".repeat(e.length-4)+e.substring(e.length-2);case"date":return"****-**-**";case"country":return e.substring(0,1)+"*".repeat(e.length-1);default:return"*".repeat(e.length)}};return l&&!O?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(re,{className:"h-8 w-8 animate-spin text-[#61936f]"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-[#61936f]"}),e.jsx("h3",{className:"text-lg font-semibold",children:t("passport.title")}),O&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-green-600",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Secured"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[O&&e.jsxs(n,{type:"button",onClick:()=>{$(!0)},variant:"outline",size:"sm",className:"flex items-center gap-2 text-red-600 hover:text-red-700",children:[e.jsx(se,{className:"h-4 w-4"}),"Delete"]}),z?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{type:"button",onClick:()=>{k({passport_number:r?.passport_number||"",passport_country:r?.passport_country||"",passport_expiry_date:r?.passport_expiry_date||""}),A(!1),j()},variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),t("actions.cancel")]}),e.jsxs(n,{type:"submit",form:"passport-form",disabled:l,className:"flex items-center gap-2",children:[l?e.jsx(re,{className:"h-4 w-4 animate-spin"}):e.jsx(le,{className:"h-4 w-4"}),t("actions.save")]})]}):e.jsxs(n,{type:"button",onClick:()=>{D(!0)},variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),O?t("actions.edit"):"Add Passport"]})]})]}),c&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700 text-sm",children:c})}),e.jsx("form",{id:"passport-form",onSubmit:async e=>{e.preventDefault();await o(P)&&(A(!1),U(!0))},className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"passportNumber",children:t("personal.passportNumber")}),e.jsx(f,{id:"passportNumber",value:z?P.passport_number:Y(P.passport_number,"passport"),onChange:e=>k({...P,passport_number:e.target.value}),placeholder:t("personal.passportNumberPlaceholder"),readOnly:!z,className:a(!z&&"bg-gray-50 text-gray-700"),type:z?"text":"password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"passportCountry",children:t("personal.passportCountry")}),z?e.jsxs(d,{value:P.passport_country,onValueChange:e=>k({...P,passport_country:e}),children:[e.jsx(m,{children:e.jsx(p,{placeholder:t("personal.selectPassportCountry")})}),e.jsxs(u,{children:[e.jsx(h,{value:"US",children:t("countries.unitedStates")}),e.jsx(h,{value:"FR",children:t("countries.france")}),e.jsx(h,{value:"ES",children:t("countries.spain")}),e.jsx(h,{value:"GB",children:t("countries.unitedKingdom")}),e.jsx(h,{value:"CA",children:t("countries.canada")}),e.jsx(h,{value:"DE",children:t("countries.germany")}),e.jsx(h,{value:"IT",children:t("countries.italy")}),e.jsx(h,{value:"JP",children:t("countries.japan")}),e.jsx(h,{value:"AU",children:t("countries.australia")})]})]}):e.jsx(f,{value:Y(P.passport_country,"country"),readOnly:!0,className:"bg-gray-50 text-gray-700"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"passportExpiry",children:t("personal.passportExpiry")}),z?e.jsx(b,{date:P.passport_expiry_date?(()=>{const[e,s,a]=P.passport_expiry_date.split("-").map(Number);return new Date(e,s-1,a)})():void 0,setDate:e=>k({...P,passport_expiry_date:e?`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`:null}),label:t("personal.passportExpiry"),placeholder:t("personal.selectPassportExpiry"),minYear:(new Date).getFullYear(),maxYear:(new Date).getFullYear()+20,disabledDates:e=>e<new Date}):e.jsx(f,{value:Y(P.passport_expiry_date,"date"),readOnly:!0,className:"bg-gray-50 text-gray-700"})]})]})}),!z&&O&&e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-800 font-medium text-sm",children:"Secure Storage"}),e.jsx("p",{className:"text-blue-700 text-sm mt-1",children:"Your passport information is encrypted and stored securely. All access attempts are logged for security purposes."})]})]})}),e.jsx(y,{open:E,onOpenChange:D,children:e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-[#61936f]"}),"Access Secure Data"]}),e.jsx(C,{children:"You are about to access your encrypted passport information. This action will be logged for security purposes."})]}),e.jsxs(M,{children:[e.jsx(_,{onClick:()=>{D(!1)},children:t("actions.cancel")}),e.jsx(S,{onClick:()=>{A(!0),D(!1),j()},className:"bg-[#61936f] hover:bg-[#4a7a5a] text-white",children:t("actions.confirm")})]})]})}),e.jsx(y,{open:F,onOpenChange:$,children:e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-red-600"}),"Delete Passport Data"]}),e.jsx(C,{children:"This will permanently delete your encrypted passport information. This action cannot be undone."})]}),e.jsxs(M,{children:[e.jsx(_,{onClick:()=>{$(!1)},children:t("actions.cancel")}),e.jsx(S,{onClick:async()=>{await g()&&(A(!1),U(!1),$(!1))},className:"bg-red-600 hover:bg-red-700 text-white",children:"Delete Permanently"})]})]})})]})}function Re(){const{toast:a}=Pe(),{t:l}=J("profile"),c=Ce(),[o,d]=s.useState(""),[m,p]=s.useState(""),[u,h]=s.useState(""),[x,g]=s.useState(!1),[j,b]=s.useState("");return e.jsxs(t,{children:[e.jsx(P,{children:e.jsx(k,{className:"text-2xl font-bold text-gray-900",children:l("passwordChange.title")})}),e.jsx(r,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),b(""),m===u)if(m.length<6)b(l("passwordChange.passwordTooShort"));else{g(!0);try{const{data:{user:e}}=await Ee.auth.getUser();if(!e)throw new Error("No user found");const{error:t}=await Ee.auth.updateUser({password:m});if(t)throw t;if(e.email)try{await Ee.functions.invoke("send-password-change-email",{body:{email:e.email,name:e.user_metadata?.first_name||e.user_metadata?.last_name||"Traveler",language:l("common.currentLanguage")}})}catch(s){}$e.delete(`profile-${e.id}`),d(""),p(""),h(""),a({title:l("passwordChange.passwordUpdated"),description:l("passwordChange.passwordUpdateSuccess")}),await Ee.auth.signOut(),c("/auth")}catch(t){a({title:l("toasts.error"),description:t.message||l("passwordChange.updateError"),variant:"destructive"})}finally{g(!1)}}else b(l("passwordChange.passwordsDoNotMatch"))},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"current-password",children:l("passwordChange.currentPassword")}),e.jsx(f,{id:"current-password",type:"password",value:o,onChange:e=>d(e.target.value),placeholder:"••••••••"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"new-password",children:l("passwordChange.newPassword")}),e.jsx(f,{id:"new-password",type:"password",value:m,onChange:e=>p(e.target.value),placeholder:"••••••••",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"confirm-password",children:l("passwordChange.confirmPassword")}),e.jsx(f,{id:"confirm-password",type:"password",value:u,onChange:e=>h(e.target.value),placeholder:"••••••••",required:!0})]}),j&&e.jsx("div",{className:"text-red-500 text-sm mt-2",children:j}),e.jsx("div",{className:"flex justify-end",children:e.jsx(n,{type:"submit",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),l("passwordChange.updating")]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),l("passwordChange.updatePassword")]})})})]})})]})}function Ge(){const{t:a}=J("profile"),{toast:l}=Pe(),c=Ce(),{emailChangeInProgress:o}=Ue(),[d,m]=s.useState(!1),[p,u]=s.useState(""),[h,x]=s.useState(""),[g,j]=s.useState(""),[b,y]=s.useState(null);s.useEffect((()=>{(async()=>{try{const{data:{user:e}}=await Ee.auth.getUser();e?.email&&u(e.email)}catch(e){}})()}),[]);return e.jsxs(t,{children:[e.jsx(P,{children:e.jsx(k,{className:"text-xl font-semibold",children:a("emailChange.title")})}),e.jsx(r,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{try{return Oe.string().email(a("profile.emailChange.invalidEmail")).parse(h),h!==g?(y(a("profile.emailChange.emailsDoNotMatch")),!1):(y(null),!0)}catch(e){return e instanceof Oe.ZodError?y(e.errors[0].message):y(a("profile.emailChange.invalidEmail")),!1}})())try{m(!0);const{data:{user:e}}=await Ee.auth.getUser();if(!e)throw new Error("User not authenticated");$e.delete(`profile-${e.id}`),ze.delete(`trips-${e.id}`),Ae.delete(`blogs-${e.id}`);const s=await Ee.functions.invoke("sync-email-change",{body:{userId:e.id,newEmail:h}});if(!s.data?.success)throw new Error(s.error?.message||"Failed to sync email change");const{error:t}=await Ee.auth.updateUser({email:h});if(t)throw t;l({title:a("profile.emailChange.verificationSent"),description:a("profile.emailChange.verificationSentDescription")}),await Ee.auth.signOut(),l({title:a("auth.notice"),description:a("auth.emailChangeVerificationText")}),c("/auth"),x(""),j("")}catch(s){l({title:a("profile.emailChange.updateError"),description:s.message||a("profile.emailChange.updateError"),variant:"destructive"})}finally{m(!1)}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"currentEmail",children:a("emailChange.currentEmail")}),e.jsx(f,{id:"currentEmail",value:p,disabled:!0,readOnly:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"newEmail",children:a("emailChange.newEmail")}),e.jsx(f,{id:"newEmail",type:"email",value:h,onChange:e=>x(e.target.value),placeholder:a("personal.email"),required:!0,disabled:d||o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"confirmNewEmail",children:a("emailChange.confirmNewEmail")}),e.jsx(f,{id:"confirmNewEmail",type:"email",value:g,onChange:e=>j(e.target.value),placeholder:a("personal.email"),required:!0,disabled:d||o})]}),b&&e.jsx("div",{className:"text-red-500 text-sm",children:b}),o&&e.jsx("div",{className:"text-amber-500 text-sm",children:a("emailChange.verificationText")}),e.jsx(n,{type:"submit",disabled:d||o,className:"w-full",children:d?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),a("emailChange.updating")]}):a("emailChange.updateEmail")})]})})]})}function Je(){const{t:a}=J("profile"),i=Ce(),[l,c]=s.useState(!1),[o,d]=s.useState(!1),[m,p]=s.useState(null),[u,h]=s.useState(!0),[x,g]=s.useState([]),[j,f]=s.useState(!1),{subscription:b,getSubscriptionDetails:y,updatePaymentMethod:v,cancelSubscription:N,reactivateSubscription:w,changeSubscriptionPlan:C,getBillingHistory:M}=Be(),_={zaptrip:{name:a("zaptrip.title"),features:a("zaptrip.features").split("|"),monthlyPrice:4.99,yearlyPrice:53.99,color:"bg-blue-100 text-blue-800",recommended:!1},zapout:{name:a("zapout.title"),features:a("zapout.features").split("|"),monthlyPrice:4.99,yearlyPrice:53.99,color:"bg-purple-100 text-purple-800",recommended:!1},zaproad:{name:a("zaproad.title"),features:a("zaproad.features").split("|"),monthlyPrice:4.99,yearlyPrice:53.99,color:"bg-pink-100 text-pink-800",recommended:!1},zappro:{name:a("zappro.title"),features:a("zappro.features").split("|"),monthlyPrice:9.99,yearlyPrice:107.99,color:"bg-yellow-100 text-yellow-800",recommended:!0},explorer:{name:a("explorer.title"),features:a("explorer.features").split("|"),monthlyPrice:0,yearlyPrice:0,color:"bg-gray-100 text-gray-800",recommended:!1}};s.useEffect((()=>{!async function(){h(!0);try{const e=await y();e.success&&e.subscription?c("year"===e.subscription.interval):c(!1)}catch(e){c(!1)}finally{h(!1)}}()}),[]),s.useEffect((()=>{}),[b]);const S=async()=>{const e=await v();e.success&&e.url&&window.open(e.url,"_blank")},G=async()=>{await w()},K=e=>{switch(e){case"active":return"bg-green-100 text-green-800 hover:bg-green-200";case"canceled":case"cancelled":return"bg-orange-100 text-orange-800 hover:bg-orange-200";case"past_due":case"unpaid":return"bg-red-100 text-red-800 hover:bg-red-200";case"incomplete":return"bg-yellow-100 text-yellow-800 hover:bg-yellow-200";case"trialing":return"bg-blue-100 text-blue-800 hover:bg-blue-200";default:return"bg-gray-100 text-gray-800 hover:bg-gray-200"}},Z=s=>{const t=`subscriptionManager.status.${s.toLowerCase()}`;return e.jsx(T,{className:K(s),children:a(t)})},Q=e=>{try{const s=new Date(e);return Se(s,"MMMM dd, yyyy")}catch(s){return e}},ee=async()=>{if(b){f(!0);try{const e=await M(20);e.success?g(e.invoices):g([])}catch(e){g([])}finally{f(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(t,{children:[e.jsxs(P,{className:"pb-3",children:[e.jsx(k,{className:"text-2xl font-bold",children:a("subscriptionManagement.title")}),e.jsx(E,{children:a("subscriptionManagement.description")})]}),e.jsx(r,{children:(()=>{if(!b||"none"===b.status||"canceled"===b.status||"cancelled"===b.status)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500",children:a("subscriptionManager.noSubscription")}),e.jsx(n,{className:"mt-4",onClick:()=>i(`/${Ye.language}/pricing`),children:a("subscriptionManager.subscribe")})]});const s=_[b.plan]||_.explorer;return e.jsxs("div",{className:"space-y-5",children:[b.cancelAtPeriodEnd&&e.jsxs(I,{variant:"destructive",className:"mb-4",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx(L,{children:a("subscriptionManager.canceledTitle")}),e.jsx(V,{children:a("subscriptionManager.canceledDescription")})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:a("subscriptionManager.currentPlan")}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(T,{className:s.color,children:s.name}),e.jsx("span",{className:"text-sm",children:"year"===b.interval?a("subscriptionManager.yearlyBilling"):a("subscriptionManager.monthlyBilling")})]})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:a("subscriptionManager.statusLabel")}),e.jsxs("div",{className:"mt-1",children:[Z(b.status),b.cancelAtPeriodEnd&&e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:a("subscriptionManager.cancelsAtEnd")})]})]}),b.cancelAtPeriodEnd?e.jsxs(n,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:G,children:[e.jsx(ue,{className:"h-3.5 w-3.5"}),a("subscriptionManager.reactivateSubscription")]}):e.jsxs(n,{variant:"outline",size:"sm",className:"flex items-center gap-1 text-red-600 hover:text-red-700 border-red-200 hover:border-red-300 hover:bg-red-50",onClick:()=>d(!0),children:[e.jsx(he,{className:"h-3.5 w-3.5"}),a("subscriptionManager.cancelSubscription")]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:a("subscriptionManager.renewalDate")}),e.jsxs("p",{className:"mt-1 flex items-center gap-1.5",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-400"}),Q(b.currentPeriodEnd)]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:a("subscriptionManager.currentPrice")}),e.jsxs("p",{className:"mt-1 flex items-center gap-1.5",children:[e.jsx(xe,{className:"h-4 w-4 text-gray-400"}),"year"===b.interval?`$${(s.yearlyPrice/12).toFixed(2)} ${a("subscriptionManager.perMonthYearly")}`:`$${s.monthlyPrice.toFixed(2)} ${a("subscriptionManager.perMonth")}`]})]}),b.paymentMethod&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:a("subscriptionManager.paymentMethod")}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"mt-1 flex items-center gap-1.5",children:[e.jsx(X,{className:"h-4 w-4 text-gray-400"}),b.paymentMethod.brand.charAt(0).toUpperCase()+b.paymentMethod.brand.slice(1)," •••• ",b.paymentMethod.last4,e.jsxs("span",{className:"text-sm text-gray-500",children:["(Expires ",b.paymentMethod.expiryMonth,"/",b.paymentMethod.expiryYear,")"]})]}),e.jsxs(n,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:S,children:[e.jsx(X,{className:"h-3.5 w-3.5 mr-1"}),a("subscriptionManager.updatePayment")]})]})]}),e.jsx("div",{className:"pt-4 mt-4 border-t"})]})})()})]}),b&&"none"!==b.status&&"canceled"!==b.status&&"cancelled"!==b.status&&e.jsxs(D,{defaultValue:"plans",onValueChange:e=>{"history"===e&&ee()},children:[e.jsxs(F,{className:"grid grid-cols-2",children:[e.jsx($,{value:"plans",children:"Plans"}),e.jsx($,{value:"history",children:a("subscriptionManager.billingHistory.title")})]}),e.jsx(z,{value:"plans",className:"mt-4",children:b?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:a("subscriptionManager.planOptions")}),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 p-1 rounded-full shadow-sm",children:[e.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 text-xs font-medium rounded-full transition-all "+(l?"text-gray-600":"bg-white shadow-sm text-blue-700"),children:a("subscriptionManager.monthlyBilling")}),e.jsx("button",{onClick:()=>c(!0),className:"px-4 py-2 text-xs font-medium rounded-full transition-all "+(l?"bg-white shadow-sm text-blue-700":"text-gray-600"),children:a("subscriptionManager.yearlyBilling")})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:Object.entries(_).sort((([e],[s])=>"zappro"===e?-1:"zappro"===s?1:e.localeCompare(s))).map((([s,r])=>{const i=b.plan===s;l?(r.yearlyPrice/12).toFixed(2):r.monthlyPrice.toFixed(2);let c=null,o="";return"zaptrip"===s?(c=e.jsx(fe,{className:"h-8 w-8 text-blue-500"}),o="bg-blue-100 text-blue-800"):"zapout"===s?(c=e.jsx(be,{className:"h-8 w-8 text-purple-500"}),o="bg-purple-100 text-purple-800"):"zaproad"===s?(c=e.jsx(ye,{className:"h-8 w-8 text-pink-500"}),o="bg-pink-100 text-pink-800"):"zappro"===s&&(c=e.jsx(ve,{className:"h-8 w-8 text-yellow-500"}),o="bg-yellow-100 text-yellow-800"),e.jsx(t,{className:"relative flex flex-col h-full bg-white/80 backdrop-blur-sm border-0 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300",children:e.jsxs("div",{className:"p-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[c,e.jsx("span",{className:`text-sm font-semibold ${o}`,children:r.name})]})}),e.jsx("h3",{className:"text-2xl font-bold mb-2",children:r.name}),e.jsx("p",{className:"text-gray-600 mb-6",children:a(`${s}.description`)}),e.jsx("ul",{className:"space-y-3 mb-8",children:r.features.map(((s,a)=>e.jsxs("li",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`flex-shrink-0 w-5 h-5 rounded-full ${r.color} flex items-center justify-center`,children:e.jsx(ge,{className:`w-3 h-3 ${o.split(" ")[1]}`})}),e.jsx("span",{className:"text-gray-700",children:s})]},a)))}),i?e.jsx(n,{variant:"outline",className:"w-full border-2 font-medium border-green-500 text-green-700",disabled:!0,children:a("subscriptionManager.currentPlanLabel")}):e.jsx(n,{className:`w-full font-medium shadow-sm ${r.color}`,onClick:()=>(e=>{b&&b.plan===e?ke({title:a("subscriptionManager.alreadyOnPlan"),description:a("subscriptionManager.alreadyOnPlanDescription")}):p(e)})(s),children:a("subscriptionManager.selectPlan")})]})},s)}))})]}):null}),e.jsx(z,{value:"history",className:"mt-4",children:e.jsxs(t,{children:[e.jsx(P,{children:e.jsx(k,{className:"text-lg",children:a("subscriptionManager.billingHistory.title")})}),e.jsx(r,{children:j?e.jsx("div",{className:"space-y-4",children:[1,2,3].map((s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"h-4 w-32"}),e.jsx(H,{className:"h-3 w-24"})]}),e.jsx(H,{className:"h-8 w-24"})]},s)))}):0===x.length?e.jsx("div",{className:"text-center text-gray-500 py-6",children:a("subscriptionManager.billingHistory.noHistory")}):e.jsx("div",{className:"space-y-3",children:x.map((s=>e.jsxs("div",{className:"flex justify-between items-center p-3 border rounded hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[a("subscriptionManager.billingHistory.invoice.number"),s.number,e.jsx(T,{className:"paid"===s.status?"bg-green-100 text-green-800 ml-2":"open"===s.status?"bg-blue-100 text-blue-800 ml-2":"bg-gray-100 text-gray-800 ml-2",children:s.status})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[Q(s.created)," • $",s.amount_paid," ",s.currency.toUpperCase()]})]}),s.hosted_invoice_url&&e.jsxs(n,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:()=>window.open(s.hosted_invoice_url,"_blank"),children:[e.jsx(W,{className:"h-3.5 w-3.5"}),a("subscriptionManager.viewInvoice"),e.jsx(je,{className:"h-3 w-3 ml-1"})]})]},s.id)))})}),e.jsx(R,{children:e.jsxs(n,{variant:"outline",size:"sm",onClick:ee,disabled:j,children:[e.jsx(de,{className:"h-4 w-4 mr-2 "+(j?"animate-spin":"")}),a("subscriptionManager.refreshBillingHistory")]})})]})})]}),e.jsx(A,{open:o,onOpenChange:d,children:e.jsxs(O,{className:"sm:max-w-md",children:[e.jsxs(U,{children:[e.jsx(Y,{children:a("subscriptionManager.confirmCancel.title")}),e.jsx(B,{children:a("subscriptionManager.confirmCancel.description")})]}),e.jsxs(q,{className:"gap-2 sm:gap-0",children:[e.jsx(n,{variant:"outline",onClick:()=>d(!1),children:a("subscriptionManager.confirmCancel.cancel")}),e.jsx(n,{variant:"destructive",onClick:async()=>{try{const e=await N();d(!1),e.success}catch(e){await y(),d(!1)}},disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-4 w-4 mr-2 animate-spin"})," ",a("common.processing")]}):a("subscriptionManager.confirmCancel.confirm")})]})]})}),e.jsx(A,{open:!!m,onOpenChange:()=>p(null),children:e.jsxs(O,{className:"sm:max-w-md",children:[e.jsxs(U,{children:[e.jsx(Y,{children:a("subscriptionManager.changePlanTitle")}),e.jsx(B,{children:a("subscriptionManager.changePlanDescription")})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"text-sm font-medium",children:a("subscriptionManager.billingCycle")}),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 p-1 rounded-full",children:[e.jsx("button",{onClick:()=>c(!1),className:"px-3 py-1 text-xs font-medium rounded-full transition-all "+(l?"text-gray-600":"bg-white shadow-sm"),children:a("subscriptionManager.monthlyBilling")}),e.jsxs("button",{onClick:()=>c(!0),className:"px-3 py-1 text-xs font-medium rounded-full transition-all "+(l?"bg-white shadow-sm":"text-gray-600"),children:[a("subscriptionManager.yearlyBilling"),e.jsx("span",{className:"ml-1 text-xs bg-green-100 text-green-800 px-1 rounded-sm",children:"-10%"})]})]})]}),m&&_[m]&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("div",{className:"font-medium",children:_[m]?.name||m}),e.jsx(T,{className:_[m]?.color||"bg-gray-100",children:a("subscriptionManager.selected")})]}),e.jsxs("div",{className:"text-2xl font-bold mt-2",children:["$",l?(_[m]?.yearlyPrice/12).toFixed(2):_[m]?.monthlyPrice.toFixed(2),e.jsxs("span",{className:"text-sm text-gray-500 font-normal ml-1",children:["/ ",a("subscriptionManager.month")]})]}),e.jsx("div",{className:"text-sm text-gray-500 mb-4",children:l?a("subscriptionManager.billedYearly",{amount:_[m]?.yearlyPrice.toFixed(2)}):a("subscriptionManager.billedMonthly")}),e.jsxs("div",{className:"text-sm mt-2",children:[e.jsxs("span",{className:"font-medium",children:[a("subscriptionManager.includes"),":"]}),e.jsx("ul",{className:"mt-2 space-y-1",children:_[m]?.features.map(((s,a)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(me,{className:"h-4 w-4 text-green-500 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:s})]},a)))})]})]}),e.jsxs(q,{className:"mt-4",children:[e.jsx(n,{variant:"outline",onClick:()=>p(null),children:a("common.cancel")}),e.jsx(n,{type:"submit",onClick:async()=>{if(m)try{if(b&&b.plan===m)return void p(null);h(!0);(await C(m,l)).success?(p(null),ke({title:a("subscriptionManager.changePlanSuccess"),description:a("subscriptionManager.changePlanDescription")}),await y()):(p(null),ke({title:a("toasts.error"),description:a("subscriptionManager.changePlanError"),variant:"destructive"}))}catch(e){p(null),ke({title:a("toasts.error"),description:a("subscriptionManager.changePlanError"),variant:"destructive"})}finally{h(!1)}},children:a("subscriptionManager.confirmChangePlan")})]})]})})]})}const Ke=()=>{const[a,i]=s.useState(!1),[l,c]=s.useState(!1),{toast:o}=Pe(),{t:d}=J("profile"),m=Ce();return e.jsxs(e.Fragment,{children:[e.jsxs(t,{className:"border-red-200",children:[e.jsx(P,{children:e.jsxs(k,{className:"text-2xl font-bold text-red-600 flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),d("deleteAccount.title")]})}),e.jsxs(r,{children:[e.jsx("p",{className:"mb-4 text-gray-600",children:d("deleteAccount.description")}),e.jsx(n,{variant:"destructive",onClick:()=>i(!0),disabled:l,children:d("deleteAccount.button")})]})]}),e.jsx(y,{open:a,onOpenChange:i,children:e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsx(w,{children:d("deleteAccount.confirmTitle")}),e.jsx(C,{children:d("deleteAccount.confirmDescription")})]}),e.jsxs(M,{children:[e.jsx(_,{disabled:l,children:d("cancel")}),e.jsx(S,{onClick:e=>{e.preventDefault(),(async()=>{try{c(!0);const{data:{user:s}}=await Ee.auth.getUser(),{data:{session:a}}=await Ee.auth.getSession();if(!s||!a)throw new Error("No authenticated user found");const t=s.id,r=s.email,n=a.access_token;if($e.delete(`profile-${t}`),ze.delete(`trips-${t}`),Ae.delete(`blogs-${t}`),r)try{await Ee.functions.invoke("send-account-deletion-email",{body:{email:r,name:s.user_metadata?.first_name||s.user_metadata?.last_name||"Traveler"}})}catch(e){}const{data:i,error:l}=await Ee.functions.invoke("delete-user",{body:{userId:t},headers:{Authorization:`Bearer ${n}`}});if(l)throw new Error(l.message||"Failed to delete account");if(!i||!i.success)throw new Error(i?.error||"Failed to delete account: Unexpected response");await Ee.auth.signOut(),m("/")}catch(s){o({title:d("deleteAccount.error"),description:s.message||d("deleteAccount.errorMessage"),variant:"destructive"}),i(!1)}finally{c(!1)}})()},disabled:l,className:"bg-red-600 hover:bg-red-700",children:d(l?"deleteAccount.deleting":"deleteAccount.confirm")})]})]})})]})};export{Re as C,Ke as D,Ge as E,qe as P,Je as S,Ve as a,He as b};
//# sourceMappingURL=components-profile.CtclhbDl.js.map
