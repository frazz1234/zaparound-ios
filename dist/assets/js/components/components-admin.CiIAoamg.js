import{j as e,r as s}from"../vendor/vendor-react-core.D1hcyiwY.js";import{I as n,B as r,T as i,a,b as l,c as t,d as o,e as c,D as d,f as m,g as h,h as x,i as u,j as p,C as j,k as g,l as _,m as v,A as f,n as b,o as y,F as N,S as w,p as C,q as k,r as S,s as E,t as I,u as T,v as F,w as A,x as z,y as U,z as D,L as O}from"./components-ui.C8hnNhgu.js";import{u as P}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{S as W,E as L,L as R,T as q,C as B,W as V,a as J,I as M}from"../vendor/vendor--lucide-react.DRw9PYsu.js";import{u as X}from"../hooks/hooks-use-toast.ts.Dg8obzHg.js";import{u as Y}from"../vendor/vendor--react-hook-form.C68mK_Ba.js";import{t as Z}from"../vendor/vendor---hookform-resolvers.CwYzTTZs.js";import{o as H,b as G,s as K}from"../vendor/vendor--zod.Cebk8UiH.js";import{u as Q}from"../vendor/vendor--react-router.Gdfmkz0l.js";import{c as $}from"../vendor/vendor-supabase-client.BJD0U0P8.js";import{u as ee}from"../vendor/vendor--sonner.ECaEf7Ie.js";import{u as se}from"../hooks/hooks-useadminauth.ts.BJ7uhFTt.js";const ne=$("https://ynvnzmkpifwteyuxondc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inludm56bWtwaWZ3dGV5dXhvbmRjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA0MzM0ODksImV4cCI6MjA1NjAwOTQ4OX0.-7uEZS3Ra22P3KqWgVn1JVgzWlTOxgKnYnjiykgWpms"),re=Object.freeze(Object.defineProperty({__proto__:null,supabase:ne},Symbol.toStringTag,{value:"Module"}));function ie({searchTerm:s,setSearchTerm:i,onRefresh:a=()=>{},isLoading:l=!1}){const{t:t}=P(["admin","common"]);return e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(W,{className:"h-5 w-5 text-gray-400"}),e.jsx(n,{type:"text",placeholder:t("common:search"),value:s,onChange:e=>i(e.target.value),className:"w-full"}),a&&e.jsxs(r,{onClick:a,variant:"outline",disabled:l,children:[l?e.jsxs("svg",{className:"h-4 w-4 animate-spin mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):null,t("common:refresh")]})]})})}function ae({users:n,onRoleUpdated:j,onDeleteUser:g}){const{t:_}=P(["admin","common"]),{toast:v}=X(),[f,b]=s.useState(null),[y,N]=s.useState(null),w=async(e,s)=>{try{b(e);const{error:n}=await ne.from("user_roles").upsert({user_id:e,role:s},{onConflict:"user_id"});if(n)throw n;v({title:_("common:success"),description:_("admin:roleUpdated")}),j()}catch(n){v({title:_("common:error"),description:_("admin:failedToUpdateRole"),variant:"destructive"})}finally{b(null)}},C=e=>{if(!e)return"";return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:_("admin:displayingUsers",{count:n.length})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(i,{children:[e.jsx(a,{children:e.jsxs(l,{children:[e.jsx(t,{children:"Email"}),e.jsx(t,{children:_("admin:role")}),e.jsx(t,{children:_("admin:zapTrips")}),e.jsx(t,{children:_("admin:zapOuts")}),e.jsx(t,{children:_("admin:zapRoads")}),e.jsx(t,{children:_("admin:createdAt")}),e.jsx(t,{className:"text-right",children:_("admin:actions")})]})}),e.jsx(o,{children:n.map((s=>e.jsxs(l,{children:[e.jsx(c,{className:"font-medium",children:s.email}),e.jsx(c,{children:e.jsx("span",{className:"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium\n                    "+("admin"===s.role?"bg-purple-100 text-purple-800":"tier4"===s.role?"bg-indigo-100 text-indigo-800":"tier3"===s.role?"bg-green-100 text-green-800":"tier2"===s.role?"bg-blue-100 text-blue-800":"tier1"===s.role?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:s.role})}),e.jsx(c,{children:s.zap_trip_count||0}),e.jsx(c,{children:s.zap_out_count||0}),e.jsx(c,{children:s.zap_road_count||0}),e.jsx(c,{children:C(s.created_at)}),e.jsx(c,{className:"text-right",children:e.jsxs(d,{children:[e.jsx(m,{asChild:!0,children:e.jsxs(r,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:_("admin:openMenu")}),e.jsx(L,{className:"h-4 w-4"})]})}),e.jsxs(h,{align:"end",children:[e.jsx(x,{children:_("admin:actions")}),e.jsx(u,{}),e.jsxs(p,{disabled:f===s.id,onClick:()=>w(s.id,"nosubs"),children:[f===s.id&&"nosubs"===s.role?e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}):null,_("admin:setAsNoSubscription")]}),e.jsxs(p,{disabled:f===s.id,onClick:()=>w(s.id,"tier1"),children:[f===s.id&&"tier1"===s.role?e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}):null,_("admin:setAsTier1")]}),e.jsxs(p,{disabled:f===s.id,onClick:()=>w(s.id,"tier2"),children:[f===s.id&&"tier2"===s.role?e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}):null,_("admin:setAsTier2")]}),e.jsxs(p,{disabled:f===s.id,onClick:()=>w(s.id,"tier3"),children:[f===s.id&&"tier3"===s.role?e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}):null,_("admin:setAsTier3")]}),e.jsxs(p,{disabled:f===s.id,onClick:()=>w(s.id,"tier4"),children:[f===s.id&&"tier4"===s.role?e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}):null,_("admin:setAsTier4")]}),e.jsxs(p,{disabled:f===s.id,onClick:()=>w(s.id,"admin"),children:[f===s.id&&"admin"===s.role?e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}):null,_("admin:setAsAdmin")]}),e.jsx(u,{}),e.jsxs(p,{className:"text-red-600",onClick:()=>g(s.id),children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),_("admin:deleteUser")]})]})]})})]},s.id)))})]})})]})}const le=H({title_en:K().min(1,"Title is required"),content_en:K().min(1,"Content is required"),title_fr:K().optional(),content_fr:K().optional(),title_es:K().optional(),content_es:K().optional(),excerpt_en:K().optional(),excerpt_fr:K().optional(),excerpt_es:K().optional(),image_url:K().url("Must be a valid URL").optional(),category:K().optional(),is_featured:G().optional(),is_published:G().default(!0)});function te(){const{t:i}=P("admin"),{toast:a}=X(),l=Q(),[t,o]=s.useState(!1),[c,d]=s.useState(null),[m,h]=s.useState(!1),[x,u]=s.useState("en"),p=Y({resolver:Z(le),defaultValues:{title_en:"",content_en:"",title_fr:"",content_fr:"",title_es:"",content_es:"",excerpt_en:"",excerpt_fr:"",excerpt_es:"",image_url:"",category:"",is_featured:!1,is_published:!0}});return e.jsxs(j,{className:"w-full",children:[e.jsx(g,{children:e.jsx(_,{children:i("createBlogPost")})}),e.jsxs(v,{children:[c&&e.jsxs(f,{variant:"destructive",className:"mb-6",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(b,{children:i("error")}),e.jsxs(y,{children:[c,e.jsx("p",{className:"mt-2",children:i("tryAgainOrContactAdmin")})]})]}),e.jsx(N,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit((async e=>{try{o(!0),d(null);const{data:s}=await ne.auth.getSession(),n=s.session?.user;if(!n)throw new Error("You must be logged in to create a blog post");const{data:r,error:t}=await ne.from("user_roles").select("role").eq("user_id",n.id).single();if(t)throw new Error("Could not verify admin permissions. Please try again.");if(!r?.role||"admin"!==r.role)throw new Error("You need admin permissions to create blog posts");const c={title_en:e.title_en,content_en:m?void 0:e.content_en,title_fr:m?void 0:e.title_fr||null,content_fr:m?void 0:e.content_fr||null,title_es:m?void 0:e.title_es||null,content_es:m?void 0:e.content_es||null,excerpt_en:e.excerpt_en||null,excerpt_fr:m?void 0:e.excerpt_fr||null,excerpt_es:m?void 0:e.excerpt_es||null,image_url:e.image_url||null,category:e.category||null,author_id:n.id,is_featured:e.is_featured||!1,is_published:e.is_published,published_at:e.is_published?(new Date).toISOString():null},{data:h,error:x}=await ne.from("blogs").insert(c).select("*").single();if(x)throw x;a({title:i("blogPostCreated"),description:i("blogPostCreatedDescription")}),l(`/admin/blog/${h.id}`)}catch(s){d(s instanceof Error?s.message:"An error occurred while creating the blog post"),a({title:i("error"),description:s instanceof Error?s.message:"An error occurred while creating the blog post",variant:"destructive"})}finally{o(!1)}})),className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{checked:m,onCheckedChange:h,id:"ai-processing"}),e.jsxs("label",{htmlFor:"ai-processing",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"Use AI Processing"]})]}),!m&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsxs(C,{value:x,onValueChange:u,children:[e.jsx(k,{className:"w-[180px]",children:e.jsx(S,{placeholder:"Select Language"})}),e.jsxs(E,{children:[e.jsx(I,{value:"en",children:"English"}),e.jsx(I,{value:"fr",children:"French"}),e.jsx(I,{value:"es",children:"Spanish"})]})]})]})]}),e.jsxs("div",{className:"en"===x||m?"block":"hidden",children:[e.jsx(T,{control:p.control,name:"title_en",render:({field:s})=>e.jsxs(F,{children:[e.jsx(A,{children:"Title (English)"}),e.jsx(z,{children:e.jsx(n,{placeholder:"Enter title in English",...s})}),e.jsx(U,{})]})}),e.jsx(T,{control:p.control,name:"content_en",render:({field:s})=>e.jsxs(F,{children:[e.jsx(A,{children:"Content (English)"}),e.jsx(z,{children:e.jsx(D,{placeholder:"Write your blog content in English",className:"min-h-[200px]",...s})}),e.jsx(U,{})]})}),e.jsx(T,{control:p.control,name:"excerpt_en",render:({field:s})=>e.jsxs(F,{children:[e.jsx(A,{children:"Excerpt (English)"}),e.jsx(z,{children:e.jsx(D,{placeholder:"Write a short excerpt in English",...s})}),e.jsx(U,{})]})})]}),!m&&"fr"===x&&e.jsxs("div",{children:[e.jsx(T,{control:p.control,name:"title_fr",render:({field:s})=>e.jsxs(F,{children:[e.jsx(A,{children:"Title (French)"}),e.jsx(z,{children:e.jsx(n,{placeholder:"Enter title in French",...s})}),e.jsx(U,{})]})}),e.jsx(T,{control:p.control,name:"content_fr",render:({field:s})=>e.jsxs(F,{children:[e.jsx(A,{children:"Content (French)"}),e.jsx(z,{children:e.jsx(D,{placeholder:"Write your blog content in French",className:"min-h-[200px]",...s})}),e.jsx(U,{})]})}),e.jsx(T,{control:p.control,name:"excerpt_fr",render:({field:s})=>e.jsxs(F,{children:[e.jsx(A,{children:"Excerpt (French)"}),e.jsx(z,{children:e.jsx(D,{placeholder:"Write a short excerpt in French",...s})}),e.jsx(U,{})]})})]}),!m&&"es"===x&&e.jsxs("div",{children:[e.jsx(T,{control:p.control,name:"title_es",render:({field:s})=>e.jsxs(F,{children:[e.jsx(A,{children:"Title (Spanish)"}),e.jsx(z,{children:e.jsx(n,{placeholder:"Enter title in Spanish",...s})}),e.jsx(U,{})]})}),e.jsx(T,{control:p.control,name:"content_es",render:({field:s})=>e.jsxs(F,{children:[e.jsx(A,{children:"Content (Spanish)"}),e.jsx(z,{children:e.jsx(D,{placeholder:"Write your blog content in Spanish",className:"min-h-[200px]",...s})}),e.jsx(U,{})]})}),e.jsx(T,{control:p.control,name:"excerpt_es",render:({field:s})=>e.jsxs(F,{children:[e.jsx(A,{children:"Excerpt (Spanish)"}),e.jsx(z,{children:e.jsx(D,{placeholder:"Write a short excerpt in Spanish",...s})}),e.jsx(U,{})]})})]}),e.jsx(T,{control:p.control,name:"image_url",render:({field:s})=>e.jsxs(F,{children:[e.jsx(A,{children:"Image URL"}),e.jsx(z,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{placeholder:"Enter image URL",...s}),e.jsx(r,{type:"button",variant:"outline",size:"icon",onClick:()=>{},children:e.jsx(M,{className:"h-4 w-4"})})]})}),e.jsx(U,{})]})}),e.jsx(T,{control:p.control,name:"category",render:({field:s})=>e.jsxs(F,{children:[e.jsx(A,{children:"Category"}),e.jsx(z,{children:e.jsx(n,{placeholder:"e.g. Travel, Food, Technology",...s})}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center",children:[e.jsx(T,{control:p.control,name:"is_featured",render:({field:s})=>e.jsxs(F,{className:"flex items-center space-x-2 space-y-0",children:[e.jsx(z,{children:e.jsx("input",{type:"checkbox",checked:s.value,onChange:s.onChange,className:"w-4 h-4"})}),e.jsx(A,{className:"font-normal",children:i("featuredPost")})]})}),e.jsx(T,{control:p.control,name:"is_published",render:({field:s})=>e.jsxs(F,{className:"flex items-center space-x-2 space-y-0",children:[e.jsx(z,{children:e.jsx("input",{type:"checkbox",checked:s.value,onChange:s.onChange,className:"w-4 h-4"})}),e.jsx(A,{className:"font-normal",children:i("publishImmediately")})]})})]}),e.jsx(r,{type:"submit",className:"w-full",disabled:t,children:t?e.jsxs(e.Fragment,{children:[i(m?"creatingAndProcessing":"creatingBlogPost"),e.jsx(R,{className:"ml-2 h-4 w-4 animate-spin"})]}):i(m?"createWithAIProcessing":"createBlogPost")})]})})]})]})}function oe({event:i,onSuccess:a}){const{t:l}=P(["admin","common"]),{isAdmin:t}=se(),o=Q(),[c,d]=s.useState(!1),[m,h]=s.useState({title:i?.title||"",content:i?.content||"",type:i?.type||"restaurant",location:i?.location||"",business_name:i?.business_name||"",url_link:i?.url_link||"",url_placeholder_image:i?.url_placeholder_image||"",priority:i?.priority||1,expiration_date:i?.expiration_date||null});s.useEffect((()=>{t||(ee.error(l("common.accessDenied")),o("/admin"))}),[t,o,l]);const x=e=>{const{name:s,value:n}=e.target;let r=n;"priority"===s&&(r=""===n?1:parseInt(n,10)),h((e=>({...e,[s]:r})))};return t?e.jsxs(j,{children:[e.jsx(g,{children:e.jsx(_,{children:l(i?.id?"admin.editEvent":"admin.createEvent")})}),e.jsx(v,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),t){if(m.url_placeholder_image)try{new URL(m.url_placeholder_image)}catch(s){return void ee.error(l("admin.invalidImageUrl"))}d(!0);try{const e={...m,url_link:m.url_link||null,priority:Number(m.priority)};if(i?.id){const{data:s,error:n}=await ne.from("event_suggestion").update(e).eq("id",i.id).select();if(n)throw n;ee.success(l("admin.eventUpdated"))}else{const{data:s,error:n}=await ne.from("event_suggestion").insert([e]).select();if(n)throw n;ee.success(l("admin.eventCreated"))}a?.(),i?.id||h({title:"",content:"",type:"restaurant",location:"",business_name:"",url_link:"",url_placeholder_image:"",priority:1,expiration_date:null})}catch(s){ee.error(s.message||s.details||s.hint||l("admin.failedToSaveEvent"))}finally{d(!1)}}else ee.error(l("common.accessDenied"))},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"title",children:[l("admin.eventTitle")," *"]}),e.jsx(n,{id:"title",name:"title",value:m.title,onChange:x,required:!0,placeholder:l("admin.enterEventTitle")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"business_name",children:[l("admin.businessName")," *"]}),e.jsx(n,{id:"business_name",name:"business_name",value:m.business_name,onChange:x,required:!0,placeholder:l("admin.enterBusinessName")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"type",children:[l("admin.eventType")," *"]}),e.jsxs(C,{value:m.type,onValueChange:e=>((e,s)=>{h((n=>({...n,[e]:s})))})("type",e),children:[e.jsx(k,{children:e.jsx(S,{placeholder:l("admin.selectType")})}),e.jsx(E,{children:[{value:"hotel",label:"Hotel"},{value:"restaurant",label:"Restaurant"},{value:"bar",label:"Bar"},{value:"event",label:"Event"},{value:"activity",label:"Activity"},{value:"other",label:"Other"}].map((s=>e.jsx(I,{value:s.value,children:l(`admin.eventTypes.${s.value}`)},s.value)))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"location",children:[l("admin.location")," *"]}),e.jsx(n,{id:"location",name:"location",value:m.location,onChange:x,required:!0,placeholder:l("admin.enterLocation")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"priority",children:l("admin.priority")}),e.jsx(n,{id:"priority",name:"priority",type:"number",min:"1",max:"10",value:m.priority,onChange:x,placeholder:l("admin.enterPriority")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"expiration_date",children:l("admin.expirationDate")}),e.jsx(n,{id:"expiration_date",name:"expiration_date",type:"datetime-local",value:m.expiration_date?m.expiration_date.slice(0,16):"",onChange:x,min:(new Date).toISOString().slice(0,16),placeholder:l("admin.selectExpirationDate")}),e.jsx("p",{className:"text-sm text-gray-500",children:l("admin.expirationDateHelp")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"url_link",children:l("admin.urlLink")}),e.jsx(n,{id:"url_link",name:"url_link",value:m.url_link||"",onChange:x,placeholder:l("admin.enterUrlLink")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"url_placeholder_image",children:[l("admin.imageUrl")," *"]}),e.jsx(n,{id:"url_placeholder_image",name:"url_placeholder_image",value:m.url_placeholder_image,onChange:x,required:!0,placeholder:l("admin.enterImageUrl")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"content",children:[l("admin.content")," *"]}),e.jsx(D,{id:"content",name:"content",value:m.content,onChange:x,required:!0,placeholder:l("admin.enterContent"),className:"min-h-[100px]"})]}),m.url_placeholder_image&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{children:l("admin.imagePreview")}),e.jsx("div",{className:"relative aspect-[16/10] overflow-hidden rounded-lg",children:e.jsx("img",{src:m.url_placeholder_image,alt:m.title,className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder-image.jpg"}})})]}),e.jsx(r,{type:"submit",className:"w-full md:w-auto",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:l("common.loading")}),e.jsx("span",{className:"animate-spin",children:"⏳"})]}):l(i?.id?"admin.updateEvent":"admin.createEvent")})]})})]}):null}export{te as B,oe as E,ie as U,ae as a,re as c,ne as s};
//# sourceMappingURL=components-admin.CiIAoamg.js.map
