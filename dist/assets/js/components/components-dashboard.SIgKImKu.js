import{j as e,r as t}from"../vendor/vendor-react-core.D1hcyiwY.js";import{u as s}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{B as a,V as r,$ as i,a0 as l,a1 as n,p as o,q as c,r as d,s as m,t as p,ai as x,G as u,J as h,K as f,M as j,ab as y,aj as g,W as N}from"./components-ui.C8hnNhgu.js";import{X as v,f as b,$ as w,F,a0 as T,C,L as k,T as O,a1 as D,a2 as M,a3 as _,M as A,a4 as R,a5 as S,a6 as z,a7 as I,a8 as Z,P as L}from"../vendor/vendor--lucide-react.DRw9PYsu.js";import{f as $,p as E,i as P,e as J,a as V,b as W}from"../vendor/vendor--date-fns.BbAlDtqN.js";import{M as q}from"../vendor/vendor--react-markdown.C_e4o-CH.js";import{m as B}from"../vendor/vendor--framer-motion.Dpgjd5L1.js";import{L as H,u as Y}from"../vendor/vendor--react-router.Gdfmkz0l.js";import{s as G}from"./components-admin.CiIAoamg.js";import{u as Q}from"../hooks/hooks-use-toast.ts.Dg8obzHg.js";const K=({fullName:t,userRole:a,hasFreeTrip:r})=>{const{t:i}=s("dashboard"),l=t?.split(" ")[0];return e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[i("welcome"),l?` ${l}`:"","!"]}),e.jsx("p",{className:"text-gray-600",children:i("planAdventure")})]})})},X=({isFilterActive:t,dateFilter:i,locationFilter:l,activityFilter:n,tripTypeFilter:o,clearFilters:c,setDateFilter:d,setLocationFilter:m,setActivityFilter:p,setTripTypeFilter:x})=>{const{t:u}=s("dashboard");return t?e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs(a,{variant:"outline",size:"sm",onClick:c,className:"flex items-center gap-1",children:[e.jsx(v,{className:"h-4 w-4"}),u("clearFilters")]}),i&&e.jsxs(r,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-3 w-3"}),$(i,"MMM dd, yyyy"),e.jsx("button",{onClick:()=>d(void 0),className:"ml-1",children:e.jsx(v,{className:"h-3 w-3"})})]}),l&&e.jsxs(r,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),l,e.jsx("button",{onClick:()=>m(""),className:"ml-1",children:e.jsx(v,{className:"h-3 w-3"})})]}),n&&e.jsxs(r,{variant:"secondary",className:"flex items-center gap-1",children:[n,e.jsx("button",{onClick:()=>p(""),className:"ml-1",children:e.jsx(v,{className:"h-3 w-3"})})]}),o&&e.jsxs(r,{variant:"secondary",className:"flex items-center gap-1",children:[o,e.jsx("button",{onClick:()=>x(""),className:"ml-1",children:e.jsx(v,{className:"h-3 w-3"})})]})]}):null},U=({locationFilter:t,dateFilter:r,activityFilter:u,tripTypeFilter:h,locations:f,categories:j,tripTypes:y,setLocationFilter:g,setDateFilter:N,setActivityFilter:v,setTripTypeFilter:b,isFilterOpen:w,setIsFilterOpen:T,applyFilters:C,clearFilters:k})=>{const{t:O}=s("dashboard");return e.jsxs(i,{open:w,onOpenChange:T,children:[e.jsx(l,{asChild:!0,children:e.jsxs(a,{variant:"outline",size:"sm",className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4"}),O("filter.apply")]})}),e.jsx(n,{className:"w-[calc(100vw-2rem)] md:w-80 p-4 bg-white shadow-lg rounded-md border z-50",align:"end",sideOffset:8,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium text-sm",children:O("filter.apply")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:O("filter.location")}),e.jsxs(o,{value:t,onValueChange:g,children:[e.jsx(c,{className:"h-8 text-xs",children:e.jsx(d,{placeholder:O("filter.allLocations")})}),e.jsxs(m,{position:"popper",className:"z-[60]",children:[e.jsx(p,{value:"",children:O("filter.allLocations")}),f.map((t=>e.jsx(p,{value:t,children:t},t)))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:O("filter.date")}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs(i,{children:[e.jsx(l,{asChild:!0,children:e.jsx(a,{variant:"outline",size:"sm",className:"h-8 text-xs justify-start text-left font-normal "+(r?"":"text-muted-foreground"),children:r?r.toLocaleDateString():O("filter.date")})}),e.jsx(n,{className:"w-auto p-0 z-[70]",align:"start",children:e.jsx(x,{mode:"single",selected:r,onSelect:N,initialFocus:!0})})]}),r&&e.jsx(a,{variant:"ghost",size:"sm",className:"text-xs h-6 mt-1 self-end",onClick:()=>N(void 0),children:O("filter.clear")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:O("filter.activity")}),e.jsxs(o,{value:u,onValueChange:v,children:[e.jsx(c,{className:"h-8 text-xs",children:e.jsx(d,{placeholder:O("filter.allCategories")})}),e.jsxs(m,{position:"popper",className:"z-[60]",children:[e.jsx(p,{value:"",children:O("filter.allCategories")}),j.map((t=>e.jsx(p,{value:t,children:t},t)))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:O("filter.tripType")}),e.jsxs(o,{value:h,onValueChange:b,children:[e.jsx(c,{className:"h-8 text-xs",children:e.jsx(d,{placeholder:O("filter.allTripTypes")})}),e.jsxs(m,{position:"popper",className:"z-[60]",children:[e.jsx(p,{value:"",children:O("filter.allTripTypes")}),y.map((t=>e.jsx(p,{value:t,children:t},t)))]})]})]}),e.jsxs("div",{className:"flex space-x-2 pt-2",children:[e.jsx(a,{variant:"outline",onClick:k,className:"text-xs h-8 flex-1",children:O("filter.clear")}),e.jsx(a,{onClick:C,className:"text-xs h-8 flex-1",children:O("filter.apply")})]})]})})]})},ee=({sortOrder:t,setSortOrder:r})=>{const{t:i}=s("dashboard");return e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>r("newest"===t?"oldest":"newest"),className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-4 w-4"}),i("newest"===t?"filter.newest":"filter.oldest")]})},te=({locationFilter:t,dateFilter:s,activityFilter:a,tripTypeFilter:r,sortOrder:i,isFilterActive:l,isFilterOpen:n,locations:o,categories:c,tripTypes:d,setLocationFilter:m,setDateFilter:p,setActivityFilter:x,setTripTypeFilter:u,setSortOrder:h,setIsFilterOpen:f,applyFilters:j,clearFilters:y})=>e.jsx("div",{className:"flex flex-col gap-4 w-full",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsx(X,{isFilterActive:l,dateFilter:s,locationFilter:t,activityFilter:a,tripTypeFilter:r,clearFilters:y,setDateFilter:p,setLocationFilter:m,setActivityFilter:x,setTripTypeFilter:u}),e.jsxs("div",{className:"flex gap-2 self-end sm:self-auto",children:[e.jsx(U,{locationFilter:t,dateFilter:s,activityFilter:a,tripTypeFilter:r,locations:o,categories:c,tripTypes:d,setLocationFilter:m,setDateFilter:p,setActivityFilter:x,setTripTypeFilter:u,isFilterOpen:n,setIsFilterOpen:f,applyFilters:j,clearFilters:y}),e.jsx(ee,{sortOrder:i,setSortOrder:h})]})]})}),se=({open:t,onOpenChange:r,tripTitle:i,onConfirm:l,isDeleting:n=!1})=>{const{t:o}=s("dashboard");return e.jsx(u,{open:t,onOpenChange:r,children:e.jsxs(h,{className:"sm:max-w-md",children:[e.jsxs(f,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-destructive"}),o("trip.deletion.confirmQuestion")]}),e.jsx(y,{children:o("trip.deletion.confirmDescription")})]}),e.jsxs(g,{className:"sm:justify-between mt-4",children:[e.jsx(a,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:n,children:o("trip.deletion.cancel")}),e.jsxs(a,{type:"button",variant:"destructive",onClick:l,className:"gap-2",disabled:n,children:[n?e.jsx(k,{className:"h-4 w-4 animate-spin"}):e.jsx(O,{className:"h-4 w-4"}),o(n?"trip.deletion.deleting":"trip.deletion.confirm")]})]})]})})},ae=({tripType:t})=>{const{t:a}=s("trip");if(!t)return null;return e.jsx(r,{variant:"outline",className:`${(()=>{switch(t){case"ZapOut":return"bg-emerald-100 text-emerald-800 border border-emerald-200 hover:bg-emerald-200";case"ZapRoad":return"bg-amber-100 text-amber-800 border border-amber-200 hover:bg-amber-200";default:return"bg-sky-100 text-sky-800 border border-sky-200 hover:bg-sky-200"}})()} font-medium px-3 py-1`,children:(()=>{switch(t){case"ZapOut":return"ZapOut ";case"ZapRoad":return"ZapRoad";default:return"ZapTrip"}})()})},re=({title:t,tripType:s})=>e.jsxs("div",{className:`${(()=>{switch(s){case"ZapOut":return"bg-gradient-to-r from-emerald-500 to-emerald-600";case"ZapRoad":return"bg-gradient-to-r from-amber-500 to-amber-600";default:return"bg-gradient-to-r from-sky-500 to-sky-600"}})()} px-5 py-3 text-primary-foreground flex justify-between items-center shadow-sm rounded-t-lg`,children:[e.jsxs("div",{className:"flex items-center space-x-1 max-w-[70%]",children:[(()=>{switch(s){case"ZapOut":return e.jsx(_,{className:"h-5 w-5 mr-2 text-white/90"});case"ZapRoad":return e.jsx(M,{className:"h-5 w-5 mr-2 text-white/90"});default:return e.jsx(D,{className:"h-5 w-5 mr-2 text-white/90"})}})(),e.jsx("h2",{className:"text-lg font-semibold truncate",children:t})]}),s&&e.jsx(ae,{tripType:s})]}),ie=({coordinates:s,location:a,tripId:r,tripTitle:i})=>{const[l,n]=t.useState(null),[o,c]=t.useState("");return t.useEffect((()=>{const e=(e=>{if(!e)return null;try{if(Array.isArray(e)&&2===e.length){const[t,s]=e;if("number"==typeof t&&"number"==typeof s&&!isNaN(t)&&!isNaN(s))return[t,s]}if("string"==typeof e){try{const t=JSON.parse(e);if(Array.isArray(t)&&2===t.length){const[e,s]=t;if("number"==typeof e&&"number"==typeof s&&!isNaN(e)&&!isNaN(s))return[e,s]}}catch{}if(e.includes(",")){const t=e.split(",").map((e=>parseFloat(e.trim())));if(2===t.length&&!isNaN(t[0])&&!isNaN(t[1]))return[t[0],t[1]]}}if("object"==typeof e&&null!==e){if("lat"in e&&"lng"in e){const{lat:t,lng:s}=e;if("number"==typeof t&&"number"==typeof s&&!isNaN(t)&&!isNaN(s))return[s,t]}if("latitude"in e&&"longitude"in e){const{latitude:t,longitude:s}=e;if("number"==typeof t&&"number"==typeof s&&!isNaN(t)&&!isNaN(s))return[s,t]}}return null}catch(t){return null}})(s);n(e||null)}),[r,s,i,a]),t.useEffect((()=>{if(l){const e="pk.eyJ1IjoibWlzdGVyZnJhenoiLCJhIjoiY203M2ZnM3BoMDhpMTJqcTNiYWpkamIzNyJ9.2SlcuEPIL2yCJw5TIPunVQ",t=`https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/${`pin-s+3b82f6(${l[0]},${l[1]})`}/${l[0]},${l[1]},12/400x144?access_token=${e}`;c(t)}}),[l]),l?e.jsx("div",{className:"w-full h-36 dashboard-card-map",children:e.jsx("img",{src:o,alt:`Map of ${a||"location"}`,className:"w-full h-full border-b object-cover dashboard-trip-map",loading:"lazy"})}):e.jsxs("div",{className:"w-full h-36 bg-gray-100 flex flex-col items-center justify-center",children:[e.jsx(A,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No location set"})]})};const le=({content:t})=>{const{t:a}=s("trip");if(!t)return null;const r=function(e){const t=e.match(/\[PREVIEW\]([\s\S]*?)\[\/PREVIEW\]/i);return t?t[1].trim():null}(t),i=r||t;return e.jsxs("div",{className:"mt-4 p-5 bg-gradient-to-br from-gray-50 to-gray-100/80 rounded-xl border border-gray-200/50 shadow-sm min-h-[16rem]",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center",children:[e.jsx("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-primary/70 mr-2"}),a("aiContent.travelTips")]}),e.jsx("div",{className:"text-sm text-gray-600 prose prose-sm max-w-none line-clamp-4 sm:line-clamp-4 md:line-clamp-6 lg:line-clamp-8 prose-a:text-blue-600 prose-a:underline hover:prose-a:text-blue-800 leading-relaxed",children:e.jsx(q,{children:(e=>{const t=e.split("\n").filter((e=>""!==e.trim()));return t.slice(0,4).join("\n")+(t.length>4?"...":"")})(i)})})]})},ne=()=>{const{t:t}=s("common");return e.jsxs("div",{className:"relative h-12 w-full overflow-hidden rounded-md",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-blue-400 via-blue-300 to-blue-100"}),e.jsx(B.div,{className:"absolute top-2 right-6",initial:{opacity:.7,scale:.9},animate:{opacity:1,scale:1.1},transition:{duration:3,repeat:1/0,repeatType:"reverse"},children:e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"h-5 w-5 text-yellow-400"}),e.jsx(B.div,{className:"absolute inset-0 rounded-full bg-yellow-200 opacity-30",initial:{scale:1},animate:{scale:1.5},transition:{duration:2,repeat:1/0,repeatType:"reverse"}})]})}),e.jsx(B.div,{className:"absolute top-2 left-10",initial:{x:-30},animate:{x:100},transition:{duration:20,repeat:1/0,repeatType:"loop"},children:e.jsx(S,{className:"h-3 w-3 text-white"})}),e.jsx(B.div,{className:"absolute top-3 left-24",initial:{x:-20},animate:{x:80},transition:{duration:15,repeat:1/0,repeatType:"loop",delay:2},children:e.jsx(S,{className:"h-2 w-2 text-white"})}),e.jsx(B.div,{className:"absolute top-1 left-5",initial:{x:-10},animate:{x:60},transition:{duration:18,repeat:1/0,repeatType:"loop",delay:1},children:e.jsx(S,{className:"h-2 w-2 text-white"})}),e.jsx(B.div,{className:"absolute bottom-0 w-full h-3 flex items-end",initial:{y:0},animate:{y:-1},transition:{duration:1.5,repeat:1/0,repeatType:"reverse"},children:e.jsx(z,{className:"w-full h-full text-blue-500"})}),e.jsxs("div",{className:"absolute bottom-2 w-full flex justify-between",children:[e.jsx(I,{className:"h-4 w-4 text-emerald-700"}),e.jsx(I,{className:"h-6 w-6 text-emerald-800"}),e.jsx(I,{className:"h-3 w-3 text-emerald-600"}),e.jsx(I,{className:"h-5 w-5 text-emerald-700"}),e.jsx(I,{className:"h-4 w-4 text-emerald-800"})]}),e.jsx(B.div,{className:"absolute bottom-3 right-8",initial:{y:-2},animate:{y:0},transition:{duration:1,repeat:1/0,repeatType:"reverse"},children:e.jsx(A,{className:"h-4 w-4 text-red-500"})}),e.jsx(B.div,{className:"absolute top-2 left-2",animate:{rotate:360},transition:{duration:10,repeat:1/0,ease:"linear"},children:e.jsx(Z,{className:"h-3 w-3 text-gray-700"})}),e.jsx(B.div,{className:"absolute",initial:{x:-30,y:15},animate:{x:150,y:10},transition:{duration:4,repeat:1/0,repeatType:"loop"},children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"h-5 w-5 text-gray-700 transform rotate-12"}),e.jsx(B.div,{className:"absolute top-1/2 right-full w-10 h-0.5 bg-gradient-to-r from-transparent to-white opacity-50",initial:{width:0},animate:{width:10},transition:{duration:.3,repeat:1/0,repeatType:"loop"}})]})})]})},oe=t=>{try{const s=document.createElement("div");s.innerHTML=t;const a=[];let r=0;for(let t=0;t<s.childNodes.length;t++){const i=s.childNodes[t];if(i.nodeType===Node.TEXT_NODE){const e=i.textContent||"";e.trim()&&a.push(e)}else if(i.nodeType===Node.ELEMENT_NODE){const t=i;if("a"===t.tagName.toLowerCase()){const s=t.getAttribute("href"),i=t.getAttribute("class")||"",l=t.textContent||"";s&&ce(s)?a.push(e.jsx(H,{to:s,className:i,onClick:e=>e.stopPropagation(),children:l},"link-"+r++)):a.push(l)}else a.push(t.textContent||"")}}return a}catch(s){return[t]}},ce=e=>e.startsWith("/")&&!e.includes("javascript:")&&!e.includes("data:"),de=({title:a,description:r,startDate:i,endDate:l,location:n,aiContent:o,tripType:c,isAiContentLoading:d=!1,zapOutDate:m})=>{const{t:p,i18n:x}=s("trip"),[u,h]=t.useState("Loading travel information..."),f=t.useRef([]),j=t.useRef([]),y=t.useRef(null),g=t.useCallback((()=>{const e=f.current;if(!e.length)return;j.current.length>=e.length-1&&(j.current=[]);const t=Array.from({length:e.length},((e,t)=>t)).filter((e=>!j.current.includes(e))),s=t[Math.floor(Math.random()*t.length)];j.current.push(s),h(e[s])}),[]),v=t.useCallback((()=>{y.current&&clearInterval(y.current),y.current=setInterval((()=>{g()}),4e3)}),[g]);t.useEffect((()=>{try{let t;try{t=p("trip.aiContent.waitMessages",{returnObjects:!0})}catch(e){}if(!Array.isArray(t)||0===t.length)try{t=p("trip:aiContent.waitMessages",{returnObjects:!0})}catch(e){}const s=[p("aiContent.waitMessages.0"),p("aiContent.waitMessages.1"),p("aiContent.waitMessages.2"),p("aiContent.waitMessages.3"),p("aiContent.waitMessages.4"),p("aiContent.waitMessages.5"),p("aiContent.waitMessages.6"),p("aiContent.waitMessages.7"),p("aiContent.waitMessages.8"),p("aiContent.waitMessages.9")],a=Array.isArray(t)&&t.length>0?t.filter((e=>"string"==typeof e)):s;f.current=a,g()}catch(t){f.current=[p("aiContent.waitMessages.0"),p("aiContent.waitMessages.1"),p("aiContent.waitMessages.2")],g()}return v(),()=>{y.current&&clearInterval(y.current)}}),[p,x.language,g,v]),t.useEffect((()=>(d?v():y.current&&(clearInterval(y.current),y.current=null),()=>{y.current&&clearInterval(y.current)})),[d,v]);const w=e=>{try{if(!e)return"";const t=E(e);if(P(t)){let e=J;return"fr"===x.language?e=V:"es"===x.language&&(e=W),$(t,"PPP",{locale:e})}return e}catch(t){return""}};return e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 line-clamp-1",children:a})}),e.jsx("div",{className:"text-sm text-gray-500 line-clamp-2 mb-3",children:r}),d&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"bg-gradient-to-r from-emerald-700/60 to-emerald-800/60 rounded-lg p-3 border border-emerald-600/50 shadow-lg shadow-emerald-700/25",children:e.jsxs("p",{className:"text-sm text-emerald-50 font-medium flex items-center justify-center gap-2",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-emerald-300 animate-pulse"}),p("aiContent.emailNotification","We'll send you an email when your adventure is ready! ✨")]})})}),!d&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-2",children:[e.jsx(b,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"font-medium mr-2",children:p("ZapOut"===c?"types.zapOut.when":"ZapRoad"===c?"types.zapRoad.dates":"form.date")}),e.jsx("span",{children:w("ZapOut"===c&&m?m:i)}),"ZapOut"!==c&&l&&l!==i&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1",children:"-"}),e.jsx("span",{children:w(l)})]})]}),n&&!d&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-3",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"line-clamp-1",children:n})]}),d?e.jsxs("div",{className:"mt-4 p-5 bg-gradient-to-br from-blue-900/60 to-indigo-900/60 rounded-xl border border-blue-700/20 relative shadow-lg shadow-blue-900/10 backdrop-blur-sm min-h-[16rem] h-[16rem]",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("h3",{className:"text-sm font-semibold text-blue-100 flex items-center",children:[e.jsx("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-blue-400 mr-2"}),p("aiContent.travelTips")]})}),e.jsx("div",{className:"my-3 h-12",children:e.jsx(ne,{})}),e.jsx("div",{className:"mt-4 text-center h-[8rem] flex items-center justify-center mb-3 px-2",children:e.jsxs("div",{className:"text-sm font-medium text-blue-50 whitespace-normal break-words px-5 py-2 rounded-lg bg-white/15 inline-block shadow-inner shadow-blue-500/10 transition-all duration-500 leading-relaxed border border-white/15 max-w-[90%]",children:[e.jsx("div",{className:"mb-3",children:e.jsx("p",{className:"text-blue-50",children:u})}),e.jsx("div",{className:"text-xs text-blue-200",children:oe(p("aiContent.waitingMessage","While you're waiting, visit the ZapMap, travel blogs or the Community!"))})]})}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx(N,{className:"h-4 w-full bg-white/10 rounded-md"}),e.jsx(N,{className:"h-4 w-3/4 bg-white/10 rounded-md"})]})]}):o&&e.jsx(le,{content:o})]})},me=({onClick:t})=>e.jsx(a,{variant:"destructive",size:"icon",className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-20",onClick:t,"aria-label":"Delete trip",children:e.jsx(O,{className:"h-4 w-4"})});function pe({trip:a,onDelete:r,userRole:i,hasFreeTrip:l}){const n=Y(),{toast:o}=Q(),[c,d]=t.useState(!1),[m,p]=t.useState(!1),[x,u]=t.useState(!1),[h,f]=t.useState(a.ai_content),j=t.useRef(null),y=t.useRef(0),{i18n:g}=s(),N=g.language,v=t.useCallback((async()=>{if(a.id)try{let e;if(y.current+=1,"ZapOut"===a.trip_type){const{data:t}=await G.from("zapout_data").select("ai_content").eq("id",a.id).single();e=t}else if("ZapRoad"===a.trip_type){const{data:t}=await G.from("zaproad_data").select("ai_content").eq("id",a.id).single();e=t}else{const{data:t}=await G.from("trips").select("ai_content").eq("id",a.id).single();e=t}e&&e.ai_content?(f(e.ai_content),j.current&&(clearInterval(j.current),j.current=null),u(!1)):y.current>=60&&(u(!1),j.current&&(clearInterval(j.current),j.current=null),o({title:"Note",description:"AI content generation is taking longer than expected. Please refresh the page later."}))}catch(e){}}),[a.id,a.trip_type,o]);return t.useEffect((()=>(h||(u(!0),v(),j.current=setInterval(v,5e3)),()=>{j.current&&(clearInterval(j.current),j.current=null)})),[h,v]),e.jsxs(e.Fragment,{children:[e.jsxs(B.div,{className:"bg-white rounded-lg shadow-md overflow-hidden relative group "+(x?"cursor-not-allowed":"cursor-pointer hover:shadow-lg"),whileHover:{scale:x?1:1.02},transition:{duration:.3},onClick:()=>{"ZapOut"===a.trip_type?n(`/${N}/zapout/${a.id}`):"ZapRoad"===a.trip_type?n(`/${N}/zaproad/${a.id}`):n(`/${N}/trips/${a.id}`)},children:[x&&e.jsx("div",{className:"absolute inset-0 bg-black/30 z-10"}),e.jsx(re,{title:a.title,tripType:a.trip_type}),e.jsx(me,{onClick:e=>{e.stopPropagation(),d(!0)}}),e.jsx("div",{className:"relative",children:e.jsx(ie,{coordinates:a.coordinates,location:a.location,tripId:a.id,tripTitle:a.title})}),e.jsx("div",{className:"relative "+(x?"z-20":""),children:e.jsx(de,{title:a.title,description:a.description,startDate:a.start_date,endDate:a.end_date,location:a.location,aiContent:h,tripType:a.trip_type,zapOutDate:"ZapOut"===a.trip_type?a.date:void 0,isAiContentLoading:x})})]}),e.jsx(se,{open:c,onOpenChange:d,tripTitle:a.title,onConfirm:async()=>{try{p(!0);const e=await r(a.id);return e&&d(!1),e}catch(e){return!1}finally{p(!1)}},isDeleting:m})]})}const xe=({trips:t,filteredTrips:r,onDeleteTrip:i,clearFilters:l,userRole:n,hasFreeTrip:o})=>{const{t:c}=s("dashboard");return 0===t.length?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-600",children:c("trip.empty.noneYet")})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.length>0?r.map((t=>e.jsx(pe,{trip:t,onDelete:i,userRole:n,hasFreeTrip:o},t.id))):e.jsxs("div",{className:"col-span-3 text-center py-8",children:[e.jsx("p",{className:"text-gray-500",children:c("trip.filter.noResults")}),e.jsx(a,{variant:"link",onClick:l,children:c("clearFilters")})]})})},ue=({trips:a,onDeleteTrip:r,userRole:i,hasFreeTrip:l})=>{const{t:n}=s("dashboard"),[o,c]=t.useState(""),[d,m]=t.useState(void 0),[p,x]=t.useState(""),[u,h]=t.useState("newest"),[f,j]=t.useState(""),[y,g]=t.useState(!1),[N,v]=t.useState(!1),w=a.filter((e=>{if(o&&e.location&&!e.location.toLowerCase().includes(o.toLowerCase()))return!1;if(d&&e.start_date){const t=new Date(e.start_date),s=new Date(d);if(t.setHours(0,0,0,0),s.setHours(0,0,0,0),t.getTime()!==s.getTime())return!1}return(!p||!e.category||e.category===p)&&(!f||!e.trip_type||e.trip_type===f)})).sort(((e,t)=>{const s=new Date(e.created_at).getTime(),a=new Date(t.created_at).getTime();return"newest"===u?a-s:s-a})),F=()=>{c(""),m(void 0),x(""),j(""),g(!1)},T=Array.from(new Set(a.filter((e=>e.category)).map((e=>e.category)))).filter(Boolean),C=Array.from(new Set(a.filter((e=>e.location)).map((e=>e.location)))).filter(Boolean),k=Array.from(new Set(a.filter((e=>e.trip_type)).map((e=>e.trip_type)))).filter(Boolean);return 0===a.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"mx-auto h-12 w-12 text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-600",children:n("trip.empty.noneYet")})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{locationFilter:o,dateFilter:d,activityFilter:p,tripTypeFilter:f,sortOrder:u,isFilterActive:y,isFilterOpen:N,locations:C,categories:T,tripTypes:k,setLocationFilter:c,setDateFilter:m,setActivityFilter:x,setTripTypeFilter:j,setSortOrder:h,setIsFilterOpen:v,applyFilters:()=>{g(!!(o||d||p||f)),v(!1)},clearFilters:F}),e.jsx(xe,{trips:a,filteredTrips:w,onDeleteTrip:r,clearFilters:F,userRole:i,hasFreeTrip:l})]})};function he({loading:t,trips:a,fullName:r,onTripCreated:i,onDeleteTrip:l,userRole:n,hasFreeTrip:o}){const{t:c}=s("dashboard");if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(k,{className:"h-8 w-8 animate-spin"})});const d=a;return e.jsxs(B.div,{className:"container mx-auto p-8",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(K,{fullName:r,onTripCreated:i,userRole:n,hasFreeTrip:o}),t?e.jsx("p",{className:"text-center text-gray-500",children:c("loading")}):e.jsx(ue,{trips:d,onDeleteTrip:l,userRole:n,hasFreeTrip:o})]})}export{he as D};
//# sourceMappingURL=components-dashboard.SIgKImKu.js.map
