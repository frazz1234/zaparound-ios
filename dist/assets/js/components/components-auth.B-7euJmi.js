import{r as e,j as s}from"../vendor/vendor-react-core.D1hcyiwY.js";import{L as a,I as t,B as r,p as i,q as l,r as n,s as o,t as c,E as d,G as m,H as u,J as h,K as p,M as x,N as g,O as v,P as f,Q as j}from"./components-ui.C8hnNhgu.js";import{s as w}from"./components-admin.CiIAoamg.js";import{u as N}from"../hooks/hooks-use-toast.ts.Dg8obzHg.js";import{H as y}from"../vendor/vendor---hcaptcha-react-hcaptcha.BYNRmVb_.js";import{u as b}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{C as S,b as P,U as E,H as k,c as U,d as C}from"../vendor/vendor--lucide-react.DRw9PYsu.js";import{R as q}from"../vendor/vendor--react-google-recaptcha.BxiZqK6Z.js";import{L as M}from"./components-trips.Ce9sOLST.js";import{A as F,m as I}from"../vendor/vendor--framer-motion.Dpgjd5L1.js";import{F as R}from"../vendor/vendor-supabase-other.BhmW1H_P.js";function B({email:i,setEmail:l,password:n,setPassword:o,onForgotPassword:c,onSuccess:d,errorMessage:m,setErrorMessage:u}){const{toast:h}=N(),{t:p}=b("auth"),[x,g]=e.useState(!1),[v,f]=e.useState(null),[j,P]=e.useState(!1);return s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),g(!0),u("");try{if(j&&!v)return u(p("validation.captchaRequired")),void g(!1);const{error:e}=await w.auth.signInWithPassword({email:i,password:n,options:{captchaToken:v||void 0}});if(e)return e.message.includes("captcha")?(P(!0),void u(p("errors.captchaFailed"))):void(e.message.includes("Invalid login credentials")?u(p("errors.invalidCredentials")):u(e.message));d()}catch(s){h({title:p("errors.default"),description:m||s.message||p("errors.default"),variant:"destructive"})}finally{g(!1)}},className:"space-y-4",children:[m&&s.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md flex items-center text-red-700",children:[s.jsx(S,{className:"h-5 w-5 mr-2 flex-shrink-0"}),s.jsxs("div",{className:"text-sm",children:[s.jsx("p",{children:m}),m===p("errors.invalidCredentials")&&s.jsx("p",{className:"mt-1",children:s.jsx("button",{type:"button",onClick:c,className:"text-blue-600 hover:underline",children:p("signIn.forgotPassword")})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"email",children:p("signIn.email")}),s.jsx(t,{id:"email",type:"email",name:"username",autoComplete:"username",placeholder:p("signIn.emailPlaceholder"),value:i,onChange:e=>l(e.target.value),required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"password",children:p("signIn.password")}),s.jsx(t,{id:"password",type:"password",name:"current-password",autoComplete:"current-password",placeholder:p("signIn.passwordPlaceholder"),value:n,onChange:e=>o(e.target.value),required:!0})]}),j&&s.jsx("div",{className:"flex justify-center my-4",children:s.jsx("div",{className:"captcha-container",children:s.jsx(y,{sitekey:"17f0e2fe-5b64-45c0-8950-8856adb63412",onVerify:e=>{f(e)},onExpire:()=>f(null)})})}),s.jsx("div",{className:"text-right",children:s.jsx("button",{type:"button",onClick:c,className:"text-sm text-blue-600 hover:underline",children:p("signIn.forgotPassword")})}),s.jsx(r,{type:"submit",className:"w-full relative px-6 py-2 bg-gradient-to-r from-[#10B981] to-[#059669] text-white border-none hover:from-[#059669] hover:to-[#047857] hover:scale-105 transition-all duration-300 shadow-lg rounded-full font-medium tracking-wide",disabled:x,variant:"default",children:p(x?"loading":"signIn.button")})]})}function D({email:d,setEmail:m,password:u,setPassword:h,errorMessage:p,setErrorMessage:x,onSuccess:g}){const{toast:v}=N(),{t:f}=b("auth"),[j,y]=e.useState(!1),[E,k]=e.useState(!1),[U,C]=e.useState(!0),[B,D]=e.useState(null),[z,A]=e.useState(!1),[L,O]=e.useState(1),[T,V]=e.useState(""),[W,Y]=e.useState(""),[H,Q]=e.useState(""),[G,Z]=e.useState(""),[_,J]=e.useState(""),[K,$]=e.useState([0,0]),[X,ee]=e.useState(""),[se,ae]=e.useState({}),[te,re]=e.useState({});e.useEffect((()=>{const e=e=>{const s=e.target;(s.closest('iframe[src*="recaptcha"]')||s.closest('div[style*="z-index: 2000000000"]'))&&e.stopPropagation()};return document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0)}}),[]);const ie=e=>{re((s=>({...s,[e]:!0})))},le=e=>te[e]&&se[e],ne=e=>{D(e),ae(e?e=>{const{captcha:s,...a}=e;return a}:e=>({...e,captcha:f("validation.captchaRequired")}))},oe=(e,s)=>{J(e),$(s),ie("location")};return s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),re({email:!0,password:!0,confirmPassword:!0,fullName:!0,location:!0,language:!0});const s={};if(d?/\S+@\S+\.\S+/.test(d)||(s.email=f("validation.emailInvalid")):s.email=f("validation.emailRequired"),u?u.length<8&&(s.password=f("validation.passwordMinLength")):s.password=f("validation.passwordRequired"),T?T!==u&&(s.confirmPassword=f("validation.passwordMatch")):s.confirmPassword=f("validation.passwordRequired"),H||(s.firstName=f("validation.firstNameRequired")),G||(s.lastName=f("validation.lastNameRequired")),_||(s.location=f("validation.locationRequired")),X||(s.language=f("validation.languageRequired")),B||(s.captcha=f("validation.captchaRequired")),ae(s),Object.keys(s).length>0)(s.email||s.password||s.confirmPassword)&&O(1);else{y(!0),x(""),k(!1);try{const e=await w.functions.invoke("signup",{body:{email:d,password:u,first_name:H,last_name:G,location:_,language:X,newsletter_subscribed:U,captchaToken:B}});if(e.error)throw e.error;const{error:s}=await w.auth.signInWithPassword({email:d,password:u});if(s)return void v({title:f("success.signUp"),description:f("signUp.loginManually")});v({title:f("success.signUp"),description:f("signUp.welcome")}),g&&g()}catch(a){if(a instanceof R)try{const e=await a.context.json();e.error&&e.error.includes("captcha")?(A(!0),x(f("errors.captchaFailed")),D(null)):e.error&&e.error.includes("already exists")?x(f("errors.emailExists")):x(e.error||f("errors.default"))}catch(t){x(f("errors.default"))}else x(a.message||f("errors.default"));p||v({title:f("errors.default"),description:a.message||f("errors.default"),variant:"destructive"})}finally{y(!1)}}},className:"space-y-4",children:[p&&s.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md flex items-center text-red-700",children:[s.jsx(S,{className:"h-5 w-5 mr-2 flex-shrink-0"}),s.jsxs("div",{className:"text-sm",children:[s.jsx("p",{children:p}),p===f("errors.emailExists")&&s.jsxs("p",{className:"mt-1",children:[f("signUp.hasAccount")," ",s.jsx("a",{href:"#",onClick:e=>{e.preventDefault(),document.getElementById("signin-tab")?.click()},className:"text-blue-600 hover:underline",children:f("signUp.signIn")})]})]})]}),E&&s.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-md flex items-center text-green-700",children:s.jsx("div",{className:"text-sm",children:s.jsx("p",{children:f("signUp.checkEmail")})})}),s.jsx(F,{mode:"wait",children:s.jsxs(I.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},transition:{duration:.3},children:[1===L&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"email",children:f("signUp.email")}),s.jsx(t,{id:"email",type:"email",name:"username",autoComplete:"username",placeholder:f("signUp.emailPlaceholder"),value:d,onChange:e=>m(e.target.value),onBlur:()=>ie("email"),required:!0,className:le("email")?"border-red-500":""}),le("email")&&s.jsx("p",{className:"text-sm text-red-500",children:se.email})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"confirmEmail",children:f("signUp.confirmEmail")}),s.jsx(t,{id:"confirmEmail",type:"email",name:"confirm-email",placeholder:f("signUp.confirmEmailPlaceholder"),value:W,onChange:e=>Y(e.target.value),onBlur:()=>ie("confirmEmail"),required:!0,className:le("confirmEmail")?"border-red-500":""}),le("confirmEmail")&&s.jsx("p",{className:"text-sm text-red-500",children:se.confirmEmail})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"password",children:f("signUp.password")}),s.jsx(t,{id:"password",type:"password",name:"new-password",autoComplete:"new-password",placeholder:f("signUp.passwordPlaceholder"),value:u,onChange:e=>h(e.target.value),onBlur:()=>ie("password"),required:!0,className:le("password")?"border-red-500":""}),le("password")&&s.jsx("p",{className:"text-sm text-red-500",children:se.password})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"confirmPassword",children:f("signUp.confirmPassword")}),s.jsx(t,{id:"confirmPassword",type:"password",name:"confirm-password",autoComplete:"new-password",placeholder:f("signUp.confirmPasswordPlaceholder"),value:T,onChange:e=>V(e.target.value),onBlur:()=>ie("confirmPassword"),required:!0,className:le("confirmPassword")?"border-red-500":""}),le("confirmPassword")&&s.jsx("p",{className:"text-sm text-red-500",children:se.confirmPassword})]})]}),2===L&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"firstName",children:f("signUp.firstName")}),s.jsx(t,{id:"firstName",type:"text",placeholder:f("signUp.firstNamePlaceholder"),value:H,onChange:e=>Q(e.target.value),onBlur:()=>ie("firstName"),required:!0,className:le("firstName")?"border-red-500":""}),le("firstName")&&s.jsx("p",{className:"text-sm text-red-500",children:se.firstName})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"lastName",children:f("signUp.lastName")}),s.jsx(t,{id:"lastName",type:"text",placeholder:f("signUp.lastNamePlaceholder"),value:G,onChange:e=>Z(e.target.value),onBlur:()=>ie("lastName"),required:!0,className:le("lastName")?"border-red-500":""}),le("lastName")&&s.jsx("p",{className:"text-sm text-red-500",children:se.lastName})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"location",children:f("signUp.location")}),s.jsx(M,{value:_,onChange:oe,className:le("location")?"border-red-500":""}),le("location")&&s.jsx("p",{className:"text-sm text-red-500",children:se.location})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"language",children:f("signUp.language")}),s.jsxs(i,{value:X,onValueChange:e=>{ee(e),ie("language")},children:[s.jsx(l,{id:"language",className:le("language")?"border-red-500":"",children:s.jsx(n,{placeholder:f("signUp.languagePlaceholder")})}),s.jsxs(o,{className:"z-[200]",children:[s.jsx(c,{value:"en",children:"English"}),s.jsx(c,{value:"fr",children:"Français"}),s.jsx(c,{value:"es",children:"Español"})]})]}),le("language")&&s.jsx("p",{className:"text-sm text-red-500",children:se.language})]}),s.jsx("div",{className:"flex justify-center my-4",children:s.jsx("div",{className:"relative z-[9999]",children:s.jsx(q,{sitekey:"6LelQh0rAAAAAMLk0Mf99W7DKHkPhSDue0yghdF7",onChange:ne,className:"transform scale-100"})})}),se.captcha&&s.jsx("p",{className:"text-sm text-red-500 text-center",children:se.captcha})]}),3===L&&s.jsxs("div",{className:"text-center space-y-6 py-8",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("img",{src:"https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExY2N4dm16MHV5NWh0emF0NDJpNHEwYWU2OGRucXlyamdpMjNjbDI0cSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3orieOSehVQs29STDi/giphy.gif",alt:"Success animation",className:"w-48 h-48 rounded-full shadow-lg mb-4"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"bg-green-100 text-green-700 rounded-full p-3",children:s.jsx(P,{className:"h-12 w-12"})})}),s.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:f("signUp.thankYouTitle")}),s.jsx("p",{className:"text-gray-600 max-w-sm mx-auto",children:f("signUp.thankYouMessage")}),s.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 mt-6 text-sm text-blue-700",children:f("signUp.checkEmailMessage")})]})]})]},L)}),s.jsxs("div",{className:"flex justify-between gap-4 mt-6",children:[L>1&&L<3&&s.jsx(r,{type:"button",variant:"outline",onClick:()=>{ae({}),re({}),O(L-1)},disabled:j,children:f("common.back")}),L<2?s.jsx(r,{type:"button",className:"w-full relative px-6 py-2 bg-gradient-to-r from-[#10B981] to-[#059669] text-white border-none hover:from-[#059669] hover:to-[#047857] hover:scale-105 transition-all duration-300 shadow-lg rounded-full font-medium tracking-wide",onClick:()=>{1===L&&re((e=>({...e,email:!0,confirmEmail:!0,password:!0,confirmPassword:!0}))),(e=>{const s={};return 1===e&&(d?/\S+@\S+\.\S+/.test(d)||(s.email=f("validation.emailInvalid")):s.email=f("validation.emailRequired"),W?W!==d&&(s.confirmEmail=f("validation.emailMatch")):s.confirmEmail=f("validation.emailRequired"),u?u.length<8&&(s.password=f("validation.passwordMinLength")):s.password=f("validation.passwordRequired"),T?T!==u&&(s.confirmPassword=f("validation.passwordMatch")):s.confirmPassword=f("validation.passwordRequired")),ae(s),0===Object.keys(s).length})(L)&&(ae({}),re({}),O(L+1))},disabled:j,children:f("common.next")}):2===L?s.jsx(r,{type:"submit",className:"w-full relative px-6 py-2 bg-gradient-to-r from-[#10B981] to-[#059669] text-white border-none hover:from-[#059669] hover:to-[#047857] hover:scale-105 transition-all duration-300 shadow-lg rounded-full font-medium tracking-wide",disabled:j,variant:"default",children:f(j?"loading":"signUp.button")}):null]})]})}function z({onSuccess:i}){const{toast:l}=N(),{t:n,i18n:o}=b("auth"),[c,m]=e.useState(""),[u,h]=e.useState(!1),[p,x]=e.useState(null),[g,v]=e.useState(!1);return s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),h(!0);try{if(!p&&g)return l({title:n("errors.default"),description:n("validation.captchaRequired"),variant:"destructive"}),void h(!1);const e=`${"https://zaparound.com"}/${o.language}/reset-password`,{error:s}=await w.auth.resetPasswordForEmail(c,{redirectTo:e,captchaToken:p||void 0});if(s){if(s.message.includes("captcha"))throw v(!0),new Error(n("errors.captchaFailed"));throw s}l({title:n("success.resetPassword"),description:n("resetPassword.subtitle")}),i()}catch(s){l({title:n("errors.default"),description:s.message||n("resetPassword.generalMessage"),variant:"destructive"}),s.message.includes("captcha")||i()}finally{h(!1)}},className:"space-y-4 mt-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"reset-email",children:n("resetPassword.email")}),s.jsx(t,{id:"reset-email",type:"email",value:c,onChange:e=>m(e.target.value),placeholder:n("resetPassword.emailPlaceholder"),required:!0})]}),g&&s.jsx("div",{className:"flex justify-center my-4",children:s.jsx("div",{className:"captcha-container",children:s.jsx(y,{sitekey:"17f0e2fe-5b64-45c0-8950-8856adb63412",onVerify:e=>{x(e)},onExpire:()=>x(null)})})}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(d,{asChild:!0,children:s.jsx(r,{type:"button",variant:"outline",children:n("resetPassword.cancel")})}),s.jsx(r,{type:"submit",disabled:u,children:n(u?"loading":"resetPassword.button")})]})]})}function A({isOpen:a,onClose:t,onSuccess:r,title:i,description:l,defaultTab:n="signin"}){const{t:o}=b("auth"),[c,d]=e.useState(n),[w,N]=e.useState(!1),[y,S]=e.useState(""),[P,q]=e.useState(""),[M,R]=e.useState(""),A=()=>{S(""),q(""),R(""),N(!1),r(),t()};return s.jsxs(m,{open:a,onOpenChange:e=>{e||(S(""),q(""),R(""),N(!1),t())},children:[s.jsx(u,{className:"bg-black/50 backdrop-blur-sm"}),s.jsxs(h,{className:"z-[110] sm:max-w-[425px] bg-white max-h-[90vh] overflow-y-auto",onInteractOutside:e=>{const s=e.target;s.closest('iframe[src*="recaptcha"]')||s.closest('div[style*="z-index: 2000000000"]')||s.closest(".grecaptcha-badge")||s.closest('[title*="recaptcha"]')||e.preventDefault()},children:[s.jsxs(p,{className:"space-y-4",children:[s.jsx(x,{className:"sr-only",children:o("signup"===c?"signUp.title":"signIn.title")}),"signup"===c&&!w&&s.jsxs(I.div,{className:"flex flex-col items-center text-center space-y-3",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[s.jsxs("div",{className:"relative w-16 h-16",children:[s.jsx("div",{className:"absolute inset-0 bg-[#61936f]/10 rounded-full animate-pulse"}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx(E,{className:"w-8 h-8 text-[#61936f]"})})]}),s.jsxs("h2",{className:"text-2xl font-bold text-[#1d1d1e] flex items-center gap-2",children:[i||o("signUp.title"),s.jsx(k,{className:"w-5 h-5 text-[#61936f] animate-bounce"})]}),s.jsx("p",{className:"text-[#62626a] max-w-sm",children:l||o("signUp.subtitle")}),s.jsxs("div",{className:"flex items-center gap-3 text-sm text-[#62626a]",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(U,{className:"w-4 h-4"}),s.jsx("span",{children:o("signUp.features.globalCommunity")})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(C,{className:"w-4 h-4"}),s.jsx("span",{children:o("signUp.features.amazingAdventures")})]})]})]})]}),w?s.jsx(z,{onSuccess:A}):s.jsxs(g,{defaultValue:n,value:c,onValueChange:d,className:"w-full",children:[s.jsxs(v,{className:"grid w-full grid-cols-2 z-[111]",children:[s.jsx(f,{id:"signin-tab",value:"signin",className:"data-[state=active]:bg-white data-[state=active]:text-[#1d1d1e]",children:o("signIn.title")}),s.jsx(f,{id:"signup-tab",value:"signup",className:"data-[state=active]:bg-white data-[state=active]:text-[#1d1d1e]",children:o("signUp.title")})]}),s.jsx(F,{mode:"wait",children:s.jsxs(I.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"z-[112]",children:[s.jsx(j,{value:"signin",className:"mt-4",children:s.jsx(B,{email:y,setEmail:S,password:P,setPassword:q,onForgotPassword:()=>{N(!0)},onSuccess:A,errorMessage:M,setErrorMessage:R})}),s.jsx(j,{value:"signup",className:"mt-4",children:s.jsx(D,{email:y,setEmail:S,password:P,setPassword:q,errorMessage:M,setErrorMessage:R,onSuccess:A})})]},c)})]})]})]})}export{A,B as L,z as R,D as S};
//# sourceMappingURL=components-auth.B-7euJmi.js.map
