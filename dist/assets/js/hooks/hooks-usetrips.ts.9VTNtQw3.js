import{r as t}from"../vendor/vendor-react-core.D1hcyiwY.js";import{s as r}from"../components/components-admin.CiIAoamg.js";import{u as e}from"./hooks-use-toast.ts.Dg8obzHg.js";import{c as a,C as s,g as o,t as i}from"../utils/utils-cache.ts.BtmNadnX.js";function n(){const[n,c]=t.useState([]),[d,p]=t.useState(!1);e();const u=async t=>{try{p(!0);const e=await o(i,`trips-${t}`,(async()=>{const{data:e,error:a}=await r.from("trips").select("*").eq("user_id",t).order("created_at",{ascending:!1});if(a)throw a;const{data:s,error:o}=await r.from("zapout_data").select("*").eq("user_id",t).order("created_at",{ascending:!1});if(o)throw o;const{data:i,error:n}=await r.from("zaproad_data").select("*").eq("user_id",t).order("created_at",{ascending:!1});if(n)throw n;const c=(s||[]).map((t=>({...t,trip_type:"ZapOut"}))),d=(i||[]).map((t=>({...t,trip_type:"ZapRoad"}))),p=[...(e||[]).map((t=>({...t,trip_type:"ZapTrip"}))),...c,...d];return p.sort(((t,r)=>{const e=new Date(t.created_at);return new Date(r.created_at).getTime()-e.getTime()})),p}),{ttl:3e5});return c(e),e}catch(e){return c([]),[]}finally{p(!1)}},f=async t=>{const r=await o(i,`trips-${t}`,(()=>u(t)),{force:!0});return c(r),r};return t.useEffect((()=>{const t=a.subscribe(s.TRIP_CREATED,(async()=>{try{const{data:{user:t}}=await r.auth.getUser();t&&await f(t.id)}catch(t){}})),e=a.subscribe(s.TRIP_DELETED,(async()=>{try{const{data:{user:t}}=await r.auth.getUser();t&&await f(t.id)}catch(t){}}));return()=>{t(),e()}}),[]),{trips:n,loading:d,getTrips:u,refreshTrips:f,deleteTrip:async t=>{try{const e=n.find((r=>r.id===t));if(!e)throw new Error("Trip not found");if("ZapOut"===e.trip_type){const{error:e}=await r.from("zapout_data").delete().eq("id",t);if(e)throw e}else if("ZapRoad"===e.trip_type){const{error:e}=await r.from("zaproad_data").delete().eq("id",t);if(e)throw e}else{const{error:e}=await r.from("trips").delete().eq("id",t);if(e)throw e}const a=e.user_id;return i.delete(`trips-${a}`),c((r=>r.filter((r=>r.id!==t)))),!0}catch(e){throw e}}}}export{n as u};
//# sourceMappingURL=hooks-usetrips.ts.9VTNtQw3.js.map
