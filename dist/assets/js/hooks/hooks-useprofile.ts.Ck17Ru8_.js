import{r as e}from"../vendor/vendor-react-core.D1hcyiwY.js";import{s as t}from"../components/components-admin.CiIAoamg.js";import{u as r}from"./hooks-use-toast.ts.Dg8obzHg.js";import{g as a,u as s}from"../utils/utils-cache.ts.BtmNadnX.js";import{u as i}from"../vendor/vendor--react-i18next.DhHVfoav.js";import{u as o}from"../vendor/vendor--react-router.Gdfmkz0l.js";function n(){const n=o();r();const{t:l}=i("profile"),[c,u]=e.useState(!0),[d,f]=e.useState(null),[m,p]=e.useState(void 0),[h,w]=e.useState(!1);e.useEffect((()=>{(async()=>{try{const{data:{session:e}}=await t.auth.getSession();e?.user?.email_confirmed_at&&e?.user?.new_email&&w(!0)}catch(e){}})()}),[]);const g=async()=>{try{u(!0);const{data:{user:e}}=await t.auth.getUser();if(!e)return void n("/auth");const r=await a(s,`profile-${e.id}`,(async()=>{const{data:r,error:a}=await t.from("profiles").select("*").eq("id",e.id).maybeSingle();if(a)throw a;return r?{...r,medical_conditions:r.medical_conditions||[],dietary_preferences:r.dietary_preferences||[],disabilities:r.disabilities||[],allergies:r.allergies||[],lgbtq_status:r.lgbtq_status||[],language:r.language||"en",newsletter_subscribed:r.newsletter_subscribed??!0,email:r.email||e.email}:null}),{ttl:9e5});if(r&&(f(r),r.birth_date)){const[e,t,a]=r.birth_date.split("-").map(Number);p(new Date(e,t-1,a))}}catch(e){throw e}finally{u(!1)}};return e.useEffect((()=>{g()}),[]),{profile:d,setProfile:f,loading:c,date:m,setDate:p,updateProfile:async e=>{try{u(!0);const{data:{user:r}}=await t.auth.getUser();if(!r)throw new Error("No user found");const{error:a}=await t.from("profiles").update(e).eq("id",r.id);if(a)throw a;return s.delete(`profile-${r.id}`),await g(),!0}catch(r){throw r}finally{u(!1)}},emailChangeInProgress:h}}export{n as u};
//# sourceMappingURL=hooks-useprofile.ts.Ck17Ru8_.js.map
