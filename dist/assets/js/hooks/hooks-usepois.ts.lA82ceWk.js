import{r as e}from"../vendor/vendor-react-core.D1hcyiwY.js";import{s as t}from"../components/components-admin.CiIAoamg.js";const r=()=>{const[r,a]=e.useState([]),[o,i]=e.useState(!0),[n,s]=e.useState(null),_=async()=>{try{i(!0),s(null);const{data:e,error:r}=await t.from("pois").select("\n          *,\n          poi_categories!poi_category_id (\n            name,\n            image_url\n          ),\n          poi_reviews (\n            rating,\n            rating_type\n          )\n        ").order("created_at",{ascending:!1});if(r)throw r;const o=(e||[]).map((e=>{let t,r=0,a=0;if(e.poi_reviews&&e.poi_reviews.length>0){const o={out_of_10:0,out_of_5:0,percentage:0};e.poi_reviews.forEach((e=>{o[e.rating_type]++}));const i=Math.max(o.out_of_10,o.out_of_5,o.percentage);t=o.out_of_10===i?"out_of_10":o.out_of_5===i?"out_of_5":"percentage";const n=e.poi_reviews.filter((e=>e.rating_type===t));if(n.length>0){r=n.reduce(((e,t)=>e+t.rating),0)/n.length}a=e.poi_reviews.length}return{id:e.id,name:e.name,url:e.url,description:e.description,address:e.address,lat:e.lat,lng:e.lng,categories:e.categories||[],poi_category_id:e.poi_category_id,created_at:e.created_at,updated_at:e.updated_at,category_name:e.poi_categories?.name,category_image_url:e.poi_categories?.image_url,average_rating:r,review_count:a,rating_type:t}}));a(o)}catch(e){s(e instanceof Error?e.message:"Failed to fetch POIs")}finally{i(!1)}};return e.useEffect((()=>{_()}),[]),{pois:r,loading:o,error:n,fetchPOIs:_,fetchPOIReviews:async e=>{try{const{data:r,error:a}=await t.from("poi_reviews").select("*").eq("poi_id",e).order("created_at",{ascending:!1});if(a)throw a;return r||[]}catch(r){return[]}},addPOIReview:async(e,r,a)=>{try{const{data:{user:o}}=await t.auth.getUser();if(!o)throw new Error("User not authenticated");const{error:i}=await t.from("poi_reviews").upsert({poi_id:e,user_id:o.id,rating:r,rating_type:"out_of_10",notes:a});if(i)throw i;return await _(),!0}catch(o){throw o}}}};export{r as u};
//# sourceMappingURL=hooks-usepois.ts.lA82ceWk.js.map
