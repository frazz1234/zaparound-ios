import{a as t}from"../vendor/vendor-query-main.DFU6mXji.js";import{u as e}from"./hooks-use-toast.ts.Dg8obzHg.js";import{s as o}from"../components/components-admin.CiIAoamg.js";import{c as r,C as s,S as a}from"../utils/utils-blogutils.ts.CpQs8y27.js";import{g as n,b as i}from"../utils/utils-cache.ts.BtmNadnX.js";const l=(r=1,l=9,c="en")=>{const{toast:u}=e();return t({queryKey:["blogs",r,l,c],queryFn:async()=>{try{const t=await n(i,`blogs-${c}-${r}-${l}`,(async()=>{const t=await async function(t=1,e=10){const r=(t-1)*e,s=r+e-1;try{const{data:t,error:n,count:i}=await o.from("blogs").select("*",{count:"exact"}).eq("is_published",!0).order("published_at",{ascending:!1}).range(r,s);if(n){if("406"===n.code||n.message?.includes("406")){const t=await o.from("blogs").select("id, title_en, created_at").eq("is_published",!0).limit(e);if(!t.error&&t.data)return{blogs:t.data||[],count:t.data.length,totalPages:1}}throw{message:"Failed to fetch blog posts",details:n,supabaseError:!0}}try{localStorage.setItem("blogs-cache",JSON.stringify({blogs:t||[],count:i||0,totalPages:Math.ceil((i||0)/e),timestamp:Date.now()}))}catch(a){}return{blogs:t||[],count:i||0,totalPages:Math.ceil((i||0)/e)}}catch(n){try{const t=localStorage.getItem("blogs-cache");if(t){const e=JSON.parse(t);if(e.timestamp&&Date.now()-e.timestamp<36e5)return e}}catch(a){}return{blogs:[],count:0,totalPages:0,error:n}}}(r,l);if(t.error)throw t.error;return t}),{ttl:a});return t.blogs.length,t}catch(t){throw"406"===t?.code||t?.message?.includes("406")||"406"===t?.details?.code||t?.details?.message?.includes("406")?u({title:"API Compatibility Issue",description:"There's a compatibility issue with the blog service. Our team has been notified.",variant:"destructive"}):u({title:"Error loading blog posts",description:"Please try again later. If the problem persists, contact support.",variant:"destructive"}),t}},staleTime:a,gcTime:s,refetchOnWindowFocus:!1,retry:3})},c=()=>{const t=(new Date).toISOString();return{id:"not-found",title_en:"Blog Not Found",title_fr:"Blog Non Trouvé",title_es:"Blog No Encontrado",content_en:"The blog post you are looking for could not be found.",content_fr:"L'article de blog que vous recherchez est introuvable.",content_es:"La entrada de blog que estás buscando no se pudo encontrar.",excerpt_en:"Not found",excerpt_fr:"Non trouvé",excerpt_es:"No encontrado",image_url:null,author_id:"system",category:null,created_at:t,updated_at:t,published_at:null,parent_id:null,notFound:!0}},u=n=>{const{toast:i}=e();return t({queryKey:["blog",n],queryFn:async()=>{try{const t=await async function(t){if(!t||"string"!=typeof t)return null;const e=t.trim().toLowerCase();try{const{data:t,error:a}=await o.from("blogs").select("*").eq("is_published",!0);if(t&&t.length,a)throw{message:"Failed to fetch blog posts",details:a,supabaseError:!0};if(t&&t.length>0){const o=t.find((t=>t.id===e));if(o)return o;const a=t.find((t=>!!t.title_en&&r(t.title_en)===e));if(a){try{const t=`blog-${e}`;localStorage.setItem(t,JSON.stringify({blog:a,timestamp:Date.now()}))}catch(s){}return a}const n=t.find((t=>!!t.title_en&&t.title_en.toLowerCase().includes(e.replace(/-/g," "))));if(n)return n}return null}catch(a){if("PGRST116"===a.details?.code||a.details?.message?.includes("JSON object requested, multiple (or no) rows returned")||a.message?.includes("JSON object requested, multiple (or no) rows returned"))return null;try{const t=`blog-${e}`,o=localStorage.getItem(t);if(o){const t=JSON.parse(o);if(t.timestamp&&Date.now()-t.timestamp<36e5)return t.blog}}catch(s){}throw a}}(n);return null===t?(i({title:"Blog not found",description:"The blog post you're looking for doesn't exist or has been removed.",variant:"destructive"}),c()):t}catch(t){if("PGRST116"===t?.code||t?.message?.includes("JSON object requested, multiple (or no) rows returned")||"PGRST116"===t?.details?.code||t?.details?.message?.includes("JSON object requested, multiple (or no) rows returned"))return i({title:"Blog not found",description:"The blog post you're looking for doesn't exist or has been removed.",variant:"destructive"}),c();throw"406"===t?.code||t?.message?.includes("406")||"406"===t?.details?.code||t?.details?.message?.includes("406")?i({title:"API Compatibility Issue",description:"There's a compatibility issue with the blog service. Our team has been notified.",variant:"destructive"}):i({title:"Error loading blog post",description:"Please try again later. If the problem persists, contact support.",variant:"destructive"}),t}},staleTime:a,gcTime:s,refetchOnWindowFocus:!1,enabled:!!n,retry:3,retryDelay:t=>Math.min(1e3*2**t,1e4)})},d=(r,l=1,c=9,u={})=>{const{toast:d}=e(),{enabled:g,...m}=u,p=void 0!==g?Boolean(g):Boolean(r&&""!==r.trim());return t({queryKey:["blogs","category",r,l,c],queryFn:async()=>{if(!r||""===r)return{blogs:[],count:0,totalPages:0};try{const t=await n(i,`blogs-category-${r}-${l}-${c}`,(async()=>{const t=await async function(t,e=1,r=10){if(!t||"string"!=typeof t)return{blogs:[],count:0,totalPages:0,error:"Invalid category"};const s=(e-1)*r,a=s+r-1,n=t.trim().toLowerCase(),i=`blogs-category-${n}-page-${e}-limit-${r}`;try{const{data:t,error:e,count:c}=await o.from("blogs").select("*",{count:"exact"}).ilike("category",`%${n}%`).order("published_at",{ascending:!1}).range(s,a);if(e){if("406"===e.code||e.message?.includes("406")){const t=await o.from("blogs").select("id, title_en, created_at, category").ilike("category",`%${n}%`).limit(r);if(!t.error&&t.data){try{localStorage.setItem(i,JSON.stringify({blogs:t.data,count:t.data.length,totalPages:1,timestamp:Date.now()}))}catch(l){}return{blogs:t.data,count:t.data.length,totalPages:1}}}throw e}const u={blogs:t||[],count:c||0,totalPages:Math.ceil((c||0)/r)};try{localStorage.setItem(i,JSON.stringify({...u,timestamp:Date.now()}))}catch(l){}return u}catch(c){try{const t=localStorage.getItem(i);if(t){const e=JSON.parse(t);if(e.timestamp&&Date.now()-e.timestamp<36e5)return e}}catch(l){}return{blogs:[],count:0,totalPages:0,error:c}}}(r,l,c);if(t.error)throw t.error;return t}),{ttl:a});return t}catch(t){throw d({title:"Error loading blog posts",description:"Please try again later. If the problem persists, contact support.",variant:"destructive"}),t}},staleTime:a,gcTime:s,refetchOnWindowFocus:!1,retry:2,enabled:p,...m})};export{d as a,u as b,l as u};
//# sourceMappingURL=hooks-useblogs.ts.B-jKAetY.js.map
