import{r as e}from"../vendor/vendor-react-core.D1hcyiwY.js";import{m as r}from"../vendor/vendor--mapbox-gl.CIg18VY7.js";const t=()=>{const t=e.useRef(new Map),a=e.useRef(""),o=e.useCallback((e=>`${e.style}-${e.showTerrain?"terrain":"no-terrain"}-${e.isMobile?"mobile":"desktop"}`),[]),n=e.useCallback((e=>{if(!e.container)return null;const n=o(e);a.current=n;const s=t.current.get(n);if(s&&s.map&&!s.map._removed){s.map.getContainer()!==e.container&&(s.map.getContainer().removeChild(s.map.getCanvas()),e.container.appendChild(s.map.getCanvas()));const r=s.map.getCenter(),t=s.map.getZoom();return(r.lng!==e.center[0]||r.lat!==e.center[1]||Math.abs(t-e.zoom)>.1)&&(s.map.setCenter(e.center),s.map.setZoom(e.zoom),void 0!==e.pitch&&s.map.setPitch(e.pitch),void 0!==e.bearing&&s.map.setBearing(e.bearing)),s.map}r.accessToken="pk.eyJ1IjoibWlzdGVyZnJhenoiLCJhIjoiY203M2ZnM3BoMDhpMTJqcTNiYWpkamIzNyJ9.2SlcuEPIL2yCJw5TIPunVQ";const l=new r.Map({container:e.container,style:e.style,center:e.center,zoom:e.zoom,pitch:e.pitch||60,bearing:e.bearing||0,attributionControl:!1,preserveDrawingBuffer:!1,antialias:!1,fadeDuration:0,crossSourceCollisions:!1}),c={map:l,style:e.style,isInitialized:!1,markers:[],sources:["route"],layers:[]};return t.current.set(n,c),(async()=>{await new Promise((t=>{const a=()=>{document.querySelectorAll(".mapboxgl-ctrl-group, .mapboxgl-ctrl-attrib").forEach((e=>e.remove()));const o=new r.NavigationControl({showCompass:!e.isMobile,visualizePitch:!e.isMobile});l.addControl(o,"top-right"),l.addControl(new r.FullscreenControl,"top-right"),l.addControl(new r.AttributionControl({compact:!0}),"bottom-right"),e.showTerrain&&i(l),l.getSource("route")||l.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}}}),l.off("style.load",a),t()};l.on("style.load",a)}))})().then((()=>{c.isInitialized=!0})),l}),[o]),i=e.useCallback((e=>{e.getSource("mapbox-dem")||(e.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),e.setTerrain({source:"mapbox-dem",exaggeration:1.5})),e.getLayer("sky")||e.addLayer({id:"sky",type:"sky",paint:{"sky-type":"atmosphere","sky-atmosphere-sun":[0,90],"sky-atmosphere-sun-intensity":15}});(e.getStyle().name||"").includes("satellite")||(!e.getLayer("water")&&e.getSource("mapbox")&&e.addLayer({id:"water",source:"mapbox","source-layer":"water",type:"fill",paint:{"fill-color":"#93c5fd","fill-opacity":.8}}),!e.getLayer("building")&&e.getSource("mapbox")&&e.addLayer({id:"building",source:"mapbox","source-layer":"building",type:"fill-extrusion",paint:{"fill-extrusion-color":"#9ca3af","fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","min_height"],"fill-extrusion-opacity":.6}}))}),[]),s=e.useCallback((e=>{const r=t.current.get(a.current);r&&(r.markers.forEach((e=>e.remove())),r.markers=e)}),[]),l=e.useCallback((e=>{const r=t.current.get(a.current);r&&r.map&&r.style!==e&&(r.map.setStyle(e),r.style=e,r.isInitialized=!1,r.map.once("style.load",(()=>{r.isInitialized=!0})))}),[]),c=e.useCallback((e=>{if(e){const r=t.current.get(e);r&&(r.markers.forEach((e=>e.remove())),r.map&&!r.map._removed&&r.map.remove(),t.current.delete(e))}else t.current.forEach((e=>{e.markers.forEach((e=>e.remove())),e.map&&!e.map._removed&&e.map.remove()})),t.current.clear()}),[]),m=e.useCallback((()=>({size:t.current.size,keys:Array.from(t.current.keys()),currentKey:a.current})),[]);return e.useEffect((()=>()=>{c()}),[c]),{getOrCreateMap:n,cacheMarkers:s,updateMapStyle:l,clearCache:c,getCacheStats:m,addTerrainLayers:i}};export{t as u};
//# sourceMappingURL=hooks-usemapcache.ts.CTfbvRaB.js.map
