import{r as t}from"../vendor/vendor-react-core.D1hcyiwY.js";import{s as e}from"../components/components-admin.CiIAoamg.js";import{u as r}from"./hooks-use-toast.ts.Dg8obzHg.js";function s(){const[s,o]=t.useState(null),[a,n]=t.useState(!1),[i,c]=t.useState(null),{toast:p}=r();return t.useEffect((()=>{const{data:{authListener:t}}=e.auth.onAuthStateChange((t=>{"SIGNED_OUT"===t&&(sessionStorage.removeItem("passport_encryption_key"),o(null),c(null))}));return()=>{t?.subscription.unsubscribe()}}),[]),{passportData:s,loading:a,error:i,storePassportData:async t=>{try{n(!0),c(null);const{data:{session:r}}=await e.auth.getSession();if(!r)throw new Error("No active session");const s=`passport_${Date.now().toString()}_${Math.random().toString(36).substring(2)}`,{data:a,error:i}=await e.functions.invoke("secure-passport",{body:{action:"store",passportData:t,encryptionKey:s},headers:{Authorization:`Bearer ${r.access_token}`}});if(i)throw new Error(i.message);if(!a.success)throw new Error(a.error||"Failed to store passport data");return sessionStorage.setItem("passport_encryption_key",s),o(t),p({title:"Passport Data Stored",description:"Your passport information has been stored securely."}),!0}catch(r){const t=r instanceof Error?r.message:"Failed to store passport data";return c(t),p({title:"Error",description:t,variant:"destructive"}),!1}finally{n(!1)}},retrievePassportData:async()=>{try{n(!0),c(null);const{data:{session:t}}=await e.auth.getSession();if(!t)throw new Error("No active session");const r=sessionStorage.getItem("passport_encryption_key");if(!r)throw new Error("No encryption key found. Please store passport data first.");const{data:s,error:a}=await e.functions.invoke("secure-passport",{body:{action:"retrieve",encryptionKey:r},headers:{Authorization:`Bearer ${t.access_token}`}});if(a)throw new Error(a.message);if(!s.success)throw new Error(s.error||"Failed to retrieve passport data");return s.passport_data?o(s.passport_data):o(null),!0}catch(t){const e=t instanceof Error?t.message:"Failed to retrieve passport data";return c(e),p({title:"Error",description:e,variant:"destructive"}),!1}finally{n(!1)}},deletePassportData:async()=>{try{n(!0),c(null);const{data:{session:t}}=await e.auth.getSession();if(!t)throw new Error("No active session");const{data:r,error:s}=await e.functions.invoke("secure-passport",{body:{action:"delete"},headers:{Authorization:`Bearer ${t.access_token}`}});if(s)throw new Error(s.message);if(!r.success)throw new Error(r.error||"Failed to delete passport data");return sessionStorage.removeItem("passport_encryption_key"),o(null),p({title:"Passport Data Deleted",description:"Your passport information has been deleted securely."}),!0}catch(t){const e=t instanceof Error?t.message:"Failed to delete passport data";return c(e),p({title:"Error",description:e,variant:"destructive"}),!1}finally{n(!1)}},clearError:()=>c(null)}}export{s as u};
//# sourceMappingURL=hooks-usesecurepassport.ts.Dh9bJBHw.js.map
