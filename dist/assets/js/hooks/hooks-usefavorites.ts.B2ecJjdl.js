import{r as e}from"../vendor/vendor-react-core.D1hcyiwY.js";import{s as t}from"../components/components-admin.CiIAoamg.js";import{u as r}from"./hooks-use-toast.ts.Dg8obzHg.js";import{c as a,C as i,a as s}from"../utils/utils-cache.ts.BtmNadnX.js";function o(){const[o,c]=e.useState([]),[d,n]=e.useState(!1),[u,l]=e.useState(null),{toast:f}=r(),v=e.useCallback((async()=>{try{n(!0),l(null);const{data:{user:e}}=await t.auth.getUser();if(!e)return void c([]);const{data:r,error:a}=await t.from("favorites").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(a)throw a;c(r||[])}catch(e){l(e.message||"Failed to fetch favorites"),f({title:"Error",description:"Failed to load favorites. Please try again.",variant:"destructive"})}finally{n(!1)}}),[f]),m=e.useCallback((async e=>{try{const{data:{user:r}}=await t.auth.getUser();if(!r)return f({title:"Login Required",description:"Please log in to save favorites.",variant:"destructive"}),!1;const{data:o,error:d}=await t.from("favorites").insert([{user_id:r.id,...e}]).select().single();if(d)throw d;return c((e=>[o,...e])),a.emit(i.FAVORITE_ADDED),await s(r.id),f({title:"Added to Favorites",description:"Place added to your favorites."}),!0}catch(r){return f({title:"Error",description:"Failed to add favorite.",variant:"destructive"}),!1}}),[f]),E=e.useCallback((async e=>{try{const{data:{user:r}}=await t.auth.getUser();if(!r)return!1;const{error:o}=await t.from("favorites").delete().eq("id",e);if(o)throw o;return c((t=>t.filter((t=>t.id!==e)))),a.emit(i.FAVORITE_REMOVED),await s(r.id),f({title:"Removed from Favorites",description:"Place removed from your favorites."}),!0}catch(r){return f({title:"Error",description:"Failed to remove favorite.",variant:"destructive"}),!1}}),[f]),p=e.useCallback((e=>o.some((t=>t.place_id===e))),[o]),F=e.useCallback((async e=>{const t=o.find((t=>t.place_id===e.place_id));return t?await E(t.id):await m(e)}),[o,m,E]);return e.useEffect((()=>{const e=a.subscribe(i.FAVORITE_ADDED,(()=>{v()})),t=a.subscribe(i.FAVORITE_REMOVED,(()=>{v()})),r=a.subscribe(i.FAVORITES_INVALIDATED,(()=>{v()}));return()=>{e(),t(),r()}}),[v]),e.useEffect((()=>{v()}),[v]),{favorites:o,loading:d,error:u,addFavorite:m,removeFavorite:E,toggleFavorite:F,isFavorited:p,refreshFavorites:v}}export{o as u};
//# sourceMappingURL=hooks-usefavorites.ts.B2ecJjdl.js.map
