const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/vendor/vendor-supabase-other.BhmW1H_P.js","assets/js/components/components-mobilenavigation.tsx.DtMtI5i3.js","assets/js/vendor/vendor-react-core.D1hcyiwY.js","assets/js/vendor/vendor--cookie.D-6orQ43.js","assets/js/components/components-languagerouter.tsx.CHVsY7fH.js","assets/js/vendor/vendor--i18next.CHTa0CEF.js","assets/js/vendor/vendor--i18next-browser-languagedetector.h4x3AYwK.js","assets/js/vendor/vendor--i18next-http-backend.DjHzioAf.js","assets/js/vendor/vendor--react-i18next.DhHVfoav.js","assets/js/vendor/vendor--react-router.Gdfmkz0l.js","assets/js/vendor/vendor-react-dom.BnDkh-2X.js","assets/js/vendor/vendor-react-scheduler.B5Ht9ZB3.js","assets/js/components/components-ui.C8hnNhgu.js","assets/js/hooks/hooks-use-toast.ts.Dg8obzHg.js","assets/js/vendor/vendor-ui-toast.CyvsGWN1.js","assets/js/vendor/vendor-ui-core.CPnW5LH0.js","assets/js/vendor/vendor--aria-hidden.BHUiN-rI.js","assets/js/vendor/vendor--react-remove-scroll.DR6iVcCg.js","assets/js/vendor/vendor--tslib.Bc9CN1Ef.js","assets/js/vendor/vendor--react-remove-scroll-bar.Dz-JErv0.js","assets/js/vendor/vendor--react-style-singleton.ER5nEGYx.js","assets/js/vendor/vendor--get-nonce.BYiZHLe3.js","assets/js/vendor/vendor--use-sidecar.svB0tWl8.js","assets/js/vendor/vendor--use-callback-ref.Dt9orvWx.js","assets/js/vendor/vendor---floating-ui-react-dom.gDT63CuY.js","assets/js/vendor/vendor---floating-ui-dom.CdGDzP9A.js","assets/js/vendor/vendor---floating-ui-core.D6mclMLM.js","assets/js/vendor/vendor---floating-ui-utils.D9HCu73I.js","assets/js/vendor/vendor-ui-dialog.CY7OxuK6.js","assets/js/vendor/vendor-ui-utils.CjDQ2U02.js","assets/js/components/components-blog.C3TFiFB1.js","assets/js/components/components-admin.CiIAoamg.js","assets/js/vendor/vendor--lucide-react.DRw9PYsu.js","assets/js/vendor/vendor--react-hook-form.C68mK_Ba.js","assets/js/vendor/vendor---hookform-resolvers.CwYzTTZs.js","assets/js/vendor/vendor--zod.Cebk8UiH.js","assets/js/vendor/vendor-supabase-client.BJD0U0P8.js","assets/js/vendor/vendor--sonner.ECaEf7Ie.js","assets/js/hooks/hooks-useadminauth.ts.BJ7uhFTt.js","assets/js/utils/utils-blogutils.ts.CpQs8y27.js","assets/js/utils/utils-cache.ts.BtmNadnX.js","assets/js/vendor/vendor--lru-cache.CYB7PIxo.js","assets/js/components/components-optimizedimage.tsx.DVN-Ynzu.js","assets/js/vendor/vendor--date-fns.BbAlDtqN.js","assets/js/hooks/hooks-useblogs.ts.B-jKAetY.js","assets/js/vendor/vendor-query-main.DFU6mXji.js","assets/js/vendor/vendor---tanstack-query-core.CIZi0Zbo.js","assets/js/vendor/vendor--lodash.D80NHDHN.js","assets/js/vendor/vendor--framer-motion.Dpgjd5L1.js","assets/js/vendor/vendor--motion-dom.C5KZPrWP.js","assets/js/vendor/vendor--motion-utils.DAP8mxSY.js","assets/js/vendor/vendor--react-markdown.C_e4o-CH.js","assets/js/vendor/vendor--devlop.Cl3hj7Sz.js","assets/js/vendor/vendor--unified.ti5-l0IV.js","assets/js/vendor/vendor--bail.gCPcOVbC.js","assets/js/vendor/vendor--extend.BFvm699q.js","assets/js/vendor/vendor--is-plain-obj.DeEdtHJQ.js","assets/js/vendor/vendor--trough.zzWXwSIo.js","assets/js/vendor/vendor--vfile.Cn6Vy3Ir.js","assets/js/vendor/vendor--vfile-message.Re42m5o3.js","assets/js/vendor/vendor--unist-util-stringify-position.CvSG9YTx.js","assets/js/vendor/vendor--remark-parse.DdoJrvcY.js","assets/js/vendor/vendor--mdast-util-from-markdown.DI8nvaYJ.js","assets/js/vendor/vendor--micromark-util-decode-numeric-character-reference.DA7xEauU.js","assets/js/vendor/vendor--micromark-util-decode-string.BCF2SQ7o.js","assets/js/vendor/vendor--decode-named-character-reference.C-EXV6yX.js","assets/js/vendor/vendor--micromark-util-normalize-identifier.CzKtq1sx.js","assets/js/vendor/vendor--micromark.aJPyxAJv.js","assets/js/vendor/vendor--micromark-util-combine-extensions.CQDa_SAq.js","assets/js/vendor/vendor--micromark-util-chunked.3k3e5hER.js","assets/js/vendor/vendor--micromark-factory-space.CZc9TqN4.js","assets/js/vendor/vendor--micromark-util-character.DUwsRT9L.js","assets/js/vendor/vendor--micromark-core-commonmark.yO25BTZZ.js","assets/js/vendor/vendor--micromark-util-classify-character.x6FlXUUS.js","assets/js/vendor/vendor--micromark-util-resolve-all.U8fstr8o.js","assets/js/vendor/vendor--micromark-util-subtokenize.BfHYzAYP.js","assets/js/vendor/vendor--micromark-factory-destination.pZKs7oL9.js","assets/js/vendor/vendor--micromark-factory-label.BbusvwMx.js","assets/js/vendor/vendor--micromark-factory-title.BBtcOUHM.js","assets/js/vendor/vendor--micromark-factory-whitespace.BhZ6YKME.js","assets/js/vendor/vendor--micromark-util-html-tag-name.DbKNfynz.js","assets/js/vendor/vendor--mdast-util-to-string.Ck87fAyN.js","assets/js/vendor/vendor--remark-rehype.B9Xnklpv.js","assets/js/vendor/vendor--mdast-util-to-hast.C2F2cLDR.js","assets/js/vendor/vendor---ungap-structured-clone.DadG6O39.js","assets/js/vendor/vendor--micromark-util-sanitize-uri.BXHzaaAi.js","assets/js/vendor/vendor--unist-util-position.CVUg9P9R.js","assets/js/vendor/vendor--trim-lines.C03Dth7Y.js","assets/js/vendor/vendor--unist-util-visit.41WSH7so.js","assets/js/vendor/vendor--unist-util-visit-parents.DAGCrDnu.js","assets/js/vendor/vendor--unist-util-is.C5Jwnfs7.js","assets/js/vendor/vendor--hast-util-to-jsx-runtime.BOWXXjuU.js","assets/js/vendor/vendor--comma-separated-tokens.DIu3lqJt.js","assets/js/vendor/vendor--property-information.Dc64tFtG.js","assets/js/vendor/vendor--space-separated-tokens.C97BfSlU.js","assets/js/vendor/vendor--style-to-js.DQsO4XA8.js","assets/js/vendor/vendor--style-to-object.DGZeIPGP.js","assets/js/vendor/vendor--inline-style-parser.BFz9PO4J.js","assets/js/vendor/vendor--hast-util-whitespace.DlJMGLAz.js","assets/js/vendor/vendor--estree-util-is-identifier-name.0h9-8Xae.js","assets/js/vendor/vendor--html-url-attributes.BA_i5Yxb.js","assets/js/vendor/vendor--react-helmet-async.BMUx00aU.js","assets/js/vendor/vendor--react-fast-compare.4d-J074I.js","assets/js/vendor/vendor--invariant.D6mx6rc7.js","assets/js/vendor/vendor--shallowequal.BwnEDCFe.js","assets/js/vendor/vendor--web-vitals.C1BoAgs7.js","assets/js/vendor/vendor-ui-tooltip.n7I39vTs.js","assets/js/vendor/vendor--embla-carousel-react.Bc6nB0ya.js","assets/js/vendor/vendor--embla-carousel-reactive-utils.BIRN7lq8.js","assets/js/vendor/vendor--embla-carousel.clUl8sxa.js","assets/js/vendor/vendor--cmdk.q6oiTfmV.js","assets/js/vendor/vendor--react-day-picker.D6HWAs9M.js","assets/js/hooks/hooks-useuserrole.ts.BKHSjdY6.js","assets/js/components/components-languageselector.tsx.x8buceJ0.js","assets/js/components/components-navigation.CB-8LlfF.js","assets/js/components/components-theme-toggle.tsx.CfzjOSrj.js","assets/js/components/components-theme-provider.tsx.Cd7zUHTE.js","assets/js/vendor/vendor--ws.BaDK4Exh.js"])))=>i.map(i=>d[i]);
import{_ as e}from"../components/components-mobilenavigation.tsx.DtMtI5i3.js";const t={"X-Client-Info":"realtime-js/2.11.2"};var s,i,n,r,o,a;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(s||(s={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(i||(i={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(n||(n={})),function(e){e.websocket="websocket"}(r||(r={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(o||(o={}));class c{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),n=t.getUint8(2);let r=this.HEADER_LENGTH+2;const o=s.decode(e.slice(r,r+i));r+=i;const a=s.decode(e.slice(r,r+n));r+=n;return{ref:null,topic:o,event:a,payload:JSON.parse(s.decode(e.slice(r,e.byteLength)))}}}class h{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(a||(a={}));const l=(e,t,s={})=>{var i;const n=null!==(i=s.skipTypes)&&void 0!==i?i:[];return Object.keys(t).reduce(((s,i)=>(s[i]=u(i,e,t,n),s)),{})},u=(e,t,s,i)=>{const n=t.find((t=>t.name===e)),r=null==n?void 0:n.type,o=s[e];return r&&!i.includes(r)?d(r,o):p(o)},d=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return g(t,s)}switch(e){case a.bool:return f(t);case a.float4:case a.float8:case a.int2:case a.int4:case a.int8:case a.numeric:case a.oid:return v(t);case a.json:case a.jsonb:return m(t);case a.timestamp:return _(t);case a.abstime:case a.date:case a.daterange:case a.int4range:case a.int8range:case a.money:case a.reltime:case a.text:case a.time:case a.timestamptz:case a.timetz:case a.tsrange:case a.tstzrange:default:return p(t)}},p=e=>e,f=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},v=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},m=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},g=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,i=e[s];if("{"===e[0]&&"}"===i){let i;const r=e.slice(1,s);try{i=JSON.parse("["+r+"]")}catch(n){i=r?r.split(","):[]}return i.map((e=>d(t,e)))}return e},_=e=>"string"==typeof e?e.replace(" ","T"):e,b=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class k{constructor(e,t,s={},i=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var y,E,T,j;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(y||(y={}));class w{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},(e=>{const{onJoin:t,onLeave:s,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=w.syncState(this.state,e,t,s),this.pendingDiffs.forEach((e=>{this.state=w.syncDiff(this.state,e,t,s)})),this.pendingDiffs=[],i()})),this.channel._on(s.diff,{},(e=>{const{onJoin:t,onLeave:s,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=w.syncDiff(this.state,e,t,s),i())})),this.onJoin(((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})})),this.onLeave(((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,s,i){const n=this.cloneDeep(e),r=this.transformState(t),o={},a={};return this.map(n,((e,t)=>{r[e]||(a[e]=t)})),this.map(r,((e,t)=>{const s=n[e];if(s){const i=t.map((e=>e.presence_ref)),n=s.map((e=>e.presence_ref)),r=t.filter((e=>n.indexOf(e.presence_ref)<0)),c=s.filter((e=>i.indexOf(e.presence_ref)<0));r.length>0&&(o[e]=r),c.length>0&&(a[e]=c)}else o[e]=t})),this.syncDiff(n,{joins:o,leaves:a},s,i)}static syncDiff(e,t,s,i){const{joins:n,leaves:r}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(n,((t,i)=>{var n;const r=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(i),r.length>0){const s=e[t].map((e=>e.presence_ref)),i=r.filter((e=>s.indexOf(e.presence_ref)<0));e[t].unshift(...i)}s(t,r,i)})),this.map(r,((t,s)=>{let n=e[t];if(!n)return;const r=s.map((e=>e.presence_ref));n=n.filter((e=>r.indexOf(e.presence_ref)<0)),e[t]=n,i(t,n,s),0===n.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((s=>t(s,e[s])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,s)=>{const i=e[s];return t[s]="metas"in i?i.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):i,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(E||(E={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(T||(T={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(j||(j={}));class R{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=i.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new k(this,n.join,this.params,this.timeout),this.rejoinTimer=new h((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=i.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=i.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=i.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=i.errored,this.rejoinTimer.scheduleTimeout())})),this._on(n.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new w(this),this.broadcastEndpointURL=b(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:r,private:o}}=this.params;this._onError((t=>null==e?void 0:e(j.CHANNEL_ERROR,t))),this._onClose((()=>null==e?void 0:e(j.CLOSED)));const a={},c={broadcast:n,presence:r,postgres_changes:null!==(i=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map((e=>e.filter)))&&void 0!==i?i:[],private:o};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const i=this.bindings.postgres_changes,n=null!==(s=null==i?void 0:i.length)&&void 0!==s?s:0,r=[];for(let s=0;s<n;s++){const n=i[s],{filter:{event:o,schema:a,table:c,filter:h}}=n,l=t&&t[s];if(!l||l.event!==o||l.schema!==a||l.table!==c||l.filter!==h)return this.unsubscribe(),void(null==e||e(j.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));r.push(Object.assign(Object.assign({},n),{id:l.id}))}return this.bindings.postgres_changes=r,void(e&&e(j.SUBSCRIBED))}null==e||e(j.SUBSCRIBED)})).receive("error",(t=>{null==e||e(j.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{null==e||e(j.TIMED_OUT)}))}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(this._canPush()||"broadcast"!==e.type)return new Promise((s=>{var i,n,r;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(r=null===(n=null===(i=this.params)||void 0===i?void 0:i.config)||void 0===n?void 0:n.broadcast)||void 0===r?void 0:r.ack)||s("ok"),o.receive("ok",(()=>s("ok"))),o.receive("error",(()=>s("error"))),o.receive("timeout",(()=>s("timed out")))}));{const{event:r,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(i=e.body)||void 0===i?void 0:i.cancel()),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=i.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(n.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((s=>{const i=new k(this,n.leave,{},e);i.receive("ok",(()=>{t(),s("ok")})).receive("timeout",(()=>{t(),s("timed out")})).receive("error",(()=>{s("error")})),i.send(),this._canPush()||i.trigger("ok",{})}))}async _fetchWithTimeout(e,t,s){const i=new AbortController,n=setTimeout((()=>i.abort()),s),r=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),r}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new k(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,r;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:h,join:l}=n;if(s&&[a,c,h,l].indexOf(o)>=0&&s!==this._joinRef())return;let u=this._onMessage(o,t,s);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?null===(i=this.bindings.postgres_changes)||void 0===i||i.filter((e=>{var t,s,i;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(i=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===i?void 0:i.toLocaleLowerCase())===o})).map((e=>e.callback(u,s))):null===(r=this.bindings[o])||void 0===r||r.filter((e=>{var s,i,n,r,a,c;if(["broadcast","presence","postgres_changes"].includes(o)){if("id"in e){const r=e.id,o=null===(s=e.filter)||void 0===s?void 0:s.event;return r&&(null===(i=t.ids)||void 0===i?void 0:i.includes(r))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const s=null===(a=null===(r=null==e?void 0:e.filter)||void 0===r?void 0:r.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===s||s===(null===(c=null==t?void 0:t.event)||void 0===c?void 0:c.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===o})).map((e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:s,commit_timestamp:i,type:n,errors:r}=e,o={schema:t,table:s,commit_timestamp:i,eventType:n,new:{},old:{},errors:r};u=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(u,s)}))}_isClosed(){return this.state===i.closed}_isJoined(){return this.state===i.joined}_isJoining(){return this.state===i.joining}_isLeaving(){return this.state===i.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter((e=>{var i;return!((null===(i=e.type)||void 0===i?void 0:i.toLocaleLowerCase())===s&&R.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(n.close,{},e)}_onError(e){this._on(n.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=i.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=l(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=l(e.columns,e.old_record)),t}}const C=()=>{},O="undefined"!=typeof WebSocket;class L{constructor(s,i){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=t,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=C,this.conn=null,this.sendBuffer=[],this.serializer=new c,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=t=>{let s;return s=t||("undefined"==typeof fetch?(...t)=>e((async()=>{const{default:e}=await import("./vendor-supabase-other.BhmW1H_P.js").then((e=>e.b));return{default:e}}),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116])).then((({default:e})=>e(...t))):fetch),(...e)=>s(...e)},this.endPoint=`${s}/${r.websocket}`,this.httpEndpoint=b(s),(null==i?void 0:i.transport)?this.transport=i.transport:this.transport=null,(null==i?void 0:i.params)&&(this.params=i.params),(null==i?void 0:i.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),i.headers)),(null==i?void 0:i.timeout)&&(this.timeout=i.timeout),(null==i?void 0:i.logger)&&(this.logger=i.logger),(null==i?void 0:i.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=i.heartbeatIntervalMs);const o=null===(n=null==i?void 0:i.params)||void 0===n?void 0:n.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=(null==i?void 0:i.reconnectAfterMs)?i.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==i?void 0:i.encode)?i.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==i?void 0:i.decode)?i.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new h((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==i?void 0:i.fetch),null==i?void 0:i.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==i?void 0:i.worker)||!1,this.workerUrl=null==i?void 0:i.workerUrl}this.accessToken=(null==i?void 0:i.accessToken)||null}connect(){if(!this.conn)if(this.transport)this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});else{if(O)return this.conn=new WebSocket(this.endpointURL()),void this.setupConnection();this.conn=new S(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),e((async()=>{const{default:e}=await import("./vendor--ws.BaDK4Exh.js").then((e=>e.b));return{default:e}}),__vite__mapDeps([117,3])).then((({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()}))}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map((e=>e.unsubscribe())));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case s.connecting:return o.Connecting;case s.open:return o.Open;case s.closing:return o.Closing;default:return o.Closed}}isConnected(){return this.connectionState()===o.Open}channel(e,t={config:{}}){const s=new R(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:i,ref:n}=e,r=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${s} (${n})`,i),this.isConnected()?r():this.sendBuffer.push(r)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let e=null;try{e=JSON.parse(atob(t.split(".")[1]))}catch(s){}if(e&&e.exp){if(!(Math.floor(Date.now()/1e3)-e.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`)}this.accessTokenValue=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t}),e.joinedOnce&&e._isJoined()&&e._push(n.access_token,{access_token:t})}))}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t._joinRef()!==e._joinRef()))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:s,payload:i,ref:n}=e;n&&n===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${t} ${s} ${n&&"("+n+")"||""}`,i),this.channels.filter((e=>e._isMember(t))).forEach((e=>e._trigger(s,i,n))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(n.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class S{constructor(e,t,i){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=s.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=i.close}}export{L as R};
//# sourceMappingURL=vendor-supabase-realtime.PMyDaGD3.js.map
